const crypto = require('crypto');
const cookie = require('cookie');

const SESSION_SECRET = process.env.SESSION_SECRET || 'drixl-default-secret-change-me';
const COOKIE_NAME = 'drixl_session';
const SESSION_DAYS = 30;

function verifyToken(token) {
  if (!token) return false;
  const parts = token.split(':');
  if (parts.length !== 3) return false;
  const [status, expires, sig] = parts;
  const payload = `${status}:${expires}`;
  const expected = crypto.createHmac('sha256', SESSION_SECRET).update(payload).digest('hex');
  if (sig !== expected) return false;
  if (Date.now() > parseInt(expires)) return false;
  return true;
}

function getLoginPage(error) {
  return `<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Drixl Transporte – Login</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: #0a1018; color: #c8d2dc; font-family: 'DM Sans', sans-serif;
    min-height: 100vh; display: flex; align-items: center; justify-content: center; }
  .login-box { width: 100%; max-width: 380px; padding: 20px; }
  .logo { text-align: center; margin-bottom: 40px; }
  .logo-sub { font-size: 11px; font-weight: 600; letter-spacing: 0.14em; text-transform: uppercase;
    color: #2a6f4e; font-family: 'JetBrains Mono', monospace; margin-bottom: 6px; }
  .logo h1 { font-size: 26px; font-weight: 700; color: #e8edf2; }
  .card { background: #111820; border: 1px solid #1a2332; border-radius: 16px; padding: 32px 28px; }
  .card-title { font-size: 14px; font-weight: 600; color: #8a9aaa; margin-bottom: 24px; text-align: center; }
  .field { margin-bottom: 20px; }
  .field label { display: block; font-size: 11px; font-weight: 600; letter-spacing: 0.08em;
    text-transform: uppercase; color: #5a6a7a; font-family: 'JetBrains Mono', monospace; margin-bottom: 8px; }
  .field input { width: 100%; background: #0a1018; border: 1px solid #1a2332; color: #e8edf2;
    font-family: 'JetBrains Mono', monospace; font-size: 14px; padding: 12px 16px; border-radius: 8px;
    outline: none; transition: border 0.2s; }
  .field input:focus { border-color: #2a6f4e; }
  .btn { width: 100%; padding: 12px; border-radius: 8px; border: none; cursor: pointer;
    font-size: 14px; font-weight: 700; font-family: 'JetBrains Mono', monospace;
    background: linear-gradient(135deg, #2a6f4e, #4ecdc4); color: #0a1018;
    transition: all 0.2s; letter-spacing: 0.04em; }
  .btn:hover { transform: translateY(-1px); box-shadow: 0 4px 20px rgba(78,205,196,0.3); }
  .error { background: #1a1215; border: 1px solid #4a2020; color: #ff6b6b; font-size: 12px;
    padding: 10px 14px; border-radius: 8px; margin-bottom: 16px; text-align: center;
    font-family: 'JetBrains Mono', monospace; }
  .footer { text-align: center; margin-top: 32px; color: #2a3a4a; font-size: 11px;
    font-family: 'JetBrains Mono', monospace; }
</style>
</head>
<body>
<div class="login-box">
  <div class="logo">
    <div class="logo-sub">Drixl Transporte GmbH</div>
    <h1>Finance Dashboard</h1>
  </div>
  <div class="card">
    <div class="card-title">Zugang zum Dashboard</div>
    ${error ? '<div class="error">' + error + '</div>' : ''}
    <form method="POST" action="/api/login">
      <div class="field">
        <label>Passwort</label>
        <input type="password" name="password" placeholder="Passwort eingeben" autofocus required>
      </div>
      <button type="submit" class="btn">Anmelden</button>
    </form>
  </div>
  <div class="footer">Geschützter Bereich · Nur für autorisierte Benutzer</div>
</div>
</body>
</html>`;
}

// Pages embedded as base64 - no filesystem needed
const PAGES_B64 = {
  '/': 'PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImRlIj4KPGhlYWQ+CjxtZXRhIGNoYXJzZXQ9IlVURi04Ij4KPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiPgo8dGl0bGU+RHJpeGwgVHJhbnNwb3J0ZSDigJMgRmluYW5jZSBEYXNoYm9hcmQ8L3RpdGxlPgo8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9jaGFydC5qc0A0LjQuMS9kaXN0L2NoYXJ0LnVtZC5taW4uanMiPjwvc2NyaXB0Pgo8bGluayBocmVmPSJodHRwczovL2ZvbnRzLmdvb2dsZWFwaXMuY29tL2NzczI/ZmFtaWx5PURNK1NhbnM6d2dodEA0MDA7NTAwOzYwMDs3MDAmZmFtaWx5PUpldEJyYWlucytNb25vOndnaHRANDAwOzUwMDs2MDAmZGlzcGxheT1zd2FwIiByZWw9InN0eWxlc2hlZXQiPgo8c3R5bGU+CiAgKiB7IG1hcmdpbjogMDsgcGFkZGluZzogMDsgYm94LXNpemluZzogYm9yZGVyLWJveDsgfQogIGJvZHkgeyBiYWNrZ3JvdW5kOiAjMGExMDE4OyBjb2xvcjogI2M4ZDJkYzsgZm9udC1mYW1pbHk6ICdETSBTYW5zJywgc2Fucy1zZXJpZjsgcGFkZGluZzogMjRweCAyMHB4OyBtaW4taGVpZ2h0OiAxMDB2aDsgfQogIC5jb250YWluZXIgeyBtYXgtd2lkdGg6IDEyMDBweDsgbWFyZ2luOiAwIGF1dG87IH0KICAubW9ubyB7IGZvbnQtZmFtaWx5OiAnSmV0QnJhaW5zIE1vbm8nLCBtb25vc3BhY2U7IH0KICAKICAuaGVhZGVyIHsgZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOyBmbGV4LXdyYXA6IHdyYXA7IGdhcDogMTJweDsgbWFyZ2luLWJvdHRvbTogMzJweDsgYW5pbWF0aW9uOiBmYWRlSW4gMC41cyBlYXNlOyB9CiAgLmhlYWRlci1zdWIgeyBmb250LXNpemU6IDExcHg7IGZvbnQtd2VpZ2h0OiA2MDA7IGxldHRlci1zcGFjaW5nOiAwLjEyZW07IHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7IGNvbG9yOiAjMmE2ZjRlOyBtYXJnaW4tYm90dG9tOiA0cHg7IH0KICAuaGVhZGVyIGgxIHsgZm9udC1zaXplOiAyOHB4OyBmb250LXdlaWdodDogNzAwOyBjb2xvcjogI2U4ZWRmMjsgbGluZS1oZWlnaHQ6IDEuMjsgfQogIAogIC55ZWFyLWJ0bnMgeyBkaXNwbGF5OiBmbGV4OyBnYXA6IDZweDsgZmxleC13cmFwOiB3cmFwOyB9CiAgLnllYXItYnRuIHsgcGFkZGluZzogNnB4IDE0cHg7IGJvcmRlci1yYWRpdXM6IDZweDsgYm9yZGVyOiBub25lOyBjdXJzb3I6IHBvaW50ZXI7IGZvbnQtc2l6ZTogMTNweDsgZm9udC13ZWlnaHQ6IDYwMDsgZm9udC1mYW1pbHk6ICdKZXRCcmFpbnMgTW9ubycsIG1vbm9zcGFjZTsgYmFja2dyb3VuZDogIzExMTgyMDsgY29sb3I6ICM1YTZhN2E7IHRyYW5zaXRpb246IGFsbCAwLjJzOyB9CiAgLnllYXItYnRuLmFjdGl2ZSB7IGJhY2tncm91bmQ6ICMyYTZmNGU7IGNvbG9yOiAjZThlZGYyOyB9CiAgLnllYXItYnRuOmhvdmVyIHsgYmFja2dyb3VuZDogIzFhMjgzMjsgY29sb3I6ICM4YTlhYWE7IH0KICAueWVhci1idG4uYWN0aXZlOmhvdmVyIHsgYmFja2dyb3VuZDogIzM1ODg2YTsgfQoKICAuc2VjdGlvbi10aXRsZSB7IGZvbnQtc2l6ZTogMTFweDsgZm9udC13ZWlnaHQ6IDcwMDsgbGV0dGVyLXNwYWNpbmc6IDAuMTRlbTsgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsgY29sb3I6ICMyYTZmNGU7IG1hcmdpbjogMjhweCAwIDE0cHg7IHBhZGRpbmctbGVmdDogMnB4OyB9CgogIC5rcGktZ3JpZCB7IGRpc3BsYXk6IGdyaWQ7IGdyaWQtdGVtcGxhdGUtY29sdW1uczogcmVwZWF0KGF1dG8tZml0LCBtaW5tYXgoMTgwcHgsIDFmcikpOyBnYXA6IDEycHg7IG1hcmdpbi1ib3R0b206IDI0cHg7IGFuaW1hdGlvbjogZmFkZUluIDAuNnMgZWFzZTsgfQogIC5rcGktY2FyZCB7IGJhY2tncm91bmQ6ICMxMTE4MjA7IGJvcmRlcjogMXB4IHNvbGlkICMxYTIzMzI7IGJvcmRlci1yYWRpdXM6IDEycHg7IHBhZGRpbmc6IDE4cHggMjBweDsgcG9zaXRpb246IHJlbGF0aXZlOyBvdmVyZmxvdzogaGlkZGVuOyB9CiAgLmtwaS1jYXJkLmFjY2VudCB7IGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsICMxYTIzMzIgMCUsICMwZjE5MjMgMTAwJSk7IGJvcmRlci1jb2xvcjogIzJhNmY0ZTsgfQogIC5rcGktY2FyZC5hY2NlbnQ6OmJlZm9yZSB7IGNvbnRlbnQ6ICcnOyBwb3NpdGlvbjogYWJzb2x1dGU7IHRvcDogMDsgbGVmdDogMDsgcmlnaHQ6IDA7IGhlaWdodDogMnB4OyBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsICMyYTZmNGUsICM0ZWNkYzQpOyB9CiAgLmtwaS1jYXJkLndhcm4geyBib3JkZXItY29sb3I6ICM1YTQ1MjA7IH0KICAua3BpLWNhcmQud2Fybjo6YmVmb3JlIHsgY29udGVudDogJyc7IHBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiAwOyBsZWZ0OiAwOyByaWdodDogMDsgaGVpZ2h0OiAycHg7IGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCg5MGRlZywgI2U4YTU0YiwgI2ZmNmI2Yik7IH0KICAua3BpLWNhcmQuaW5mbyB7IGJvcmRlci1jb2xvcjogIzFhMzM1NTsgfQogIC5rcGktY2FyZC5pbmZvOjpiZWZvcmUgeyBjb250ZW50OiAnJzsgcG9zaXRpb246IGFic29sdXRlOyB0b3A6IDA7IGxlZnQ6IDA7IHJpZ2h0OiAwOyBoZWlnaHQ6IDJweDsgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjNGE5MGQ5LCAjNmNiNGVlKTsgfQogIC5rcGktbGFiZWwgeyBmb250LXNpemU6IDExcHg7IGZvbnQtd2VpZ2h0OiA2MDA7IGxldHRlci1zcGFjaW5nOiAwLjA4ZW07IHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7IGNvbG9yOiAjNWE2YTdhOyBtYXJnaW4tYm90dG9tOiA2cHg7IH0KICAua3BpLXZhbHVlIHsgZm9udC1zaXplOiAyNnB4OyBmb250LXdlaWdodDogNzAwOyBjb2xvcjogI2U4ZWRmMjsgbGluZS1oZWlnaHQ6IDEuMTsgbWFyZ2luLWJvdHRvbTogNHB4OyB9CiAgLmtwaS1jYXJkLmFjY2VudCAua3BpLXZhbHVlIHsgY29sb3I6ICM0ZWNkYzQ7IH0KICAua3BpLWNhcmQud2FybiAua3BpLXZhbHVlIHsgY29sb3I6ICNlOGE1NGI7IH0KICAua3BpLWNhcmQuaW5mbyAua3BpLXZhbHVlIHsgY29sb3I6ICM2Y2I0ZWU7IH0KICAua3BpLXN1YiB7IGZvbnQtc2l6ZTogMTJweDsgY29sb3I6ICM0YTVhNmE7IH0KICAua3BpLXN1Yi5ncmVlbiB7IGNvbG9yOiAjNGVjZGM0OyB9CiAgLmtwaS1zdWIucmVkIHsgY29sb3I6ICNmZjZiNmI7IH0KCiAgLmNoYXJ0cy1ncmlkIHsgZGlzcGxheTogZ3JpZDsgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgMWZyOyBnYXA6IDEycHg7IG1hcmdpbi1ib3R0b206IDI0cHg7IGFuaW1hdGlvbjogZmFkZUluIDAuN3MgZWFzZTsgfQogIC5jaGFydC1jYXJkIHsgYmFja2dyb3VuZDogIzExMTgyMDsgYm9yZGVyOiAxcHggc29saWQgIzFhMjMzMjsgYm9yZGVyLXJhZGl1czogMTJweDsgcGFkZGluZzogMjBweDsgfQogIC5jaGFydC10aXRsZSB7IGZvbnQtc2l6ZTogMTNweDsgZm9udC13ZWlnaHQ6IDYwMDsgY29sb3I6ICM1YTZhN2E7IGxldHRlci1zcGFjaW5nOiAwLjA2ZW07IHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7IG1hcmdpbi1ib3R0b206IDE2cHg7IH0KICAuY2hhcnQtd3JhcCB7IHBvc2l0aW9uOiByZWxhdGl2ZTsgaGVpZ2h0OiAyNDBweDsgfQoKICAuYm90dG9tLWdyaWQgeyBkaXNwbGF5OiBncmlkOyBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciAxZnI7IGdhcDogMTJweDsgYW5pbWF0aW9uOiBmYWRlSW4gMC44cyBlYXNlOyB9CiAgLmxpc3QtY2FyZCB7IGJhY2tncm91bmQ6ICMxMTE4MjA7IGJvcmRlcjogMXB4IHNvbGlkICMxYTIzMzI7IGJvcmRlci1yYWRpdXM6IDEycHg7IHBhZGRpbmc6IDIwcHg7IH0KCiAgLmN1c3RvbWVyLXJvdyB7IHBhZGRpbmc6IDhweCAwOyB9CiAgLmN1c3RvbWVyLXJvdzpob3ZlciB7IGJhY2tncm91bmQ6ICMwZjE2MjA7IGJvcmRlci1yYWRpdXM6IDZweDsgfQogIC5jdXN0b21lci1oZWFkZXIgeyBkaXNwbGF5OiBmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47IGFsaWduLWl0ZW1zOiBjZW50ZXI7IG1hcmdpbi1ib3R0b206IDRweDsgfQogIC5jdXN0b21lci1uYW1lIHsgZm9udC1zaXplOiAxM3B4OyBjb2xvcjogI2M4ZDJkYzsgZm9udC13ZWlnaHQ6IDUwMDsgfQogIC5jdXN0b21lci1yYW5rIHsgY29sb3I6ICMzYTRhNWE7IGZvbnQtc2l6ZTogMTFweDsgbWFyZ2luLXJpZ2h0OiA4cHg7IH0KICAuY3VzdG9tZXItYW1vdW50IHsgZm9udC1zaXplOiAxM3B4OyBmb250LXdlaWdodDogNjAwOyBjb2xvcjogIzRlY2RjNDsgd2hpdGUtc3BhY2U6IG5vd3JhcDsgfQogIC5taW5pLWJhciB7IHdpZHRoOiAxMDAlOyBoZWlnaHQ6IDRweDsgYmFja2dyb3VuZDogIzFhMjMzMjsgYm9yZGVyLXJhZGl1czogMnB4OyBvdmVyZmxvdzogaGlkZGVuOyB9CiAgLm1pbmktYmFyLWZpbGwgeyBoZWlnaHQ6IDEwMCU7IGJhY2tncm91bmQ6ICMyYTZmNGU7IGJvcmRlci1yYWRpdXM6IDJweDsgdHJhbnNpdGlvbjogd2lkdGggMXMgZWFzZTsgfQoKICAuaW52LXJvdyB7IGRpc3BsYXk6IGZsZXg7IGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsgYWxpZ24taXRlbXM6IGNlbnRlcjsgcGFkZGluZzogOHB4IDRweDsgYm9yZGVyLXJhZGl1czogNHB4OyB9CiAgLmludi1yb3c6aG92ZXIgeyBiYWNrZ3JvdW5kOiAjMGYxNjIwOyB9CiAgLmludi1uYW1lIHsgZm9udC1zaXplOiAxM3B4OyBjb2xvcjogI2M4ZDJkYzsgZm9udC13ZWlnaHQ6IDUwMDsgfQogIC5pbnYtZGV0YWlsIHsgZm9udC1zaXplOiAxMXB4OyBjb2xvcjogIzNhNGE1YTsgfQogIC5pbnYtYW1vdW50IHsgZm9udC1zaXplOiAxNHB4OyBmb250LXdlaWdodDogNjAwOyBjb2xvcjogI2U4YTU0Yjsgd2hpdGUtc3BhY2U6IG5vd3JhcDsgfQoKICAuZnVubmVsLXJvdyB7IGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGdhcDogMTJweDsgbWFyZ2luLWJvdHRvbTogMTBweDsgfQogIC5mdW5uZWwtbGFiZWwgeyBmb250LXNpemU6IDEycHg7IGNvbG9yOiAjOGE5YWFhOyB3aWR0aDogOTBweDsgdGV4dC1hbGlnbjogcmlnaHQ7IGZsZXgtc2hyaW5rOiAwOyB9CiAgLmZ1bm5lbC1iYXItd3JhcCB7IGZsZXg6IDE7IGhlaWdodDogMjhweDsgYmFja2dyb3VuZDogIzBmMTYyMDsgYm9yZGVyLXJhZGl1czogNnB4OyBvdmVyZmxvdzogaGlkZGVuOyB9CiAgLmZ1bm5lbC1iYXIgeyBoZWlnaHQ6IDEwMCU7IGJvcmRlci1yYWRpdXM6IDZweDsgZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsgcGFkZGluZzogMCAxMHB4OyBmb250LXNpemU6IDEycHg7IGZvbnQtd2VpZ2h0OiA2MDA7IGNvbG9yOiAjZThlZGYyOyB0cmFuc2l0aW9uOiB3aWR0aCAxcyBlYXNlOyB9CiAgLmZ1bm5lbC1jb3VudCB7IGZvbnQtc2l6ZTogMTFweDsgY29sb3I6ICM1YTZhN2E7IHdpZHRoOiA2MHB4OyB0ZXh0LWFsaWduOiByaWdodDsgZmxleC1zaHJpbms6IDA7IH0KCiAgLmZvb3RlciB7IHRleHQtYWxpZ246IGNlbnRlcjsgcGFkZGluZzogMzJweCAwIDE2cHg7IGNvbG9yOiAjMmEzYTRhOyBmb250LXNpemU6IDExcHg7IH0KICAuZW1wdHktc3RhdGUgeyB0ZXh0LWFsaWduOiBjZW50ZXI7IHBhZGRpbmc6IDQwcHg7IGNvbG9yOiAjM2E0YTVhOyB9CiAgLmVtcHR5LXN0YXRlIC5pY29uIHsgZm9udC1zaXplOiAzMnB4OyBtYXJnaW4tYm90dG9tOiA4cHg7IH0KICAubG9hZGluZyB7IGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGp1c3RpZnktY29udGVudDogY2VudGVyOyBtaW4taGVpZ2h0OiA4MHZoOyB9CiAgLnNwaW5uZXIgeyB3aWR0aDogMjBweDsgaGVpZ2h0OiAyMHB4OyBib3JkZXI6IDJweCBzb2xpZCAjNGVjZGM0OyBib3JkZXItdG9wLWNvbG9yOiB0cmFuc3BhcmVudDsgYm9yZGVyLXJhZGl1czogNTAlOyBhbmltYXRpb246IHNwaW4gMXMgbGluZWFyIGluZmluaXRlOyBtYXJnaW4tcmlnaHQ6IDEycHg7IH0KICAKICBAa2V5ZnJhbWVzIHNwaW4geyB0byB7IHRyYW5zZm9ybTogcm90YXRlKDM2MGRlZyk7IH0gfQogIEBrZXlmcmFtZXMgZmFkZUluIHsgZnJvbSB7IG9wYWNpdHk6IDA7IHRyYW5zZm9ybTogdHJhbnNsYXRlWSg4cHgpOyB9IHRvIHsgb3BhY2l0eTogMTsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDApOyB9IH0KCiAgQG1lZGlhIChtYXgtd2lkdGg6IDkwMHB4KSB7CiAgICAuY2hhcnRzLWdyaWQsIC5ib3R0b20tZ3JpZCB7IGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyOyB9CiAgICAua3BpLWdyaWQgeyBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciAxZnI7IH0KICAgIC5oZWFkZXIgaDEgeyBmb250LXNpemU6IDIycHg7IH0KICB9Cjwvc3R5bGU+CjwvaGVhZD4KPGJvZHk+CjxkaXYgY2xhc3M9ImNvbnRhaW5lciIgaWQ9ImFwcCI+CiAgPGRpdiBjbGFzcz0ibG9hZGluZyI+CiAgICA8ZGl2IGNsYXNzPSJzcGlubmVyIj48L2Rpdj4KICAgIDxzcGFuIHN0eWxlPSJjb2xvcjogIzRlY2RjNDsgZm9udC1zaXplOiAxOHB4OyI+TGFkZSBEYXRlbiB2b24gU3VwYWJhc2UuLi48L3NwYW4+CiAgPC9kaXY+CjwvZGl2PgoKPHNjcmlwdD4KY29uc3QgU1VQQUJBU0VfVVJMID0gImh0dHBzOi8vbnpmd2RlaHVhY3J3aXN1aXhkeHUuc3VwYWJhc2UuY28iOwpjb25zdCBTVVBBQkFTRV9LRVkgPSAiZXlKaGJHY2lPaUpJVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKemRYQmhZbUZ6WlNJc0luSmxaaUk2SW01NlpuZGtaV2gxWVdOeWQybHpkV2w0WkhoMUlpd2ljbTlzWlNJNkluTmxjblpwWTJWZmNtOXNaU0lzSW1saGRDSTZNVGMzTVRJMk9EVXpOeXdpWlhod0lqb3lNRGcyT0RRME5UTTNmUS5famo1S0hVdWxwZ0MxVkluZDBfN20tQXNNQS1Na2hjSnNEa04tMXg1eFhVIjsKCmxldCBhY3RpdmVZZWFyID0gbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpOwpsZXQgY2hhcnRzID0ge307Cgphc3luYyBmdW5jdGlvbiBxdWVyeSh0YWJsZSwgcGFyYW1zID0gIiIpIHsKICBjb25zdCBhbGxEYXRhID0gW107CiAgbGV0IG9mZnNldCA9IDA7CiAgY29uc3QgYmF0Y2hTaXplID0gMTAwMDsKICB3aGlsZSAodHJ1ZSkgewogICAgY29uc3QgdXJsID0gYCR7U1VQQUJBU0VfVVJMfS9yZXN0L3YxLyR7dGFibGV9PyR7cGFyYW1zfSZvZmZzZXQ9JHtvZmZzZXR9JmxpbWl0PSR7YmF0Y2hTaXplfWA7CiAgICB0cnkgewogICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaCh1cmwsIHsKICAgICAgICBoZWFkZXJzOiB7IGFwaWtleTogU1VQQUJBU0VfS0VZLCBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7U1VQQUJBU0VfS0VZfWAsIFByZWZlcjogImNvdW50PWV4YWN0IiB9CiAgICAgIH0pOwogICAgICBpZiAoIXJlcy5vaykgeyBjb25zb2xlLndhcm4oYCR7dGFibGV9IGJhdGNoQCR7b2Zmc2V0fTogSFRUUCAke3Jlcy5zdGF0dXN9YCk7IGJyZWFrOyB9CiAgICAgIGNvbnN0IGJhdGNoID0gYXdhaXQgcmVzLmpzb24oKTsKICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGJhdGNoKSkgeyBjb25zb2xlLndhcm4oYCR7dGFibGV9IGJhdGNoQCR7b2Zmc2V0fTogbm90IGFycmF5YCwgYmF0Y2gpOyBicmVhazsgfQogICAgICBpZiAoYmF0Y2gubGVuZ3RoID09PSAwKSBicmVhazsKICAgICAgYWxsRGF0YS5wdXNoKC4uLmJhdGNoKTsKICAgICAgY29uc29sZS5sb2coYCAgJHt0YWJsZX06IGxvYWRlZCAke2FsbERhdGEubGVuZ3RofSAoYmF0Y2ggJHtiYXRjaC5sZW5ndGh9KWApOwogICAgICBpZiAoYmF0Y2gubGVuZ3RoIDwgYmF0Y2hTaXplKSBicmVhazsKICAgICAgb2Zmc2V0ICs9IGJhdGNoU2l6ZTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgY29uc29sZS5lcnJvcihgJHt0YWJsZX0gYmF0Y2hAJHtvZmZzZXR9OiBmZXRjaCBlcnJvcmAsIGUpOwogICAgICBicmVhazsKICAgIH0KICB9CiAgY29uc29sZS5sb2coYOKckyAke3RhYmxlfTogJHthbGxEYXRhLmxlbmd0aH0gdG90YWwgcmVjb3Jkc2ApOwogIHJldHVybiBhbGxEYXRhOwp9CgpmdW5jdGlvbiBmb3JtYXRDSEYodikgewogIGNvbnN0IG4gPSBwYXJzZUZsb2F0KHYpIHx8IDA7CiAgaWYgKG4gPj0gMTAwMDAwMCkgcmV0dXJuIGBDSEYgJHsobi8xMDAwMDAwKS50b0ZpeGVkKDIpfSBNaW9gOwogIGlmIChuID49IDEwMDAwKSByZXR1cm4gYENIRiAkeyhuLzEwMDApLnRvRml4ZWQoMCl9S2A7CiAgaWYgKG4gPj0gMTAwMCkgcmV0dXJuIGBDSEYgJHsobi8xMDAwKS50b0ZpeGVkKDEpfUtgOwogIHJldHVybiBgQ0hGICR7bi50b0ZpeGVkKDApfWA7Cn0KZnVuY3Rpb24gZm9ybWF0TnVtKHYpIHsgcmV0dXJuIG5ldyBJbnRsLk51bWJlckZvcm1hdCgiZGUtQ0giKS5mb3JtYXQodiB8fCAwKTsgfQoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIERBVEEgTE9BRElORwovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKCndpbmRvdy5fYWxsRGF0YSA9IHt9OwoKYXN5bmMgZnVuY3Rpb24gbG9hZEFsbERhdGEoKSB7CiAgLy8gU2VxdWVudGlhbCBsb2FkaW5nIHRvIGF2b2lkIFN1cGFiYXNlIHJhdGUgbGltaXRzCiAgY29uc29sZS5sb2coIkxvYWRpbmcgaW52b2ljZXMuLi4iKTsKICBjb25zdCBpbnZvaWNlcyA9IGF3YWl0IHF1ZXJ5KCJpbnZvaWNlcyIsICJzZWxlY3Q9aWQsaXNfdmFsaWRfZnJvbSx0b3RhbF9ncm9zcyx0b3RhbF9uZXQsdG90YWxfdGF4ZXMsc3RhdHVzLGNvbnRhY3RfaWQsZG9jdW1lbnRfbnIsY3JlYXRlZF9hdCx1cGRhdGVkX2F0Iik7CiAgY29uc29sZS5sb2coIkxvYWRpbmcgcXVvdGVzLi4uIik7CiAgY29uc3QgcXVvdGVzID0gYXdhaXQgcXVlcnkoInF1b3RlcyIsICJzZWxlY3Q9aWQsaXNfdmFsaWRfZnJvbSx0b3RhbF9ncm9zcyx0b3RhbF9uZXQsc3RhdHVzLGNyZWF0ZWRfYXQiKTsKICBjb25zb2xlLmxvZygiTG9hZGluZyBvcmRlcnMuLi4iKTsKICBjb25zdCBvcmRlcnMgPSBhd2FpdCBxdWVyeSgib3JkZXJzIiwgInNlbGVjdD1pZCx0b3RhbF9ncm9zcyx0b3RhbF9uZXQsc3RhdHVzLGlzX3ZhbGlkX2Zyb20iKTsKICBjb25zb2xlLmxvZygiTG9hZGluZyBjb250YWN0cy4uLiIpOwogIGNvbnN0IGNvbnRhY3RzID0gYXdhaXQgcXVlcnkoImNvbnRhY3RzIiwgInNlbGVjdD1pZCxuYW1lXzEsbmFtZV8yIik7CiAgY29uc29sZS5sb2coIkxvYWRpbmcgcGF5bWVudHMuLi4iKTsKICBjb25zdCBwYXltZW50cyA9IGF3YWl0IHF1ZXJ5KCJpbmNvbWluZ19wYXltZW50cyIsICJzZWxlY3Q9aWQsaW52b2ljZV9pZCxwYXltZW50X2RhdGUsYW1vdW50Iik7CiAgd2luZG93Ll9hbGxEYXRhID0geyBpbnZvaWNlcywgcXVvdGVzLCBvcmRlcnMsIGNvbnRhY3RzLCBwYXltZW50cyB9OwogIGNvbnNvbGUubG9nKGA9PT0gQUxMIERBVEEgTE9BREVEID09PSBpbnZvaWNlczoke2ludm9pY2VzLmxlbmd0aH0gcXVvdGVzOiR7cXVvdGVzLmxlbmd0aH0gb3JkZXJzOiR7b3JkZXJzLmxlbmd0aH0gY29udGFjdHM6JHtjb250YWN0cy5sZW5ndGh9IHBheW1lbnRzOiR7cGF5bWVudHMubGVuZ3RofWApOwp9CgovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKLy8gREFUQSBQUk9DRVNTSU5HCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAoKZnVuY3Rpb24gcHJvY2Vzc0RhdGEoKSB7CiAgY29uc3QgeyBpbnZvaWNlcywgcXVvdGVzLCBvcmRlcnMsIGNvbnRhY3RzLCBwYXltZW50cyB9ID0gd2luZG93Ll9hbGxEYXRhOwoKICBjb25zdCBjbSA9IHt9OwogIGNvbnRhY3RzLmZvckVhY2goYyA9PiBjbVtjLmlkXSA9IFtjLm5hbWVfMSwgYy5uYW1lXzJdLmZpbHRlcihCb29sZWFuKS5qb2luKCIgIikpOwoKICBjb25zdCByZXZlbnVlSW52ID0gaW52b2ljZXMuZmlsdGVyKGkgPT4gaS5zdGF0dXMgIT09ICJjYW5jZWxsZWQiICYmIGkuc3RhdHVzICE9PSAiZHJhZnQiKTsKICBjb25zdCBwYWlkSW52ID0gaW52b2ljZXMuZmlsdGVyKGkgPT4gaS5zdGF0dXMgPT09ICJwYWlkIik7CgogIC8vIOKUgOKUgCBZZWFybHkg4pSA4pSACiAgY29uc3QgeWVhcmx5ID0ge307CiAgcmV2ZW51ZUludi5mb3JFYWNoKGludiA9PiB7CiAgICBpZiAoIWludi5pc192YWxpZF9mcm9tKSByZXR1cm47CiAgICBjb25zdCB5ID0gbmV3IERhdGUoaW52LmlzX3ZhbGlkX2Zyb20pLmdldEZ1bGxZZWFyKCk7CiAgICBpZiAoIXllYXJseVt5XSkgeWVhcmx5W3ldID0geyB5ZWFyOiB5LCByZXZlbnVlOiAwLCBjb3VudDogMCB9OwogICAgeWVhcmx5W3ldLnJldmVudWUgKz0gcGFyc2VGbG9hdChpbnYudG90YWxfbmV0IHx8IDApOwogICAgeWVhcmx5W3ldLmNvdW50Kys7CiAgfSk7CiAgY29uc3QgeWVhcmx5RGF0YSA9IE9iamVjdC52YWx1ZXMoeWVhcmx5KS5zb3J0KChhLCBiKSA9PiBhLnllYXIgLSBiLnllYXIpOwogIGNvbnN0IHllYXJzID0geWVhcmx5RGF0YS5tYXAoeSA9PiB5LnllYXIpOwoKICAvLyDilIDilIAgS1BJcyDilIDilIAKICBjb25zdCB0b3RhbFJldmVudWUgPSByZXZlbnVlSW52LnJlZHVjZSgocywgaSkgPT4gcyArIHBhcnNlRmxvYXQoaS50b3RhbF9uZXQgfHwgMCksIDApOwogIGNvbnN0IGN1clllYXJSZXYgPSB5ZWFybHlbYWN0aXZlWWVhcl0/LnJldmVudWUgfHwgMDsKCiAgLy8gWVREIGNvbXBhcmlzb246IHNhbWUgcGVyaW9kIGxhc3QgeWVhciAodXAgdG8gdG9kYXkncyBtb250aCtkYXkpCiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTsKICBjb25zdCB5dGRDdXRvZmYgPSBhY3RpdmVZZWFyID09PSBub3cuZ2V0RnVsbFllYXIoKQogICAgPyBuZXcgRGF0ZShhY3RpdmVZZWFyIC0gMSwgbm93LmdldE1vbnRoKCksIG5vdy5nZXREYXRlKCkpICAvLyBjdXJyZW50IHllYXI6IGNvbXBhcmUgdXAgdG8gdG9kYXkgbGFzdCB5ZWFyCiAgICA6IG5ldyBEYXRlKGFjdGl2ZVllYXIsIDExLCAzMSk7ICAvLyBwYXN0IHllYXI6IGZ1bGwgeWVhciBjb21wYXJpc29uCiAgY29uc3QgeXRkU3RhcnQgPSBuZXcgRGF0ZShhY3RpdmVZZWFyIC0gMSwgMCwgMSk7CiAgY29uc3QgbGFzdFllYXJZVEQgPSByZXZlbnVlSW52LmZpbHRlcihpID0+IHsKICAgIGlmICghaS5pc192YWxpZF9mcm9tKSByZXR1cm4gZmFsc2U7CiAgICBjb25zdCBkID0gbmV3IERhdGUoaS5pc192YWxpZF9mcm9tKTsKICAgIHJldHVybiBkID49IHl0ZFN0YXJ0ICYmIGQgPD0geXRkQ3V0b2ZmOwogIH0pLnJlZHVjZSgocywgaSkgPT4gcyArIHBhcnNlRmxvYXQoaS50b3RhbF9uZXQgfHwgMCksIDApOwogIGNvbnN0IHlveSA9IGxhc3RZZWFyWVREID4gMCA/ICgoY3VyWWVhclJldiAtIGxhc3RZZWFyWVREKSAvIGxhc3RZZWFyWVREICogMTAwKSA6IDA7CiAgY29uc3QgaXNZVEQgPSBhY3RpdmVZZWFyID09PSBub3cuZ2V0RnVsbFllYXIoKTsKCiAgY29uc3Qgb3BlbkludiA9IGludm9pY2VzLmZpbHRlcihpID0+IGkuc3RhdHVzID09PSAicGVuZGluZyIpOwogIGNvbnN0IG9wZW5Ub3RhbCA9IG9wZW5JbnYucmVkdWNlKChzLCBpKSA9PiBzICsgcGFyc2VGbG9hdChpLnRvdGFsX25ldCB8fCAwKSwgMCk7CgogIC8vIOKUgOKUgCDDmCBSZWNobnVuZ3NiZXRyYWcg4pSA4pSACiAgY29uc3QgY3VyWWVhckludiA9IHJldmVudWVJbnYuZmlsdGVyKGkgPT4gaS5pc192YWxpZF9mcm9tICYmIG5ldyBEYXRlKGkuaXNfdmFsaWRfZnJvbSkuZ2V0RnVsbFllYXIoKSA9PT0gYWN0aXZlWWVhcik7CiAgY29uc3QgYXZnSW52Q3VyWWVhciA9IGN1clllYXJJbnYubGVuZ3RoID4gMCA/IGN1clllYXJJbnYucmVkdWNlKChzLCBpKSA9PiBzICsgcGFyc2VGbG9hdChpLnRvdGFsX25ldCB8fCAwKSwgMCkgLyBjdXJZZWFySW52Lmxlbmd0aCA6IDA7CiAgY29uc3QgbGFzdFllYXJJbnYgPSByZXZlbnVlSW52LmZpbHRlcihpID0+IGkuaXNfdmFsaWRfZnJvbSAmJiBuZXcgRGF0ZShpLmlzX3ZhbGlkX2Zyb20pLmdldEZ1bGxZZWFyKCkgPT09IGFjdGl2ZVllYXIgLSAxKTsKICBjb25zdCBhdmdJbnZMYXN0WWVhciA9IGxhc3RZZWFySW52Lmxlbmd0aCA+IDAgPyBsYXN0WWVhckludi5yZWR1Y2UoKHMsIGkpID0+IHMgKyBwYXJzZUZsb2F0KGkudG90YWxfbmV0IHx8IDApLCAwKSAvIGxhc3RZZWFySW52Lmxlbmd0aCA6IDA7CiAgY29uc3QgYXZnSW52Q2hhbmdlID0gYXZnSW52TGFzdFllYXIgPiAwID8gKChhdmdJbnZDdXJZZWFyIC0gYXZnSW52TGFzdFllYXIpIC8gYXZnSW52TGFzdFllYXIgKiAxMDApIDogMDsKICBjb25zdCBhdmdJbnZCeVllYXIgPSB5ZWFybHlEYXRhLm1hcCh5ID0+ICh7IHllYXI6IHkueWVhciwgYXZnOiB5LmNvdW50ID4gMCA/IHkucmV2ZW51ZSAvIHkuY291bnQgOiAwLCBjb3VudDogeS5jb3VudCB9KSk7CgogIC8vIOKUgOKUgCBPZmZlcnRlbiDilIDilIAKICBjb25zdCB0b3RhbFF1b3RlcyA9IHF1b3Rlcy5sZW5ndGg7CiAgY29uc3QgYWNjZXB0ZWRRdW90ZXMgPSBxdW90ZXMuZmlsdGVyKHEgPT4gcS5zdGF0dXMgPT09ICJhY2NlcHRlZCIpLmxlbmd0aDsKICBjb25zdCBwZW5kaW5nUXVvdGVzID0gcXVvdGVzLmZpbHRlcihxID0+IHEuc3RhdHVzID09PSAicGVuZGluZyIpLmxlbmd0aDsKICBjb25zdCBkZWNsaW5lZFF1b3RlcyA9IHF1b3Rlcy5maWx0ZXIocSA9PiBxLnN0YXR1cyA9PT0gImRlY2xpbmVkIikubGVuZ3RoOwogIGNvbnN0IHF1b3RlQ29udiA9IHRvdGFsUXVvdGVzID4gMCA/IChhY2NlcHRlZFF1b3RlcyAvIHRvdGFsUXVvdGVzICogMTAwKSA6IDA7CgogIGNvbnN0IHF1b3Rlc0J5WWVhciA9IHt9OwogIHF1b3Rlcy5mb3JFYWNoKHEgPT4gewogICAgY29uc3QgZHQgPSBxLmlzX3ZhbGlkX2Zyb20gfHwgcS5jcmVhdGVkX2F0OwogICAgaWYgKCFkdCkgcmV0dXJuOwogICAgY29uc3QgeSA9IG5ldyBEYXRlKGR0KS5nZXRGdWxsWWVhcigpOwogICAgaWYgKCFxdW90ZXNCeVllYXJbeV0pIHF1b3Rlc0J5WWVhclt5XSA9IHsgdG90YWw6IDAsIGFjY2VwdGVkOiAwLCBkZWNsaW5lZDogMCwgcGVuZGluZzogMCB9OwogICAgcXVvdGVzQnlZZWFyW3ldLnRvdGFsKys7CiAgICBpZiAocS5zdGF0dXMgPT09ICJhY2NlcHRlZCIpIHF1b3Rlc0J5WWVhclt5XS5hY2NlcHRlZCsrOwogICAgZWxzZSBpZiAocS5zdGF0dXMgPT09ICJkZWNsaW5lZCIpIHF1b3Rlc0J5WWVhclt5XS5kZWNsaW5lZCsrOwogICAgZWxzZSBpZiAocS5zdGF0dXMgPT09ICJwZW5kaW5nIikgcXVvdGVzQnlZZWFyW3ldLnBlbmRpbmcrKzsKICB9KTsKCiAgLy8g4pSA4pSAIFRvcCBLdW5kZW4g4pSA4pSACiAgY29uc3QgY3VzdFJldiA9IHt9OwogIHJldmVudWVJbnYuZm9yRWFjaChpbnYgPT4gewogICAgaWYgKCFpbnYuY29udGFjdF9pZCkgcmV0dXJuOwogICAgaWYgKCFjdXN0UmV2W2ludi5jb250YWN0X2lkXSkgY3VzdFJldltpbnYuY29udGFjdF9pZF0gPSB7IGlkOiBpbnYuY29udGFjdF9pZCwgdG90YWw6IDAsIGNvdW50OiAwIH07CiAgICBjdXN0UmV2W2ludi5jb250YWN0X2lkXS50b3RhbCArPSBwYXJzZUZsb2F0KGludi50b3RhbF9uZXQgfHwgMCk7CiAgICBjdXN0UmV2W2ludi5jb250YWN0X2lkXS5jb3VudCsrOwogIH0pOwogIGNvbnN0IHRvcEN1c3QgPSBPYmplY3QudmFsdWVzKGN1c3RSZXYpLnNvcnQoKGEsIGIpID0+IGIudG90YWwgLSBhLnRvdGFsKS5zbGljZSgwLCA4KTsKICBjb25zdCB0b3BNYXggPSB0b3BDdXN0WzBdPy50b3RhbCB8fCAxOwogIGNvbnN0IG9wZW5MaXN0ID0gb3Blbkludi5zb3J0KChhLCBiKSA9PiBwYXJzZUZsb2F0KGIudG90YWxfbmV0IHx8IDApIC0gcGFyc2VGbG9hdChhLnRvdGFsX25ldCB8fCAwKSkuc2xpY2UoMCwgOCk7CgogIC8vIOKUgOKUgCBaYWhsdW5nc21vcmFsIChEU08pIOKUgOKUgAogIGNvbnN0IHBheW1lbnRNYXAgPSB7fTsKICBwYXltZW50cy5mb3JFYWNoKHAgPT4geyBpZiAoIXBheW1lbnRNYXBbcC5pbnZvaWNlX2lkXSkgcGF5bWVudE1hcFtwLmludm9pY2VfaWRdID0gW107IHBheW1lbnRNYXBbcC5pbnZvaWNlX2lkXS5wdXNoKHApOyB9KTsKCiAgY29uc3QgZHNvRGF0YSA9IFtdOwogIHBhaWRJbnYuZm9yRWFjaChpbnYgPT4gewogICAgaWYgKCFpbnYuaXNfdmFsaWRfZnJvbSB8fCAhcGF5bWVudE1hcFtpbnYuaWRdKSByZXR1cm47CiAgICBjb25zdCBpbnZEYXRlID0gbmV3IERhdGUoaW52LmlzX3ZhbGlkX2Zyb20pOwogICAgY29uc3QgcGF5cyA9IHBheW1lbnRNYXBbaW52LmlkXTsKICAgIGNvbnN0IGxhc3RQYXkgPSBwYXlzLnNvcnQoKGEsIGIpID0+IG5ldyBEYXRlKGIucGF5bWVudF9kYXRlKSAtIG5ldyBEYXRlKGEucGF5bWVudF9kYXRlKSlbMF07CiAgICBpZiAoIWxhc3RQYXk/LnBheW1lbnRfZGF0ZSkgcmV0dXJuOwogICAgY29uc3QgZGF5cyA9IE1hdGgucm91bmQoKG5ldyBEYXRlKGxhc3RQYXkucGF5bWVudF9kYXRlKSAtIGludkRhdGUpIC8gKDEwMDAgKiA2MCAqIDYwICogMjQpKTsKICAgIGlmIChkYXlzID49IDAgJiYgZGF5cyA8IDM2NSkgZHNvRGF0YS5wdXNoKHsgeWVhcjogaW52RGF0ZS5nZXRGdWxsWWVhcigpLCBkYXlzIH0pOwogIH0pOwoKICBjb25zdCBkc29CeVllYXIgPSB7fTsKICBkc29EYXRhLmZvckVhY2goZCA9PiB7IGlmICghZHNvQnlZZWFyW2QueWVhcl0pIGRzb0J5WWVhcltkLnllYXJdID0geyBzdW06IDAsIGNvdW50OiAwIH07IGRzb0J5WWVhcltkLnllYXJdLnN1bSArPSBkLmRheXM7IGRzb0J5WWVhcltkLnllYXJdLmNvdW50Kys7IH0pOwogIGNvbnN0IGRzb1llYXJseUFyciA9IE9iamVjdC5lbnRyaWVzKGRzb0J5WWVhcikubWFwKChbeSwgdl0pID0+ICh7IHllYXI6IHBhcnNlSW50KHkpLCBhdmc6IHYuY291bnQgPiAwID8gdi5zdW0gLyB2LmNvdW50IDogMCwgY291bnQ6IHYuY291bnQgfSkpLnNvcnQoKGEsIGIpID0+IGEueWVhciAtIGIueWVhcik7CgogIGNvbnN0IGN1ckRzbyA9IGRzb0RhdGEuZmlsdGVyKGQgPT4gZC55ZWFyID09PSBhY3RpdmVZZWFyKTsKICBjb25zdCBhdmdEc29DdXJZZWFyID0gY3VyRHNvLmxlbmd0aCA+IDAgPyBjdXJEc28ucmVkdWNlKChzLCBkKSA9PiBzICsgZC5kYXlzLCAwKSAvIGN1ckRzby5sZW5ndGggOiAwOwogIGNvbnN0IGxhc3REc28gPSBkc29EYXRhLmZpbHRlcihkID0+IGQueWVhciA9PT0gYWN0aXZlWWVhciAtIDEpOwogIGNvbnN0IGF2Z0Rzb0xhc3RZZWFyID0gbGFzdERzby5sZW5ndGggPiAwID8gbGFzdERzby5yZWR1Y2UoKHMsIGQpID0+IHMgKyBkLmRheXMsIDApIC8gbGFzdERzby5sZW5ndGggOiAwOwoKICBjb25zdCBkc29CdWNrZXRzID0geyAiMC0xNCI6IDAsICIxNS0zMCI6IDAsICIzMS02MCI6IDAsICI2MS05MCI6IDAsICI5MCsiOiAwIH07CiAgY29uc3QgcmVsRHNvID0gZHNvRGF0YS5maWx0ZXIoZCA9PiBkLnllYXIgPT09IGFjdGl2ZVllYXIpOwogIChyZWxEc28ubGVuZ3RoID4gMTAgPyByZWxEc28gOiBkc29EYXRhKS5mb3JFYWNoKGQgPT4gewogICAgaWYgKGQuZGF5cyA8PSAxNCkgZHNvQnVja2V0c1siMC0xNCJdKys7CiAgICBlbHNlIGlmIChkLmRheXMgPD0gMzApIGRzb0J1Y2tldHNbIjE1LTMwIl0rKzsKICAgIGVsc2UgaWYgKGQuZGF5cyA8PSA2MCkgZHNvQnVja2V0c1siMzEtNjAiXSsrOwogICAgZWxzZSBpZiAoZC5kYXlzIDw9IDkwKSBkc29CdWNrZXRzWyI2MS05MCJdKys7CiAgICBlbHNlIGRzb0J1Y2tldHNbIjkwKyJdKys7CiAgfSk7CgogIC8vIOKUgOKUgCBLdW5kZW5lbnR3aWNrbHVuZyDilIDilIAKICBjb25zdCBjdXN0Rmlyc3RZZWFyID0ge307CiAgcmV2ZW51ZUludi5mb3JFYWNoKGludiA9PiB7CiAgICBpZiAoIWludi5jb250YWN0X2lkIHx8ICFpbnYuaXNfdmFsaWRfZnJvbSkgcmV0dXJuOwogICAgY29uc3QgeSA9IG5ldyBEYXRlKGludi5pc192YWxpZF9mcm9tKS5nZXRGdWxsWWVhcigpOwogICAgaWYgKCFjdXN0Rmlyc3RZZWFyW2ludi5jb250YWN0X2lkXSB8fCB5IDwgY3VzdEZpcnN0WWVhcltpbnYuY29udGFjdF9pZF0pIGN1c3RGaXJzdFllYXJbaW52LmNvbnRhY3RfaWRdID0geTsKICB9KTsKCiAgY29uc3QgY3VzdERldkJ5WWVhciA9IHt9OwogIHJldmVudWVJbnYuZm9yRWFjaChpbnYgPT4gewogICAgaWYgKCFpbnYuY29udGFjdF9pZCB8fCAhaW52LmlzX3ZhbGlkX2Zyb20pIHJldHVybjsKICAgIGNvbnN0IHkgPSBuZXcgRGF0ZShpbnYuaXNfdmFsaWRfZnJvbSkuZ2V0RnVsbFllYXIoKTsKICAgIGlmICghY3VzdERldkJ5WWVhclt5XSkgY3VzdERldkJ5WWVhclt5XSA9IHsgbmV3Q3VzdDogbmV3IFNldCgpLCBleGlzdEN1c3Q6IG5ldyBTZXQoKSB9OwogICAgaWYgKGN1c3RGaXJzdFllYXJbaW52LmNvbnRhY3RfaWRdID09PSB5KSBjdXN0RGV2QnlZZWFyW3ldLm5ld0N1c3QuYWRkKGludi5jb250YWN0X2lkKTsKICAgIGVsc2UgY3VzdERldkJ5WWVhclt5XS5leGlzdEN1c3QuYWRkKGludi5jb250YWN0X2lkKTsKICB9KTsKICBjb25zdCBjdXN0RGV2QXJyID0gT2JqZWN0LmVudHJpZXMoY3VzdERldkJ5WWVhcikubWFwKChbeSwgdl0pID0+ICh7CiAgICB5ZWFyOiBwYXJzZUludCh5KSwgbmV3Q291bnQ6IHYubmV3Q3VzdC5zaXplLCBleGlzdENvdW50OiB2LmV4aXN0Q3VzdC5zaXplCiAgfSkpLnNvcnQoKGEsIGIpID0+IGEueWVhciAtIGIueWVhcik7CgogIGNvbnN0IGN1ckN1c3REZXYgPSBjdXN0RGV2QXJyLmZpbmQoYyA9PiBjLnllYXIgPT09IGFjdGl2ZVllYXIpOwogIGNvbnN0IG5ld0N1c3RDdXJZZWFyID0gY3VyQ3VzdERldiA/IGN1ckN1c3REZXYubmV3Q291bnQgOiAwOwogIGNvbnN0IGV4aXN0Q3VzdEN1clllYXIgPSBjdXJDdXN0RGV2ID8gY3VyQ3VzdERldi5leGlzdENvdW50IDogMDsKCiAgLy8g4pSA4pSAIE1vbnRobHkgY29tcGFyaXNvbiDilIDilIAKICBmdW5jdGlvbiBtb250aGx5Rm9yWWVhcih5cikgewogICAgY29uc3QgbSA9IEFycmF5LmZyb20oe2xlbmd0aDogMTJ9LCAoKSA9PiAoeyByZXZlbnVlOiAwLCBjb3VudDogMCB9KSk7CiAgICBpbnZvaWNlcy5mb3JFYWNoKGludiA9PiB7CiAgICAgIGlmICghaW52LmlzX3ZhbGlkX2Zyb20gfHwgaW52LnN0YXR1cyA9PT0gImNhbmNlbGxlZCIgfHwgaW52LnN0YXR1cyA9PT0gImRyYWZ0IikgcmV0dXJuOwogICAgICBjb25zdCBkID0gbmV3IERhdGUoaW52LmlzX3ZhbGlkX2Zyb20pOwogICAgICBpZiAoZC5nZXRGdWxsWWVhcigpICE9PSB5cikgcmV0dXJuOwogICAgICBtW2QuZ2V0TW9udGgoKV0ucmV2ZW51ZSArPSBwYXJzZUZsb2F0KGludi50b3RhbF9uZXQgfHwgMCk7CiAgICAgIG1bZC5nZXRNb250aCgpXS5jb3VudCsrOwogICAgfSk7CiAgICByZXR1cm4gbTsKICB9CiAgY29uc3QgbW9udGhseUN1ciA9IG1vbnRobHlGb3JZZWFyKGFjdGl2ZVllYXIpOwogIGNvbnN0IG1vbnRobHlQcmV2ID0gbW9udGhseUZvclllYXIoYWN0aXZlWWVhciAtIDEpOwogIGNvbnN0IG1vbnRoTGFiZWxzID0gWyJKYW4iLCJGZWIiLCJNw6RyIiwiQXByIiwiTWFpIiwiSnVuIiwiSnVsIiwiQXVnIiwiU2VwIiwiT2t0IiwiTm92IiwiRGV6Il07CgogIHJldHVybiB7CiAgICB5ZWFybHlEYXRhLCB5ZWFycywgdG90YWxSZXZlbnVlLCBjdXJZZWFyUmV2LCB5b3ksIGlzWVRELAogICAgb3BlblRvdGFsLCBvcGVuQ291bnQ6IG9wZW5JbnYubGVuZ3RoLCBvcGVuTGlzdCwKICAgIGF2Z0ludkN1clllYXIsIGF2Z0ludkNoYW5nZSwgYXZnSW52QnlZZWFyLCBjdXJZZWFySW52Q291bnQ6IGN1clllYXJJbnYubGVuZ3RoLAogICAgcXVvdGVDb252LCB0b3RhbFF1b3RlcywgYWNjZXB0ZWRRdW90ZXMsIHBlbmRpbmdRdW90ZXMsIGRlY2xpbmVkUXVvdGVzLCBxdW90ZXNCeVllYXIsCiAgICB0b3BDdXN0LCB0b3BNYXgsIGNtLCBpbnZvaWNlQ291bnQ6IHJldmVudWVJbnYubGVuZ3RoLAogICAgYXZnRHNvQ3VyWWVhciwgYXZnRHNvTGFzdFllYXIsIGRzb1llYXJseUFyciwgZHNvQnVja2V0cywKICAgIG5ld0N1c3RDdXJZZWFyLCBleGlzdEN1c3RDdXJZZWFyLCBjdXN0RGV2QXJyLAogICAgbW9udGhseUN1ciwgbW9udGhseVByZXYsIG1vbnRoTGFiZWxzLAogIH07Cn0KCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovLyBSRU5ERVJJTkcKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCgpmdW5jdGlvbiByZW5kZXJEYXNoYm9hcmQoZCkgewogIGNvbnN0IGFwcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhcHAiKTsKCiAgY29uc3QgeWVhckJ0bnMgPSBkLnllYXJzLm1hcCh5ID0+CiAgICBgPGJ1dHRvbiBjbGFzcz0ieWVhci1idG4gbW9ubyAke3kgPT09IGFjdGl2ZVllYXIgPyAnYWN0aXZlJyA6ICcnfSIgb25jbGljaz0ic3dpdGNoWWVhcigke3l9KSI+JHt5fTwvYnV0dG9uPmAKICApLmpvaW4oIiIpOwoKICBjb25zdCBjdXN0Um93cyA9IGQudG9wQ3VzdC5tYXAoKGMsIGkpID0+IGAKICAgIDxkaXYgY2xhc3M9ImN1c3RvbWVyLXJvdyI+CiAgICAgIDxkaXYgY2xhc3M9ImN1c3RvbWVyLWhlYWRlciI+CiAgICAgICAgPHNwYW4gY2xhc3M9ImN1c3RvbWVyLW5hbWUiPjxzcGFuIGNsYXNzPSJjdXN0b21lci1yYW5rIG1vbm8iPiR7U3RyaW5nKGkrMSkucGFkU3RhcnQoMiwnMCcpfTwvc3Bhbj4keyhkLmNtW2MuaWRdIHx8ICcjJytjLmlkKS5zdWJzdHJpbmcoMCwgMzApfTwvc3Bhbj4KICAgICAgICA8c3BhbiBjbGFzcz0iY3VzdG9tZXItYW1vdW50IG1vbm8iPiR7Zm9ybWF0Q0hGKGMudG90YWwpfTwvc3Bhbj4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9Im1pbmktYmFyIj48ZGl2IGNsYXNzPSJtaW5pLWJhci1maWxsIiBzdHlsZT0id2lkdGg6ICR7KGMudG90YWwvZC50b3BNYXgqMTAwKS50b0ZpeGVkKDEpfSUiPjwvZGl2PjwvZGl2PgogICAgPC9kaXY+CiAgYCkuam9pbigiIik7CgogIGNvbnN0IGludlJvd3MgPSBkLm9wZW5MaXN0Lmxlbmd0aCA9PT0gMAogICAgPyBgPGRpdiBjbGFzcz0iZW1wdHktc3RhdGUiPjxkaXYgY2xhc3M9Imljb24iPuKckzwvZGl2PjxkaXY+S2VpbmUgb2ZmZW5lbiBSZWNobnVuZ2VuPC9kaXY+PC9kaXY+YAogICAgOiBkLm9wZW5MaXN0Lm1hcChpbnYgPT4gYAogICAgICA8ZGl2IGNsYXNzPSJpbnYtcm93Ij4KICAgICAgICA8ZGl2PgogICAgICAgICAgPGRpdiBjbGFzcz0iaW52LW5hbWUiPiR7KGQuY21baW52LmNvbnRhY3RfaWRdIHx8ICcjJytpbnYuY29udGFjdF9pZCkuc3Vic3RyaW5nKDAsIDI4KX08L2Rpdj4KICAgICAgICAgIDxkaXYgY2xhc3M9Imludi1kZXRhaWwgbW9ubyI+JHtpbnYuZG9jdW1lbnRfbnIgfHwgJ+KAkyd9IMK3ICR7aW52LmlzX3ZhbGlkX2Zyb20gPyBuZXcgRGF0ZShpbnYuaXNfdmFsaWRfZnJvbSkudG9Mb2NhbGVEYXRlU3RyaW5nKCdkZS1DSCcpIDogJ+KAkyd9PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPHNwYW4gY2xhc3M9Imludi1hbW91bnQgbW9ubyI+JHtmb3JtYXRDSEYoaW52LnRvdGFsX25ldCl9PC9zcGFuPgogICAgICA8L2Rpdj4KICAgIGApLmpvaW4oIiIpOwoKICAvLyBGdW5uZWwKICBjb25zdCBtYXhRID0gTWF0aC5tYXgoZC50b3RhbFF1b3RlcywgMSk7CiAgY29uc3QgZnVubmVsRGF0YSA9IFsKICAgIHsgbGFiZWw6ICJUb3RhbCIsIGNvdW50OiBkLnRvdGFsUXVvdGVzLCBwY3Q6IDEwMCwgY29sb3I6ICcjNGE5MGQ5JyB9LAogICAgeyBsYWJlbDogIkFuZ2Vub21tZW4iLCBjb3VudDogZC5hY2NlcHRlZFF1b3RlcywgcGN0OiAoZC5hY2NlcHRlZFF1b3Rlcy9tYXhRKjEwMCksIGNvbG9yOiAnIzJhNmY0ZScgfSwKICAgIHsgbGFiZWw6ICJPZmZlbiIsIGNvdW50OiBkLnBlbmRpbmdRdW90ZXMsIHBjdDogKGQucGVuZGluZ1F1b3Rlcy9tYXhRKjEwMCksIGNvbG9yOiAnI2U4YTU0YicgfSwKICAgIHsgbGFiZWw6ICJBYmdlbGVobnQiLCBjb3VudDogZC5kZWNsaW5lZFF1b3RlcywgcGN0OiAoZC5kZWNsaW5lZFF1b3Rlcy9tYXhRKjEwMCksIGNvbG9yOiAnI2ZmNmI2YicgfSwKICBdOwogIGNvbnN0IGZ1bm5lbFJvd3MgPSBmdW5uZWxEYXRhLm1hcChmID0+IGAKICAgIDxkaXYgY2xhc3M9ImZ1bm5lbC1yb3ciPgogICAgICA8c3BhbiBjbGFzcz0iZnVubmVsLWxhYmVsIG1vbm8iPiR7Zi5sYWJlbH08L3NwYW4+CiAgICAgIDxkaXYgY2xhc3M9ImZ1bm5lbC1iYXItd3JhcCI+CiAgICAgICAgPGRpdiBjbGFzcz0iZnVubmVsLWJhciIgc3R5bGU9IndpZHRoOiAke01hdGgubWF4KGYucGN0LCAyKX0lOyBiYWNrZ3JvdW5kOiAke2YuY29sb3J9OyI+JHtmLnBjdCA+IDE1ID8gZm9ybWF0TnVtKGYuY291bnQpIDogJyd9PC9kaXY+CiAgICAgIDwvZGl2PgogICAgICA8c3BhbiBjbGFzcz0iZnVubmVsLWNvdW50IG1vbm8iPiR7Zm9ybWF0TnVtKGYuY291bnQpfTwvc3Bhbj4KICAgIDwvZGl2PgogIGApLmpvaW4oIiIpOwoKICBjb25zdCB5b3lDbGFzcyA9IGQueW95ID4gMCA/ICJncmVlbiIgOiBkLnlveSA8IDAgPyAicmVkIiA6ICIiOwogIGNvbnN0IHlveVNpZ24gPSBkLnlveSA+IDAgPyAiKyIgOiAiIjsKICBjb25zdCBhdmdDaGdDbGFzcyA9IGQuYXZnSW52Q2hhbmdlID4gMCA/ICJncmVlbiIgOiBkLmF2Z0ludkNoYW5nZSA8IDAgPyAicmVkIiA6ICIiOwogIGNvbnN0IGF2Z0NoZ1NpZ24gPSBkLmF2Z0ludkNoYW5nZSA+IDAgPyAiKyIgOiAiIjsKICBjb25zdCBkc29DaGcgPSBkLmF2Z0Rzb0xhc3RZZWFyID4gMCA/IGQuYXZnRHNvQ3VyWWVhciAtIGQuYXZnRHNvTGFzdFllYXIgOiAwOwogIGNvbnN0IGRzb0NsYXNzID0gZHNvQ2hnIDwgMCA/ICJncmVlbiIgOiBkc29DaGcgPiAwID8gInJlZCIgOiAiIjsKICBjb25zdCBkc29TaWduID0gZHNvQ2hnID4gMCA/ICIrIiA6ICIiOwoKICBhcHAuaW5uZXJIVE1MID0gYAogICAgPGRpdiBjbGFzcz0iaGVhZGVyIj4KICAgICAgPGRpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJoZWFkZXItc3ViIG1vbm8iPkRyaXhsIFRyYW5zcG9ydGUgR21iSDwvZGl2PgogICAgICAgIDxoMT5GaW5hbmNlIERhc2hib2FyZDwvaDE+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBnYXA6IDEycHg7IGZsZXgtd3JhcDogd3JhcDsiPgogICAgICAgIDxkaXYgY2xhc3M9InllYXItYnRucyI+JHt5ZWFyQnRuc308L2Rpdj4KICAgICAgICA8YSBocmVmPSIvdmVyZ2xlaWNoLmh0bWwiIHN0eWxlPSJmb250LXNpemU6IDEycHg7IGNvbG9yOiAjNGVjZGM0OyB0ZXh0LWRlY29yYXRpb246IG5vbmU7IGJvcmRlcjogMXB4IHNvbGlkICMxYTNhNGE7IHBhZGRpbmc6IDZweCAxNHB4OyBib3JkZXItcmFkaXVzOiA2cHg7IGZvbnQtZmFtaWx5OiAnSmV0QnJhaW5zIE1vbm8nLCBtb25vc3BhY2U7IHRyYW5zaXRpb246IGFsbCAwLjJzOyIgb25tb3VzZW92ZXI9InRoaXMuc3R5bGUuYmFja2dyb3VuZD0nIzFhM2E0YSciIG9ubW91c2VvdXQ9InRoaXMuc3R5bGUuYmFja2dyb3VuZD0ndHJhbnNwYXJlbnQnIj7wn5OKIFBlcmlvZGVudmVyZ2xlaWNoIOKGkjwvYT4KICAgICAgICA8YSBocmVmPSIvY2FzaGZsb3cuaHRtbCIgc3R5bGU9ImZvbnQtc2l6ZTogMTJweDsgY29sb3I6ICM0ZWNkYzQ7IHRleHQtZGVjb3JhdGlvbjogbm9uZTsgYm9yZGVyOiAxcHggc29saWQgIzFhM2E0YTsgcGFkZGluZzogNnB4IDE0cHg7IGJvcmRlci1yYWRpdXM6IDZweDsgZm9udC1mYW1pbHk6ICdKZXRCcmFpbnMgTW9ubycsIG1vbm9zcGFjZTsgdHJhbnNpdGlvbjogYWxsIDAuMnM7IiBvbm1vdXNlb3Zlcj0idGhpcy5zdHlsZS5iYWNrZ3JvdW5kPScjMWEzYTRhJyIgb25tb3VzZW91dD0idGhpcy5zdHlsZS5iYWNrZ3JvdW5kPSd0cmFuc3BhcmVudCciPvCfkrAgQ2FzaGZsb3cg4oaSPC9hPgogICAgICAgIDxhIGhyZWY9Ii9jYXNoZmxvdy5odG1sIiBzdHlsZT0iZm9udC1zaXplOiAxMnB4OyBjb2xvcjogIzRlY2RjNDsgdGV4dC1kZWNvcmF0aW9uOiBub25lOyBib3JkZXI6IDFweCBzb2xpZCAjMWEzYTRhOyBwYWRkaW5nOiA2cHggMTRweDsgYm9yZGVyLXJhZGl1czogNnB4OyBmb250LWZhbWlseTogJ0pldEJyYWlucyBNb25vJywgbW9ub3NwYWNlOyB0cmFuc2l0aW9uOiBhbGwgMC4yczsiIG9ubW91c2VvdmVyPSJ0aGlzLnN0eWxlLmJhY2tncm91bmQ9JyMxYTNhNGEnIiBvbm1vdXNlb3V0PSJ0aGlzLnN0eWxlLmJhY2tncm91bmQ9J3RyYW5zcGFyZW50JyI+8J+SsCBDYXNoZmxvdyDihpI8L2E+CiAgICAgICAgPGEgaHJlZj0iL2FwaS9sb2dvdXQiIHN0eWxlPSJmb250LXNpemU6IDExcHg7IGNvbG9yOiAjNWE2YTdhOyB0ZXh0LWRlY29yYXRpb246IG5vbmU7IHBhZGRpbmc6IDZweCAxMHB4OyBib3JkZXItcmFkaXVzOiA2cHg7IGZvbnQtZmFtaWx5OiAnSmV0QnJhaW5zIE1vbm8nLCBtb25vc3BhY2U7IHRyYW5zaXRpb246IGFsbCAwLjJzOyIgb25tb3VzZW92ZXI9InRoaXMuc3R5bGUuY29sb3I9JyNmZjZiNmInIiBvbm1vdXNlb3V0PSJ0aGlzLnN0eWxlLmNvbG9yPScjNWE2YTdhJyI+4o+7IExvZ291dDwvYT4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KCiAgICA8ZGl2IGNsYXNzPSJzZWN0aW9uLXRpdGxlIG1vbm8iPvCfk4ogVW1zYXR6ICYgS2VubnphaGxlbjwvZGl2PgogICAgPGRpdiBjbGFzcz0ia3BpLWdyaWQiPgogICAgICA8ZGl2IGNsYXNzPSJrcGktY2FyZCBhY2NlbnQiPgogICAgICAgIDxkaXYgY2xhc3M9ImtwaS1sYWJlbCBtb25vIj7il4YgVW1zYXR6IEdlc2FtdDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImtwaS12YWx1ZSI+JHtmb3JtYXRDSEYoZC50b3RhbFJldmVudWUpfTwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImtwaS1zdWIgbW9ubyI+JHtmb3JtYXROdW0oZC5pbnZvaWNlQ291bnQpfSBSZWNobnVuZ2VuIChuZXR0byk8L2Rpdj4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9ImtwaS1jYXJkIGFjY2VudCI+CiAgICAgICAgPGRpdiBjbGFzcz0ia3BpLWxhYmVsIG1vbm8iPuKWsiBVbXNhdHogJHthY3RpdmVZZWFyfTwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImtwaS12YWx1ZSI+JHtmb3JtYXRDSEYoZC5jdXJZZWFyUmV2KX08L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJrcGktc3ViIG1vbm8gJHt5b3lDbGFzc30iPiR7ZC55b3kgIT09IDAgPyB5b3lTaWduICsgZC55b3kudG9GaXhlZCgxKSArICclIHZzICcgKyAoYWN0aXZlWWVhci0xKSArIChkLmlzWVREID8gJyAoWVREKScgOiAnJykgOiAn4oCTJ308L2Rpdj4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9ImtwaS1jYXJkIHdhcm4iPgogICAgICAgIDxkaXYgY2xhc3M9ImtwaS1sYWJlbCBtb25vIj7il4sgT2ZmZW5lIFJlY2hudW5nZW48L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJrcGktdmFsdWUiPiR7Zm9ybWF0Q0hGKGQub3BlblRvdGFsKX08L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJrcGktc3ViIG1vbm8iPiR7ZC5vcGVuQ291bnR9IG9mZmVuPC9kaXY+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJrcGktY2FyZCI+CiAgICAgICAgPGRpdiBjbGFzcz0ia3BpLWxhYmVsIG1vbm8iPuKJoSDDmCBSZWNobnVuZyAke2FjdGl2ZVllYXJ9PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0ia3BpLXZhbHVlIj4ke2Zvcm1hdENIRihkLmF2Z0ludkN1clllYXIpfTwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImtwaS1zdWIgbW9ubyAke2F2Z0NoZ0NsYXNzfSI+JHtkLmF2Z0ludkNoYW5nZSAhPT0gMCA/IGF2Z0NoZ1NpZ24gKyBkLmF2Z0ludkNoYW5nZS50b0ZpeGVkKDEpICsgJyUgdnMgJyArIChhY3RpdmVZZWFyLTEpIDogJ+KAkyd9IMK3ICR7ZC5jdXJZZWFySW52Q291bnR9IFN0azwvZGl2PgogICAgICA8L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0ia3BpLWNhcmQiPgogICAgICAgIDxkaXYgY2xhc3M9ImtwaS1sYWJlbCBtb25vIj7ij7Egw5ggWmFobHVuZ3NmcmlzdDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImtwaS12YWx1ZSI+JHtkLmF2Z0Rzb0N1clllYXIgPiAwID8gZC5hdmdEc29DdXJZZWFyLnRvRml4ZWQoMCkgKyAnIFRhZ2UnIDogJ+KAkyd9PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0ia3BpLXN1YiBtb25vICR7ZHNvQ2xhc3N9Ij4ke2Rzb0NoZyAhPT0gMCA/IGRzb1NpZ24gKyBkc29DaGcudG9GaXhlZCgwKSArICcgVGFnZSB2cyAnICsgKGFjdGl2ZVllYXItMSkgOiAn4oCTJ308L2Rpdj4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9ImtwaS1jYXJkIGluZm8iPgogICAgICAgIDxkaXYgY2xhc3M9ImtwaS1sYWJlbCBtb25vIj7il4cgT2ZmZXJ0LVF1b3RlPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0ia3BpLXZhbHVlIj4ke2QucXVvdGVDb252LnRvRml4ZWQoMCl9JTwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImtwaS1zdWIgbW9ubyI+JHtmb3JtYXROdW0oZC5hY2NlcHRlZFF1b3Rlcyl9IC8gJHtmb3JtYXROdW0oZC50b3RhbFF1b3Rlcyl9PC9kaXY+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0ic2VjdGlvbi10aXRsZSBtb25vIj7wn5OIIFVtc2F0emVudHdpY2tsdW5nPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJjaGFydHMtZ3JpZCI+CiAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LWNhcmQiPgogICAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LXRpdGxlIG1vbm8iPkphaHJlc3Vtc2F0eiAoTmV0dG8pPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtd3JhcCI+PGNhbnZhcyBpZD0ieWVhcmx5Q2hhcnQiPjwvY2FudmFzPjwvZGl2PgogICAgICA8L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtY2FyZCI+CiAgICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtdGl0bGUgbW9ubyI+TW9uYXRzdmVyZ2xlaWNoICR7YWN0aXZlWWVhcn0gdnMgJHthY3RpdmVZZWFyIC0gMX08L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJjaGFydC13cmFwIj48Y2FudmFzIGlkPSJtb250aENvbXBhcmVDaGFydCI+PC9jYW52YXM+PC9kaXY+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0ic2VjdGlvbi10aXRsZSBtb25vIj7wn5KwIFJlY2hudW5nZW4gJiBaYWhsdW5nc21vcmFsPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJjaGFydHMtZ3JpZCI+CiAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LWNhcmQiPgogICAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LXRpdGxlIG1vbm8iPsOYIFJlY2hudW5nc2JldHJhZyBwcm8gSmFocjwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LXdyYXAiPjxjYW52YXMgaWQ9ImF2Z0ludkNoYXJ0Ij48L2NhbnZhcz48L2Rpdj4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LWNhcmQiPgogICAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LXRpdGxlIG1vbm8iPsOYIFRhZ2UgYmlzIFphaGx1bmcgcHJvIEphaHI8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJjaGFydC13cmFwIj48Y2FudmFzIGlkPSJkc29DaGFydCI+PC9jYW52YXM+PC9kaXY+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0ic2VjdGlvbi10aXRsZSBtb25vIj7wn5OLIE9mZmVydGVuICYgS3VuZGVuPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJjaGFydHMtZ3JpZCI+CiAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LWNhcmQiPgogICAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LXRpdGxlIG1vbm8iPlphaGx1bmdzZnJpc3QtVmVydGVpbHVuZzwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LXdyYXAiPjxjYW52YXMgaWQ9ImRzb0J1Y2tldENoYXJ0Ij48L2NhbnZhcz48L2Rpdj4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LWNhcmQiPgogICAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LXRpdGxlIG1vbm8iPk9mZmVydGVuLVBpcGVsaW5lPC9kaXY+CiAgICAgICAgPGRpdiBzdHlsZT0icGFkZGluZy10b3A6IDhweDsiPiR7ZnVubmVsUm93c308L2Rpdj4KICAgICAgICA8ZGl2IHN0eWxlPSJtYXJnaW4tdG9wOiAxMnB4OyBmb250LXNpemU6IDExcHg7IGNvbG9yOiAjM2E0YTVhOyIgY2xhc3M9Im1vbm8iPkNvbnZlcnNpb246ICR7ZC5xdW90ZUNvbnYudG9GaXhlZCgxKX0lPC9kaXY+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0iY2hhcnRzLWdyaWQiPgogICAgICA8ZGl2IGNsYXNzPSJjaGFydC1jYXJkIj4KICAgICAgICA8ZGl2IGNsYXNzPSJjaGFydC10aXRsZSBtb25vIj5LdW5kZW5lbnR3aWNrbHVuZyAoTmV1IHZzLiBCZXN0YW5kKTwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LXdyYXAiPjxjYW52YXMgaWQ9ImN1c3REZXZDaGFydCI+PC9jYW52YXM+PC9kaXY+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJjaGFydC1jYXJkIj4KICAgICAgICA8ZGl2IGNsYXNzPSJjaGFydC10aXRsZSBtb25vIj5PZmZlcnQtUXVvdGUgcHJvIEphaHI8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJjaGFydC13cmFwIj48Y2FudmFzIGlkPSJxdW90ZVllYXJDaGFydCI+PC9jYW52YXM+PC9kaXY+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0ic2VjdGlvbi10aXRsZSBtb25vIj7wn5ORIERldGFpbHM8L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImJvdHRvbS1ncmlkIj4KICAgICAgPGRpdiBjbGFzcz0ibGlzdC1jYXJkIj4KICAgICAgICA8ZGl2IGNsYXNzPSJjaGFydC10aXRsZSBtb25vIj5Ub3AgS3VuZGVuIChVbXNhdHogR2VzYW10KTwvZGl2PgogICAgICAgICR7Y3VzdFJvd3N9CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJsaXN0LWNhcmQiPgogICAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LXRpdGxlIG1vbm8iPk9mZmVuZSBSZWNobnVuZ2VuPC9kaXY+CiAgICAgICAgJHtpbnZSb3dzfQogICAgICA8L2Rpdj4KICAgIDwvZGl2PgoKICAgIDxkaXYgY2xhc3M9ImZvb3RlciBtb25vIj4KICAgICAgRGF0ZW4gdmlhIGJleGlvIEFQSSDCtyBBa3R1YWxpc2llcnQ6ICR7bmV3IERhdGUoKS50b0xvY2FsZURhdGVTdHJpbmcoJ2RlLUNIJyl9ICR7bmV3IERhdGUoKS50b0xvY2FsZVRpbWVTdHJpbmcoJ2RlLUNIJyx7aG91cjonMi1kaWdpdCcsbWludXRlOicyLWRpZ2l0J30pfSDCtyBQb3dlcmVkIGJ5IFN1cGFiYXNlCiAgICA8L2Rpdj4KICBgOwoKICBkcmF3WWVhcmx5Q2hhcnQoZC55ZWFybHlEYXRhKTsKICBkcmF3TW9udGhDb21wYXJlQ2hhcnQoZC5tb250aGx5Q3VyLCBkLm1vbnRobHlQcmV2LCBkLm1vbnRoTGFiZWxzKTsKICBkcmF3QXZnSW52Q2hhcnQoZC5hdmdJbnZCeVllYXIpOwogIGRyYXdEc29DaGFydChkLmRzb1llYXJseUFycik7CiAgZHJhd0Rzb0J1Y2tldENoYXJ0KGQuZHNvQnVja2V0cyk7CiAgZHJhd0N1c3REZXZDaGFydChkLmN1c3REZXZBcnIpOwogIGRyYXdRdW90ZVllYXJDaGFydChkLnF1b3Rlc0J5WWVhciwgZC55ZWFycyk7Cn0KCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovLyBDSEFSVCBIRUxQRVJTCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAoKY29uc3QgY0RlZiA9IHsKICByZXNwb25zaXZlOiB0cnVlLCBtYWludGFpbkFzcGVjdFJhdGlvOiBmYWxzZSwKICBwbHVnaW5zOiB7IGxlZ2VuZDogeyBkaXNwbGF5OiBmYWxzZSB9LCB0b29sdGlwOiB7CiAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjMWEyMzMyJywgYm9yZGVyQ29sb3I6ICcjMmEzYTRhJywgYm9yZGVyV2lkdGg6IDEsCiAgICB0aXRsZUZvbnQ6IHsgZmFtaWx5OiAiJ0pldEJyYWlucyBNb25vJyIgfSwgYm9keUZvbnQ6IHsgZmFtaWx5OiAiJ0pldEJyYWlucyBNb25vJyIgfSwKICB9fSwKfTsKY29uc3QgYXggPSB7CiAgeDogeyBncmlkOiB7IGRpc3BsYXk6IGZhbHNlIH0sIHRpY2tzOiB7IGNvbG9yOiAnIzRhNWE2YScsIGZvbnQ6IHsgZmFtaWx5OiAiJ0pldEJyYWlucyBNb25vJyIsIHNpemU6IDExIH0gfSB9LAogIHk6IHsgZ3JpZDogeyBjb2xvcjogJyMxYTIzMzInIH0sIHRpY2tzOiB7IGNvbG9yOiAnIzNhNGE1YScsIGZvbnQ6IHsgZmFtaWx5OiAiJ0pldEJyYWlucyBNb25vJyIsIHNpemU6IDEwIH0gfSB9Cn07CmZ1bmN0aW9uIGRjKG4pIHsgaWYgKGNoYXJ0c1tuXSkgeyBjaGFydHNbbl0uZGVzdHJveSgpOyBkZWxldGUgY2hhcnRzW25dOyB9IH0KZnVuY3Rpb24gbGVnKCkgeyByZXR1cm4geyBkaXNwbGF5OiB0cnVlLCBwb3NpdGlvbjogJ3RvcCcsIGxhYmVsczogeyBjb2xvcjogJyM1YTZhN2EnLCBmb250OiB7IGZhbWlseTogIidKZXRCcmFpbnMgTW9ubyciLCBzaXplOiAxMCB9LCBib3hXaWR0aDogMTIsIHBhZGRpbmc6IDEyIH0gfTsgfQoKLy8g4pSA4pSAIDEpIFllYXJseSBSZXZlbnVlIOKUgOKUgApmdW5jdGlvbiBkcmF3WWVhcmx5Q2hhcnQoZGF0YSkgewogIGNvbnN0IGN0eCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd5ZWFybHlDaGFydCcpOyBpZiAoIWN0eCkgcmV0dXJuOyBkYygneWVhcmx5Jyk7CiAgY2hhcnRzLnllYXJseSA9IG5ldyBDaGFydChjdHgsIHsKICAgIHR5cGU6ICdiYXInLAogICAgZGF0YTogeyBsYWJlbHM6IGRhdGEubWFwKGQgPT4gZC55ZWFyKSwgZGF0YXNldHM6IFt7IGRhdGE6IGRhdGEubWFwKGQgPT4gZC5yZXZlbnVlKSwKICAgICAgYmFja2dyb3VuZENvbG9yOiBkYXRhLm1hcChkID0+IGQueWVhciA9PT0gYWN0aXZlWWVhciA/ICcjNGVjZGM0JyA6ICcjMmE2ZjRlJyksIGJvcmRlclJhZGl1czogNCwgYm9yZGVyU2tpcHBlZDogZmFsc2UgfV0gfSwKICAgIG9wdGlvbnM6IHsgLi4uY0RlZiwgc2NhbGVzOiB7IC4uLmF4LCB5OiB7IC4uLmF4LnksIHRpY2tzOiB7IC4uLmF4LnkudGlja3MsIGNhbGxiYWNrOiB2ID0+ICh2LzEwMDAwMDApLnRvRml4ZWQoMSkrJ00nIH0gfSB9LAogICAgICBwbHVnaW5zOiB7IC4uLmNEZWYucGx1Z2lucywgdG9vbHRpcDogeyAuLi5jRGVmLnBsdWdpbnMudG9vbHRpcCwgY2FsbGJhY2tzOiB7IGxhYmVsOiBjID0+IGZvcm1hdENIRihjLnJhdykgfSB9IH0gfQogIH0pOwp9CgovLyDilIDilIAgMikgTW9udGhseSBDb21wYXJlIOKUgOKUgApmdW5jdGlvbiBkcmF3TW9udGhDb21wYXJlQ2hhcnQoY3VyLCBwcmV2LCBsYWJlbHMpIHsKICBjb25zdCBjdHggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9udGhDb21wYXJlQ2hhcnQnKTsgaWYgKCFjdHgpIHJldHVybjsgZGMoJ21vbnRoQ29tcGFyZScpOwogIGNoYXJ0cy5tb250aENvbXBhcmUgPSBuZXcgQ2hhcnQoY3R4LCB7CiAgICB0eXBlOiAnYmFyJywKICAgIGRhdGE6IHsgbGFiZWxzLCBkYXRhc2V0czogWwogICAgICB7IGxhYmVsOiBgJHthY3RpdmVZZWFyfWAsIGRhdGE6IGN1ci5tYXAobSA9PiBtLnJldmVudWUpLCBiYWNrZ3JvdW5kQ29sb3I6ICcjNGVjZGM0JywgYm9yZGVyUmFkaXVzOiAzLCBib3JkZXJTa2lwcGVkOiBmYWxzZSB9LAogICAgICB7IGxhYmVsOiBgJHthY3RpdmVZZWFyLTF9YCwgZGF0YTogcHJldi5tYXAobSA9PiBtLnJldmVudWUpLCBiYWNrZ3JvdW5kQ29sb3I6ICcjMWEzYTRhJywgYm9yZGVyUmFkaXVzOiAzLCBib3JkZXJTa2lwcGVkOiBmYWxzZSB9LAogICAgXX0sCiAgICBvcHRpb25zOiB7IC4uLmNEZWYsIHBsdWdpbnM6IHsgbGVnZW5kOiBsZWcoKSwgdG9vbHRpcDogeyAuLi5jRGVmLnBsdWdpbnMudG9vbHRpcCwgY2FsbGJhY2tzOiB7IGxhYmVsOiBjID0+IGAke2MuZGF0YXNldC5sYWJlbH06ICR7Zm9ybWF0Q0hGKGMucmF3KX1gIH0gfSB9LAogICAgICBzY2FsZXM6IHsgLi4uYXgsIHk6IHsgLi4uYXgueSwgdGlja3M6IHsgLi4uYXgueS50aWNrcywgY2FsbGJhY2s6IHYgPT4gKHYvMTAwMCkudG9GaXhlZCgwKSsnSycgfSB9IH0gfQogIH0pOwp9CgovLyDilIDilIAgMykgQXZnIEludm9pY2Ug4pSA4pSACmZ1bmN0aW9uIGRyYXdBdmdJbnZDaGFydChkYXRhKSB7CiAgY29uc3QgY3R4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2F2Z0ludkNoYXJ0Jyk7IGlmICghY3R4KSByZXR1cm47IGRjKCdhdmdJbnYnKTsKICBjaGFydHMuYXZnSW52ID0gbmV3IENoYXJ0KGN0eCwgewogICAgdHlwZTogJ2xpbmUnLAogICAgZGF0YTogeyBsYWJlbHM6IGRhdGEubWFwKGQgPT4gZC55ZWFyKSwgZGF0YXNldHM6IFt7IGRhdGE6IGRhdGEubWFwKGQgPT4gZC5hdmcpLAogICAgICBib3JkZXJDb2xvcjogJyM2Y2I0ZWUnLCBiYWNrZ3JvdW5kQ29sb3I6ICdyZ2JhKDEwOCwxODAsMjM4LDAuMSknLCBmaWxsOiB0cnVlLCB0ZW5zaW9uOiAwLjMsCiAgICAgIHBvaW50QmFja2dyb3VuZENvbG9yOiAnIzZjYjRlZScsIHBvaW50UmFkaXVzOiA0LCBwb2ludEhvdmVyUmFkaXVzOiA3IH1dIH0sCiAgICBvcHRpb25zOiB7IC4uLmNEZWYsIHBsdWdpbnM6IHsgLi4uY0RlZi5wbHVnaW5zLCB0b29sdGlwOiB7IC4uLmNEZWYucGx1Z2lucy50b29sdGlwLAogICAgICBjYWxsYmFja3M6IHsgbGFiZWw6IGMgPT4gYMOYICR7Zm9ybWF0Q0hGKGMucmF3KX0gKCR7ZGF0YVtjLmRhdGFJbmRleF0uY291bnR9IFN0aylgIH0gfSB9LAogICAgICBzY2FsZXM6IHsgLi4uYXgsIHk6IHsgLi4uYXgueSwgdGlja3M6IHsgLi4uYXgueS50aWNrcywgY2FsbGJhY2s6IHYgPT4gZm9ybWF0Q0hGKHYpIH0gfSB9IH0KICB9KTsKfQoKLy8g4pSA4pSAIDQpIERTTyBieSBZZWFyIOKUgOKUgApmdW5jdGlvbiBkcmF3RHNvQ2hhcnQoZGF0YSkgewogIGNvbnN0IGN0eCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkc29DaGFydCcpOyBpZiAoIWN0eCkgcmV0dXJuOyBkYygnZHNvJyk7CiAgY2hhcnRzLmRzbyA9IG5ldyBDaGFydChjdHgsIHsKICAgIHR5cGU6ICdiYXInLAogICAgZGF0YTogeyBsYWJlbHM6IGRhdGEubWFwKGQgPT4gZC55ZWFyKSwgZGF0YXNldHM6IFt7IGRhdGE6IGRhdGEubWFwKGQgPT4gZC5hdmcpLAogICAgICBiYWNrZ3JvdW5kQ29sb3I6IGRhdGEubWFwKGQgPT4gZC5hdmcgPD0gMzAgPyAnIzJhNmY0ZScgOiBkLmF2ZyA8PSA0NSA/ICcjZThhNTRiJyA6ICcjZmY2YjZiJyksIGJvcmRlclJhZGl1czogNCwgYm9yZGVyU2tpcHBlZDogZmFsc2UgfV0gfSwKICAgIG9wdGlvbnM6IHsgLi4uY0RlZiwgcGx1Z2luczogeyAuLi5jRGVmLnBsdWdpbnMsIHRvb2x0aXA6IHsgLi4uY0RlZi5wbHVnaW5zLnRvb2x0aXAsCiAgICAgIGNhbGxiYWNrczogeyBsYWJlbDogYyA9PiBgw5ggJHtjLnJhdy50b0ZpeGVkKDEpfSBUYWdlICgke2RhdGFbYy5kYXRhSW5kZXhdLmNvdW50fSBaYWhsdW5nZW4pYCB9IH0gfSwKICAgICAgc2NhbGVzOiB7IC4uLmF4LCB5OiB7IC4uLmF4LnksIHRpY2tzOiB7IC4uLmF4LnkudGlja3MsIGNhbGxiYWNrOiB2ID0+IHYgKyAnIFQnIH0gfSB9IH0KICB9KTsKfQoKLy8g4pSA4pSAIDUpIERTTyBEaXN0cmlidXRpb24g4pSA4pSACmZ1bmN0aW9uIGRyYXdEc29CdWNrZXRDaGFydChidWNrZXRzKSB7CiAgY29uc3QgY3R4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rzb0J1Y2tldENoYXJ0Jyk7IGlmICghY3R4KSByZXR1cm47IGRjKCdkc29CdWNrZXQnKTsKICBjb25zdCBsYWJlbHMgPSBPYmplY3Qua2V5cyhidWNrZXRzKTsKICBjb25zdCB2YWx1ZXMgPSBPYmplY3QudmFsdWVzKGJ1Y2tldHMpOwogIGNvbnN0IGNvbG9ycyA9IFsnIzJhNmY0ZScsJyM0ZWNkYzQnLCcjZThhNTRiJywnI2ZmOGM0MicsJyNmZjZiNmInXTsKICBjaGFydHMuZHNvQnVja2V0ID0gbmV3IENoYXJ0KGN0eCwgewogICAgdHlwZTogJ2RvdWdobnV0JywKICAgIGRhdGE6IHsgbGFiZWxzLCBkYXRhc2V0czogW3sgZGF0YTogdmFsdWVzLCBiYWNrZ3JvdW5kQ29sb3I6IGNvbG9ycywgYm9yZGVyQ29sb3I6ICcjMTExODIwJywgYm9yZGVyV2lkdGg6IDMgfV0gfSwKICAgIG9wdGlvbnM6IHsgcmVzcG9uc2l2ZTogdHJ1ZSwgbWFpbnRhaW5Bc3BlY3RSYXRpbzogZmFsc2UsIHBsdWdpbnM6IHsKICAgICAgbGVnZW5kOiB7IHBvc2l0aW9uOiAncmlnaHQnLCBsYWJlbHM6IHsgY29sb3I6ICcjOGE5YWFhJywgZm9udDogeyBmYW1pbHk6ICInSmV0QnJhaW5zIE1vbm8nIiwgc2l6ZTogMTEgfSwgcGFkZGluZzogMTIgfSB9LAogICAgICB0b29sdGlwOiB7IC4uLmNEZWYucGx1Z2lucy50b29sdGlwLCBjYWxsYmFja3M6IHsKICAgICAgICBsYWJlbDogYyA9PiB7IGNvbnN0IHQgPSB2YWx1ZXMucmVkdWNlKChhLGIpID0+IGErYiwgMCk7IHJldHVybiBgJHtjLmxhYmVsfSBUYWdlOiAke2MucmF3fSAoJHsoYy5yYXcvdCoxMDApLnRvRml4ZWQoMCl9JSlgOyB9CiAgICAgIH19IH0gfQogIH0pOwp9CgovLyDilIDilIAgNikgQ3VzdG9tZXIgRGV2ZWxvcG1lbnQg4pSA4pSACmZ1bmN0aW9uIGRyYXdDdXN0RGV2Q2hhcnQoZGF0YSkgewogIGNvbnN0IGN0eCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdXN0RGV2Q2hhcnQnKTsgaWYgKCFjdHgpIHJldHVybjsgZGMoJ2N1c3REZXYnKTsKICBjaGFydHMuY3VzdERldiA9IG5ldyBDaGFydChjdHgsIHsKICAgIHR5cGU6ICdiYXInLAogICAgZGF0YTogeyBsYWJlbHM6IGRhdGEubWFwKGQgPT4gZC55ZWFyKSwgZGF0YXNldHM6IFsKICAgICAgeyBsYWJlbDogJ05ldWt1bmRlbicsIGRhdGE6IGRhdGEubWFwKGQgPT4gZC5uZXdDb3VudCksIGJhY2tncm91bmRDb2xvcjogJyM0ZWNkYzQnLCBib3JkZXJSYWRpdXM6IDMsIGJvcmRlclNraXBwZWQ6IGZhbHNlIH0sCiAgICAgIHsgbGFiZWw6ICdCZXN0YW5kc2t1bmRlbicsIGRhdGE6IGRhdGEubWFwKGQgPT4gZC5leGlzdENvdW50KSwgYmFja2dyb3VuZENvbG9yOiAnIzJhNmY0ZScsIGJvcmRlclJhZGl1czogMywgYm9yZGVyU2tpcHBlZDogZmFsc2UgfSwKICAgIF19LAogICAgb3B0aW9uczogeyAuLi5jRGVmLCBwbHVnaW5zOiB7IGxlZ2VuZDogbGVnKCksIHRvb2x0aXA6IHsgLi4uY0RlZi5wbHVnaW5zLnRvb2x0aXAsCiAgICAgIGNhbGxiYWNrczogeyBsYWJlbDogYyA9PiBgJHtjLmRhdGFzZXQubGFiZWx9OiAke2MucmF3fWAgfSB9IH0sCiAgICAgIHNjYWxlczogeyAuLi5heCwgeDogeyAuLi5heC54LCBzdGFja2VkOiB0cnVlIH0sIHk6IHsgLi4uYXgueSwgc3RhY2tlZDogdHJ1ZSB9IH0gfQogIH0pOwp9CgovLyDilIDilIAgNykgUXVvdGUgQ29udmVyc2lvbiBieSBZZWFyIOKUgOKUgApmdW5jdGlvbiBkcmF3UXVvdGVZZWFyQ2hhcnQoYnlZZWFyLCB5ZWFycykgewogIGNvbnN0IGN0eCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdW90ZVllYXJDaGFydCcpOyBpZiAoIWN0eCkgcmV0dXJuOyBkYygncXVvdGVZZWFyJyk7CiAgY29uc3QgeXJzID0geWVhcnMuZmlsdGVyKHkgPT4gYnlZZWFyW3ldKS5zb3J0KCk7CiAgY2hhcnRzLnF1b3RlWWVhciA9IG5ldyBDaGFydChjdHgsIHsKICAgIHR5cGU6ICdiYXInLAogICAgZGF0YTogeyBsYWJlbHM6IHlycywgZGF0YXNldHM6IFsKICAgICAgeyBsYWJlbDogJ0FuZ2Vub21tZW4nLCBkYXRhOiB5cnMubWFwKHkgPT4gYnlZZWFyW3ldPy5hY2NlcHRlZCB8fCAwKSwgYmFja2dyb3VuZENvbG9yOiAnIzJhNmY0ZScsIGJvcmRlclJhZGl1czogMiwgYm9yZGVyU2tpcHBlZDogZmFsc2UgfSwKICAgICAgeyBsYWJlbDogJ09mZmVuJywgZGF0YTogeXJzLm1hcCh5ID0+IGJ5WWVhclt5XT8ucGVuZGluZyB8fCAwKSwgYmFja2dyb3VuZENvbG9yOiAnI2U4YTU0YicsIGJvcmRlclJhZGl1czogMiwgYm9yZGVyU2tpcHBlZDogZmFsc2UgfSwKICAgICAgeyBsYWJlbDogJ0FiZ2VsZWhudCcsIGRhdGE6IHlycy5tYXAoeSA9PiBieVllYXJbeV0/LmRlY2xpbmVkIHx8IDApLCBiYWNrZ3JvdW5kQ29sb3I6ICcjZmY2YjZiJywgYm9yZGVyUmFkaXVzOiAyLCBib3JkZXJTa2lwcGVkOiBmYWxzZSB9LAogICAgXX0sCiAgICBvcHRpb25zOiB7IC4uLmNEZWYsIHBsdWdpbnM6IHsgbGVnZW5kOiBsZWcoKSB9LCBzY2FsZXM6IHsgLi4uYXgsIHg6IHsgLi4uYXgueCwgc3RhY2tlZDogdHJ1ZSB9LCB5OiB7IC4uLmF4LnksIHN0YWNrZWQ6IHRydWUgfSB9IH0KICB9KTsKfQoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIElOSVQKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCgphc3luYyBmdW5jdGlvbiBpbml0KCkgewogIGF3YWl0IGxvYWRBbGxEYXRhKCk7CiAgcmVuZGVyRGFzaGJvYXJkKHByb2Nlc3NEYXRhKCkpOwp9CgpmdW5jdGlvbiBzd2l0Y2hZZWFyKHkpIHsKICBhY3RpdmVZZWFyID0geTsKICByZW5kZXJEYXNoYm9hcmQocHJvY2Vzc0RhdGEoKSk7Cn0KCmluaXQoKS5jYXRjaChlcnIgPT4gewogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhcHAiKS5pbm5lckhUTUwgPSBgCiAgICA8ZGl2IGNsYXNzPSJsb2FkaW5nIiBzdHlsZT0iY29sb3I6ICNmZjZiNmI7IGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47IGdhcDogMTJweDsiPgogICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6IDE4cHg7Ij5GZWhsZXIgYmVpbSBMYWRlbjwvZGl2PgogICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6IDEzcHg7IGNvbG9yOiAjNWE2YTdhOyI+JHtlcnIubWVzc2FnZX08L2Rpdj4KICAgIDwvZGl2PmA7Cn0pOwo8L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+Cg==',
  '/vergleich.html': 'PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImRlIj4KPGhlYWQ+CjxtZXRhIGNoYXJzZXQ9IlVURi04Ij4KPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiPgo8dGl0bGU+RHJpeGwgVHJhbnNwb3J0ZSDigJMgUGVyaW9kZW52ZXJnbGVpY2g8L3RpdGxlPgo8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9jaGFydC5qc0A0LjQuMS9kaXN0L2NoYXJ0LnVtZC5taW4uanMiPjwvc2NyaXB0Pgo8bGluayBocmVmPSJodHRwczovL2ZvbnRzLmdvb2dsZWFwaXMuY29tL2NzczI/ZmFtaWx5PURNK1NhbnM6d2dodEA0MDA7NTAwOzYwMDs3MDAmZmFtaWx5PUpldEJyYWlucytNb25vOndnaHRANDAwOzUwMDs2MDAmZGlzcGxheT1zd2FwIiByZWw9InN0eWxlc2hlZXQiPgo8c3R5bGU+CiAgKiB7IG1hcmdpbjogMDsgcGFkZGluZzogMDsgYm94LXNpemluZzogYm9yZGVyLWJveDsgfQogIGJvZHkgeyBiYWNrZ3JvdW5kOiAjMGExMDE4OyBjb2xvcjogI2M4ZDJkYzsgZm9udC1mYW1pbHk6ICdETSBTYW5zJywgc2Fucy1zZXJpZjsgcGFkZGluZzogMjRweCAyMHB4OyBtaW4taGVpZ2h0OiAxMDB2aDsgfQogIC5jb250YWluZXIgeyBtYXgtd2lkdGg6IDEyMDBweDsgbWFyZ2luOiAwIGF1dG87IH0KICAubW9ubyB7IGZvbnQtZmFtaWx5OiAnSmV0QnJhaW5zIE1vbm8nLCBtb25vc3BhY2U7IH0KCiAgLyog4pSA4pSAIEhlYWRlciDilIDilIAgKi8KICAuaGVhZGVyIHsgZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOyBmbGV4LXdyYXA6IHdyYXA7IGdhcDogMTJweDsgbWFyZ2luLWJvdHRvbTogOHB4OyB9CiAgLmhlYWRlci1zdWIgeyBmb250LXNpemU6IDExcHg7IGZvbnQtd2VpZ2h0OiA2MDA7IGxldHRlci1zcGFjaW5nOiAwLjEyZW07IHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7IGNvbG9yOiAjMmE2ZjRlOyBtYXJnaW4tYm90dG9tOiA0cHg7IH0KICAuaGVhZGVyIGgxIHsgZm9udC1zaXplOiAyOHB4OyBmb250LXdlaWdodDogNzAwOyBjb2xvcjogI2U4ZWRmMjsgbGluZS1oZWlnaHQ6IDEuMjsgfQogIC5uYXYtbGluayB7IGZvbnQtc2l6ZTogMTJweDsgY29sb3I6ICM0ZWNkYzQ7IHRleHQtZGVjb3JhdGlvbjogbm9uZTsgYm9yZGVyOiAxcHggc29saWQgIzFhM2E0YTsgcGFkZGluZzogNnB4IDE0cHg7IGJvcmRlci1yYWRpdXM6IDZweDsgdHJhbnNpdGlvbjogYWxsIDAuMnM7IH0KICAubmF2LWxpbms6aG92ZXIgeyBiYWNrZ3JvdW5kOiAjMWEzYTRhOyBjb2xvcjogI2U4ZWRmMjsgfQoKICAvKiDilIDilIAgUGVyaW9kIFNlbGVjdG9yIOKUgOKUgCAqLwogIC5wZXJpb2QtYnVpbGRlciB7IGJhY2tncm91bmQ6ICMxMTE4MjA7IGJvcmRlcjogMXB4IHNvbGlkICMxYTIzMzI7IGJvcmRlci1yYWRpdXM6IDEycHg7IHBhZGRpbmc6IDIwcHggMjRweDsgbWFyZ2luOiAyMHB4IDAgMjhweDsgfQogIC5wYi10aXRsZSB7IGZvbnQtc2l6ZTogMTFweDsgZm9udC13ZWlnaHQ6IDcwMDsgbGV0dGVyLXNwYWNpbmc6IDAuMTJlbTsgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsgY29sb3I6ICMyYTZmNGU7IG1hcmdpbi1ib3R0b206IDE2cHg7IH0KICAucGItcm93IHsgZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGZsZXgtZW5kOyBnYXA6IDEycHg7IGZsZXgtd3JhcDogd3JhcDsgbWFyZ2luLWJvdHRvbTogMTJweDsgfQogIC5wYi1ncm91cCB7IGRpc3BsYXk6IGZsZXg7IGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47IGdhcDogNHB4OyB9CiAgLnBiLWxhYmVsIHsgZm9udC1zaXplOiAxMHB4OyBmb250LXdlaWdodDogNjAwOyBsZXR0ZXItc3BhY2luZzogMC4wOGVtOyB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOyBjb2xvcjogIzVhNmE3YTsgfQogIAogIHNlbGVjdCwgaW5wdXRbdHlwZT0iZGF0ZSJdIHsKICAgIGJhY2tncm91bmQ6ICMwYTEwMTg7IGJvcmRlcjogMXB4IHNvbGlkICMxYTIzMzI7IGNvbG9yOiAjYzhkMmRjOyBmb250LWZhbWlseTogJ0pldEJyYWlucyBNb25vJywgbW9ub3NwYWNlOwogICAgZm9udC1zaXplOiAxM3B4OyBwYWRkaW5nOiA4cHggMTJweDsgYm9yZGVyLXJhZGl1czogNnB4OyBvdXRsaW5lOiBub25lOyB0cmFuc2l0aW9uOiBib3JkZXIgMC4yczsKICB9CiAgc2VsZWN0OmZvY3VzLCBpbnB1dFt0eXBlPSJkYXRlIl06Zm9jdXMgeyBib3JkZXItY29sb3I6ICMyYTZmNGU7IH0KICBzZWxlY3Qgb3B0aW9uIHsgYmFja2dyb3VuZDogIzExMTgyMDsgY29sb3I6ICNjOGQyZGM7IH0KCiAgLnByZXNldC1idG5zIHsgZGlzcGxheTogZmxleDsgZ2FwOiA2cHg7IGZsZXgtd3JhcDogd3JhcDsgbWFyZ2luLWJvdHRvbTogMTRweDsgfQogIC5wcmVzZXQtYnRuIHsgcGFkZGluZzogNXB4IDEycHg7IGJvcmRlci1yYWRpdXM6IDVweDsgYm9yZGVyOiAxcHggc29saWQgIzFhMjMzMjsgY3Vyc29yOiBwb2ludGVyOyBmb250LXNpemU6IDExcHg7IGZvbnQtd2VpZ2h0OiA2MDA7CiAgICBmb250LWZhbWlseTogJ0pldEJyYWlucyBNb25vJywgbW9ub3NwYWNlOyBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsgY29sb3I6ICM1YTZhN2E7IHRyYW5zaXRpb246IGFsbCAwLjJzOyB9CiAgLnByZXNldC1idG46aG92ZXIgeyBib3JkZXItY29sb3I6ICMyYTZmNGU7IGNvbG9yOiAjOGE5YWFhOyB9CiAgLnByZXNldC1idG4uYWN0aXZlIHsgYmFja2dyb3VuZDogIzJhNmY0ZTsgYm9yZGVyLWNvbG9yOiAjMmE2ZjRlOyBjb2xvcjogI2U4ZWRmMjsgfQoKICAvKiBQZXJpb2QgY2hpcHMgKi8KICAucGVyaW9kLWNoaXBzIHsgZGlzcGxheTogZmxleDsgZ2FwOiA4cHg7IGZsZXgtd3JhcDogd3JhcDsgbWFyZ2luLXRvcDogMTJweDsgbWluLWhlaWdodDogMzZweDsgYWxpZ24taXRlbXM6IGNlbnRlcjsgfQogIC5jaGlwIHsgZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsgZ2FwOiA2cHg7IHBhZGRpbmc6IDZweCAxNHB4OyBib3JkZXItcmFkaXVzOiAyMHB4OyBmb250LXNpemU6IDEycHg7IGZvbnQtd2VpZ2h0OiA2MDA7CiAgICBmb250LWZhbWlseTogJ0pldEJyYWlucyBNb25vJywgbW9ub3NwYWNlOyBib3JkZXI6IDFweCBzb2xpZDsgfQogIC5jaGlwIC5yZW1vdmUgeyBjdXJzb3I6IHBvaW50ZXI7IG9wYWNpdHk6IDAuNjsgZm9udC1zaXplOiAxNHB4OyBsaW5lLWhlaWdodDogMTsgfQogIC5jaGlwIC5yZW1vdmU6aG92ZXIgeyBvcGFjaXR5OiAxOyB9CiAgLmNoaXAtZW1wdHkgeyBmb250LXNpemU6IDEycHg7IGNvbG9yOiAjM2E0YTVhOyBwYWRkaW5nOiA4cHggMDsgfQoKICAuYWRkLWJ0biB7IHBhZGRpbmc6IDdweCAxOHB4OyBib3JkZXItcmFkaXVzOiA2cHg7IGJvcmRlcjogbm9uZTsgY3Vyc29yOiBwb2ludGVyOyBmb250LXNpemU6IDEycHg7IGZvbnQtd2VpZ2h0OiA3MDA7CiAgICBmb250LWZhbWlseTogJ0pldEJyYWlucyBNb25vJywgbW9ub3NwYWNlOyBiYWNrZ3JvdW5kOiAjMmE2ZjRlOyBjb2xvcjogI2U4ZWRmMjsgdHJhbnNpdGlvbjogYWxsIDAuMnM7IH0KICAuYWRkLWJ0bjpob3ZlciB7IGJhY2tncm91bmQ6ICMzNTg4NmE7IH0KICAuYWRkLWJ0bjpkaXNhYmxlZCB7IG9wYWNpdHk6IDAuMzsgY3Vyc29yOiBub3QtYWxsb3dlZDsgfQoKICAuY29tcGFyZS1idG4geyBwYWRkaW5nOiAxMHB4IDI4cHg7IGJvcmRlci1yYWRpdXM6IDhweDsgYm9yZGVyOiBub25lOyBjdXJzb3I6IHBvaW50ZXI7IGZvbnQtc2l6ZTogMTNweDsgZm9udC13ZWlnaHQ6IDcwMDsKICAgIGZvbnQtZmFtaWx5OiAnSmV0QnJhaW5zIE1vbm8nLCBtb25vc3BhY2U7IGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsICMyYTZmNGUsICM0ZWNkYzQpOyBjb2xvcjogIzBhMTAxODsgdHJhbnNpdGlvbjogYWxsIDAuMnM7IGxldHRlci1zcGFjaW5nOiAwLjA0ZW07IH0KICAuY29tcGFyZS1idG46aG92ZXIgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTFweCk7IGJveC1zaGFkb3c6IDAgNHB4IDIwcHggcmdiYSg3OCwyMDUsMTk2LDAuMyk7IH0KICAuY29tcGFyZS1idG46ZGlzYWJsZWQgeyBvcGFjaXR5OiAwLjM7IGN1cnNvcjogbm90LWFsbG93ZWQ7IHRyYW5zZm9ybTogbm9uZTsgYm94LXNoYWRvdzogbm9uZTsgfQoKICAvKiDilIDilIAgUmVzdWx0cyDilIDilIAgKi8KICAuc2VjdGlvbi10aXRsZSB7IGZvbnQtc2l6ZTogMTFweDsgZm9udC13ZWlnaHQ6IDcwMDsgbGV0dGVyLXNwYWNpbmc6IDAuMTRlbTsgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsgY29sb3I6ICMyYTZmNGU7IG1hcmdpbjogMjhweCAwIDE0cHg7IH0KCiAgLnJlc3VsdC1ncmlkIHsgZGlzcGxheTogZ3JpZDsgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgMWZyOyBnYXA6IDEycHg7IG1hcmdpbi1ib3R0b206IDI0cHg7IH0KICAucmVzdWx0LWNhcmQgeyBiYWNrZ3JvdW5kOiAjMTExODIwOyBib3JkZXI6IDFweCBzb2xpZCAjMWEyMzMyOyBib3JkZXItcmFkaXVzOiAxMnB4OyBwYWRkaW5nOiAyMHB4OyB9CiAgLnJlc3VsdC1jYXJkLmZ1bGwgeyBncmlkLWNvbHVtbjogMSAvIC0xOyB9CiAgLmNoYXJ0LXRpdGxlIHsgZm9udC1zaXplOiAxM3B4OyBmb250LXdlaWdodDogNjAwOyBjb2xvcjogIzVhNmE3YTsgbGV0dGVyLXNwYWNpbmc6IDAuMDZlbTsgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsgbWFyZ2luLWJvdHRvbTogMTZweDsgfQogIC5jaGFydC13cmFwIHsgcG9zaXRpb246IHJlbGF0aXZlOyBoZWlnaHQ6IDMwMHB4OyB9CgogIC8qIENvbXBhcmUgdGFibGUgKi8KICAuY29tcGFyZS10YWJsZSB7IHdpZHRoOiAxMDAlOyBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlOyB9CiAgLmNvbXBhcmUtdGFibGUgdGggeyBmb250LXNpemU6IDExcHg7IGZvbnQtd2VpZ2h0OiA3MDA7IGxldHRlci1zcGFjaW5nOiAwLjA2ZW07IHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7IGNvbG9yOiAjNWE2YTdhOyAKICAgIHBhZGRpbmc6IDEwcHggMTJweDsgdGV4dC1hbGlnbjogbGVmdDsgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICMxYTIzMzI7IH0KICAuY29tcGFyZS10YWJsZSB0ZCB7IGZvbnQtc2l6ZTogMTNweDsgcGFkZGluZzogMTBweCAxMnB4OyBib3JkZXItYm90dG9tOiAxcHggc29saWQgIzBmMTYyMDsgfQogIC5jb21wYXJlLXRhYmxlIHRyOmhvdmVyIHRkIHsgYmFja2dyb3VuZDogIzBmMTYyMDsgfQogIC5jb21wYXJlLXRhYmxlIC5udW0geyB0ZXh0LWFsaWduOiByaWdodDsgZm9udC13ZWlnaHQ6IDYwMDsgfQogIC5jb21wYXJlLXRhYmxlIC5ncmVlbiB7IGNvbG9yOiAjNGVjZGM0OyB9CiAgLmNvbXBhcmUtdGFibGUgLnJlZCB7IGNvbG9yOiAjZmY2YjZiOyB9CiAgLmNvbXBhcmUtdGFibGUgLmxhYmVsIHsgY29sb3I6ICM4YTlhYWE7IH0KCiAgLmZvb3RlciB7IHRleHQtYWxpZ246IGNlbnRlcjsgcGFkZGluZzogMzJweCAwIDE2cHg7IGNvbG9yOiAjMmEzYTRhOyBmb250LXNpemU6IDExcHg7IH0KCiAgLmxvYWRpbmcgeyBkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsgbWluLWhlaWdodDogNDB2aDsgfQogIC5zcGlubmVyIHsgd2lkdGg6IDIwcHg7IGhlaWdodDogMjBweDsgYm9yZGVyOiAycHggc29saWQgIzRlY2RjNDsgYm9yZGVyLXRvcC1jb2xvcjogdHJhbnNwYXJlbnQ7IGJvcmRlci1yYWRpdXM6IDUwJTsgYW5pbWF0aW9uOiBzcGluIDFzIGxpbmVhciBpbmZpbml0ZTsgbWFyZ2luLXJpZ2h0OiAxMnB4OyB9CgogIC5lbXB0eS1oaW50IHsgdGV4dC1hbGlnbjogY2VudGVyOyBwYWRkaW5nOiA2MHB4IDIwcHg7IGNvbG9yOiAjM2E0YTVhOyB9CiAgLmVtcHR5LWhpbnQgLmljb24geyBmb250LXNpemU6IDQwcHg7IG1hcmdpbi1ib3R0b206IDEycHg7IH0KICAuZW1wdHktaGludCAudGV4dCB7IGZvbnQtc2l6ZTogMTRweDsgbGluZS1oZWlnaHQ6IDEuNjsgfQoKICBAa2V5ZnJhbWVzIHNwaW4geyB0byB7IHRyYW5zZm9ybTogcm90YXRlKDM2MGRlZyk7IH0gfQogIEBrZXlmcmFtZXMgZmFkZUluIHsgZnJvbSB7IG9wYWNpdHk6IDA7IHRyYW5zZm9ybTogdHJhbnNsYXRlWSg4cHgpOyB9IHRvIHsgb3BhY2l0eTogMTsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDApOyB9IH0KICAuZmFkZS1pbiB7IGFuaW1hdGlvbjogZmFkZUluIDAuNXMgZWFzZTsgfQoKICBAbWVkaWEgKG1heC13aWR0aDogNzY4cHgpIHsKICAgIC5yZXN1bHQtZ3JpZCB7IGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyOyB9CiAgICAucGItcm93IHsgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsgYWxpZ24taXRlbXM6IHN0cmV0Y2g7IH0KICAgIC5oZWFkZXIgaDEgeyBmb250LXNpemU6IDIycHg7IH0KICB9Cjwvc3R5bGU+CjwvaGVhZD4KPGJvZHk+CjxkaXYgY2xhc3M9ImNvbnRhaW5lciI+CgogIDxkaXYgY2xhc3M9ImhlYWRlciI+CiAgICA8ZGl2PgogICAgICA8ZGl2IGNsYXNzPSJoZWFkZXItc3ViIG1vbm8iPkRyaXhsIFRyYW5zcG9ydGUgR21iSDwvZGl2PgogICAgICA8aDE+UGVyaW9kZW52ZXJnbGVpY2g8L2gxPgogICAgPC9kaXY+CiAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBnYXA6IDhweDsgYWxpZ24taXRlbXM6IGNlbnRlcjsiPgogICAgICA8ZGl2IGNsYXNzPSJuYXYtbGlua3MiIHN0eWxlPSJkaXNwbGF5OmZsZXg7Z2FwOjhweCI+CiAgICAgICAgPGEgaHJlZj0iLyIgY2xhc3M9Im5hdi1saW5rIG1vbm8iPuKGkCBEYXNoYm9hcmQ8L2E+CiAgICAgICAgPGEgaHJlZj0iL2Nhc2hmbG93Lmh0bWwiIGNsYXNzPSJuYXYtbGluayBtb25vIj7wn5KwIENhc2hmbG93PC9hPgogICAgICA8L2Rpdj4KICAgICAgPGEgaHJlZj0iL2FwaS9sb2dvdXQiIGNsYXNzPSJtb25vIiBzdHlsZT0iZm9udC1zaXplOiAxMXB4OyBjb2xvcjogIzVhNmE3YTsgdGV4dC1kZWNvcmF0aW9uOiBub25lOyBwYWRkaW5nOiA2cHggMTBweDsgYm9yZGVyLXJhZGl1czogNnB4OyB0cmFuc2l0aW9uOiBhbGwgMC4yczsiIG9ubW91c2VvdmVyPSJ0aGlzLnN0eWxlLmNvbG9yPScjZmY2YjZiJyIgb25tb3VzZW91dD0idGhpcy5zdHlsZS5jb2xvcj0nIzVhNmE3YSciPuKPuyBMb2dvdXQ8L2E+CiAgICA8L2Rpdj4KICA8L2Rpdj4KCiAgPCEtLSDilZDilZDilZAgUEVSSU9EIEJVSUxERVIg4pWQ4pWQ4pWQIC0tPgogIDxkaXYgY2xhc3M9InBlcmlvZC1idWlsZGVyIiBpZD0iYnVpbGRlciI+CiAgICA8ZGl2IGNsYXNzPSJwYi10aXRsZSBtb25vIj5QZXJpb2RlbiBhdXN3w6RobGVuPC9kaXY+CgogICAgPCEtLSBQcmVzZXRzIC0tPgogICAgPGRpdiBjbGFzcz0icHJlc2V0LWJ0bnMiIGlkPSJwcmVzZXRCdG5zIj4KICAgICAgPGJ1dHRvbiBjbGFzcz0icHJlc2V0LWJ0biBtb25vIGFjdGl2ZSIgb25jbGljaz0ic2V0TW9kZSgncXVhcnRlcicpIj5RdWFydGFsZTwvYnV0dG9uPgogICAgICA8YnV0dG9uIGNsYXNzPSJwcmVzZXQtYnRuIG1vbm8iIG9uY2xpY2s9InNldE1vZGUoJ21vbnRoJykiPk1vbmF0ZTwvYnV0dG9uPgogICAgICA8YnV0dG9uIGNsYXNzPSJwcmVzZXQtYnRuIG1vbm8iIG9uY2xpY2s9InNldE1vZGUoJ3llYXInKSI+SmFocmU8L2J1dHRvbj4KICAgICAgPGJ1dHRvbiBjbGFzcz0icHJlc2V0LWJ0biBtb25vIiBvbmNsaWNrPSJzZXRNb2RlKCdjdXN0b20nKSI+RWlnZW5lciBaZWl0cmF1bTwvYnV0dG9uPgogICAgPC9kaXY+CgogICAgPCEtLSBRdWFydGVyIHNlbGVjdG9yIC0tPgogICAgPGRpdiBjbGFzcz0icGItcm93IiBpZD0icXVhcnRlclJvdyI+CiAgICAgIDxkaXYgY2xhc3M9InBiLWdyb3VwIj4KICAgICAgICA8c3BhbiBjbGFzcz0icGItbGFiZWwgbW9ubyI+UXVhcnRhbDwvc3Bhbj4KICAgICAgICA8c2VsZWN0IGlkPSJzZWxRdWFydGVyIj4KICAgICAgICAgIDxvcHRpb24gdmFsdWU9IjEiPlExIChKYW4g4oCTIE3DpHIpPC9vcHRpb24+CiAgICAgICAgICA8b3B0aW9uIHZhbHVlPSIyIj5RMiAoQXByIOKAkyBKdW4pPC9vcHRpb24+CiAgICAgICAgICA8b3B0aW9uIHZhbHVlPSIzIj5RMyAoSnVsIOKAkyBTZXApPC9vcHRpb24+CiAgICAgICAgICA8b3B0aW9uIHZhbHVlPSI0Ij5RNCAoT2t0IOKAkyBEZXopPC9vcHRpb24+CiAgICAgICAgPC9zZWxlY3Q+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJwYi1ncm91cCI+CiAgICAgICAgPHNwYW4gY2xhc3M9InBiLWxhYmVsIG1vbm8iPkphaHI8L3NwYW4+CiAgICAgICAgPHNlbGVjdCBpZD0ic2VsUXVhcnRlclllYXIiPjwvc2VsZWN0PgogICAgICA8L2Rpdj4KICAgICAgPGJ1dHRvbiBjbGFzcz0iYWRkLWJ0biBtb25vIiBvbmNsaWNrPSJhZGRQZXJpb2QoKSI+KyBIaW56dWbDvGdlbjwvYnV0dG9uPgogICAgPC9kaXY+CgogICAgPCEtLSBNb250aCBzZWxlY3RvciAtLT4KICAgIDxkaXYgY2xhc3M9InBiLXJvdyIgaWQ9Im1vbnRoUm93IiBzdHlsZT0iZGlzcGxheTpub25lOyI+CiAgICAgIDxkaXYgY2xhc3M9InBiLWdyb3VwIj4KICAgICAgICA8c3BhbiBjbGFzcz0icGItbGFiZWwgbW9ubyI+TW9uYXQ8L3NwYW4+CiAgICAgICAgPHNlbGVjdCBpZD0ic2VsTW9udGgiPgogICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iMSI+SmFudWFyPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iMiI+RmVicnVhcjwvb3B0aW9uPjxvcHRpb24gdmFsdWU9IjMiPk3DpHJ6PC9vcHRpb24+CiAgICAgICAgICA8b3B0aW9uIHZhbHVlPSI0Ij5BcHJpbDwvb3B0aW9uPjxvcHRpb24gdmFsdWU9IjUiPk1haTwvb3B0aW9uPjxvcHRpb24gdmFsdWU9IjYiPkp1bmk8L29wdGlvbj4KICAgICAgICAgIDxvcHRpb24gdmFsdWU9IjciPkp1bGk8L29wdGlvbj48b3B0aW9uIHZhbHVlPSI4Ij5BdWd1c3Q8L29wdGlvbj48b3B0aW9uIHZhbHVlPSI5Ij5TZXB0ZW1iZXI8L29wdGlvbj4KICAgICAgICAgIDxvcHRpb24gdmFsdWU9IjEwIj5Pa3RvYmVyPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iMTEiPk5vdmVtYmVyPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iMTIiPkRlemVtYmVyPC9vcHRpb24+CiAgICAgICAgPC9zZWxlY3Q+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJwYi1ncm91cCI+CiAgICAgICAgPHNwYW4gY2xhc3M9InBiLWxhYmVsIG1vbm8iPkphaHI8L3NwYW4+CiAgICAgICAgPHNlbGVjdCBpZD0ic2VsTW9udGhZZWFyIj48L3NlbGVjdD4KICAgICAgPC9kaXY+CiAgICAgIDxidXR0b24gY2xhc3M9ImFkZC1idG4gbW9ubyIgb25jbGljaz0iYWRkUGVyaW9kKCkiPisgSGluenVmw7xnZW48L2J1dHRvbj4KICAgIDwvZGl2PgoKICAgIDwhLS0gWWVhciBzZWxlY3RvciAtLT4KICAgIDxkaXYgY2xhc3M9InBiLXJvdyIgaWQ9InllYXJSb3ciIHN0eWxlPSJkaXNwbGF5Om5vbmU7Ij4KICAgICAgPGRpdiBjbGFzcz0icGItZ3JvdXAiPgogICAgICAgIDxzcGFuIGNsYXNzPSJwYi1sYWJlbCBtb25vIj5KYWhyPC9zcGFuPgogICAgICAgIDxzZWxlY3QgaWQ9InNlbFllYXIiPjwvc2VsZWN0PgogICAgICA8L2Rpdj4KICAgICAgPGJ1dHRvbiBjbGFzcz0iYWRkLWJ0biBtb25vIiBvbmNsaWNrPSJhZGRQZXJpb2QoKSI+KyBIaW56dWbDvGdlbjwvYnV0dG9uPgogICAgPC9kaXY+CgogICAgPCEtLSBDdXN0b20gc2VsZWN0b3IgLS0+CiAgICA8ZGl2IGNsYXNzPSJwYi1yb3ciIGlkPSJjdXN0b21Sb3ciIHN0eWxlPSJkaXNwbGF5Om5vbmU7Ij4KICAgICAgPGRpdiBjbGFzcz0icGItZ3JvdXAiPgogICAgICAgIDxzcGFuIGNsYXNzPSJwYi1sYWJlbCBtb25vIj5Wb248L3NwYW4+CiAgICAgICAgPGlucHV0IHR5cGU9ImRhdGUiIGlkPSJjdXN0b21Gcm9tIj4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9InBiLWdyb3VwIj4KICAgICAgICA8c3BhbiBjbGFzcz0icGItbGFiZWwgbW9ubyI+QmlzPC9zcGFuPgogICAgICAgIDxpbnB1dCB0eXBlPSJkYXRlIiBpZD0iY3VzdG9tVG8iPgogICAgICA8L2Rpdj4KICAgICAgPGJ1dHRvbiBjbGFzcz0iYWRkLWJ0biBtb25vIiBvbmNsaWNrPSJhZGRQZXJpb2QoKSI+KyBIaW56dWbDvGdlbjwvYnV0dG9uPgogICAgPC9kaXY+CgogICAgPCEtLSBTZWxlY3RlZCBwZXJpb2RzIC0tPgogICAgPGRpdiBjbGFzcz0icGVyaW9kLWNoaXBzIiBpZD0iY2hpcHMiPgogICAgICA8c3BhbiBjbGFzcz0iY2hpcC1lbXB0eSBtb25vIj5Ob2NoIGtlaW5lIFBlcmlvZGVuIGF1c2dld8OkaGx0IOKAkyBmw7xnZSBtaW5kZXN0ZW5zIDIgaGluenU8L3NwYW4+CiAgICA8L2Rpdj4KCiAgICA8ZGl2IHN0eWxlPSJtYXJnaW4tdG9wOiAxNnB4OyBkaXNwbGF5OiBmbGV4OyBnYXA6IDEycHg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7Ij4KICAgICAgPGJ1dHRvbiBjbGFzcz0iY29tcGFyZS1idG4gbW9ubyIgaWQ9ImNvbXBhcmVCdG4iIG9uY2xpY2s9InJ1bkNvbXBhcmlzb24oKSIgZGlzYWJsZWQ+VmVyZ2xlaWNoZW48L2J1dHRvbj4KICAgICAgPHNwYW4gaWQ9ImNvbXBhcmVIaW50IiBjbGFzcz0ibW9ubyIgc3R5bGU9ImZvbnQtc2l6ZTogMTFweDsgY29sb3I6ICMzYTRhNWE7Ij5NaW5kZXN0ZW5zIDIgUGVyaW9kZW4gd8OkaGxlbjwvc3Bhbj4KICAgIDwvZGl2PgogIDwvZGl2PgoKICA8IS0tIOKVkOKVkOKVkCBSRVNVTFRTIOKVkOKVkOKVkCAtLT4KICA8ZGl2IGlkPSJyZXN1bHRzIj4KICAgIDxkaXYgY2xhc3M9ImVtcHR5LWhpbnQiPgogICAgICA8ZGl2IGNsYXNzPSJpY29uIj7wn5OKPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9InRleHQiPlfDpGhsZSBvYmVuIFBlcmlvZGVuIGF1cyB1bmQga2xpY2tlIGF1ZiA8c3Ryb25nPlZlcmdsZWljaGVuPC9zdHJvbmc+LDxicj51bSBlaW5lbiBkZXRhaWxsaWVydGVuIFBlcmlvZGVudmVyZ2xlaWNoIHp1IGVyc3RlbGxlbi48L2Rpdj4KICAgIDwvZGl2PgogIDwvZGl2PgoKICA8ZGl2IGNsYXNzPSJmb290ZXIgbW9ubyI+CiAgICBEYXRlbiB2aWEgYmV4aW8gQVBJIMK3IFBvd2VyZWQgYnkgU3VwYWJhc2UKICA8L2Rpdj4KPC9kaXY+Cgo8c2NyaXB0Pgpjb25zdCBTVVBBQkFTRV9VUkwgPSAiaHR0cHM6Ly9uemZ3ZGVodWFjcndpc3VpeGR4dS5zdXBhYmFzZS5jbyI7CmNvbnN0IFNVUEFCQVNFX0tFWSA9ICJleUpoYkdjaU9pSklVekkxTmlJc0luUjVjQ0k2SWtwWFZDSjkuZXlKcGMzTWlPaUp6ZFhCaFltRnpaU0lzSW5KbFppSTZJbTU2Wm5ka1pXaDFZV055ZDJsemRXbDRaSGgxSWl3aWNtOXNaU0k2SW5ObGNuWnBZMlZmY205c1pTSXNJbWxoZENJNk1UYzNNVEkyT0RVek55d2laWGh3SWpveU1EZzJPRFEwTlRNM2ZRLl9qajVLSFV1bHBnQzFWSW5kMF83bS1Bc01BLU1raGNKc0RrTi0xeDV4WFUiOwoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIFNUQVRFCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAoKbGV0IG1vZGUgPSAicXVhcnRlciI7CmxldCBwZXJpb2RzID0gW107ICAvLyB7IGlkLCBsYWJlbCwgZnJvbSwgdG8sIGNvbG9yIH0KbGV0IGFsbERhdGEgPSBudWxsOwpsZXQgY2hhcnRJbnN0YW5jZXMgPSB7fTsKCmNvbnN0IENPTE9SUyA9IFsnIzRlY2RjNCcsJyNlOGE1NGInLCcjZmY2YjZiJywnIzZjYjRlZScsJyNhNzhiZmEnLCcjZjQ3MmI2JywnIzM0ZDM5OScsJyNmYmJmMjQnXTsKY29uc3QgTU9OVEhfTkFNRVMgPSBbIkphbiIsIkZlYiIsIk3DpHIiLCJBcHIiLCJNYWkiLCJKdW4iLCJKdWwiLCJBdWciLCJTZXAiLCJPa3QiLCJOb3YiLCJEZXoiXTsKCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovLyBEQVRBIExPQURJTkcKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCgphc3luYyBmdW5jdGlvbiBxdWVyeSh0YWJsZSwgcGFyYW1zID0gIiIpIHsKICBjb25zdCBhbGxSb3dzID0gW107CiAgbGV0IG9mZnNldCA9IDA7CiAgd2hpbGUgKHRydWUpIHsKICAgIGNvbnN0IHVybCA9IGAke1NVUEFCQVNFX1VSTH0vcmVzdC92MS8ke3RhYmxlfT8ke3BhcmFtc30mb2Zmc2V0PSR7b2Zmc2V0fSZsaW1pdD0xMDAwYDsKICAgIHRyeSB7CiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKHVybCwgeyBoZWFkZXJzOiB7IGFwaWtleTogU1VQQUJBU0VfS0VZLCBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7U1VQQUJBU0VfS0VZfWAsIFByZWZlcjogImNvdW50PWV4YWN0IiB9IH0pOwogICAgICBpZiAoIXJlcy5vaykgeyBjb25zb2xlLndhcm4oYCR7dGFibGV9QCR7b2Zmc2V0fTogSFRUUCAke3Jlcy5zdGF0dXN9YCk7IGJyZWFrOyB9CiAgICAgIGNvbnN0IGJhdGNoID0gYXdhaXQgcmVzLmpzb24oKTsKICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGJhdGNoKSB8fCBiYXRjaC5sZW5ndGggPT09IDApIGJyZWFrOwogICAgICBhbGxSb3dzLnB1c2goLi4uYmF0Y2gpOwogICAgICBjb25zb2xlLmxvZyhgICAke3RhYmxlfTogJHthbGxSb3dzLmxlbmd0aH0gKGJhdGNoICR7YmF0Y2gubGVuZ3RofSlgKTsKICAgICAgaWYgKGJhdGNoLmxlbmd0aCA8IDEwMDApIGJyZWFrOwogICAgICBvZmZzZXQgKz0gMTAwMDsKICAgIH0gY2F0Y2ggKGUpIHsgY29uc29sZS5lcnJvcihgJHt0YWJsZX1AJHtvZmZzZXR9OiBlcnJvcmAsIGUpOyBicmVhazsgfQogIH0KICBjb25zb2xlLmxvZyhg4pyTICR7dGFibGV9OiAke2FsbFJvd3MubGVuZ3RofSB0b3RhbGApOwogIHJldHVybiBhbGxSb3dzOwp9Cgphc3luYyBmdW5jdGlvbiBsb2FkRGF0YSgpIHsKICBpZiAoYWxsRGF0YSkgcmV0dXJuIGFsbERhdGE7CiAgY29uc29sZS5sb2coIkxvYWRpbmcgaW52b2ljZXMuLi4iKTsKICBjb25zdCBpbnZvaWNlcyA9IGF3YWl0IHF1ZXJ5KCJpbnZvaWNlcyIsICJzZWxlY3Q9aWQsaXNfdmFsaWRfZnJvbSx0b3RhbF9ncm9zcyx0b3RhbF9uZXQsc3RhdHVzLGNvbnRhY3RfaWQsZG9jdW1lbnRfbnIiKTsKICBjb25zb2xlLmxvZygiTG9hZGluZyBxdW90ZXMuLi4iKTsKICBjb25zdCBxdW90ZXMgPSBhd2FpdCBxdWVyeSgicXVvdGVzIiwgInNlbGVjdD1pZCxpc192YWxpZF9mcm9tLHRvdGFsX25ldCxzdGF0dXMsY3JlYXRlZF9hdCIpOwogIGNvbnNvbGUubG9nKCJMb2FkaW5nIGNvbnRhY3RzLi4uIik7CiAgY29uc3QgY29udGFjdHMgPSBhd2FpdCBxdWVyeSgiY29udGFjdHMiLCAic2VsZWN0PWlkLG5hbWVfMSxuYW1lXzIiKTsKICBjb25zb2xlLmxvZygiTG9hZGluZyBwYXltZW50cy4uLiIpOwogIGNvbnN0IHBheW1lbnRzID0gYXdhaXQgcXVlcnkoImluY29taW5nX3BheW1lbnRzIiwgInNlbGVjdD1pZCxpbnZvaWNlX2lkLHBheW1lbnRfZGF0ZSxhbW91bnQiKTsKICBjb25zdCBjbSA9IHt9OwogIGNvbnRhY3RzLmZvckVhY2goYyA9PiBjbVtjLmlkXSA9IFtjLm5hbWVfMSwgYy5uYW1lXzJdLmZpbHRlcihCb29sZWFuKS5qb2luKCIgIikpOwogIGNvbnN0IHBheU1hcCA9IHt9OwogIHBheW1lbnRzLmZvckVhY2gocCA9PiB7IGlmICghcGF5TWFwW3AuaW52b2ljZV9pZF0pIHBheU1hcFtwLmludm9pY2VfaWRdID0gW107IHBheU1hcFtwLmludm9pY2VfaWRdLnB1c2gocCk7IH0pOwogIGFsbERhdGEgPSB7IGludm9pY2VzLCBxdW90ZXMsIGNtLCBwYXlNYXAgfTsKICBjb25zb2xlLmxvZyhgPT09IEFMTCBMT0FERUQgPT09IGludjoke2ludm9pY2VzLmxlbmd0aH0gcXVvdGVzOiR7cXVvdGVzLmxlbmd0aH0gY29udGFjdHM6JHtjb250YWN0cy5sZW5ndGh9IHBheToke3BheW1lbnRzLmxlbmd0aH1gKTsKICByZXR1cm4gYWxsRGF0YTsKfQoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIFBFUklPRCBCVUlMREVSIFVJCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAoKZnVuY3Rpb24gcG9wdWxhdGVZZWFyU2VsZWN0cygpIHsKICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCk7CiAgY29uc3QgeWVhcnMgPSBbXTsKICBmb3IgKGxldCB5ID0gbm93OyB5ID49IDIwMTU7IHktLSkgeWVhcnMucHVzaCh5KTsKICBjb25zdCBodG1sID0geWVhcnMubWFwKHkgPT4gYDxvcHRpb24gdmFsdWU9IiR7eX0iPiR7eX08L29wdGlvbj5gKS5qb2luKCIiKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2VsUXVhcnRlclllYXIiKS5pbm5lckhUTUwgPSBodG1sOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzZWxNb250aFllYXIiKS5pbm5lckhUTUwgPSBodG1sOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzZWxZZWFyIikuaW5uZXJIVE1MID0gaHRtbDsKfQoKZnVuY3Rpb24gc2V0TW9kZShtKSB7CiAgbW9kZSA9IG07CiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLnByZXNldC1idG4iKS5mb3JFYWNoKGIgPT4gYi5jbGFzc0xpc3QucmVtb3ZlKCJhY3RpdmUiKSk7CiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLnByZXNldC1idG5bb25jbGljaz0ic2V0TW9kZSgnJHttfScpIl1gKS5jbGFzc0xpc3QuYWRkKCJhY3RpdmUiKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicXVhcnRlclJvdyIpLnN0eWxlLmRpc3BsYXkgPSBtID09PSAicXVhcnRlciIgPyAiZmxleCIgOiAibm9uZSI7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1vbnRoUm93Iikuc3R5bGUuZGlzcGxheSA9IG0gPT09ICJtb250aCIgPyAiZmxleCIgOiAibm9uZSI7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInllYXJSb3ciKS5zdHlsZS5kaXNwbGF5ID0gbSA9PT0gInllYXIiID8gImZsZXgiIDogIm5vbmUiOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjdXN0b21Sb3ciKS5zdHlsZS5kaXNwbGF5ID0gbSA9PT0gImN1c3RvbSIgPyAiZmxleCIgOiAibm9uZSI7Cn0KCmZ1bmN0aW9uIGFkZFBlcmlvZCgpIHsKICBsZXQgbGFiZWwsIGZyb20sIHRvOwoKICBpZiAobW9kZSA9PT0gInF1YXJ0ZXIiKSB7CiAgICBjb25zdCBxID0gcGFyc2VJbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNlbFF1YXJ0ZXIiKS52YWx1ZSk7CiAgICBjb25zdCB5ID0gcGFyc2VJbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNlbFF1YXJ0ZXJZZWFyIikudmFsdWUpOwogICAgbGFiZWwgPSBgUSR7cX0vJHt5fWA7CiAgICBjb25zdCBzbSA9IChxIC0gMSkgKiAzOwogICAgZnJvbSA9IG5ldyBEYXRlKHksIHNtLCAxKTsKICAgIHRvID0gbmV3IERhdGUoeSwgc20gKyAzLCAwKTsKICB9IGVsc2UgaWYgKG1vZGUgPT09ICJtb250aCIpIHsKICAgIGNvbnN0IG0gPSBwYXJzZUludChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2VsTW9udGgiKS52YWx1ZSk7CiAgICBjb25zdCB5ID0gcGFyc2VJbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNlbE1vbnRoWWVhciIpLnZhbHVlKTsKICAgIGxhYmVsID0gYCR7TU9OVEhfTkFNRVNbbS0xXX0gJHt5fWA7CiAgICBmcm9tID0gbmV3IERhdGUoeSwgbSAtIDEsIDEpOwogICAgdG8gPSBuZXcgRGF0ZSh5LCBtLCAwKTsKICB9IGVsc2UgaWYgKG1vZGUgPT09ICJ5ZWFyIikgewogICAgY29uc3QgeSA9IHBhcnNlSW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzZWxZZWFyIikudmFsdWUpOwogICAgbGFiZWwgPSBgJHt5fWA7CiAgICBmcm9tID0gbmV3IERhdGUoeSwgMCwgMSk7CiAgICB0byA9IG5ldyBEYXRlKHksIDExLCAzMSk7CiAgfSBlbHNlIHsKICAgIGNvbnN0IGZ2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImN1c3RvbUZyb20iKS52YWx1ZTsKICAgIGNvbnN0IHR2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImN1c3RvbVRvIikudmFsdWU7CiAgICBpZiAoIWZ2IHx8ICF0dikgcmV0dXJuOwogICAgZnJvbSA9IG5ldyBEYXRlKGZ2KTsKICAgIHRvID0gbmV3IERhdGUodHYpOwogICAgaWYgKGZyb20gPj0gdG8pIHJldHVybjsKICAgIGxhYmVsID0gYCR7ZnJvbS50b0xvY2FsZURhdGVTdHJpbmcoJ2RlLUNIJyl9IOKAkyAke3RvLnRvTG9jYWxlRGF0ZVN0cmluZygnZGUtQ0gnKX1gOwogIH0KCiAgLy8gQ2hlY2sgZHVwbGljYXRlCiAgaWYgKHBlcmlvZHMuZmluZChwID0+IHAubGFiZWwgPT09IGxhYmVsKSkgcmV0dXJuOwogIGlmIChwZXJpb2RzLmxlbmd0aCA+PSA4KSByZXR1cm47CgogIGNvbnN0IGNvbG9yID0gQ09MT1JTW3BlcmlvZHMubGVuZ3RoICUgQ09MT1JTLmxlbmd0aF07CiAgcGVyaW9kcy5wdXNoKHsgaWQ6IERhdGUubm93KCksIGxhYmVsLCBmcm9tLCB0bywgY29sb3IgfSk7CiAgcmVuZGVyQ2hpcHMoKTsKfQoKZnVuY3Rpb24gcmVtb3ZlUGVyaW9kKGlkKSB7CiAgcGVyaW9kcyA9IHBlcmlvZHMuZmlsdGVyKHAgPT4gcC5pZCAhPT0gaWQpOwogIC8vIFJlYXNzaWduIGNvbG9ycwogIHBlcmlvZHMuZm9yRWFjaCgocCwgaSkgPT4gcC5jb2xvciA9IENPTE9SU1tpICUgQ09MT1JTLmxlbmd0aF0pOwogIHJlbmRlckNoaXBzKCk7Cn0KCmZ1bmN0aW9uIHJlbmRlckNoaXBzKCkgewogIGNvbnN0IGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNoaXBzIik7CiAgaWYgKHBlcmlvZHMubGVuZ3RoID09PSAwKSB7CiAgICBlbC5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9ImNoaXAtZW1wdHkgbW9ubyI+Tm9jaCBrZWluZSBQZXJpb2RlbiBhdXNnZXfDpGhsdCDigJMgZsO8Z2UgbWluZGVzdGVucyAyIGhpbnp1PC9zcGFuPmA7CiAgfSBlbHNlIHsKICAgIGVsLmlubmVySFRNTCA9IHBlcmlvZHMubWFwKHAgPT4gYAogICAgICA8ZGl2IGNsYXNzPSJjaGlwIG1vbm8iIHN0eWxlPSJiYWNrZ3JvdW5kOiAke3AuY29sb3J9MTU7IGJvcmRlci1jb2xvcjogJHtwLmNvbG9yfTQwOyBjb2xvcjogJHtwLmNvbG9yfTsiPgogICAgICAgICR7cC5sYWJlbH0KICAgICAgICA8c3BhbiBjbGFzcz0icmVtb3ZlIiBvbmNsaWNrPSJyZW1vdmVQZXJpb2QoJHtwLmlkfSkiPuKclTwvc3Bhbj4KICAgICAgPC9kaXY+CiAgICBgKS5qb2luKCIiKTsKICB9CiAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvbXBhcmVCdG4iKTsKICBjb25zdCBoaW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvbXBhcmVIaW50Iik7CiAgYnRuLmRpc2FibGVkID0gcGVyaW9kcy5sZW5ndGggPCAyOwogIGhpbnQudGV4dENvbnRlbnQgPSBwZXJpb2RzLmxlbmd0aCA8IDIgPyBgTm9jaCAkezIgLSBwZXJpb2RzLmxlbmd0aH0gUGVyaW9kZShuKSBoaW56dWbDvGdlbmAgOiBgJHtwZXJpb2RzLmxlbmd0aH0gUGVyaW9kZW4gYmVyZWl0YDsKICBoaW50LnN0eWxlLmNvbG9yID0gcGVyaW9kcy5sZW5ndGggPj0gMiA/ICcjNGVjZGM0JyA6ICcjM2E0YTVhJzsKfQoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIENPTVBBUklTT04gTE9HSUMKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCgpmdW5jdGlvbiBmb3JtYXRDSEYodikgewogIGNvbnN0IG4gPSBwYXJzZUZsb2F0KHYpIHx8IDA7CiAgaWYgKE1hdGguYWJzKG4pID49IDEwMDAwMDApIHJldHVybiBgQ0hGICR7KG4vMTAwMDAwMCkudG9GaXhlZCgyKX0gTWlvYDsKICBpZiAoTWF0aC5hYnMobikgPj0gMTAwMDApIHJldHVybiBgQ0hGICR7KG4vMTAwMCkudG9GaXhlZCgwKX1LYDsKICBpZiAoTWF0aC5hYnMobikgPj0gMTAwMCkgcmV0dXJuIGBDSEYgJHsobi8xMDAwKS50b0ZpeGVkKDEpfUtgOwogIHJldHVybiBgQ0hGICR7bi50b0ZpeGVkKDApfWA7Cn0KZnVuY3Rpb24gZm9ybWF0TnVtKHYpIHsgcmV0dXJuIG5ldyBJbnRsLk51bWJlckZvcm1hdCgiZGUtQ0giKS5mb3JtYXQodiB8fCAwKTsgfQoKZnVuY3Rpb24gaW5QZXJpb2QoZGF0ZVN0ciwgZnJvbSwgdG8pIHsKICBpZiAoIWRhdGVTdHIpIHJldHVybiBmYWxzZTsKICBjb25zdCBkID0gbmV3IERhdGUoZGF0ZVN0cik7CiAgcmV0dXJuIGQgPj0gZnJvbSAmJiBkIDw9IHRvOwp9CgpmdW5jdGlvbiBjb21wdXRlUGVyaW9kU3RhdHMoZGF0YSwgcGVyaW9kKSB7CiAgY29uc3QgeyBpbnZvaWNlcywgcXVvdGVzLCBjbSwgcGF5TWFwIH0gPSBkYXRhOwogIGNvbnN0IHsgZnJvbSwgdG8gfSA9IHBlcmlvZDsKCiAgY29uc3QgaW52cyA9IGludm9pY2VzLmZpbHRlcihpID0+IGkuc3RhdHVzICE9PSAiY2FuY2VsbGVkIiAmJiBpLnN0YXR1cyAhPT0gImRyYWZ0IiAmJiBpblBlcmlvZChpLmlzX3ZhbGlkX2Zyb20sIGZyb20sIHRvKSk7CiAgY29uc3QgcmV2ZW51ZSA9IGludnMucmVkdWNlKChzLCBpKSA9PiBzICsgcGFyc2VGbG9hdChpLnRvdGFsX25ldCB8fCAwKSwgMCk7CiAgY29uc3QgY291bnQgPSBpbnZzLmxlbmd0aDsKICBjb25zdCBhdmcgPSBjb3VudCA+IDAgPyByZXZlbnVlIC8gY291bnQgOiAwOwoKICAvLyBVbmlxdWUgY3VzdG9tZXJzCiAgY29uc3QgY3VzdHMgPSBuZXcgU2V0KGludnMubWFwKGkgPT4gaS5jb250YWN0X2lkKS5maWx0ZXIoQm9vbGVhbikpOwoKICAvLyBRdW90ZXMKICBjb25zdCBxcyA9IHF1b3Rlcy5maWx0ZXIocSA9PiBpblBlcmlvZChxLmlzX3ZhbGlkX2Zyb20gfHwgcS5jcmVhdGVkX2F0LCBmcm9tLCB0bykpOwogIGNvbnN0IHFUb3RhbCA9IHFzLmxlbmd0aDsKICBjb25zdCBxQWNjZXB0ZWQgPSBxcy5maWx0ZXIocSA9PiBxLnN0YXR1cyA9PT0gImFjY2VwdGVkIikubGVuZ3RoOwogIGNvbnN0IHFDb252ID0gcVRvdGFsID4gMCA/IChxQWNjZXB0ZWQgLyBxVG90YWwgKiAxMDApIDogMDsKCiAgLy8gRFNPCiAgY29uc3QgcGFpZEludnMgPSBpbnZvaWNlcy5maWx0ZXIoaSA9PiBpLnN0YXR1cyA9PT0gInBhaWQiICYmIGluUGVyaW9kKGkuaXNfdmFsaWRfZnJvbSwgZnJvbSwgdG8pKTsKICBsZXQgZHNvU3VtID0gMCwgZHNvQ291bnQgPSAwOwogIHBhaWRJbnZzLmZvckVhY2goaW52ID0+IHsKICAgIGlmICghcGF5TWFwW2ludi5pZF0pIHJldHVybjsKICAgIGNvbnN0IHBheXMgPSBwYXlNYXBbaW52LmlkXS5maWx0ZXIocCA9PiBwLnBheW1lbnRfZGF0ZSk7CiAgICBpZiAocGF5cy5sZW5ndGggPT09IDApIHJldHVybjsKICAgIGNvbnN0IGxhc3RQYXkgPSBwYXlzLnNvcnQoKGEsIGIpID0+IG5ldyBEYXRlKGIucGF5bWVudF9kYXRlKSAtIG5ldyBEYXRlKGEucGF5bWVudF9kYXRlKSlbMF07CiAgICBjb25zdCBkYXlzID0gTWF0aC5yb3VuZCgobmV3IERhdGUobGFzdFBheS5wYXltZW50X2RhdGUpIC0gbmV3IERhdGUoaW52LmlzX3ZhbGlkX2Zyb20pKSAvIDg2NDAwMDAwKTsKICAgIGlmIChkYXlzID49IDAgJiYgZGF5cyA8IDM2NSkgeyBkc29TdW0gKz0gZGF5czsgZHNvQ291bnQrKzsgfQogIH0pOwogIGNvbnN0IGRzbyA9IGRzb0NvdW50ID4gMCA/IGRzb1N1bSAvIGRzb0NvdW50IDogMDsKCiAgLy8gVG9wIDUgY3VzdG9tZXJzIGluIHRoaXMgcGVyaW9kCiAgY29uc3QgY3VzdFJldiA9IHt9OwogIGludnMuZm9yRWFjaChpbnYgPT4gewogICAgaWYgKCFpbnYuY29udGFjdF9pZCkgcmV0dXJuOwogICAgaWYgKCFjdXN0UmV2W2ludi5jb250YWN0X2lkXSkgY3VzdFJldltpbnYuY29udGFjdF9pZF0gPSB7IGlkOiBpbnYuY29udGFjdF9pZCwgdG90YWw6IDAgfTsKICAgIGN1c3RSZXZbaW52LmNvbnRhY3RfaWRdLnRvdGFsICs9IHBhcnNlRmxvYXQoaW52LnRvdGFsX25ldCB8fCAwKTsKICB9KTsKICBjb25zdCB0b3BDdXN0ID0gT2JqZWN0LnZhbHVlcyhjdXN0UmV2KS5zb3J0KChhLCBiKSA9PiBiLnRvdGFsIC0gYS50b3RhbCkuc2xpY2UoMCwgNSk7CgogIC8vIE1vbnRobHkgYnJlYWtkb3duIHdpdGhpbiBwZXJpb2QKICBjb25zdCBtb250aGx5UmV2ID0ge307CiAgaW52cy5mb3JFYWNoKGludiA9PiB7CiAgICBjb25zdCBkID0gbmV3IERhdGUoaW52LmlzX3ZhbGlkX2Zyb20pOwogICAgY29uc3Qga2V5ID0gYCR7ZC5nZXRGdWxsWWVhcigpfS0ke1N0cmluZyhkLmdldE1vbnRoKCkrMSkucGFkU3RhcnQoMiwnMCcpfWA7CiAgICBtb250aGx5UmV2W2tleV0gPSAobW9udGhseVJldltrZXldIHx8IDApICsgcGFyc2VGbG9hdChpbnYudG90YWxfbmV0IHx8IDApOwogIH0pOwoKICByZXR1cm4geyByZXZlbnVlLCBjb3VudCwgYXZnLCBjdXN0b21lcnM6IGN1c3RzLnNpemUsIHFUb3RhbCwgcUFjY2VwdGVkLCBxQ29udiwgZHNvLCBkc29Db3VudCwgdG9wQ3VzdCwgbW9udGhseVJldiB9Owp9Cgphc3luYyBmdW5jdGlvbiBydW5Db21wYXJpc29uKCkgewogIGlmIChwZXJpb2RzLmxlbmd0aCA8IDIpIHJldHVybjsKCiAgY29uc3QgcmVzdWx0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyZXN1bHRzIik7CiAgcmVzdWx0cy5pbm5lckhUTUwgPSBgPGRpdiBjbGFzcz0ibG9hZGluZyI+PGRpdiBjbGFzcz0ic3Bpbm5lciI+PC9kaXY+PHNwYW4gc3R5bGU9ImNvbG9yOiAjNGVjZGM0OyI+TGFkZSAmIGJlcmVjaG5lLi4uPC9zcGFuPjwvZGl2PmA7CgogIGNvbnN0IGRhdGEgPSBhd2FpdCBsb2FkRGF0YSgpOwogIGNvbnN0IHN0YXRzID0gcGVyaW9kcy5tYXAocCA9PiAoeyAuLi5wLCBzdGF0czogY29tcHV0ZVBlcmlvZFN0YXRzKGRhdGEsIHApIH0pKTsKCiAgLy8gRGVzdHJveSBvbGQgY2hhcnRzCiAgT2JqZWN0LnZhbHVlcyhjaGFydEluc3RhbmNlcykuZm9yRWFjaChjID0+IGMuZGVzdHJveSgpKTsKICBjaGFydEluc3RhbmNlcyA9IHt9OwoKICByZW5kZXJSZXN1bHRzKHN0YXRzLCBkYXRhLmNtKTsKfQoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIFJFU1VMVFMgUkVOREVSSU5HCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAoKZnVuY3Rpb24gcmVuZGVyUmVzdWx0cyhzdGF0cywgY20pIHsKICBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyZXN1bHRzIik7CgogIC8vIEJlc3QgcGVyaW9kIGZvciBlYWNoIG1ldHJpYwogIGNvbnN0IGJlc3RSZXYgPSBNYXRoLm1heCguLi5zdGF0cy5tYXAocyA9PiBzLnN0YXRzLnJldmVudWUpKTsKICBjb25zdCBiZXN0QXZnID0gTWF0aC5tYXgoLi4uc3RhdHMubWFwKHMgPT4gcy5zdGF0cy5hdmcpKTsKICBjb25zdCBiZXN0RHNvID0gTWF0aC5taW4oLi4uc3RhdHMuZmlsdGVyKHMgPT4gcy5zdGF0cy5kc28gPiAwKS5tYXAocyA9PiBzLnN0YXRzLmRzbykpIHx8IDA7CiAgY29uc3QgYmVzdENvbnYgPSBNYXRoLm1heCguLi5zdGF0cy5tYXAocyA9PiBzLnN0YXRzLnFDb252KSk7CgogIC8vIENvbXBhcmlzb24gdGFibGUgcm93cwogIGNvbnN0IG1ldHJpY3MgPSBbCiAgICB7IGxhYmVsOiAiVW1zYXR6IChOZXR0bykiLCBrZXk6ICJyZXZlbnVlIiwgZm10OiBmb3JtYXRDSEYsIGJlc3Q6ICJtYXgiIH0sCiAgICB7IGxhYmVsOiAiQW56YWhsIFJlY2hudW5nZW4iLCBrZXk6ICJjb3VudCIsIGZtdDogZm9ybWF0TnVtLCBiZXN0OiAibWF4IiB9LAogICAgeyBsYWJlbDogIsOYIFJlY2hudW5nc2JldHJhZyIsIGtleTogImF2ZyIsIGZtdDogZm9ybWF0Q0hGLCBiZXN0OiAibWF4IiB9LAogICAgeyBsYWJlbDogIkFrdGl2ZSBLdW5kZW4iLCBrZXk6ICJjdXN0b21lcnMiLCBmbXQ6IGZvcm1hdE51bSwgYmVzdDogIm1heCIgfSwKICAgIHsgbGFiZWw6ICJPZmZlcnRlbiBUb3RhbCIsIGtleTogInFUb3RhbCIsIGZtdDogZm9ybWF0TnVtLCBiZXN0OiAibWF4IiB9LAogICAgeyBsYWJlbDogIk9mZmVydGVuIGFuZ2Vub21tZW4iLCBrZXk6ICJxQWNjZXB0ZWQiLCBmbXQ6IGZvcm1hdE51bSwgYmVzdDogIm1heCIgfSwKICAgIHsgbGFiZWw6ICJPZmZlcnQtUXVvdGUiLCBrZXk6ICJxQ29udiIsIGZtdDogdiA9PiB2LnRvRml4ZWQoMSkgKyAiJSIsIGJlc3Q6ICJtYXgiIH0sCiAgICB7IGxhYmVsOiAiw5ggWmFobHVuZ3NmcmlzdCIsIGtleTogImRzbyIsIGZtdDogdiA9PiB2ID4gMCA/IHYudG9GaXhlZCgwKSArICIgVGFnZSIgOiAi4oCTIiwgYmVzdDogIm1pbiIgfSwKICBdOwoKICBjb25zdCB0YWJsZUhlYWRlciA9IGA8dGggY2xhc3M9Im1vbm8gbGFiZWwiPktlbm56YWhsPC90aD5gICsgc3RhdHMubWFwKHMgPT4KICAgIGA8dGggY2xhc3M9Im1vbm8gbnVtIiBzdHlsZT0iY29sb3I6ICR7cy5jb2xvcn07Ij4ke3MubGFiZWx9PC90aD5gCiAgKS5qb2luKCIiKSArIGA8dGggY2xhc3M9Im1vbm8gbnVtIj7OlDwvdGg+YDsKCiAgY29uc3QgdGFibGVSb3dzID0gbWV0cmljcy5tYXAobSA9PiB7CiAgICBjb25zdCB2YWxzID0gc3RhdHMubWFwKHMgPT4gcy5zdGF0c1ttLmtleV0pOwogICAgY29uc3QgYmVzdCA9IG0uYmVzdCA9PT0gIm1heCIgPyBNYXRoLm1heCguLi52YWxzKSA6IE1hdGgubWluKC4uLnZhbHMuZmlsdGVyKHYgPT4gdiA+IDApKTsKICAgIGNvbnN0IGZpcnN0ID0gdmFsc1swXSwgbGFzdCA9IHZhbHNbdmFscy5sZW5ndGggLSAxXTsKICAgIGxldCBkZWx0YSA9ICIiOwogICAgaWYgKG0ua2V5ID09PSAiZHNvIikgewogICAgICBpZiAoZmlyc3QgPiAwICYmIGxhc3QgPiAwKSB7CiAgICAgICAgY29uc3QgZGlmZiA9IGxhc3QgLSBmaXJzdDsKICAgICAgICBkZWx0YSA9IGA8c3BhbiBjbGFzcz0iJHtkaWZmIDwgMCA/ICdncmVlbicgOiBkaWZmID4gMCA/ICdyZWQnIDogJyd9Ij4ke2RpZmYgPiAwID8gJysnIDogJyd9JHtkaWZmLnRvRml4ZWQoMCl9IFQ8L3NwYW4+YDsKICAgICAgfQogICAgfSBlbHNlIGlmIChtLmtleSA9PT0gInFDb252IikgewogICAgICBjb25zdCBkaWZmID0gbGFzdCAtIGZpcnN0OwogICAgICBkZWx0YSA9IGA8c3BhbiBjbGFzcz0iJHtkaWZmID4gMCA/ICdncmVlbicgOiBkaWZmIDwgMCA/ICdyZWQnIDogJyd9Ij4ke2RpZmYgPiAwID8gJysnIDogJyd9JHtkaWZmLnRvRml4ZWQoMSl9JTwvc3Bhbj5gOwogICAgfSBlbHNlIGlmIChmaXJzdCA+IDApIHsKICAgICAgY29uc3QgcGN0RGlmZiA9ICgobGFzdCAtIGZpcnN0KSAvIGZpcnN0ICogMTAwKTsKICAgICAgZGVsdGEgPSBgPHNwYW4gY2xhc3M9IiR7cGN0RGlmZiA+IDAgPyAnZ3JlZW4nIDogcGN0RGlmZiA8IDAgPyAncmVkJyA6ICcnfSI+JHtwY3REaWZmID4gMCA/ICcrJyA6ICcnfSR7cGN0RGlmZi50b0ZpeGVkKDEpfSU8L3NwYW4+YDsKICAgIH0KCiAgICByZXR1cm4gYDx0cj4KICAgICAgPHRkIGNsYXNzPSJsYWJlbCBtb25vIj4ke20ubGFiZWx9PC90ZD4KICAgICAgJHt2YWxzLm1hcCgodiwgaSkgPT4gewogICAgICAgIGNvbnN0IGlzQmVzdCA9IG0uYmVzdCA9PT0gIm1heCIgPyB2ID09PSBiZXN0ICYmIHYgPiAwIDogdiA9PT0gYmVzdCAmJiB2ID4gMDsKICAgICAgICByZXR1cm4gYDx0ZCBjbGFzcz0ibnVtIG1vbm8iIHN0eWxlPSIke2lzQmVzdCA/ICdjb2xvcjogIzRlY2RjNDsgZm9udC13ZWlnaHQ6IDcwMDsnIDogJyd9Ij4ke20uZm10KHYpfTwvdGQ+YDsKICAgICAgfSkuam9pbigiIil9CiAgICAgIDx0ZCBjbGFzcz0ibnVtIG1vbm8iPiR7ZGVsdGF9PC90ZD4KICAgIDwvdHI+YDsKICB9KS5qb2luKCIiKTsKCiAgZWwuaW5uZXJIVE1MID0gYAogICAgPGRpdiBjbGFzcz0iZmFkZS1pbiI+CiAgICAgIDwhLS0gQ29tcGFyaXNvbiBUYWJsZSAtLT4KICAgICAgPGRpdiBjbGFzcz0ic2VjdGlvbi10aXRsZSBtb25vIj7wn5OKIEtlbm56YWhsZW4tVmVyZ2xlaWNoPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9InJlc3VsdC1jYXJkIiBzdHlsZT0iYmFja2dyb3VuZDogIzExMTgyMDsgYm9yZGVyOiAxcHggc29saWQgIzFhMjMzMjsgYm9yZGVyLXJhZGl1czogMTJweDsgcGFkZGluZzogMjBweDsgbWFyZ2luLWJvdHRvbTogMjRweDsgb3ZlcmZsb3cteDogYXV0bzsiPgogICAgICAgIDx0YWJsZSBjbGFzcz0iY29tcGFyZS10YWJsZSI+CiAgICAgICAgICA8dGhlYWQ+PHRyPiR7dGFibGVIZWFkZXJ9PC90cj48L3RoZWFkPgogICAgICAgICAgPHRib2R5PiR7dGFibGVSb3dzfTwvdGJvZHk+CiAgICAgICAgPC90YWJsZT4KICAgICAgPC9kaXY+CgogICAgICA8IS0tIENoYXJ0cyAtLT4KICAgICAgPGRpdiBjbGFzcz0ic2VjdGlvbi10aXRsZSBtb25vIj7wn5OIIFZpc3VhbGlzaWVydW5nZW48L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0icmVzdWx0LWdyaWQiPgogICAgICAgIDxkaXYgY2xhc3M9InJlc3VsdC1jYXJkIj4KICAgICAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LXRpdGxlIG1vbm8iPlVtc2F0ei1WZXJnbGVpY2g8L2Rpdj4KICAgICAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LXdyYXAiPjxjYW52YXMgaWQ9ImNtcFJldmVudWVDaGFydCI+PC9jYW52YXM+PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0icmVzdWx0LWNhcmQiPgogICAgICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtdGl0bGUgbW9ubyI+w5ggUmVjaG51bmdzYmV0cmFnPC9kaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJjaGFydC13cmFwIj48Y2FudmFzIGlkPSJjbXBBdmdDaGFydCI+PC9jYW52YXM+PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0icmVzdWx0LWNhcmQiPgogICAgICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtdGl0bGUgbW9ubyI+UmVjaG51bmdlbiAmIEt1bmRlbjwvZGl2PgogICAgICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtd3JhcCI+PGNhbnZhcyBpZD0iY21wQ291bnRDaGFydCI+PC9jYW52YXM+PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0icmVzdWx0LWNhcmQiPgogICAgICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtdGl0bGUgbW9ubyI+T2ZmZXJ0ZW4gJiBaYWhsdW5nc21vcmFsPC9kaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJjaGFydC13cmFwIj48Y2FudmFzIGlkPSJjbXBNaXhDaGFydCI+PC9jYW52YXM+PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgoKICAgICAgPCEtLSBUb3AgS3VuZGVuIHBlciBQZXJpb2QgLS0+CiAgICAgIDxkaXYgY2xhc3M9InNlY3Rpb24tdGl0bGUgbW9ubyI+8J+RpSBUb3AgS3VuZGVuIHBybyBQZXJpb2RlPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9InJlc3VsdC1ncmlkIj4KICAgICAgICAke3N0YXRzLm1hcChzID0+IGAKICAgICAgICAgIDxkaXYgY2xhc3M9InJlc3VsdC1jYXJkIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtdGl0bGUgbW9ubyIgc3R5bGU9ImNvbG9yOiAke3MuY29sb3J9OyI+JHtzLmxhYmVsfTwvZGl2PgogICAgICAgICAgICAke3Muc3RhdHMudG9wQ3VzdC5sZW5ndGggPT09IDAgPyAnPGRpdiBzdHlsZT0iY29sb3I6ICMzYTRhNWE7IGZvbnQtc2l6ZTogMTNweDsiPktlaW5lIERhdGVuPC9kaXY+JyA6CiAgICAgICAgICAgICAgcy5zdGF0cy50b3BDdXN0Lm1hcCgoYywgaSkgPT4gYAogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTogZmxleDsganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOyBwYWRkaW5nOiA2cHggMDsgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICMwZjE2MjA7Ij4KICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im1vbm8iIHN0eWxlPSJmb250LXNpemU6IDEycHg7IGNvbG9yOiAjOGE5YWFhOyI+PHNwYW4gc3R5bGU9ImNvbG9yOiAjM2E0YTVhOyBtYXJnaW4tcmlnaHQ6IDZweDsiPiR7aSsxfS48L3NwYW4+JHsoY21bYy5pZF0gfHwgJyMnK2MuaWQpLnN1YnN0cmluZygwLCAyNSl9PC9zcGFuPgogICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ibW9ubyIgc3R5bGU9ImZvbnQtc2l6ZTogMTJweDsgZm9udC13ZWlnaHQ6IDYwMDsgY29sb3I6ICR7cy5jb2xvcn07Ij4ke2Zvcm1hdENIRihjLnRvdGFsKX08L3NwYW4+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICBgKS5qb2luKCIiKQogICAgICAgICAgICB9CiAgICAgICAgICA8L2Rpdj4KICAgICAgICBgKS5qb2luKCIiKX0KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KICBgOwoKICAvLyBEcmF3IGNvbXBhcmlzb24gY2hhcnRzCiAgZHJhd0NtcFJldmVudWVDaGFydChzdGF0cyk7CiAgZHJhd0NtcEF2Z0NoYXJ0KHN0YXRzKTsKICBkcmF3Q21wQ291bnRDaGFydChzdGF0cyk7CiAgZHJhd0NtcE1peENoYXJ0KHN0YXRzKTsKfQoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIENPTVBBUklTT04gQ0hBUlRTCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAoKY29uc3QgY0RlZnMgPSB7CiAgcmVzcG9uc2l2ZTogdHJ1ZSwgbWFpbnRhaW5Bc3BlY3RSYXRpbzogZmFsc2UsCiAgcGx1Z2luczogeyB0b29sdGlwOiB7CiAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjMWEyMzMyJywgYm9yZGVyQ29sb3I6ICcjMmEzYTRhJywgYm9yZGVyV2lkdGg6IDEsCiAgICB0aXRsZUZvbnQ6IHsgZmFtaWx5OiAiJ0pldEJyYWlucyBNb25vJyIgfSwgYm9keUZvbnQ6IHsgZmFtaWx5OiAiJ0pldEJyYWlucyBNb25vJyIgfSwKICB9fSwKfTsKY29uc3QgYXhEZWYgPSB7CiAgeDogeyBncmlkOiB7IGRpc3BsYXk6IGZhbHNlIH0sIHRpY2tzOiB7IGNvbG9yOiAnIzRhNWE2YScsIGZvbnQ6IHsgZmFtaWx5OiAiJ0pldEJyYWlucyBNb25vJyIsIHNpemU6IDExIH0gfSB9LAogIHk6IHsgZ3JpZDogeyBjb2xvcjogJyMxYTIzMzInIH0sIHRpY2tzOiB7IGNvbG9yOiAnIzNhNGE1YScsIGZvbnQ6IHsgZmFtaWx5OiAiJ0pldEJyYWlucyBNb25vJyIsIHNpemU6IDEwIH0gfSB9Cn07CgpmdW5jdGlvbiBkcmF3Q21wUmV2ZW51ZUNoYXJ0KHN0YXRzKSB7CiAgY29uc3QgY3R4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NtcFJldmVudWVDaGFydCcpOyBpZiAoIWN0eCkgcmV0dXJuOwogIGNoYXJ0SW5zdGFuY2VzLnJldiA9IG5ldyBDaGFydChjdHgsIHsKICAgIHR5cGU6ICdiYXInLAogICAgZGF0YTogewogICAgICBsYWJlbHM6IHN0YXRzLm1hcChzID0+IHMubGFiZWwpLAogICAgICBkYXRhc2V0czogW3sgZGF0YTogc3RhdHMubWFwKHMgPT4gcy5zdGF0cy5yZXZlbnVlKSwgYmFja2dyb3VuZENvbG9yOiBzdGF0cy5tYXAocyA9PiBzLmNvbG9yKSwKICAgICAgICBib3JkZXJSYWRpdXM6IDYsIGJvcmRlclNraXBwZWQ6IGZhbHNlLCBtYXhCYXJUaGlja25lc3M6IDgwIH1dCiAgICB9LAogICAgb3B0aW9uczogeyAuLi5jRGVmcywgcGx1Z2luczogeyAuLi5jRGVmcy5wbHVnaW5zLCBsZWdlbmQ6IHsgZGlzcGxheTogZmFsc2UgfSwKICAgICAgdG9vbHRpcDogeyAuLi5jRGVmcy5wbHVnaW5zLnRvb2x0aXAsIGNhbGxiYWNrczogeyBsYWJlbDogYyA9PiBmb3JtYXRDSEYoYy5yYXcpIH0gfSB9LAogICAgICBzY2FsZXM6IHsgLi4uYXhEZWYsIHk6IHsgLi4uYXhEZWYueSwgdGlja3M6IHsgLi4uYXhEZWYueS50aWNrcywgY2FsbGJhY2s6IHYgPT4gZm9ybWF0Q0hGKHYpIH0gfSB9IH0KICB9KTsKfQoKZnVuY3Rpb24gZHJhd0NtcEF2Z0NoYXJ0KHN0YXRzKSB7CiAgY29uc3QgY3R4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NtcEF2Z0NoYXJ0Jyk7IGlmICghY3R4KSByZXR1cm47CiAgY2hhcnRJbnN0YW5jZXMuYXZnID0gbmV3IENoYXJ0KGN0eCwgewogICAgdHlwZTogJ2JhcicsCiAgICBkYXRhOiB7CiAgICAgIGxhYmVsczogc3RhdHMubWFwKHMgPT4gcy5sYWJlbCksCiAgICAgIGRhdGFzZXRzOiBbeyBkYXRhOiBzdGF0cy5tYXAocyA9PiBzLnN0YXRzLmF2ZyksIGJhY2tncm91bmRDb2xvcjogc3RhdHMubWFwKHMgPT4gcy5jb2xvciArICc5MCcpLAogICAgICAgIGJvcmRlckNvbG9yOiBzdGF0cy5tYXAocyA9PiBzLmNvbG9yKSwgYm9yZGVyV2lkdGg6IDIsIGJvcmRlclJhZGl1czogNiwgYm9yZGVyU2tpcHBlZDogZmFsc2UsIG1heEJhclRoaWNrbmVzczogODAgfV0KICAgIH0sCiAgICBvcHRpb25zOiB7IC4uLmNEZWZzLCBwbHVnaW5zOiB7IC4uLmNEZWZzLnBsdWdpbnMsIGxlZ2VuZDogeyBkaXNwbGF5OiBmYWxzZSB9LAogICAgICB0b29sdGlwOiB7IC4uLmNEZWZzLnBsdWdpbnMudG9vbHRpcCwgY2FsbGJhY2tzOiB7IGxhYmVsOiBjID0+IGDDmCAke2Zvcm1hdENIRihjLnJhdyl9YCB9IH0gfSwKICAgICAgc2NhbGVzOiB7IC4uLmF4RGVmLCB5OiB7IC4uLmF4RGVmLnksIHRpY2tzOiB7IC4uLmF4RGVmLnkudGlja3MsIGNhbGxiYWNrOiB2ID0+IGZvcm1hdENIRih2KSB9IH0gfSB9CiAgfSk7Cn0KCmZ1bmN0aW9uIGRyYXdDbXBDb3VudENoYXJ0KHN0YXRzKSB7CiAgY29uc3QgY3R4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NtcENvdW50Q2hhcnQnKTsgaWYgKCFjdHgpIHJldHVybjsKICBjaGFydEluc3RhbmNlcy5jbnQgPSBuZXcgQ2hhcnQoY3R4LCB7CiAgICB0eXBlOiAnYmFyJywKICAgIGRhdGE6IHsKICAgICAgbGFiZWxzOiBzdGF0cy5tYXAocyA9PiBzLmxhYmVsKSwKICAgICAgZGF0YXNldHM6IFsKICAgICAgICB7IGxhYmVsOiAnUmVjaG51bmdlbicsIGRhdGE6IHN0YXRzLm1hcChzID0+IHMuc3RhdHMuY291bnQpLCBiYWNrZ3JvdW5kQ29sb3I6IHN0YXRzLm1hcChzID0+IHMuY29sb3IpLCBib3JkZXJSYWRpdXM6IDQsIGJvcmRlclNraXBwZWQ6IGZhbHNlIH0sCiAgICAgICAgeyBsYWJlbDogJ0t1bmRlbicsIGRhdGE6IHN0YXRzLm1hcChzID0+IHMuc3RhdHMuY3VzdG9tZXJzKSwgYmFja2dyb3VuZENvbG9yOiBzdGF0cy5tYXAocyA9PiBzLmNvbG9yICsgJzUwJyksCiAgICAgICAgICBib3JkZXJDb2xvcjogc3RhdHMubWFwKHMgPT4gcy5jb2xvciksIGJvcmRlcldpZHRoOiAxLCBib3JkZXJSYWRpdXM6IDQsIGJvcmRlclNraXBwZWQ6IGZhbHNlIH0sCiAgICAgIF0KICAgIH0sCiAgICBvcHRpb25zOiB7IC4uLmNEZWZzLCBwbHVnaW5zOiB7CiAgICAgIGxlZ2VuZDogeyBkaXNwbGF5OiB0cnVlLCBwb3NpdGlvbjogJ3RvcCcsIGxhYmVsczogeyBjb2xvcjogJyM1YTZhN2EnLCBmb250OiB7IGZhbWlseTogIidKZXRCcmFpbnMgTW9ubyciLCBzaXplOiAxMCB9LCBib3hXaWR0aDogMTIsIHBhZGRpbmc6IDEyIH0gfSwKICAgICAgdG9vbHRpcDogeyAuLi5jRGVmcy5wbHVnaW5zLnRvb2x0aXAgfSB9LAogICAgICBzY2FsZXM6IGF4RGVmIH0KICB9KTsKfQoKZnVuY3Rpb24gZHJhd0NtcE1peENoYXJ0KHN0YXRzKSB7CiAgY29uc3QgY3R4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NtcE1peENoYXJ0Jyk7IGlmICghY3R4KSByZXR1cm47CiAgY2hhcnRJbnN0YW5jZXMubWl4ID0gbmV3IENoYXJ0KGN0eCwgewogICAgdHlwZTogJ2JhcicsCiAgICBkYXRhOiB7CiAgICAgIGxhYmVsczogc3RhdHMubWFwKHMgPT4gcy5sYWJlbCksCiAgICAgIGRhdGFzZXRzOiBbCiAgICAgICAgeyBsYWJlbDogJ09mZmVydC1RdW90ZSAlJywgZGF0YTogc3RhdHMubWFwKHMgPT4gcy5zdGF0cy5xQ29udiksIGJhY2tncm91bmRDb2xvcjogJyM0YTkwZDknLCBib3JkZXJSYWRpdXM6IDQsIGJvcmRlclNraXBwZWQ6IGZhbHNlLCB5QXhpc0lEOiAneScgfSwKICAgICAgICB7IGxhYmVsOiAnw5ggWmFobHVuZ3NmcmlzdCAoVGFnZSknLCBkYXRhOiBzdGF0cy5tYXAocyA9PiBzLnN0YXRzLmRzbyksIGJhY2tncm91bmRDb2xvcjogJyNlOGE1NGInLCBib3JkZXJSYWRpdXM6IDQsIGJvcmRlclNraXBwZWQ6IGZhbHNlLCB5QXhpc0lEOiAneTEnIH0sCiAgICAgIF0KICAgIH0sCiAgICBvcHRpb25zOiB7IC4uLmNEZWZzLCBwbHVnaW5zOiB7CiAgICAgIGxlZ2VuZDogeyBkaXNwbGF5OiB0cnVlLCBwb3NpdGlvbjogJ3RvcCcsIGxhYmVsczogeyBjb2xvcjogJyM1YTZhN2EnLCBmb250OiB7IGZhbWlseTogIidKZXRCcmFpbnMgTW9ubyciLCBzaXplOiAxMCB9LCBib3hXaWR0aDogMTIsIHBhZGRpbmc6IDEyIH0gfSwKICAgICAgdG9vbHRpcDogeyAuLi5jRGVmcy5wbHVnaW5zLnRvb2x0aXAgfSB9LAogICAgICBzY2FsZXM6IHsKICAgICAgICAuLi5heERlZiwKICAgICAgICB5OiB7IC4uLmF4RGVmLnksIHBvc2l0aW9uOiAnbGVmdCcsIHRpdGxlOiB7IGRpc3BsYXk6IHRydWUsIHRleHQ6ICdRdW90ZSAlJywgY29sb3I6ICcjNGE5MGQ5JywgZm9udDogeyBmYW1pbHk6ICInSmV0QnJhaW5zIE1vbm8nIiwgc2l6ZTogMTAgfSB9IH0sCiAgICAgICAgeTE6IHsgLi4uYXhEZWYueSwgcG9zaXRpb246ICdyaWdodCcsIGdyaWQ6IHsgZGlzcGxheTogZmFsc2UgfSwgdGl0bGU6IHsgZGlzcGxheTogdHJ1ZSwgdGV4dDogJ1RhZ2UnLCBjb2xvcjogJyNlOGE1NGInLCBmb250OiB7IGZhbWlseTogIidKZXRCcmFpbnMgTW9ubyciLCBzaXplOiAxMCB9IH0gfSwKICAgICAgfSB9CiAgfSk7Cn0KCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovLyBJTklUCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAoKcG9wdWxhdGVZZWFyU2VsZWN0cygpOwoKLy8gQXV0by1hZGQgYSB1c2VmdWwgZGVmYXVsdDogbGFzdCAzIFExcwpjb25zdCBjdXJZZWFyID0gbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpOwpjb25zdCBjdXJRID0gTWF0aC5mbG9vcihuZXcgRGF0ZSgpLmdldE1vbnRoKCkgLyAzKSArIDE7Cjwvc2NyaXB0Pgo8L2JvZHk+CjwvaHRtbD4K',
  '/cashflow.html': 'PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImRlIj4KPGhlYWQ+CjxtZXRhIGNoYXJzZXQ9IlVURi04Ij4KPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiPgo8dGl0bGU+RHJpeGwgVHJhbnNwb3J0ZSDigJMgQ2FzaGZsb3c8L3RpdGxlPgo8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9jaGFydC5qc0A0LjQuMS9kaXN0L2NoYXJ0LnVtZC5taW4uanMiPjwvc2NyaXB0Pgo8bGluayBocmVmPSJodHRwczovL2ZvbnRzLmdvb2dsZWFwaXMuY29tL2NzczI/ZmFtaWx5PURNK1NhbnM6d2dodEA0MDA7NTAwOzYwMDs3MDAmZmFtaWx5PUpldEJyYWlucytNb25vOndnaHRANDAwOzUwMDs2MDAmZGlzcGxheT1zd2FwIiByZWw9InN0eWxlc2hlZXQiPgo8c3R5bGU+CiAgKiB7IG1hcmdpbjogMDsgcGFkZGluZzogMDsgYm94LXNpemluZzogYm9yZGVyLWJveDsgfQogIGJvZHkgeyBiYWNrZ3JvdW5kOiAjMGExMDE4OyBjb2xvcjogI2M4ZDJkYzsgZm9udC1mYW1pbHk6ICdETSBTYW5zJywgc2Fucy1zZXJpZjsgcGFkZGluZzogMjRweCAyMHB4OyBtaW4taGVpZ2h0OiAxMDB2aDsgfQogIC5jb250YWluZXIgeyBtYXgtd2lkdGg6IDEyMDBweDsgbWFyZ2luOiAwIGF1dG87IH0KICAubW9ubyB7IGZvbnQtZmFtaWx5OiAnSmV0QnJhaW5zIE1vbm8nLCBtb25vc3BhY2U7IH0KCiAgLyog4pSA4pSAIEhlYWRlciDilIDilIAgKi8KICAuaGVhZGVyIHsgZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOyBmbGV4LXdyYXA6IHdyYXA7IGdhcDogMTJweDsgbWFyZ2luLWJvdHRvbTogMjRweDsgfQogIC5oZWFkZXItc3ViIHsgZm9udC1zaXplOiAxMXB4OyBmb250LXdlaWdodDogNjAwOyBsZXR0ZXItc3BhY2luZzogMC4xMmVtOyB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOyBjb2xvcjogIzJhNmY0ZTsgbWFyZ2luLWJvdHRvbTogNHB4OyB9CiAgLmhlYWRlciBoMSB7IGZvbnQtc2l6ZTogMjhweDsgZm9udC13ZWlnaHQ6IDcwMDsgY29sb3I6ICNlOGVkZjI7IGxpbmUtaGVpZ2h0OiAxLjI7IH0KICAubmF2LWxpbmtzIHsgZGlzcGxheTogZmxleDsgZ2FwOiA4cHg7IGZsZXgtd3JhcDogd3JhcDsgfQogIC5uYXYtbGluayB7IGZvbnQtc2l6ZTogMTJweDsgY29sb3I6ICM0ZWNkYzQ7IHRleHQtZGVjb3JhdGlvbjogbm9uZTsgYm9yZGVyOiAxcHggc29saWQgIzFhM2E0YTsgcGFkZGluZzogNnB4IDE0cHg7IGJvcmRlci1yYWRpdXM6IDZweDsgdHJhbnNpdGlvbjogYWxsIDAuMnM7IGZvbnQtZmFtaWx5OiAnSmV0QnJhaW5zIE1vbm8nLCBtb25vc3BhY2U7IH0KICAubmF2LWxpbms6aG92ZXIgeyBiYWNrZ3JvdW5kOiAjMWEzYTRhOyBjb2xvcjogI2U4ZWRmMjsgfQoKICAvKiDilIDilIAgU2VjdGlvbiBUaXRsZXMg4pSA4pSAICovCiAgLnNlY3Rpb24tdGl0bGUgeyBmb250LXNpemU6IDExcHg7IGZvbnQtd2VpZ2h0OiA3MDA7IGxldHRlci1zcGFjaW5nOiAwLjE0ZW07IHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7IGNvbG9yOiAjMmE2ZjRlOyBtYXJnaW46IDI4cHggMCAxNHB4OyB9CgogIC8qIOKUgOKUgCBLUEkgQ2FyZHMg4pSA4pSAICovCiAgLmtwaS1ncmlkIHsgZGlzcGxheTogZ3JpZDsgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiByZXBlYXQoNCwgMWZyKTsgZ2FwOiAxMnB4OyBtYXJnaW4tYm90dG9tOiAyNHB4OyB9CiAgLmtwaS1jYXJkIHsgYmFja2dyb3VuZDogIzExMTgyMDsgYm9yZGVyOiAxcHggc29saWQgIzFhMjMzMjsgYm9yZGVyLXJhZGl1czogMTJweDsgcGFkZGluZzogMThweCAyMHB4OyB9CiAgLmtwaS1sYWJlbCB7IGZvbnQtc2l6ZTogMTBweDsgZm9udC13ZWlnaHQ6IDYwMDsgbGV0dGVyLXNwYWNpbmc6IDAuMWVtOyB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOyBjb2xvcjogIzVhNmE3YTsgbWFyZ2luLWJvdHRvbTogOHB4OyB9CiAgLmtwaS12YWx1ZSB7IGZvbnQtc2l6ZTogMjRweDsgZm9udC13ZWlnaHQ6IDcwMDsgY29sb3I6ICNlOGVkZjI7IH0KICAua3BpLXN1YiB7IGZvbnQtc2l6ZTogMTFweDsgY29sb3I6ICM1YTZhN2E7IG1hcmdpbi10b3A6IDRweDsgfQogIC5rcGktdmFsdWUuZ3JlZW4geyBjb2xvcjogIzRlY2RjNDsgfQogIC5rcGktdmFsdWUucmVkIHsgY29sb3I6ICNmZjZiNmI7IH0KICAua3BpLXZhbHVlLmFtYmVyIHsgY29sb3I6ICNmZmE3MjY7IH0KCiAgLyog4pSA4pSAIENoYXJ0IENhcmRzIOKUgOKUgCAqLwogIC5jaGFydC1ncmlkIHsgZGlzcGxheTogZ3JpZDsgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgMWZyOyBnYXA6IDEycHg7IG1hcmdpbi1ib3R0b206IDI0cHg7IH0KICAuY2hhcnQtY2FyZCB7IGJhY2tncm91bmQ6ICMxMTE4MjA7IGJvcmRlcjogMXB4IHNvbGlkICMxYTIzMzI7IGJvcmRlci1yYWRpdXM6IDEycHg7IHBhZGRpbmc6IDIwcHg7IH0KICAuY2hhcnQtY2FyZC5mdWxsIHsgZ3JpZC1jb2x1bW46IDEgLyAtMTsgfQogIC5jaGFydC10aXRsZSB7IGZvbnQtc2l6ZTogMTNweDsgZm9udC13ZWlnaHQ6IDYwMDsgY29sb3I6ICM1YTZhN2E7IGxldHRlci1zcGFjaW5nOiAwLjA2ZW07IHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7IG1hcmdpbi1ib3R0b206IDE2cHg7IH0KICAuY2hhcnQtd3JhcCB7IHBvc2l0aW9uOiByZWxhdGl2ZTsgaGVpZ2h0OiAzMDBweDsgfQoKICAvKiDilIDilIAgVGFibGUg4pSA4pSAICovCiAgLnRhYmxlLWNhcmQgeyBiYWNrZ3JvdW5kOiAjMTExODIwOyBib3JkZXI6IDFweCBzb2xpZCAjMWEyMzMyOyBib3JkZXItcmFkaXVzOiAxMnB4OyBwYWRkaW5nOiAyMHB4OyBtYXJnaW4tYm90dG9tOiAyNHB4OyBvdmVyZmxvdy14OiBhdXRvOyB9CiAgLmRhdGEtdGFibGUgeyB3aWR0aDogMTAwJTsgYm9yZGVyLWNvbGxhcHNlOiBjb2xsYXBzZTsgfQogIC5kYXRhLXRhYmxlIHRoIHsgZm9udC1zaXplOiAxMHB4OyBmb250LXdlaWdodDogNzAwOyBsZXR0ZXItc3BhY2luZzogMC4wOGVtOyB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOyBjb2xvcjogIzVhNmE3YTsgcGFkZGluZzogMTBweCAxMnB4OyB0ZXh0LWFsaWduOiBsZWZ0OyBib3JkZXItYm90dG9tOiAxcHggc29saWQgIzFhMjMzMjsgd2hpdGUtc3BhY2U6IG5vd3JhcDsgfQogIC5kYXRhLXRhYmxlIHRkIHsgZm9udC1zaXplOiAxM3B4OyBwYWRkaW5nOiAxMHB4IDEycHg7IGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjMGYxNjIwOyB3aGl0ZS1zcGFjZTogbm93cmFwOyB9CiAgLmRhdGEtdGFibGUgdHI6aG92ZXIgdGQgeyBiYWNrZ3JvdW5kOiAjMGYxNjIwOyB9CiAgLmRhdGEtdGFibGUgLm51bSB7IHRleHQtYWxpZ246IHJpZ2h0OyBmb250LXdlaWdodDogNjAwOyB9CiAgLmRhdGEtdGFibGUgLmdyZWVuIHsgY29sb3I6ICM0ZWNkYzQ7IH0KICAuZGF0YS10YWJsZSAucmVkIHsgY29sb3I6ICNmZjZiNmI7IH0KICAuZGF0YS10YWJsZSAuYW1iZXIgeyBjb2xvcjogI2ZmYTcyNjsgfQogIC5kYXRhLXRhYmxlIC5tdXRlZCB7IGNvbG9yOiAjNWE2YTdhOyB9CgogIC8qIOKUgOKUgCBTdGF0dXMgYmFkZ2VzIOKUgOKUgCAqLwogIC5iYWRnZSB7IGRpc3BsYXk6IGlubGluZS1ibG9jazsgcGFkZGluZzogMnB4IDhweDsgYm9yZGVyLXJhZGl1czogNHB4OyBmb250LXNpemU6IDEwcHg7IGZvbnQtd2VpZ2h0OiA3MDA7IGxldHRlci1zcGFjaW5nOiAwLjA1ZW07IHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7IH0KICAuYmFkZ2Uub3ZlcmR1ZSB7IGJhY2tncm91bmQ6IHJnYmEoMjU1LDEwNywxMDcsMC4xNSk7IGNvbG9yOiAjZmY2YjZiOyB9CiAgLmJhZGdlLnBlbmRpbmcgeyBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwxNjcsMzgsMC4xNSk7IGNvbG9yOiAjZmZhNzI2OyB9CiAgLmJhZGdlLnBhaWQgeyBiYWNrZ3JvdW5kOiByZ2JhKDc4LDIwNSwxOTYsMC4xNSk7IGNvbG9yOiAjNGVjZGM0OyB9CiAgLmJhZGdlLmRyYWZ0IHsgYmFja2dyb3VuZDogcmdiYSg5MCwxMDYsMTIyLDAuMTUpOyBjb2xvcjogIzVhNmE3YTsgfQoKICAvKiDilIDilIAgQWdpbmcgYmFyIOKUgOKUgCAqLwogIC5hZ2luZy1iYXIgeyBkaXNwbGF5OiBmbGV4OyBoZWlnaHQ6IDI4cHg7IGJvcmRlci1yYWRpdXM6IDZweDsgb3ZlcmZsb3c6IGhpZGRlbjsgbWFyZ2luLXRvcDogOHB4OyB9CiAgLmFnaW5nLXNlZ21lbnQgeyBkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsgZm9udC1zaXplOiAxMHB4OyBmb250LXdlaWdodDogNzAwOyBjb2xvcjogIzBhMTAxODsgbWluLXdpZHRoOiAzMHB4OyB0cmFuc2l0aW9uOiB3aWR0aCAwLjVzIGVhc2U7IH0KICAuYWdpbmctMC0zMCB7IGJhY2tncm91bmQ6ICM0ZWNkYzQ7IH0KICAuYWdpbmctMzEtNjAgeyBiYWNrZ3JvdW5kOiAjZmZhNzI2OyB9CiAgLmFnaW5nLTYxLTkwIHsgYmFja2dyb3VuZDogI2ZmNzA0MzsgfQogIC5hZ2luZy05MHBsdXMgeyBiYWNrZ3JvdW5kOiAjZmY2YjZiOyB9CgogIC8qIOKUgOKUgCBGb290ZXIg4pSA4pSAICovCiAgLmZvb3RlciB7IHRleHQtYWxpZ246IGNlbnRlcjsgcGFkZGluZzogMzJweCAwIDE2cHg7IGNvbG9yOiAjMmEzYTRhOyBmb250LXNpemU6IDExcHg7IH0KCiAgLmxvYWRpbmcgeyBkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsgbWluLWhlaWdodDogNDB2aDsgfQogIC5zcGlubmVyIHsgd2lkdGg6IDIwcHg7IGhlaWdodDogMjBweDsgYm9yZGVyOiAycHggc29saWQgIzRlY2RjNDsgYm9yZGVyLXRvcC1jb2xvcjogdHJhbnNwYXJlbnQ7IGJvcmRlci1yYWRpdXM6IDUwJTsgYW5pbWF0aW9uOiBzcGluIDFzIGxpbmVhciBpbmZpbml0ZTsgbWFyZ2luLXJpZ2h0OiAxMnB4OyB9CiAgQGtleWZyYW1lcyBzcGluIHsgdG8geyB0cmFuc2Zvcm06IHJvdGF0ZSgzNjBkZWcpOyB9IH0KICBAa2V5ZnJhbWVzIGZhZGVJbiB7IGZyb20geyBvcGFjaXR5OiAwOyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoOHB4KTsgfSB0byB7IG9wYWNpdHk6IDE7IHRyYW5zZm9ybTogdHJhbnNsYXRlWSgwKTsgfSB9CiAgLmZhZGUtaW4geyBhbmltYXRpb246IGZhZGVJbiAwLjVzIGVhc2U7IH0KCiAgLyog4pSA4pSAIFRhYnMg4pSA4pSAICovCiAgLnRhYi1yb3cgeyBkaXNwbGF5OiBmbGV4OyBnYXA6IDRweDsgbWFyZ2luLWJvdHRvbTogMjBweDsgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICMxYTIzMzI7IHBhZGRpbmctYm90dG9tOiAwOyB9CiAgLnRhYi1idG4geyBwYWRkaW5nOiA4cHggMThweDsgYm9yZGVyOiBub25lOyBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsgY29sb3I6ICM1YTZhN2E7IGZvbnQtc2l6ZTogMTJweDsgZm9udC13ZWlnaHQ6IDYwMDsgZm9udC1mYW1pbHk6ICdKZXRCcmFpbnMgTW9ubycsIG1vbm9zcGFjZTsgY3Vyc29yOiBwb2ludGVyOyBib3JkZXItYm90dG9tOiAycHggc29saWQgdHJhbnNwYXJlbnQ7IHRyYW5zaXRpb246IGFsbCAwLjJzOyB9CiAgLnRhYi1idG46aG92ZXIgeyBjb2xvcjogIzhhOWFhYTsgfQogIC50YWItYnRuLmFjdGl2ZSB7IGNvbG9yOiAjNGVjZGM0OyBib3JkZXItYm90dG9tLWNvbG9yOiAjNGVjZGM0OyB9CiAgLnRhYi1wYW5lbCB7IGRpc3BsYXk6IG5vbmU7IH0KICAudGFiLXBhbmVsLmFjdGl2ZSB7IGRpc3BsYXk6IGJsb2NrOyB9CgogIEBtZWRpYSAobWF4LXdpZHRoOiA5MDBweCkgewogICAgLmtwaS1ncmlkIHsgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiByZXBlYXQoMiwgMWZyKTsgfQogICAgLmNoYXJ0LWdyaWQgeyBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmcjsgfQogIH0KICBAbWVkaWEgKG1heC13aWR0aDogNjAwcHgpIHsKICAgIC5rcGktZ3JpZCB7IGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyOyB9CiAgICAuaGVhZGVyIGgxIHsgZm9udC1zaXplOiAyMnB4OyB9CiAgfQo8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5Pgo8ZGl2IGNsYXNzPSJjb250YWluZXIiIGlkPSJhcHAiPgogIDxkaXYgY2xhc3M9ImxvYWRpbmciPjxkaXYgY2xhc3M9InNwaW5uZXIiPjwvZGl2PjxzcGFuIGNsYXNzPSJtb25vIiBzdHlsZT0iY29sb3I6IzVhNmE3YSI+Q2FzaGZsb3ctRGF0ZW4gbGFkZW4g4oCmPC9zcGFuPjwvZGl2Pgo8L2Rpdj4KCjxzY3JpcHQ+CmNvbnN0IFNVUEFCQVNFX1VSTCA9ICJodHRwczovL256ZndkZWh1YWNyd2lzdWl4ZHh1LnN1cGFiYXNlLmNvIjsKY29uc3QgU1VQQUJBU0VfS0VZID0gImV5SmhiR2NpT2lKSVV6STFOaUlzSW5SNWNDSTZJa3BYVkNKOS5leUpwYzNNaU9pSnpkWEJoWW1GelpTSXNJbkpsWmlJNkltNTZabmRrWldoMVlXTnlkMmx6ZFdsNFpIaDFJaXdpY205c1pTSTZJbk5sY25acFkyVmZjbTlzWlNJc0ltbGhkQ0k2TVRjM01USTJPRFV6Tnl3aVpYaHdJam95TURnMk9EUTBOVE0zZlEuX2pqNUtIVXVscGdDMVZJbmQwXzdtLUFzTUEtTWtoY0pzRGtOLTF4NXhYVSI7Cgpjb25zdCBmbXQgPSAodikgPT4gbmV3IEludGwuTnVtYmVyRm9ybWF0KCJkZS1DSCIsIHsgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAwLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDAgfSkuZm9ybWF0KHYpOwpjb25zdCBmbXRLID0gKHYpID0+IHYgPj0gMTAwMCA/IGAkeyh2LzEwMDApLnRvRml4ZWQodiA+PSAxMDAwMCA/IDAgOiAxKX1rYCA6IGZtdCh2KTsKY29uc3QgZm10RGF0ZSA9IChkKSA9PiBkID8gbmV3IERhdGUoZCkudG9Mb2NhbGVEYXRlU3RyaW5nKCJkZS1DSCIpIDogIuKAkyI7CmNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKTsgdG9kYXkuc2V0SG91cnMoMCwwLDAsMCk7Cgphc3luYyBmdW5jdGlvbiBmZXRjaEFsbCh0YWJsZSwgZmlsdGVyID0gIiIpIHsKICBjb25zdCBhbGwgPSBbXTsgbGV0IG9mZnNldCA9IDA7CiAgd2hpbGUgKHRydWUpIHsKICAgIGNvbnN0IHVybCA9IGAke1NVUEFCQVNFX1VSTH0vcmVzdC92MS8ke3RhYmxlfT8ke2ZpbHRlcn0mb2Zmc2V0PSR7b2Zmc2V0fSZsaW1pdD0xMDAwYDsKICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKHVybCwgeyBoZWFkZXJzOiB7IGFwaWtleTogU1VQQUJBU0VfS0VZLCBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7U1VQQUJBU0VfS0VZfWAsIFByZWZlcjogImNvdW50PWV4YWN0IiB9IH0pOwogICAgaWYgKCFyZXMub2spIGJyZWFrOwogICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlcy5qc29uKCk7CiAgICBhbGwucHVzaCguLi5kYXRhKTsKICAgIGNvbnN0IHRvdGFsID0gcGFyc2VJbnQocmVzLmhlYWRlcnMuZ2V0KCJjb250ZW50LXJhbmdlIik/LnNwbGl0KCIvIik/LlsxXSB8fCAiMCIpOwogICAgb2Zmc2V0ICs9IDEwMDA7CiAgICBpZiAob2Zmc2V0ID49IHRvdGFsIHx8IGRhdGEubGVuZ3RoIDwgMTAwMCkgYnJlYWs7CiAgfQogIHJldHVybiBhbGw7Cn0KCmZ1bmN0aW9uIGRheXNEaWZmKGRhdGVTdHIpIHsKICBpZiAoIWRhdGVTdHIpIHJldHVybiAwOwogIGNvbnN0IGQgPSBuZXcgRGF0ZShkYXRlU3RyKTsgZC5zZXRIb3VycygwLDAsMCwwKTsKICByZXR1cm4gTWF0aC5yb3VuZCgodG9kYXkgLSBkKSAvIDg2NDAwMDAwKTsKfQoKZnVuY3Rpb24gd2Vla0tleShkYXRlU3RyKSB7CiAgaWYgKCFkYXRlU3RyKSByZXR1cm4gbnVsbDsKICBjb25zdCBkID0gbmV3IERhdGUoZGF0ZVN0cik7CiAgY29uc3Qgc3RhcnQgPSBuZXcgRGF0ZShkKTsKICBzdGFydC5zZXREYXRlKHN0YXJ0LmdldERhdGUoKSAtIHN0YXJ0LmdldERheSgpICsgMSk7IC8vIE1vbmRheQogIHJldHVybiBzdGFydC50b0lTT1N0cmluZygpLnNsaWNlKDAsIDEwKTsKfQoKYXN5bmMgZnVuY3Rpb24gbWFpbigpIHsKICAvLyBMb2FkIGRhdGEKICBjb25zdCBbaW52b2ljZXMsIGJpbGxzXSA9IGF3YWl0IFByb21pc2UuYWxsKFsKICAgIGZldGNoQWxsKCJpbnZvaWNlcyIsICJzZWxlY3Q9aWQsZG9jdW1lbnRfbnIsdGl0bGUsY29udGFjdF9pZCxzdGF0dXMsaXNfdmFsaWRfZnJvbSxpc192YWxpZF90byx0b3RhbF9ncm9zcyx0b3RhbF9uZXQsdG90YWxfcmVjZWl2ZWQsY3VycmVuY3lfY29kZSZzdGF0dXM9bm90LmluLihjYW5jZWxsZWQsZHJhZnQpIiksCiAgICBmZXRjaEFsbCgiYmlsbHMiLCAic2VsZWN0PWlkLGRvY3VtZW50X25yLHRpdGxlLGNvbnRhY3RfaWQsc3RhdHVzLGJpbGxfZGF0ZSxkdWVfZGF0ZSx0b3RhbF9ncm9zcyx0b3RhbF9uZXQsdG90YWxfcGFpZCxwZW5kaW5nX2Ftb3VudCxjdXJyZW5jeV9jb2RlIiksCiAgXSk7CgogIC8vIOKUgOKUgCBDb21wdXRlIG9wZW4gcmVjZWl2YWJsZXMgKERlYml0b3Jlbikg4pSA4pSACiAgY29uc3Qgb3Blbkludm9pY2VzID0gaW52b2ljZXMuZmlsdGVyKGkgPT4gWyJwZW5kaW5nIiwicGFydGlhbCIsIm92ZXJkdWUiXS5pbmNsdWRlcyhpLnN0YXR1cykgfHwgKHBhcnNlRmxvYXQoaS50b3RhbF9ncm9zc3x8MCkgLSBwYXJzZUZsb2F0KGkudG90YWxfcmVjZWl2ZWR8fDApKSA+IDAuNSk7CiAgY29uc3Qgb3BlblJlY2VpdmFibGVzID0gb3Blbkludm9pY2VzLnJlZHVjZSgocywgaSkgPT4gcyArIHBhcnNlRmxvYXQoaS50b3RhbF9ncm9zc3x8MCkgLSBwYXJzZUZsb2F0KGkudG90YWxfcmVjZWl2ZWR8fDApLCAwKTsKCiAgLy8g4pSA4pSAIENvbXB1dGUgb3BlbiBwYXlhYmxlcyAoS3JlZGl0b3Jlbikg4pSA4pSACiAgLy8g4oCUIENvbXB1dGUgb3BlbiBwYXlhYmxlcyAoS3JlZGl0b3Jlbikg4oCUIGJpbGxzIHVzZSBVUFBFUkNBU0Ugc3RhdHVzCiAgY29uc3Qgb3BlbkJpbGxzID0gYmlsbHMuZmlsdGVyKGIgPT4gewogICAgY29uc3QgcyA9IChiLnN0YXR1cyB8fCAnJykudG9VcHBlckNhc2UoKTsKICAgIGNvbnN0IGFtdCA9IHBhcnNlRmxvYXQoYi5wZW5kaW5nX2Ftb3VudCB8fCAwKTsKICAgIHJldHVybiBbJ0JPT0tFRCcsJ1BBUlRJQUxMWV9QQUlEJywnQ1JFQVRFRCcsJ1NFTlQnXS5pbmNsdWRlcyhzKSB8fCBhbXQgPiAwLjU7CiAgfSk7CiAgY29uc3Qgb3BlblBheWFibGVzID0gb3BlbkJpbGxzLnJlZHVjZSgocywgYikgPT4gcyArIHBhcnNlRmxvYXQoYi5wZW5kaW5nX2Ftb3VudCB8fCAwKSwgMCk7CgogIGNvbnN0IG5ldENhc2hmbG93ID0gb3BlblJlY2VpdmFibGVzIC0gb3BlblBheWFibGVzOwoKICAvLyDilIDilIAgT3ZlcmR1ZSBhbW91bnRzIOKUgOKUgAogIGNvbnN0IG92ZXJkdWVSZWNlaXZhYmxlcyA9IG9wZW5JbnZvaWNlcy5maWx0ZXIoaSA9PiBpLmlzX3ZhbGlkX3RvICYmIG5ldyBEYXRlKGkuaXNfdmFsaWRfdG8pIDwgdG9kYXkpCiAgICAucmVkdWNlKChzLCBpKSA9PiBzICsgcGFyc2VGbG9hdChpLnRvdGFsX2dyb3NzfHwwKSAtIHBhcnNlRmxvYXQoaS50b3RhbF9yZWNlaXZlZHx8MCksIDApOwogIGNvbnN0IG92ZXJkdWVQYXlhYmxlcyA9IG9wZW5CaWxscy5maWx0ZXIoYiA9PiBiLmR1ZV9kYXRlICYmIG5ldyBEYXRlKGIuZHVlX2RhdGUpIDwgdG9kYXkpCiAgICAucmVkdWNlKChzLCBiKSA9PiBzICsgcGFyc2VGbG9hdChiLnBlbmRpbmdfYW1vdW50IHx8IDApLCAwKTsKCiAgLy8g4pSA4pSAIEFnaW5nIGJ1Y2tldHMgKHJlY2VpdmFibGVzKSDilIDilIAKICBjb25zdCBhZ2luZ1IgPSB7ICIwLTMwIjogMCwgIjMxLTYwIjogMCwgIjYxLTkwIjogMCwgIjkwKyI6IDAgfTsKICBvcGVuSW52b2ljZXMuZm9yRWFjaChpID0+IHsKICAgIGNvbnN0IG9wZW4gPSBwYXJzZUZsb2F0KGkudG90YWxfZ3Jvc3N8fDApIC0gcGFyc2VGbG9hdChpLnRvdGFsX3JlY2VpdmVkfHwwKTsKICAgIGNvbnN0IGRheXMgPSBkYXlzRGlmZihpLmlzX3ZhbGlkX3RvIHx8IGkuaXNfdmFsaWRfZnJvbSk7CiAgICBpZiAoZGF5cyA8PSAzMCkgYWdpbmdSWyIwLTMwIl0gKz0gb3BlbjsKICAgIGVsc2UgaWYgKGRheXMgPD0gNjApIGFnaW5nUlsiMzEtNjAiXSArPSBvcGVuOwogICAgZWxzZSBpZiAoZGF5cyA8PSA5MCkgYWdpbmdSWyI2MS05MCJdICs9IG9wZW47CiAgICBlbHNlIGFnaW5nUlsiOTArIl0gKz0gb3BlbjsKICB9KTsKCiAgLy8g4pSA4pSAIEFnaW5nIGJ1Y2tldHMgKHBheWFibGVzKSDilIDilIAKICBjb25zdCBhZ2luZ1AgPSB7ICIwLTMwIjogMCwgIjMxLTYwIjogMCwgIjYxLTkwIjogMCwgIjkwKyI6IDAgfTsKICBvcGVuQmlsbHMuZm9yRWFjaChiID0+IHsKICAgIGNvbnN0IG9wZW4gPSBwYXJzZUZsb2F0KGIucGVuZGluZ19hbW91bnQgfHwgMCk7CiAgICBjb25zdCBkYXlzID0gZGF5c0RpZmYoYi5kdWVfZGF0ZSB8fCBiLmJpbGxfZGF0ZSk7CiAgICBpZiAoZGF5cyA8PSAzMCkgYWdpbmdQWyIwLTMwIl0gKz0gb3BlbjsKICAgIGVsc2UgaWYgKGRheXMgPD0gNjApIGFnaW5nUFsiMzEtNjAiXSArPSBvcGVuOwogICAgZWxzZSBpZiAoZGF5cyA8PSA5MCkgYWdpbmdQWyI2MS05MCJdICs9IG9wZW47CiAgICBlbHNlIGFnaW5nUFsiOTArIl0gKz0gb3BlbjsKICB9KTsKCiAgLy8g4pSA4pSAIFdlZWtseSBjYXNoZmxvdyBwcm9qZWN0aW9uIChuZXh0IDEyIHdlZWtzKSDilIDilIAKICBjb25zdCB3ZWVrcyA9IFtdOwogIGNvbnN0IHdlZWtTdGFydCA9IG5ldyBEYXRlKHRvZGF5KTsKICB3ZWVrU3RhcnQuc2V0RGF0ZSh3ZWVrU3RhcnQuZ2V0RGF0ZSgpIC0gd2Vla1N0YXJ0LmdldERheSgpICsgMSk7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMjsgaSsrKSB7CiAgICBjb25zdCB3cyA9IG5ldyBEYXRlKHdlZWtTdGFydCk7IHdzLnNldERhdGUod3MuZ2V0RGF0ZSgpICsgaSAqIDcpOwogICAgY29uc3Qgd2UgPSBuZXcgRGF0ZSh3cyk7IHdlLnNldERhdGUod2UuZ2V0RGF0ZSgpICsgNik7CiAgICB3ZWVrcy5wdXNoKHsgc3RhcnQ6IG5ldyBEYXRlKHdzKSwgZW5kOiBuZXcgRGF0ZSh3ZSksIGxhYmVsOiBgS1cke2dldFdlZWtOdW1iZXIod3MpfWAsIGluZmxvdzogMCwgb3V0ZmxvdzogMCB9KTsKICB9CgogIG9wZW5JbnZvaWNlcy5mb3JFYWNoKGkgPT4gewogICAgY29uc3QgZHVlID0gbmV3IERhdGUoaS5pc192YWxpZF90byB8fCBpLmlzX3ZhbGlkX2Zyb20pOyBkdWUuc2V0SG91cnMoMCwwLDAsMCk7CiAgICBjb25zdCBvcGVuID0gcGFyc2VGbG9hdChpLnRvdGFsX2dyb3NzfHwwKSAtIHBhcnNlRmxvYXQoaS50b3RhbF9yZWNlaXZlZHx8MCk7CiAgICBjb25zdCB3ID0gd2Vla3MuZmluZCh3ID0+IGR1ZSA+PSB3LnN0YXJ0ICYmIGR1ZSA8PSB3LmVuZCk7CiAgICBpZiAodykgdy5pbmZsb3cgKz0gb3BlbjsKICAgIGVsc2UgaWYgKGR1ZSA8IHdlZWtzWzBdLnN0YXJ0KSB3ZWVrc1swXS5pbmZsb3cgKz0gb3BlbjsgLy8gb3ZlcmR1ZSDihpIgZXhwZWN0IHRoaXMgd2VlawogIH0pOwoKICBvcGVuQmlsbHMuZm9yRWFjaChiID0+IHsKICAgIGNvbnN0IGR1ZSA9IG5ldyBEYXRlKGIuZHVlX2RhdGUgfHwgYi5iaWxsX2RhdGUpOyBkdWUuc2V0SG91cnMoMCwwLDAsMCk7CiAgICBjb25zdCBvcGVuID0gcGFyc2VGbG9hdChiLnBlbmRpbmdfYW1vdW50IHx8IDApOwogICAgY29uc3QgdyA9IHdlZWtzLmZpbmQodyA9PiBkdWUgPj0gdy5zdGFydCAmJiBkdWUgPD0gdy5lbmQpOwogICAgaWYgKHcpIHcub3V0ZmxvdyArPSBvcGVuOwogICAgZWxzZSBpZiAoZHVlIDwgd2Vla3NbMF0uc3RhcnQpIHdlZWtzWzBdLm91dGZsb3cgKz0gb3BlbjsKICB9KTsKCiAgLy8gY3VtdWxhdGl2ZSBuZXQKICBsZXQgY3VtTmV0ID0gMDsKICB3ZWVrcy5mb3JFYWNoKHcgPT4geyBjdW1OZXQgKz0gdy5pbmZsb3cgLSB3Lm91dGZsb3c7IHcuY3VtTmV0ID0gY3VtTmV0OyB9KTsKCiAgZnVuY3Rpb24gZ2V0V2Vla051bWJlcihkKSB7CiAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoRGF0ZS5VVEMoZC5nZXRGdWxsWWVhcigpLCBkLmdldE1vbnRoKCksIGQuZ2V0RGF0ZSgpKSk7CiAgICBkYXRlLnNldFVUQ0RhdGUoZGF0ZS5nZXRVVENEYXRlKCkgKyA0IC0gKGRhdGUuZ2V0VVRDRGF5KCkgfHwgNykpOwogICAgY29uc3QgeWVhclN0YXJ0ID0gbmV3IERhdGUoRGF0ZS5VVEMoZGF0ZS5nZXRVVENGdWxsWWVhcigpLCAwLCAxKSk7CiAgICByZXR1cm4gTWF0aC5jZWlsKCgoKGRhdGUgLSB5ZWFyU3RhcnQpIC8gODY0MDAwMDApICsgMSkgLyA3KTsKICB9CgogIC8vIOKUgOKUgCBUb3AgMTAgb3BlbiBpbnZvaWNlcyArIGJpbGxzIOKUgOKUgAogIGNvbnN0IHRvcFJlY2VpdmFibGVzID0gWy4uLm9wZW5JbnZvaWNlc10KICAgIC5tYXAoaSA9PiAoeyAuLi5pLCBvcGVuOiBwYXJzZUZsb2F0KGkudG90YWxfZ3Jvc3N8fDApIC0gcGFyc2VGbG9hdChpLnRvdGFsX3JlY2VpdmVkfHwwKSwgZHVlOiBpLmlzX3ZhbGlkX3RvIH0pKQogICAgLnNvcnQoKGEsYikgPT4gYi5vcGVuIC0gYS5vcGVuKS5zbGljZSgwLCAxMCk7CiAgY29uc3QgdG9wUGF5YWJsZXMgPSBbLi4ub3BlbkJpbGxzXQogICAgLm1hcChiID0+ICh7IC4uLmIsIG9wZW46IHBhcnNlRmxvYXQoYi5wZW5kaW5nX2Ftb3VudCB8fCAwKSwgZHVlOiBiLmR1ZV9kYXRlIH0pKQogICAgLnNvcnQoKGEsYikgPT4gYi5vcGVuIC0gYS5vcGVuKS5zbGljZSgwLCAxMCk7CgogIC8vIOKUgOKUgCBSRU5ERVIg4pSA4pSACiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImFwcCIpLmlubmVySFRNTCA9IGAKICAgIDxkaXYgY2xhc3M9ImZhZGUtaW4iPgogICAgICA8ZGl2IGNsYXNzPSJoZWFkZXIiPgogICAgICAgIDxkaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJoZWFkZXItc3ViIj5Ecml4bCBUcmFuc3BvcnRlIEdtYkg8L2Rpdj4KICAgICAgICAgIDxoMT7wn5KwIENhc2hmbG93ICYgTGlxdWlkaXTDpHQ8L2gxPgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9Im5hdi1saW5rcyI+CiAgICAgICAgICA8YSBocmVmPSIvIiBjbGFzcz0ibmF2LWxpbmsiPuKGkCBEYXNoYm9hcmQ8L2E+CiAgICAgICAgICA8YSBocmVmPSIvdmVyZ2xlaWNoLmh0bWwiIGNsYXNzPSJuYXYtbGluayI+8J+TiiBWZXJnbGVpY2g8L2E+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgoKICAgICAgPCEtLSBLUEkgUm93IC0tPgogICAgICA8ZGl2IGNsYXNzPSJzZWN0aW9uLXRpdGxlIj7DnGJlcnNpY2h0IG9mZmVuZSBQb3N0ZW48L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0ia3BpLWdyaWQiPgogICAgICAgIDxkaXYgY2xhc3M9ImtwaS1jYXJkIj4KICAgICAgICAgIDxkaXYgY2xhc3M9ImtwaS1sYWJlbCBtb25vIj5PZmZlbmUgRGViaXRvcmVuPC9kaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJrcGktdmFsdWUgZ3JlZW4gbW9ubyI+Q0hGICR7Zm10KG9wZW5SZWNlaXZhYmxlcyl9PC9kaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJrcGktc3ViIG1vbm8iPiR7b3Blbkludm9pY2VzLmxlbmd0aH0gUmVjaG51bmdlbjwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImtwaS1jYXJkIj4KICAgICAgICAgIDxkaXYgY2xhc3M9ImtwaS1sYWJlbCBtb25vIj5PZmZlbmUgS3JlZGl0b3JlbjwvZGl2PgogICAgICAgICAgPGRpdiBjbGFzcz0ia3BpLXZhbHVlIHJlZCBtb25vIj5DSEYgJHtmbXQob3BlblBheWFibGVzKX08L2Rpdj4KICAgICAgICAgIDxkaXYgY2xhc3M9ImtwaS1zdWIgbW9ubyI+JHtvcGVuQmlsbHMubGVuZ3RofSBSZWNobnVuZ2VuPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0ia3BpLWNhcmQiPgogICAgICAgICAgPGRpdiBjbGFzcz0ia3BpLWxhYmVsIG1vbm8iPk5ldHRvIENhc2hmbG93PC9kaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJrcGktdmFsdWUgJHtuZXRDYXNoZmxvdyA+PSAwID8gJ2dyZWVuJyA6ICdyZWQnfSBtb25vIj5DSEYgJHtuZXRDYXNoZmxvdyA+PSAwID8gJysnIDogJyd9JHtmbXQobmV0Q2FzaGZsb3cpfTwvZGl2PgogICAgICAgICAgPGRpdiBjbGFzcz0ia3BpLXN1YiBtb25vIj5EZWJpdG9yZW4g4oiSIEtyZWRpdG9yZW48L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJrcGktY2FyZCI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJrcGktbGFiZWwgbW9ubyI+w5xiZXJmw6RsbGlnPC9kaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJrcGktdmFsdWUgJHtvdmVyZHVlUmVjZWl2YWJsZXMgPiAwID8gJ2FtYmVyJyA6ICdncmVlbid9IG1vbm8iPkNIRiAke2ZtdChvdmVyZHVlUmVjZWl2YWJsZXMpfTwvZGl2PgogICAgICAgICAgPGRpdiBjbGFzcz0ia3BpLXN1YiBtb25vIj4ke292ZXJkdWVQYXlhYmxlcyA+IDAgPyBgS3JlZGl0b3JlbjogQ0hGICR7Zm10KG92ZXJkdWVQYXlhYmxlcyl9YCA6ICdLZWluZSDDvGJlcmbDpGxsaWdlbiBLcmVkaXRvcmVuJ308L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+CgogICAgICA8IS0tIEFnaW5nIEFuYWx5c2lzIC0tPgogICAgICA8ZGl2IGNsYXNzPSJzZWN0aW9uLXRpdGxlIj5Gw6RsbGlna2VpdHNhbmFseXNlIChBZ2luZyk8L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtZ3JpZCI+CiAgICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtY2FyZCI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJjaGFydC10aXRsZSBtb25vIj5EZWJpdG9yZW4gQWdpbmc8L2Rpdj4KICAgICAgICAgICR7cmVuZGVyQWdpbmdCYXIoYWdpbmdSLCBvcGVuUmVjZWl2YWJsZXMpfQogICAgICAgICAgPGRpdiBzdHlsZT0ibWFyZ2luLXRvcDoxMnB4Ij4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtd3JhcCIgc3R5bGU9ImhlaWdodDoyMjBweCI+PGNhbnZhcyBpZD0iY2hhcnRBZ2luZ1IiPjwvY2FudmFzPjwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtY2FyZCI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJjaGFydC10aXRsZSBtb25vIj5LcmVkaXRvcmVuIEFnaW5nPC9kaXY+CiAgICAgICAgICAke3JlbmRlckFnaW5nQmFyKGFnaW5nUCwgb3BlblBheWFibGVzKX0KICAgICAgICAgIDxkaXYgc3R5bGU9Im1hcmdpbi10b3A6MTJweCI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LXdyYXAiIHN0eWxlPSJoZWlnaHQ6MjIwcHgiPjxjYW52YXMgaWQ9ImNoYXJ0QWdpbmdQIj48L2NhbnZhcz48L2Rpdj4KICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICA8L2Rpdj4KCiAgICAgIDwhLS0gV2Vla2x5IEZvcmVjYXN0IENoYXJ0IC0tPgogICAgICA8ZGl2IGNsYXNzPSJzZWN0aW9uLXRpdGxlIj4xMi1Xb2NoZW4gQ2FzaGZsb3ctUHJvZ25vc2U8L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtZ3JpZCI+CiAgICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtY2FyZCBmdWxsIj4KICAgICAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LXRpdGxlIG1vbm8iPkVyd2FydGV0ZSBFaW4tICYgQXVzemFobHVuZ2VuIHBybyBXb2NoZTwvZGl2PgogICAgICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtd3JhcCI+PGNhbnZhcyBpZD0iY2hhcnRXZWVrbHkiPjwvY2FudmFzPjwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICA8L2Rpdj4KCiAgICAgIDwhLS0gVGFiczogVG9wIFJlY2VpdmFibGVzIC8gUGF5YWJsZXMgLS0+CiAgICAgIDxkaXYgY2xhc3M9InNlY3Rpb24tdGl0bGUiPk9mZmVuZSBQb3N0ZW4g4oCTIERldGFpbHM8L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0idGFiLXJvdyI+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0idGFiLWJ0biBhY3RpdmUgbW9ubyIgb25jbGljaz0ic3dpdGNoVGFiKCdyZWN2JykiPlRvcCBEZWJpdG9yZW48L2J1dHRvbj4KICAgICAgICA8YnV0dG9uIGNsYXNzPSJ0YWItYnRuIG1vbm8iIG9uY2xpY2s9InN3aXRjaFRhYigncGF5JykiPlRvcCBLcmVkaXRvcmVuPC9idXR0b24+CiAgICAgIDwvZGl2PgoKICAgICAgPGRpdiBpZD0idGFiLXJlY3YiIGNsYXNzPSJ0YWItcGFuZWwgYWN0aXZlIj4KICAgICAgICA8ZGl2IGNsYXNzPSJ0YWJsZS1jYXJkIj4KICAgICAgICAgIDx0YWJsZSBjbGFzcz0iZGF0YS10YWJsZSBtb25vIj4KICAgICAgICAgICAgPHRoZWFkPjx0cj48dGg+TnI8L3RoPjx0aD5UaXRlbDwvdGg+PHRoPkbDpGxsaWc8L3RoPjx0aD5TdGF0dXM8L3RoPjx0aCBjbGFzcz0ibnVtIj5PZmZlbiAoQ0hGKTwvdGg+PC90cj48L3RoZWFkPgogICAgICAgICAgICA8dGJvZHk+CiAgICAgICAgICAgICAgJHt0b3BSZWNlaXZhYmxlcy5tYXAociA9PiBgPHRyPgogICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJtdXRlZCI+JHtyLmRvY3VtZW50X25yIHx8ICfigJMnfTwvdGQ+CiAgICAgICAgICAgICAgICA8dGQ+JHsoci50aXRsZSB8fCAnJykuc2xpY2UoMCw0MCl9PC90ZD4KICAgICAgICAgICAgICAgIDx0ZD4ke2ZtdERhdGUoci5kdWUpfTwvdGQ+CiAgICAgICAgICAgICAgICA8dGQ+JHtzdGF0dXNCYWRnZShyLnN0YXR1cywgci5kdWUpfTwvdGQ+CiAgICAgICAgICAgICAgICA8dGQgY2xhc3M9Im51bSAke3IuZHVlICYmIG5ldyBEYXRlKHIuZHVlKSA8IHRvZGF5ID8gJ2FtYmVyJyA6ICdncmVlbid9Ij4ke2ZtdChyLm9wZW4pfTwvdGQ+CiAgICAgICAgICAgICAgPC90cj5gKS5qb2luKCcnKX0KICAgICAgICAgICAgPC90Ym9keT4KICAgICAgICAgIDwvdGFibGU+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgoKICAgICAgPGRpdiBpZD0idGFiLXBheSIgY2xhc3M9InRhYi1wYW5lbCI+CiAgICAgICAgPGRpdiBjbGFzcz0idGFibGUtY2FyZCI+CiAgICAgICAgICA8dGFibGUgY2xhc3M9ImRhdGEtdGFibGUgbW9ubyI+CiAgICAgICAgICAgIDx0aGVhZD48dHI+PHRoPk5yPC90aD48dGg+VGl0ZWw8L3RoPjx0aD5Gw6RsbGlnPC90aD48dGg+U3RhdHVzPC90aD48dGggY2xhc3M9Im51bSI+T2ZmZW4gKENIRik8L3RoPjwvdHI+PC90aGVhZD4KICAgICAgICAgICAgPHRib2R5PgogICAgICAgICAgICAgICR7dG9wUGF5YWJsZXMubWFwKGIgPT4gYDx0cj4KICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0ibXV0ZWQiPiR7Yi5kb2N1bWVudF9uciB8fCAn4oCTJ308L3RkPgogICAgICAgICAgICAgICAgPHRkPiR7KGIudGl0bGUgfHwgJycpLnNsaWNlKDAsNDApfTwvdGQ+CiAgICAgICAgICAgICAgICA8dGQ+JHtmbXREYXRlKGIuZHVlKX08L3RkPgogICAgICAgICAgICAgICAgPHRkPiR7c3RhdHVzQmFkZ2UoYi5zdGF0dXMsIGIuZHVlKX08L3RkPgogICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJudW0gJHtiLmR1ZSAmJiBuZXcgRGF0ZShiLmR1ZSkgPCB0b2RheSA/ICdhbWJlcicgOiAncmVkJ30iPiR7Zm10KGIub3Blbil9PC90ZD4KICAgICAgICAgICAgICA8L3RyPmApLmpvaW4oJycpfQogICAgICAgICAgICA8L3Rib2R5PgogICAgICAgICAgPC90YWJsZT4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+CgogICAgICA8ZGl2IGNsYXNzPSJmb290ZXIgbW9ubyI+U3RhbmQ6ICR7bmV3IERhdGUoKS50b0xvY2FsZURhdGVTdHJpbmcoImRlLUNIIil9IMK3IERyaXhsIFRyYW5zcG9ydGUgR21iSCDCtyBEYXRlbiBhdXMgYmV4aW8gdmlhIFN1cGFiYXNlPC9kaXY+CiAgICA8L2Rpdj4KICBgOwoKICAvLyDilIDilIAgQ2hhcnRzIOKUgOKUgAogIGNvbnN0IGNoYXJ0RGVmYXVsdHMgPSB7IHJlc3BvbnNpdmU6IHRydWUsIG1haW50YWluQXNwZWN0UmF0aW86IGZhbHNlLAogICAgcGx1Z2luczogeyBsZWdlbmQ6IHsgbGFiZWxzOiB7IGNvbG9yOiAiIzhhOWFhYSIsIGZvbnQ6IHsgZmFtaWx5OiAiJ0pldEJyYWlucyBNb25vJyIgfSB9IH0gfSwKICAgIHNjYWxlczogeyB4OiB7IHRpY2tzOiB7IGNvbG9yOiAiIzVhNmE3YSIsIGZvbnQ6IHsgZmFtaWx5OiAiJ0pldEJyYWlucyBNb25vJyIsIHNpemU6IDEwIH0gfSwgZ3JpZDogeyBjb2xvcjogIiMxYTIzMzIiIH0gfSwKICAgICAgICAgICAgICB5OiB7IHRpY2tzOiB7IGNvbG9yOiAiIzVhNmE3YSIsIGZvbnQ6IHsgZmFtaWx5OiAiJ0pldEJyYWlucyBNb25vJyIsIHNpemU6IDEwIH0sIGNhbGxiYWNrOiB2ID0+IGZtdEsodikgfSwgZ3JpZDogeyBjb2xvcjogIiMxYTIzMzIiIH0gfSB9CiAgfTsKCiAgLy8gQWdpbmcgZG9udXQgLSBSZWNlaXZhYmxlcwogIG5ldyBDaGFydChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2hhcnRBZ2luZ1IiKSwgewogICAgdHlwZTogImRvdWdobnV0IiwKICAgIGRhdGE6IHsgbGFiZWxzOiBbIjDigJMzMCBUIiwgIjMx4oCTNjAgVCIsICI2MeKAkzkwIFQiLCAiOTArIFQiXSwKICAgICAgZGF0YXNldHM6IFt7IGRhdGE6IFthZ2luZ1JbIjAtMzAiXSwgYWdpbmdSWyIzMS02MCJdLCBhZ2luZ1JbIjYxLTkwIl0sIGFnaW5nUlsiOTArIl1dLAogICAgICAgIGJhY2tncm91bmRDb2xvcjogWyIjNGVjZGM0IiwiI2ZmYTcyNiIsIiNmZjcwNDMiLCIjZmY2YjZiIl0sIGJvcmRlcldpZHRoOiAwIH1dIH0sCiAgICBvcHRpb25zOiB7IHJlc3BvbnNpdmU6IHRydWUsIG1haW50YWluQXNwZWN0UmF0aW86IGZhbHNlLCBjdXRvdXQ6ICI2NSUiLAogICAgICBwbHVnaW5zOiB7IGxlZ2VuZDogeyBwb3NpdGlvbjogImJvdHRvbSIsIGxhYmVsczogeyBjb2xvcjogIiM4YTlhYWEiLCBmb250OiB7IGZhbWlseTogIidKZXRCcmFpbnMgTW9ubyciLCBzaXplOiAxMSB9LCBwYWRkaW5nOiAxMiB9IH0gfSB9CiAgfSk7CgogIC8vIEFnaW5nIGRvbnV0IC0gUGF5YWJsZXMKICBuZXcgQ2hhcnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNoYXJ0QWdpbmdQIiksIHsKICAgIHR5cGU6ICJkb3VnaG51dCIsCiAgICBkYXRhOiB7IGxhYmVsczogWyIw4oCTMzAgVCIsICIzMeKAkzYwIFQiLCAiNjHigJM5MCBUIiwgIjkwKyBUIl0sCiAgICAgIGRhdGFzZXRzOiBbeyBkYXRhOiBbYWdpbmdQWyIwLTMwIl0sIGFnaW5nUFsiMzEtNjAiXSwgYWdpbmdQWyI2MS05MCJdLCBhZ2luZ1BbIjkwKyJdXSwKICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IFsiIzRlY2RjNCIsIiNmZmE3MjYiLCIjZmY3MDQzIiwiI2ZmNmI2YiJdLCBib3JkZXJXaWR0aDogMCB9XSB9LAogICAgb3B0aW9uczogeyByZXNwb25zaXZlOiB0cnVlLCBtYWludGFpbkFzcGVjdFJhdGlvOiBmYWxzZSwgY3V0b3V0OiAiNjUlIiwKICAgICAgcGx1Z2luczogeyBsZWdlbmQ6IHsgcG9zaXRpb246ICJib3R0b20iLCBsYWJlbHM6IHsgY29sb3I6ICIjOGE5YWFhIiwgZm9udDogeyBmYW1pbHk6ICInSmV0QnJhaW5zIE1vbm8nIiwgc2l6ZTogMTEgfSwgcGFkZGluZzogMTIgfSB9IH0gfQogIH0pOwoKICAvLyBXZWVrbHkgY2FzaGZsb3cKICBuZXcgQ2hhcnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNoYXJ0V2Vla2x5IiksIHsKICAgIHR5cGU6ICJiYXIiLAogICAgZGF0YTogewogICAgICBsYWJlbHM6IHdlZWtzLm1hcCh3ID0+IHcubGFiZWwpLAogICAgICBkYXRhc2V0czogWwogICAgICAgIHsgbGFiZWw6ICJFaW5uYWhtZW4gKGVyd2FydGV0KSIsIGRhdGE6IHdlZWtzLm1hcCh3ID0+IHcuaW5mbG93KSwgYmFja2dyb3VuZENvbG9yOiAicmdiYSg3OCwyMDUsMTk2LDAuNykiLCBib3JkZXJSYWRpdXM6IDQsIG9yZGVyOiAyIH0sCiAgICAgICAgeyBsYWJlbDogIkF1c2dhYmVuIChlcndhcnRldCkiLCBkYXRhOiB3ZWVrcy5tYXAodyA9PiAtdy5vdXRmbG93KSwgYmFja2dyb3VuZENvbG9yOiAicmdiYSgyNTUsMTA3LDEwNywwLjcpIiwgYm9yZGVyUmFkaXVzOiA0LCBvcmRlcjogMiB9LAogICAgICAgIHsgbGFiZWw6ICJLdW11bGllcnQgTmV0dG8iLCBkYXRhOiB3ZWVrcy5tYXAodyA9PiB3LmN1bU5ldCksIHR5cGU6ICJsaW5lIiwgYm9yZGVyQ29sb3I6ICIjZmZhNzI2IiwgYmFja2dyb3VuZENvbG9yOiAidHJhbnNwYXJlbnQiLAogICAgICAgICAgYm9yZGVyV2lkdGg6IDIsIHBvaW50UmFkaXVzOiAzLCBwb2ludEJhY2tncm91bmRDb2xvcjogIiNmZmE3MjYiLCB0ZW5zaW9uOiAwLjMsIG9yZGVyOiAxIH0sCiAgICAgIF0KICAgIH0sCiAgICBvcHRpb25zOiB7IC4uLmNoYXJ0RGVmYXVsdHMsCiAgICAgIHBsdWdpbnM6IHsgLi4uY2hhcnREZWZhdWx0cy5wbHVnaW5zLAogICAgICAgIHRvb2x0aXA6IHsgY2FsbGJhY2tzOiB7IGxhYmVsOiBjdHggPT4gYCR7Y3R4LmRhdGFzZXQubGFiZWx9OiBDSEYgJHtmbXQoTWF0aC5hYnMoY3R4LnJhdykpfWAgfSB9IH0sCiAgICAgIHNjYWxlczogeyAuLi5jaGFydERlZmF1bHRzLnNjYWxlcywKICAgICAgICB4OiB7IC4uLmNoYXJ0RGVmYXVsdHMuc2NhbGVzLngsIHN0YWNrZWQ6IHRydWUgfSwKICAgICAgICB5OiB7IC4uLmNoYXJ0RGVmYXVsdHMuc2NhbGVzLnksIHN0YWNrZWQ6IGZhbHNlLAogICAgICAgICAgdGlja3M6IHsgLi4uY2hhcnREZWZhdWx0cy5zY2FsZXMueS50aWNrcywgY2FsbGJhY2s6IHYgPT4gYCR7diA8IDAgPyAnLScgOiAnJ30ke2ZtdEsoTWF0aC5hYnModikpfWAgfSB9CiAgICAgIH0KICAgIH0KICB9KTsKfQoKZnVuY3Rpb24gcmVuZGVyQWdpbmdCYXIoYWdpbmcsIHRvdGFsKSB7CiAgaWYgKHRvdGFsIDw9IDApIHJldHVybiAnPGRpdiBzdHlsZT0iY29sb3I6IzVhNmE3YTtmb250LXNpemU6MTJweDtwYWRkaW5nOjhweCI+S2VpbmUgb2ZmZW5lbiBQb3N0ZW48L2Rpdj4nOwogIGNvbnN0IHBjdCA9ICh2KSA9PiBNYXRoLm1heCgoKHYgLyB0b3RhbCkgKiAxMDApLCB2ID4gMCA/IDUgOiAwKS50b0ZpeGVkKDEpOwogIHJldHVybiBgCiAgICA8ZGl2IGNsYXNzPSJhZ2luZy1iYXIiPgogICAgICAke2FnaW5nWyIwLTMwIl0gPiAwID8gYDxkaXYgY2xhc3M9ImFnaW5nLXNlZ21lbnQgYWdpbmctMC0zMCIgc3R5bGU9IndpZHRoOiR7cGN0KGFnaW5nWyIwLTMwIl0pfSUiIHRpdGxlPSIw4oCTMzAgVGFnZTogQ0hGICR7Zm10KGFnaW5nWyIwLTMwIl0pfSI+JHtmbXRLKGFnaW5nWyIwLTMwIl0pfTwvZGl2PmAgOiAnJ30KICAgICAgJHthZ2luZ1siMzEtNjAiXSA+IDAgPyBgPGRpdiBjbGFzcz0iYWdpbmctc2VnbWVudCBhZ2luZy0zMS02MCIgc3R5bGU9IndpZHRoOiR7cGN0KGFnaW5nWyIzMS02MCJdKX0lIiB0aXRsZT0iMzHigJM2MCBUYWdlOiBDSEYgJHtmbXQoYWdpbmdbIjMxLTYwIl0pfSI+JHtmbXRLKGFnaW5nWyIzMS02MCJdKX08L2Rpdj5gIDogJyd9CiAgICAgICR7YWdpbmdbIjYxLTkwIl0gPiAwID8gYDxkaXYgY2xhc3M9ImFnaW5nLXNlZ21lbnQgYWdpbmctNjEtOTAiIHN0eWxlPSJ3aWR0aDoke3BjdChhZ2luZ1siNjEtOTAiXSl9JSIgdGl0bGU9IjYx4oCTOTAgVGFnZTogQ0hGICR7Zm10KGFnaW5nWyI2MS05MCJdKX0iPiR7Zm10SyhhZ2luZ1siNjEtOTAiXSl9PC9kaXY+YCA6ICcnfQogICAgICAke2FnaW5nWyI5MCsiXSA+IDAgPyBgPGRpdiBjbGFzcz0iYWdpbmctc2VnbWVudCBhZ2luZy05MHBsdXMiIHN0eWxlPSJ3aWR0aDoke3BjdChhZ2luZ1siOTArIl0pfSUiIHRpdGxlPSI5MCsgVGFnZTogQ0hGICR7Zm10KGFnaW5nWyI5MCsiXSl9Ij4ke2ZtdEsoYWdpbmdbIjkwKyJdKX08L2Rpdj5gIDogJyd9CiAgICA8L2Rpdj4KICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2Vlbjtmb250LXNpemU6MTBweDtjb2xvcjojNWE2YTdhO21hcmdpbi10b3A6NHB4O2ZvbnQtZmFtaWx5OidKZXRCcmFpbnMgTW9ubycsbW9ub3NwYWNlIj4KICAgICAgPHNwYW4+MOKAkzMwIFQ8L3NwYW4+PHNwYW4+MzHigJM2MCBUPC9zcGFuPjxzcGFuPjYx4oCTOTAgVDwvc3Bhbj48c3Bhbj45MCsgVDwvc3Bhbj4KICAgIDwvZGl2PmA7Cn0KCmZ1bmN0aW9uIHN0YXR1c0JhZGdlKHN0YXR1cywgZHVlRGF0ZSkgewogIGNvbnN0IHMgPSAoc3RhdHVzIHx8ICcnKS50b1VwcGVyQ2FzZSgpOwogIGlmIChkdWVEYXRlICYmIG5ldyBEYXRlKGR1ZURhdGUpIDwgdG9kYXkgJiYgIVsnUEFJRCcsJ0NBTkNFTExFRCddLmluY2x1ZGVzKHMpKSByZXR1cm4gJzxzcGFuIGNsYXNzPSJiYWRnZSBvdmVyZHVlIj7DnGJlcmbDpGxsaWc8L3NwYW4+JzsKICBpZiAocyA9PT0gJ1BBSUQnKSByZXR1cm4gJzxzcGFuIGNsYXNzPSJiYWRnZSBwYWlkIj5CZXphaGx0PC9zcGFuPic7CiAgaWYgKFsnUEFSVElBTCcsJ1BBUlRJQUxMWV9QQUlEJ10uaW5jbHVkZXMocykpIHJldHVybiAnPHNwYW4gY2xhc3M9ImJhZGdlIHBlbmRpbmciPlRlaWx6YWhsdW5nPC9zcGFuPic7CiAgaWYgKFsnRFJBRlQnLCdDUkVBVEVEJ10uaW5jbHVkZXMocykpIHJldHVybiAnPHNwYW4gY2xhc3M9ImJhZGdlIGRyYWZ0Ij5FbnR3dXJmPC9zcGFuPic7CiAgcmV0dXJuICc8c3BhbiBjbGFzcz0iYmFkZ2UgcGVuZGluZyI+T2ZmZW48L3NwYW4+JzsKfQoKZnVuY3Rpb24gc3dpdGNoVGFiKHRhYikgewogIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy50YWItYnRuJykuZm9yRWFjaChiID0+IGIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy50YWItcGFuZWwnKS5mb3JFYWNoKHAgPT4gcC5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHRhYi0ke3RhYn1gKS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICBldmVudC50YXJnZXQuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7Cn0KCm1haW4oKS5jYXRjaChlcnIgPT4gewogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhcHAiKS5pbm5lckhUTUwgPSBgPGRpdiBzdHlsZT0iY29sb3I6I2ZmNmI2YjtwYWRkaW5nOjQwcHg7dGV4dC1hbGlnbjpjZW50ZXIiPkZlaGxlcjogJHtlcnIubWVzc2FnZX08L2Rpdj5gOwp9KTsKPC9zY3JpcHQ+CjwvYm9keT4KPC9odG1sPgo='
};
PAGES_B64['/index.html'] = PAGES_B64['/'];

function decodePage(key) {
  const b64 = PAGES_B64[key];
  if (!b64) return null;
  return Buffer.from(b64, 'base64').toString('utf8');
}

module.exports = async (req, res) => {
  const cookies = cookie.parse(req.headers.cookie || '');
  const token = cookies[COOKIE_NAME];
  const isAuth = verifyToken(token);

  let reqPath = req.url.split('?')[0];
  if (reqPath === '' || reqPath === '/') reqPath = '/';

  if (!isAuth) {
    res.setHeader('Content-Type', 'text/html; charset=utf-8');
    return res.status(200).send(getLoginPage());
  }

  const page = decodePage(reqPath) || decodePage('/');
  if (page) {
    res.setHeader('Content-Type', 'text/html; charset=utf-8');
    return res.status(200).send(page);
  }

  return res.status(404).send('Not found');
};
