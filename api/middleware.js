const crypto = require('crypto');
const cookie = require('cookie');

const SESSION_SECRET = process.env.SESSION_SECRET || 'drixl-default-secret-change-me';
const COOKIE_NAME = 'drixl_session';
const SESSION_DAYS = 30;

function verifyToken(token) {
  if (!token) return false;
  const parts = token.split(':');
  if (parts.length !== 3) return false;
  const [status, expires, sig] = parts;
  const payload = `${status}:${expires}`;
  const expected = crypto.createHmac('sha256', SESSION_SECRET).update(payload).digest('hex');
  if (sig !== expected) return false;
  if (Date.now() > parseInt(expires)) return false;
  return true;
}

function getLoginPage(error) {
  return `<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Drixl Transporte – Login</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: #0a1018; color: #c8d2dc; font-family: 'DM Sans', sans-serif;
    min-height: 100vh; display: flex; align-items: center; justify-content: center; }
  .login-box { width: 100%; max-width: 380px; padding: 20px; }
  .logo { text-align: center; margin-bottom: 40px; }
  .logo-sub { font-size: 11px; font-weight: 600; letter-spacing: 0.14em; text-transform: uppercase;
    color: #2a6f4e; font-family: 'JetBrains Mono', monospace; margin-bottom: 6px; }
  .logo h1 { font-size: 26px; font-weight: 700; color: #e8edf2; }
  .card { background: #111820; border: 1px solid #1a2332; border-radius: 16px; padding: 32px 28px; }
  .card-title { font-size: 14px; font-weight: 600; color: #8a9aaa; margin-bottom: 24px; text-align: center; }
  .field { margin-bottom: 20px; }
  .field label { display: block; font-size: 11px; font-weight: 600; letter-spacing: 0.08em;
    text-transform: uppercase; color: #5a6a7a; font-family: 'JetBrains Mono', monospace; margin-bottom: 8px; }
  .field input { width: 100%; background: #0a1018; border: 1px solid #1a2332; color: #e8edf2;
    font-family: 'JetBrains Mono', monospace; font-size: 14px; padding: 12px 16px; border-radius: 8px;
    outline: none; transition: border 0.2s; }
  .field input:focus { border-color: #2a6f4e; }
  .btn { width: 100%; padding: 12px; border-radius: 8px; border: none; cursor: pointer;
    font-size: 14px; font-weight: 700; font-family: 'JetBrains Mono', monospace;
    background: linear-gradient(135deg, #2a6f4e, #4ecdc4); color: #0a1018;
    transition: all 0.2s; letter-spacing: 0.04em; }
  .btn:hover { transform: translateY(-1px); box-shadow: 0 4px 20px rgba(78,205,196,0.3); }
  .error { background: #1a1215; border: 1px solid #4a2020; color: #ff6b6b; font-size: 12px;
    padding: 10px 14px; border-radius: 8px; margin-bottom: 16px; text-align: center;
    font-family: 'JetBrains Mono', monospace; }
  .footer { text-align: center; margin-top: 32px; color: #2a3a4a; font-size: 11px;
    font-family: 'JetBrains Mono', monospace; }
</style>
</head>
<body>
<div class="login-box">
  <div class="logo">
    <div class="logo-sub">Drixl Transporte GmbH</div>
    <h1>Finance Dashboard</h1>
  </div>
  <div class="card">
    <div class="card-title">Zugang zum Dashboard</div>
    ${error ? '<div class="error">' + error + '</div>' : ''}
    <form method="POST" action="/api/login">
      <div class="field">
        <label>Passwort</label>
        <input type="password" name="password" placeholder="Passwort eingeben" autofocus required>
      </div>
      <button type="submit" class="btn">Anmelden</button>
    </form>
  </div>
  <div class="footer">Geschützter Bereich · Nur für autorisierte Benutzer</div>
</div>
</body>
</html>`;
}

// Pages embedded as base64 - no filesystem needed
const PAGES_B64 = {
  '/': 'PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImRlIj4KPGhlYWQ+CjxtZXRhIGNoYXJzZXQ9IlVURi04Ij4KPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiPgo8dGl0bGU+RHJpeGwgVHJhbnNwb3J0ZSDigJMgRmluYW5jZSBEYXNoYm9hcmQ8L3RpdGxlPgo8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9jaGFydC5qc0A0LjQuMS9kaXN0L2NoYXJ0LnVtZC5taW4uanMiPjwvc2NyaXB0Pgo8bGluayBocmVmPSJodHRwczovL2ZvbnRzLmdvb2dsZWFwaXMuY29tL2NzczI/ZmFtaWx5PURNK1NhbnM6d2dodEA0MDA7NTAwOzYwMDs3MDAmZmFtaWx5PUpldEJyYWlucytNb25vOndnaHRANDAwOzUwMDs2MDAmZGlzcGxheT1zd2FwIiByZWw9InN0eWxlc2hlZXQiPgo8c3R5bGU+CiAgKiB7IG1hcmdpbjogMDsgcGFkZGluZzogMDsgYm94LXNpemluZzogYm9yZGVyLWJveDsgfQogIGJvZHkgeyBiYWNrZ3JvdW5kOiAjMGExMDE4OyBjb2xvcjogI2M4ZDJkYzsgZm9udC1mYW1pbHk6ICdETSBTYW5zJywgc2Fucy1zZXJpZjsgcGFkZGluZzogMjRweCAyMHB4OyBtaW4taGVpZ2h0OiAxMDB2aDsgfQogIC5jb250YWluZXIgeyBtYXgtd2lkdGg6IDEyMDBweDsgbWFyZ2luOiAwIGF1dG87IH0KICAubW9ubyB7IGZvbnQtZmFtaWx5OiAnSmV0QnJhaW5zIE1vbm8nLCBtb25vc3BhY2U7IH0KICAKICAuaGVhZGVyIHsgZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOyBmbGV4LXdyYXA6IHdyYXA7IGdhcDogMTJweDsgbWFyZ2luLWJvdHRvbTogMzJweDsgYW5pbWF0aW9uOiBmYWRlSW4gMC41cyBlYXNlOyB9CiAgLmhlYWRlci1zdWIgeyBmb250LXNpemU6IDExcHg7IGZvbnQtd2VpZ2h0OiA2MDA7IGxldHRlci1zcGFjaW5nOiAwLjEyZW07IHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7IGNvbG9yOiAjMmE2ZjRlOyBtYXJnaW4tYm90dG9tOiA0cHg7IH0KICAuaGVhZGVyIGgxIHsgZm9udC1zaXplOiAyOHB4OyBmb250LXdlaWdodDogNzAwOyBjb2xvcjogI2U4ZWRmMjsgbGluZS1oZWlnaHQ6IDEuMjsgfQogIAogIC55ZWFyLWJ0bnMgeyBkaXNwbGF5OiBmbGV4OyBnYXA6IDZweDsgZmxleC13cmFwOiB3cmFwOyB9CiAgLnllYXItYnRuIHsgcGFkZGluZzogNnB4IDE0cHg7IGJvcmRlci1yYWRpdXM6IDZweDsgYm9yZGVyOiBub25lOyBjdXJzb3I6IHBvaW50ZXI7IGZvbnQtc2l6ZTogMTNweDsgZm9udC13ZWlnaHQ6IDYwMDsgZm9udC1mYW1pbHk6ICdKZXRCcmFpbnMgTW9ubycsIG1vbm9zcGFjZTsgYmFja2dyb3VuZDogIzExMTgyMDsgY29sb3I6ICM1YTZhN2E7IHRyYW5zaXRpb246IGFsbCAwLjJzOyB9CiAgLnllYXItYnRuLmFjdGl2ZSB7IGJhY2tncm91bmQ6ICMyYTZmNGU7IGNvbG9yOiAjZThlZGYyOyB9CiAgLnllYXItYnRuOmhvdmVyIHsgYmFja2dyb3VuZDogIzFhMjgzMjsgY29sb3I6ICM4YTlhYWE7IH0KICAueWVhci1idG4uYWN0aXZlOmhvdmVyIHsgYmFja2dyb3VuZDogIzM1ODg2YTsgfQoKICAuc2VjdGlvbi10aXRsZSB7IGZvbnQtc2l6ZTogMTFweDsgZm9udC13ZWlnaHQ6IDcwMDsgbGV0dGVyLXNwYWNpbmc6IDAuMTRlbTsgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsgY29sb3I6ICMyYTZmNGU7IG1hcmdpbjogMjhweCAwIDE0cHg7IHBhZGRpbmctbGVmdDogMnB4OyB9CgogIC5rcGktZ3JpZCB7IGRpc3BsYXk6IGdyaWQ7IGdyaWQtdGVtcGxhdGUtY29sdW1uczogcmVwZWF0KGF1dG8tZml0LCBtaW5tYXgoMTgwcHgsIDFmcikpOyBnYXA6IDEycHg7IG1hcmdpbi1ib3R0b206IDI0cHg7IGFuaW1hdGlvbjogZmFkZUluIDAuNnMgZWFzZTsgfQogIC5rcGktY2FyZCB7IGJhY2tncm91bmQ6ICMxMTE4MjA7IGJvcmRlcjogMXB4IHNvbGlkICMxYTIzMzI7IGJvcmRlci1yYWRpdXM6IDEycHg7IHBhZGRpbmc6IDE4cHggMjBweDsgcG9zaXRpb246IHJlbGF0aXZlOyBvdmVyZmxvdzogaGlkZGVuOyB9CiAgLmtwaS1jYXJkLmFjY2VudCB7IGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsICMxYTIzMzIgMCUsICMwZjE5MjMgMTAwJSk7IGJvcmRlci1jb2xvcjogIzJhNmY0ZTsgfQogIC5rcGktY2FyZC5hY2NlbnQ6OmJlZm9yZSB7IGNvbnRlbnQ6ICcnOyBwb3NpdGlvbjogYWJzb2x1dGU7IHRvcDogMDsgbGVmdDogMDsgcmlnaHQ6IDA7IGhlaWdodDogMnB4OyBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsICMyYTZmNGUsICM0ZWNkYzQpOyB9CiAgLmtwaS1jYXJkLndhcm4geyBib3JkZXItY29sb3I6ICM1YTQ1MjA7IH0KICAua3BpLWNhcmQud2Fybjo6YmVmb3JlIHsgY29udGVudDogJyc7IHBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiAwOyBsZWZ0OiAwOyByaWdodDogMDsgaGVpZ2h0OiAycHg7IGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCg5MGRlZywgI2U4YTU0YiwgI2ZmNmI2Yik7IH0KICAua3BpLWNhcmQuaW5mbyB7IGJvcmRlci1jb2xvcjogIzFhMzM1NTsgfQogIC5rcGktY2FyZC5pbmZvOjpiZWZvcmUgeyBjb250ZW50OiAnJzsgcG9zaXRpb246IGFic29sdXRlOyB0b3A6IDA7IGxlZnQ6IDA7IHJpZ2h0OiAwOyBoZWlnaHQ6IDJweDsgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjNGE5MGQ5LCAjNmNiNGVlKTsgfQogIC5rcGktbGFiZWwgeyBmb250LXNpemU6IDExcHg7IGZvbnQtd2VpZ2h0OiA2MDA7IGxldHRlci1zcGFjaW5nOiAwLjA4ZW07IHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7IGNvbG9yOiAjNWE2YTdhOyBtYXJnaW4tYm90dG9tOiA2cHg7IH0KICAua3BpLXZhbHVlIHsgZm9udC1zaXplOiAyNnB4OyBmb250LXdlaWdodDogNzAwOyBjb2xvcjogI2U4ZWRmMjsgbGluZS1oZWlnaHQ6IDEuMTsgbWFyZ2luLWJvdHRvbTogNHB4OyB9CiAgLmtwaS1jYXJkLmFjY2VudCAua3BpLXZhbHVlIHsgY29sb3I6ICM0ZWNkYzQ7IH0KICAua3BpLWNhcmQud2FybiAua3BpLXZhbHVlIHsgY29sb3I6ICNlOGE1NGI7IH0KICAua3BpLWNhcmQuaW5mbyAua3BpLXZhbHVlIHsgY29sb3I6ICM2Y2I0ZWU7IH0KICAua3BpLXN1YiB7IGZvbnQtc2l6ZTogMTJweDsgY29sb3I6ICM0YTVhNmE7IH0KICAua3BpLXN1Yi5ncmVlbiB7IGNvbG9yOiAjNGVjZGM0OyB9CiAgLmtwaS1zdWIucmVkIHsgY29sb3I6ICNmZjZiNmI7IH0KCiAgLmNoYXJ0cy1ncmlkIHsgZGlzcGxheTogZ3JpZDsgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgMWZyOyBnYXA6IDEycHg7IG1hcmdpbi1ib3R0b206IDI0cHg7IGFuaW1hdGlvbjogZmFkZUluIDAuN3MgZWFzZTsgfQogIC5jaGFydC1jYXJkIHsgYmFja2dyb3VuZDogIzExMTgyMDsgYm9yZGVyOiAxcHggc29saWQgIzFhMjMzMjsgYm9yZGVyLXJhZGl1czogMTJweDsgcGFkZGluZzogMjBweDsgfQogIC5jaGFydC10aXRsZSB7IGZvbnQtc2l6ZTogMTNweDsgZm9udC13ZWlnaHQ6IDYwMDsgY29sb3I6ICM1YTZhN2E7IGxldHRlci1zcGFjaW5nOiAwLjA2ZW07IHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7IG1hcmdpbi1ib3R0b206IDE2cHg7IH0KICAuY2hhcnQtd3JhcCB7IHBvc2l0aW9uOiByZWxhdGl2ZTsgaGVpZ2h0OiAyNDBweDsgfQoKICAuYm90dG9tLWdyaWQgeyBkaXNwbGF5OiBncmlkOyBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciAxZnI7IGdhcDogMTJweDsgYW5pbWF0aW9uOiBmYWRlSW4gMC44cyBlYXNlOyB9CiAgLmxpc3QtY2FyZCB7IGJhY2tncm91bmQ6ICMxMTE4MjA7IGJvcmRlcjogMXB4IHNvbGlkICMxYTIzMzI7IGJvcmRlci1yYWRpdXM6IDEycHg7IHBhZGRpbmc6IDIwcHg7IH0KCiAgLmN1c3RvbWVyLXJvdyB7IHBhZGRpbmc6IDhweCAwOyB9CiAgLmN1c3RvbWVyLXJvdzpob3ZlciB7IGJhY2tncm91bmQ6ICMwZjE2MjA7IGJvcmRlci1yYWRpdXM6IDZweDsgfQogIC5jdXN0b21lci1oZWFkZXIgeyBkaXNwbGF5OiBmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47IGFsaWduLWl0ZW1zOiBjZW50ZXI7IG1hcmdpbi1ib3R0b206IDRweDsgfQogIC5jdXN0b21lci1uYW1lIHsgZm9udC1zaXplOiAxM3B4OyBjb2xvcjogI2M4ZDJkYzsgZm9udC13ZWlnaHQ6IDUwMDsgfQogIC5jdXN0b21lci1yYW5rIHsgY29sb3I6ICMzYTRhNWE7IGZvbnQtc2l6ZTogMTFweDsgbWFyZ2luLXJpZ2h0OiA4cHg7IH0KICAuY3VzdG9tZXItYW1vdW50IHsgZm9udC1zaXplOiAxM3B4OyBmb250LXdlaWdodDogNjAwOyBjb2xvcjogIzRlY2RjNDsgd2hpdGUtc3BhY2U6IG5vd3JhcDsgfQogIC5taW5pLWJhciB7IHdpZHRoOiAxMDAlOyBoZWlnaHQ6IDRweDsgYmFja2dyb3VuZDogIzFhMjMzMjsgYm9yZGVyLXJhZGl1czogMnB4OyBvdmVyZmxvdzogaGlkZGVuOyB9CiAgLm1pbmktYmFyLWZpbGwgeyBoZWlnaHQ6IDEwMCU7IGJhY2tncm91bmQ6ICMyYTZmNGU7IGJvcmRlci1yYWRpdXM6IDJweDsgdHJhbnNpdGlvbjogd2lkdGggMXMgZWFzZTsgfQoKICAuaW52LXJvdyB7IGRpc3BsYXk6IGZsZXg7IGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsgYWxpZ24taXRlbXM6IGNlbnRlcjsgcGFkZGluZzogOHB4IDRweDsgYm9yZGVyLXJhZGl1czogNHB4OyB9CiAgLmludi1yb3c6aG92ZXIgeyBiYWNrZ3JvdW5kOiAjMGYxNjIwOyB9CiAgLmludi1uYW1lIHsgZm9udC1zaXplOiAxM3B4OyBjb2xvcjogI2M4ZDJkYzsgZm9udC13ZWlnaHQ6IDUwMDsgfQogIC5pbnYtZGV0YWlsIHsgZm9udC1zaXplOiAxMXB4OyBjb2xvcjogIzNhNGE1YTsgfQogIC5pbnYtYW1vdW50IHsgZm9udC1zaXplOiAxNHB4OyBmb250LXdlaWdodDogNjAwOyBjb2xvcjogI2U4YTU0Yjsgd2hpdGUtc3BhY2U6IG5vd3JhcDsgfQoKICAuZnVubmVsLXJvdyB7IGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGdhcDogMTJweDsgbWFyZ2luLWJvdHRvbTogMTBweDsgfQogIC5mdW5uZWwtbGFiZWwgeyBmb250LXNpemU6IDEycHg7IGNvbG9yOiAjOGE5YWFhOyB3aWR0aDogOTBweDsgdGV4dC1hbGlnbjogcmlnaHQ7IGZsZXgtc2hyaW5rOiAwOyB9CiAgLmZ1bm5lbC1iYXItd3JhcCB7IGZsZXg6IDE7IGhlaWdodDogMjhweDsgYmFja2dyb3VuZDogIzBmMTYyMDsgYm9yZGVyLXJhZGl1czogNnB4OyBvdmVyZmxvdzogaGlkZGVuOyB9CiAgLmZ1bm5lbC1iYXIgeyBoZWlnaHQ6IDEwMCU7IGJvcmRlci1yYWRpdXM6IDZweDsgZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsgcGFkZGluZzogMCAxMHB4OyBmb250LXNpemU6IDEycHg7IGZvbnQtd2VpZ2h0OiA2MDA7IGNvbG9yOiAjZThlZGYyOyB0cmFuc2l0aW9uOiB3aWR0aCAxcyBlYXNlOyB9CiAgLmZ1bm5lbC1jb3VudCB7IGZvbnQtc2l6ZTogMTFweDsgY29sb3I6ICM1YTZhN2E7IHdpZHRoOiA2MHB4OyB0ZXh0LWFsaWduOiByaWdodDsgZmxleC1zaHJpbms6IDA7IH0KCiAgLmZvb3RlciB7IHRleHQtYWxpZ246IGNlbnRlcjsgcGFkZGluZzogMzJweCAwIDE2cHg7IGNvbG9yOiAjMmEzYTRhOyBmb250LXNpemU6IDExcHg7IH0KICAuZW1wdHktc3RhdGUgeyB0ZXh0LWFsaWduOiBjZW50ZXI7IHBhZGRpbmc6IDQwcHg7IGNvbG9yOiAjM2E0YTVhOyB9CiAgLmVtcHR5LXN0YXRlIC5pY29uIHsgZm9udC1zaXplOiAzMnB4OyBtYXJnaW4tYm90dG9tOiA4cHg7IH0KICAubG9hZGluZyB7IGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGp1c3RpZnktY29udGVudDogY2VudGVyOyBtaW4taGVpZ2h0OiA4MHZoOyB9CiAgLnNwaW5uZXIgeyB3aWR0aDogMjBweDsgaGVpZ2h0OiAyMHB4OyBib3JkZXI6IDJweCBzb2xpZCAjNGVjZGM0OyBib3JkZXItdG9wLWNvbG9yOiB0cmFuc3BhcmVudDsgYm9yZGVyLXJhZGl1czogNTAlOyBhbmltYXRpb246IHNwaW4gMXMgbGluZWFyIGluZmluaXRlOyBtYXJnaW4tcmlnaHQ6IDEycHg7IH0KICAKICBAa2V5ZnJhbWVzIHNwaW4geyB0byB7IHRyYW5zZm9ybTogcm90YXRlKDM2MGRlZyk7IH0gfQogIEBrZXlmcmFtZXMgZmFkZUluIHsgZnJvbSB7IG9wYWNpdHk6IDA7IHRyYW5zZm9ybTogdHJhbnNsYXRlWSg4cHgpOyB9IHRvIHsgb3BhY2l0eTogMTsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDApOyB9IH0KCiAgQG1lZGlhIChtYXgtd2lkdGg6IDkwMHB4KSB7CiAgICAuY2hhcnRzLWdyaWQsIC5ib3R0b20tZ3JpZCB7IGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyOyB9CiAgICAua3BpLWdyaWQgeyBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciAxZnI7IH0KICAgIC5oZWFkZXIgaDEgeyBmb250LXNpemU6IDIycHg7IH0KICB9Cjwvc3R5bGU+CjwvaGVhZD4KPGJvZHk+CjxkaXYgY2xhc3M9ImNvbnRhaW5lciIgaWQ9ImFwcCI+CiAgPGRpdiBjbGFzcz0ibG9hZGluZyI+CiAgICA8ZGl2IGNsYXNzPSJzcGlubmVyIj48L2Rpdj4KICAgIDxzcGFuIHN0eWxlPSJjb2xvcjogIzRlY2RjNDsgZm9udC1zaXplOiAxOHB4OyI+TGFkZSBEYXRlbiB2b24gU3VwYWJhc2UuLi48L3NwYW4+CiAgPC9kaXY+CjwvZGl2PgoKPHNjcmlwdD4KY29uc3QgU1VQQUJBU0VfVVJMID0gImh0dHBzOi8vbnpmd2RlaHVhY3J3aXN1aXhkeHUuc3VwYWJhc2UuY28iOwpjb25zdCBTVVBBQkFTRV9LRVkgPSAiZXlKaGJHY2lPaUpJVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKemRYQmhZbUZ6WlNJc0luSmxaaUk2SW01NlpuZGtaV2gxWVdOeWQybHpkV2w0WkhoMUlpd2ljbTlzWlNJNkluTmxjblpwWTJWZmNtOXNaU0lzSW1saGRDSTZNVGMzTVRJMk9EVXpOeXdpWlhod0lqb3lNRGcyT0RRME5UTTNmUS5famo1S0hVdWxwZ0MxVkluZDBfN20tQXNNQS1Na2hjSnNEa04tMXg1eFhVIjsKCmxldCBhY3RpdmVZZWFyID0gbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpOwpsZXQgY2hhcnRzID0ge307Cgphc3luYyBmdW5jdGlvbiBxdWVyeSh0YWJsZSwgcGFyYW1zID0gIiIpIHsKICBjb25zdCBhbGxEYXRhID0gW107CiAgbGV0IG9mZnNldCA9IDA7CiAgY29uc3QgYmF0Y2hTaXplID0gMTAwMDsKICB3aGlsZSAodHJ1ZSkgewogICAgY29uc3QgdXJsID0gYCR7U1VQQUJBU0VfVVJMfS9yZXN0L3YxLyR7dGFibGV9PyR7cGFyYW1zfSZvZmZzZXQ9JHtvZmZzZXR9JmxpbWl0PSR7YmF0Y2hTaXplfWA7CiAgICB0cnkgewogICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaCh1cmwsIHsKICAgICAgICBoZWFkZXJzOiB7IGFwaWtleTogU1VQQUJBU0VfS0VZLCBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7U1VQQUJBU0VfS0VZfWAsIFByZWZlcjogImNvdW50PWV4YWN0IiB9CiAgICAgIH0pOwogICAgICBpZiAoIXJlcy5vaykgeyBjb25zb2xlLndhcm4oYCR7dGFibGV9IGJhdGNoQCR7b2Zmc2V0fTogSFRUUCAke3Jlcy5zdGF0dXN9YCk7IGJyZWFrOyB9CiAgICAgIGNvbnN0IGJhdGNoID0gYXdhaXQgcmVzLmpzb24oKTsKICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGJhdGNoKSkgeyBjb25zb2xlLndhcm4oYCR7dGFibGV9IGJhdGNoQCR7b2Zmc2V0fTogbm90IGFycmF5YCwgYmF0Y2gpOyBicmVhazsgfQogICAgICBpZiAoYmF0Y2gubGVuZ3RoID09PSAwKSBicmVhazsKICAgICAgYWxsRGF0YS5wdXNoKC4uLmJhdGNoKTsKICAgICAgY29uc29sZS5sb2coYCAgJHt0YWJsZX06IGxvYWRlZCAke2FsbERhdGEubGVuZ3RofSAoYmF0Y2ggJHtiYXRjaC5sZW5ndGh9KWApOwogICAgICBpZiAoYmF0Y2gubGVuZ3RoIDwgYmF0Y2hTaXplKSBicmVhazsKICAgICAgb2Zmc2V0ICs9IGJhdGNoU2l6ZTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgY29uc29sZS5lcnJvcihgJHt0YWJsZX0gYmF0Y2hAJHtvZmZzZXR9OiBmZXRjaCBlcnJvcmAsIGUpOwogICAgICBicmVhazsKICAgIH0KICB9CiAgY29uc29sZS5sb2coYOKckyAke3RhYmxlfTogJHthbGxEYXRhLmxlbmd0aH0gdG90YWwgcmVjb3Jkc2ApOwogIHJldHVybiBhbGxEYXRhOwp9CgpmdW5jdGlvbiBmb3JtYXRDSEYodikgewogIGNvbnN0IG4gPSBwYXJzZUZsb2F0KHYpIHx8IDA7CiAgaWYgKG4gPj0gMTAwMDAwMCkgcmV0dXJuIGBDSEYgJHsobi8xMDAwMDAwKS50b0ZpeGVkKDIpfSBNaW9gOwogIGlmIChuID49IDEwMDAwKSByZXR1cm4gYENIRiAkeyhuLzEwMDApLnRvRml4ZWQoMCl9S2A7CiAgaWYgKG4gPj0gMTAwMCkgcmV0dXJuIGBDSEYgJHsobi8xMDAwKS50b0ZpeGVkKDEpfUtgOwogIHJldHVybiBgQ0hGICR7bi50b0ZpeGVkKDApfWA7Cn0KZnVuY3Rpb24gZm9ybWF0TnVtKHYpIHsgcmV0dXJuIG5ldyBJbnRsLk51bWJlckZvcm1hdCgiZGUtQ0giKS5mb3JtYXQodiB8fCAwKTsgfQoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIERBVEEgTE9BRElORwovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKCndpbmRvdy5fYWxsRGF0YSA9IHt9OwoKYXN5bmMgZnVuY3Rpb24gbG9hZEFsbERhdGEoKSB7CiAgLy8gU2VxdWVudGlhbCBsb2FkaW5nIHRvIGF2b2lkIFN1cGFiYXNlIHJhdGUgbGltaXRzCiAgY29uc29sZS5sb2coIkxvYWRpbmcgaW52b2ljZXMuLi4iKTsKICBjb25zdCBpbnZvaWNlcyA9IGF3YWl0IHF1ZXJ5KCJpbnZvaWNlcyIsICJzZWxlY3Q9aWQsaXNfdmFsaWRfZnJvbSx0b3RhbF9ncm9zcyx0b3RhbF9uZXQsdG90YWxfdGF4ZXMsc3RhdHVzLGNvbnRhY3RfaWQsZG9jdW1lbnRfbnIsY3JlYXRlZF9hdCx1cGRhdGVkX2F0Iik7CiAgY29uc29sZS5sb2coIkxvYWRpbmcgcXVvdGVzLi4uIik7CiAgY29uc3QgcXVvdGVzID0gYXdhaXQgcXVlcnkoInF1b3RlcyIsICJzZWxlY3Q9aWQsaXNfdmFsaWRfZnJvbSx0b3RhbF9ncm9zcyx0b3RhbF9uZXQsc3RhdHVzLGNyZWF0ZWRfYXQiKTsKICBjb25zb2xlLmxvZygiTG9hZGluZyBvcmRlcnMuLi4iKTsKICBjb25zdCBvcmRlcnMgPSBhd2FpdCBxdWVyeSgib3JkZXJzIiwgInNlbGVjdD1pZCx0b3RhbF9ncm9zcyx0b3RhbF9uZXQsc3RhdHVzLGlzX3ZhbGlkX2Zyb20iKTsKICBjb25zb2xlLmxvZygiTG9hZGluZyBjb250YWN0cy4uLiIpOwogIGNvbnN0IGNvbnRhY3RzID0gYXdhaXQgcXVlcnkoImNvbnRhY3RzIiwgInNlbGVjdD1pZCxuYW1lXzEsbmFtZV8yIik7CiAgY29uc29sZS5sb2coIkxvYWRpbmcgcGF5bWVudHMuLi4iKTsKICBjb25zdCBwYXltZW50cyA9IGF3YWl0IHF1ZXJ5KCJpbmNvbWluZ19wYXltZW50cyIsICJzZWxlY3Q9aWQsaW52b2ljZV9pZCxwYXltZW50X2RhdGUsYW1vdW50Iik7CiAgd2luZG93Ll9hbGxEYXRhID0geyBpbnZvaWNlcywgcXVvdGVzLCBvcmRlcnMsIGNvbnRhY3RzLCBwYXltZW50cyB9OwogIGNvbnNvbGUubG9nKGA9PT0gQUxMIERBVEEgTE9BREVEID09PSBpbnZvaWNlczoke2ludm9pY2VzLmxlbmd0aH0gcXVvdGVzOiR7cXVvdGVzLmxlbmd0aH0gb3JkZXJzOiR7b3JkZXJzLmxlbmd0aH0gY29udGFjdHM6JHtjb250YWN0cy5sZW5ndGh9IHBheW1lbnRzOiR7cGF5bWVudHMubGVuZ3RofWApOwp9CgovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKLy8gREFUQSBQUk9DRVNTSU5HCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAoKZnVuY3Rpb24gcHJvY2Vzc0RhdGEoKSB7CiAgY29uc3QgeyBpbnZvaWNlcywgcXVvdGVzLCBvcmRlcnMsIGNvbnRhY3RzLCBwYXltZW50cyB9ID0gd2luZG93Ll9hbGxEYXRhOwoKICBjb25zdCBjbSA9IHt9OwogIGNvbnRhY3RzLmZvckVhY2goYyA9PiBjbVtjLmlkXSA9IFtjLm5hbWVfMSwgYy5uYW1lXzJdLmZpbHRlcihCb29sZWFuKS5qb2luKCIgIikpOwoKICBjb25zdCByZXZlbnVlSW52ID0gaW52b2ljZXMuZmlsdGVyKGkgPT4gaS5zdGF0dXMgIT09ICJjYW5jZWxsZWQiICYmIGkuc3RhdHVzICE9PSAiZHJhZnQiKTsKICBjb25zdCBwYWlkSW52ID0gaW52b2ljZXMuZmlsdGVyKGkgPT4gaS5zdGF0dXMgPT09ICJwYWlkIik7CgogIC8vIOKUgOKUgCBZZWFybHkg4pSA4pSACiAgY29uc3QgeWVhcmx5ID0ge307CiAgcmV2ZW51ZUludi5mb3JFYWNoKGludiA9PiB7CiAgICBpZiAoIWludi5pc192YWxpZF9mcm9tKSByZXR1cm47CiAgICBjb25zdCB5ID0gbmV3IERhdGUoaW52LmlzX3ZhbGlkX2Zyb20pLmdldEZ1bGxZZWFyKCk7CiAgICBpZiAoIXllYXJseVt5XSkgeWVhcmx5W3ldID0geyB5ZWFyOiB5LCByZXZlbnVlOiAwLCBjb3VudDogMCB9OwogICAgeWVhcmx5W3ldLnJldmVudWUgKz0gcGFyc2VGbG9hdChpbnYudG90YWxfbmV0IHx8IDApOwogICAgeWVhcmx5W3ldLmNvdW50Kys7CiAgfSk7CiAgY29uc3QgeWVhcmx5RGF0YSA9IE9iamVjdC52YWx1ZXMoeWVhcmx5KS5zb3J0KChhLCBiKSA9PiBhLnllYXIgLSBiLnllYXIpOwogIGNvbnN0IHllYXJzID0geWVhcmx5RGF0YS5tYXAoeSA9PiB5LnllYXIpOwoKICAvLyDilIDilIAgS1BJcyDilIDilIAKICBjb25zdCB0b3RhbFJldmVudWUgPSByZXZlbnVlSW52LnJlZHVjZSgocywgaSkgPT4gcyArIHBhcnNlRmxvYXQoaS50b3RhbF9uZXQgfHwgMCksIDApOwogIGNvbnN0IGN1clllYXJSZXYgPSB5ZWFybHlbYWN0aXZlWWVhcl0/LnJldmVudWUgfHwgMDsKICBjb25zdCBsYXN0WWVhclJldiA9IHllYXJseVthY3RpdmVZZWFyIC0gMV0/LnJldmVudWUgfHwgMDsKICBjb25zdCB5b3kgPSBsYXN0WWVhclJldiA+IDAgPyAoKGN1clllYXJSZXYgLSBsYXN0WWVhclJldikgLyBsYXN0WWVhclJldiAqIDEwMCkgOiAwOwoKICBjb25zdCBvcGVuSW52ID0gaW52b2ljZXMuZmlsdGVyKGkgPT4gaS5zdGF0dXMgPT09ICJwZW5kaW5nIik7CiAgY29uc3Qgb3BlblRvdGFsID0gb3Blbkludi5yZWR1Y2UoKHMsIGkpID0+IHMgKyBwYXJzZUZsb2F0KGkudG90YWxfbmV0IHx8IDApLCAwKTsKCiAgLy8g4pSA4pSAIMOYIFJlY2hudW5nc2JldHJhZyDilIDilIAKICBjb25zdCBjdXJZZWFySW52ID0gcmV2ZW51ZUludi5maWx0ZXIoaSA9PiBpLmlzX3ZhbGlkX2Zyb20gJiYgbmV3IERhdGUoaS5pc192YWxpZF9mcm9tKS5nZXRGdWxsWWVhcigpID09PSBhY3RpdmVZZWFyKTsKICBjb25zdCBhdmdJbnZDdXJZZWFyID0gY3VyWWVhckludi5sZW5ndGggPiAwID8gY3VyWWVhckludi5yZWR1Y2UoKHMsIGkpID0+IHMgKyBwYXJzZUZsb2F0KGkudG90YWxfbmV0IHx8IDApLCAwKSAvIGN1clllYXJJbnYubGVuZ3RoIDogMDsKICBjb25zdCBsYXN0WWVhckludiA9IHJldmVudWVJbnYuZmlsdGVyKGkgPT4gaS5pc192YWxpZF9mcm9tICYmIG5ldyBEYXRlKGkuaXNfdmFsaWRfZnJvbSkuZ2V0RnVsbFllYXIoKSA9PT0gYWN0aXZlWWVhciAtIDEpOwogIGNvbnN0IGF2Z0ludkxhc3RZZWFyID0gbGFzdFllYXJJbnYubGVuZ3RoID4gMCA/IGxhc3RZZWFySW52LnJlZHVjZSgocywgaSkgPT4gcyArIHBhcnNlRmxvYXQoaS50b3RhbF9uZXQgfHwgMCksIDApIC8gbGFzdFllYXJJbnYubGVuZ3RoIDogMDsKICBjb25zdCBhdmdJbnZDaGFuZ2UgPSBhdmdJbnZMYXN0WWVhciA+IDAgPyAoKGF2Z0ludkN1clllYXIgLSBhdmdJbnZMYXN0WWVhcikgLyBhdmdJbnZMYXN0WWVhciAqIDEwMCkgOiAwOwogIGNvbnN0IGF2Z0ludkJ5WWVhciA9IHllYXJseURhdGEubWFwKHkgPT4gKHsgeWVhcjogeS55ZWFyLCBhdmc6IHkuY291bnQgPiAwID8geS5yZXZlbnVlIC8geS5jb3VudCA6IDAsIGNvdW50OiB5LmNvdW50IH0pKTsKCiAgLy8g4pSA4pSAIE9mZmVydGVuIOKUgOKUgAogIGNvbnN0IHRvdGFsUXVvdGVzID0gcXVvdGVzLmxlbmd0aDsKICBjb25zdCBhY2NlcHRlZFF1b3RlcyA9IHF1b3Rlcy5maWx0ZXIocSA9PiBxLnN0YXR1cyA9PT0gImFjY2VwdGVkIikubGVuZ3RoOwogIGNvbnN0IHBlbmRpbmdRdW90ZXMgPSBxdW90ZXMuZmlsdGVyKHEgPT4gcS5zdGF0dXMgPT09ICJwZW5kaW5nIikubGVuZ3RoOwogIGNvbnN0IGRlY2xpbmVkUXVvdGVzID0gcXVvdGVzLmZpbHRlcihxID0+IHEuc3RhdHVzID09PSAiZGVjbGluZWQiKS5sZW5ndGg7CiAgY29uc3QgcXVvdGVDb252ID0gdG90YWxRdW90ZXMgPiAwID8gKGFjY2VwdGVkUXVvdGVzIC8gdG90YWxRdW90ZXMgKiAxMDApIDogMDsKCiAgY29uc3QgcXVvdGVzQnlZZWFyID0ge307CiAgcXVvdGVzLmZvckVhY2gocSA9PiB7CiAgICBjb25zdCBkdCA9IHEuaXNfdmFsaWRfZnJvbSB8fCBxLmNyZWF0ZWRfYXQ7CiAgICBpZiAoIWR0KSByZXR1cm47CiAgICBjb25zdCB5ID0gbmV3IERhdGUoZHQpLmdldEZ1bGxZZWFyKCk7CiAgICBpZiAoIXF1b3Rlc0J5WWVhclt5XSkgcXVvdGVzQnlZZWFyW3ldID0geyB0b3RhbDogMCwgYWNjZXB0ZWQ6IDAsIGRlY2xpbmVkOiAwLCBwZW5kaW5nOiAwIH07CiAgICBxdW90ZXNCeVllYXJbeV0udG90YWwrKzsKICAgIGlmIChxLnN0YXR1cyA9PT0gImFjY2VwdGVkIikgcXVvdGVzQnlZZWFyW3ldLmFjY2VwdGVkKys7CiAgICBlbHNlIGlmIChxLnN0YXR1cyA9PT0gImRlY2xpbmVkIikgcXVvdGVzQnlZZWFyW3ldLmRlY2xpbmVkKys7CiAgICBlbHNlIGlmIChxLnN0YXR1cyA9PT0gInBlbmRpbmciKSBxdW90ZXNCeVllYXJbeV0ucGVuZGluZysrOwogIH0pOwoKICAvLyDilIDilIAgVG9wIEt1bmRlbiDilIDilIAKICBjb25zdCBjdXN0UmV2ID0ge307CiAgcmV2ZW51ZUludi5mb3JFYWNoKGludiA9PiB7CiAgICBpZiAoIWludi5jb250YWN0X2lkKSByZXR1cm47CiAgICBpZiAoIWN1c3RSZXZbaW52LmNvbnRhY3RfaWRdKSBjdXN0UmV2W2ludi5jb250YWN0X2lkXSA9IHsgaWQ6IGludi5jb250YWN0X2lkLCB0b3RhbDogMCwgY291bnQ6IDAgfTsKICAgIGN1c3RSZXZbaW52LmNvbnRhY3RfaWRdLnRvdGFsICs9IHBhcnNlRmxvYXQoaW52LnRvdGFsX25ldCB8fCAwKTsKICAgIGN1c3RSZXZbaW52LmNvbnRhY3RfaWRdLmNvdW50Kys7CiAgfSk7CiAgY29uc3QgdG9wQ3VzdCA9IE9iamVjdC52YWx1ZXMoY3VzdFJldikuc29ydCgoYSwgYikgPT4gYi50b3RhbCAtIGEudG90YWwpLnNsaWNlKDAsIDgpOwogIGNvbnN0IHRvcE1heCA9IHRvcEN1c3RbMF0/LnRvdGFsIHx8IDE7CiAgY29uc3Qgb3Blbkxpc3QgPSBvcGVuSW52LnNvcnQoKGEsIGIpID0+IHBhcnNlRmxvYXQoYi50b3RhbF9uZXQgfHwgMCkgLSBwYXJzZUZsb2F0KGEudG90YWxfbmV0IHx8IDApKS5zbGljZSgwLCA4KTsKCiAgLy8g4pSA4pSAIFphaGx1bmdzbW9yYWwgKERTTykg4pSA4pSACiAgY29uc3QgcGF5bWVudE1hcCA9IHt9OwogIHBheW1lbnRzLmZvckVhY2gocCA9PiB7IGlmICghcGF5bWVudE1hcFtwLmludm9pY2VfaWRdKSBwYXltZW50TWFwW3AuaW52b2ljZV9pZF0gPSBbXTsgcGF5bWVudE1hcFtwLmludm9pY2VfaWRdLnB1c2gocCk7IH0pOwoKICBjb25zdCBkc29EYXRhID0gW107CiAgcGFpZEludi5mb3JFYWNoKGludiA9PiB7CiAgICBpZiAoIWludi5pc192YWxpZF9mcm9tIHx8ICFwYXltZW50TWFwW2ludi5pZF0pIHJldHVybjsKICAgIGNvbnN0IGludkRhdGUgPSBuZXcgRGF0ZShpbnYuaXNfdmFsaWRfZnJvbSk7CiAgICBjb25zdCBwYXlzID0gcGF5bWVudE1hcFtpbnYuaWRdOwogICAgY29uc3QgbGFzdFBheSA9IHBheXMuc29ydCgoYSwgYikgPT4gbmV3IERhdGUoYi5wYXltZW50X2RhdGUpIC0gbmV3IERhdGUoYS5wYXltZW50X2RhdGUpKVswXTsKICAgIGlmICghbGFzdFBheT8ucGF5bWVudF9kYXRlKSByZXR1cm47CiAgICBjb25zdCBkYXlzID0gTWF0aC5yb3VuZCgobmV3IERhdGUobGFzdFBheS5wYXltZW50X2RhdGUpIC0gaW52RGF0ZSkgLyAoMTAwMCAqIDYwICogNjAgKiAyNCkpOwogICAgaWYgKGRheXMgPj0gMCAmJiBkYXlzIDwgMzY1KSBkc29EYXRhLnB1c2goeyB5ZWFyOiBpbnZEYXRlLmdldEZ1bGxZZWFyKCksIGRheXMgfSk7CiAgfSk7CgogIGNvbnN0IGRzb0J5WWVhciA9IHt9OwogIGRzb0RhdGEuZm9yRWFjaChkID0+IHsgaWYgKCFkc29CeVllYXJbZC55ZWFyXSkgZHNvQnlZZWFyW2QueWVhcl0gPSB7IHN1bTogMCwgY291bnQ6IDAgfTsgZHNvQnlZZWFyW2QueWVhcl0uc3VtICs9IGQuZGF5czsgZHNvQnlZZWFyW2QueWVhcl0uY291bnQrKzsgfSk7CiAgY29uc3QgZHNvWWVhcmx5QXJyID0gT2JqZWN0LmVudHJpZXMoZHNvQnlZZWFyKS5tYXAoKFt5LCB2XSkgPT4gKHsgeWVhcjogcGFyc2VJbnQoeSksIGF2Zzogdi5jb3VudCA+IDAgPyB2LnN1bSAvIHYuY291bnQgOiAwLCBjb3VudDogdi5jb3VudCB9KSkuc29ydCgoYSwgYikgPT4gYS55ZWFyIC0gYi55ZWFyKTsKCiAgY29uc3QgY3VyRHNvID0gZHNvRGF0YS5maWx0ZXIoZCA9PiBkLnllYXIgPT09IGFjdGl2ZVllYXIpOwogIGNvbnN0IGF2Z0Rzb0N1clllYXIgPSBjdXJEc28ubGVuZ3RoID4gMCA/IGN1ckRzby5yZWR1Y2UoKHMsIGQpID0+IHMgKyBkLmRheXMsIDApIC8gY3VyRHNvLmxlbmd0aCA6IDA7CiAgY29uc3QgbGFzdERzbyA9IGRzb0RhdGEuZmlsdGVyKGQgPT4gZC55ZWFyID09PSBhY3RpdmVZZWFyIC0gMSk7CiAgY29uc3QgYXZnRHNvTGFzdFllYXIgPSBsYXN0RHNvLmxlbmd0aCA+IDAgPyBsYXN0RHNvLnJlZHVjZSgocywgZCkgPT4gcyArIGQuZGF5cywgMCkgLyBsYXN0RHNvLmxlbmd0aCA6IDA7CgogIGNvbnN0IGRzb0J1Y2tldHMgPSB7ICIwLTE0IjogMCwgIjE1LTMwIjogMCwgIjMxLTYwIjogMCwgIjYxLTkwIjogMCwgIjkwKyI6IDAgfTsKICBjb25zdCByZWxEc28gPSBkc29EYXRhLmZpbHRlcihkID0+IGQueWVhciA9PT0gYWN0aXZlWWVhcik7CiAgKHJlbERzby5sZW5ndGggPiAxMCA/IHJlbERzbyA6IGRzb0RhdGEpLmZvckVhY2goZCA9PiB7CiAgICBpZiAoZC5kYXlzIDw9IDE0KSBkc29CdWNrZXRzWyIwLTE0Il0rKzsKICAgIGVsc2UgaWYgKGQuZGF5cyA8PSAzMCkgZHNvQnVja2V0c1siMTUtMzAiXSsrOwogICAgZWxzZSBpZiAoZC5kYXlzIDw9IDYwKSBkc29CdWNrZXRzWyIzMS02MCJdKys7CiAgICBlbHNlIGlmIChkLmRheXMgPD0gOTApIGRzb0J1Y2tldHNbIjYxLTkwIl0rKzsKICAgIGVsc2UgZHNvQnVja2V0c1siOTArIl0rKzsKICB9KTsKCiAgLy8g4pSA4pSAIEt1bmRlbmVudHdpY2tsdW5nIOKUgOKUgAogIGNvbnN0IGN1c3RGaXJzdFllYXIgPSB7fTsKICByZXZlbnVlSW52LmZvckVhY2goaW52ID0+IHsKICAgIGlmICghaW52LmNvbnRhY3RfaWQgfHwgIWludi5pc192YWxpZF9mcm9tKSByZXR1cm47CiAgICBjb25zdCB5ID0gbmV3IERhdGUoaW52LmlzX3ZhbGlkX2Zyb20pLmdldEZ1bGxZZWFyKCk7CiAgICBpZiAoIWN1c3RGaXJzdFllYXJbaW52LmNvbnRhY3RfaWRdIHx8IHkgPCBjdXN0Rmlyc3RZZWFyW2ludi5jb250YWN0X2lkXSkgY3VzdEZpcnN0WWVhcltpbnYuY29udGFjdF9pZF0gPSB5OwogIH0pOwoKICBjb25zdCBjdXN0RGV2QnlZZWFyID0ge307CiAgcmV2ZW51ZUludi5mb3JFYWNoKGludiA9PiB7CiAgICBpZiAoIWludi5jb250YWN0X2lkIHx8ICFpbnYuaXNfdmFsaWRfZnJvbSkgcmV0dXJuOwogICAgY29uc3QgeSA9IG5ldyBEYXRlKGludi5pc192YWxpZF9mcm9tKS5nZXRGdWxsWWVhcigpOwogICAgaWYgKCFjdXN0RGV2QnlZZWFyW3ldKSBjdXN0RGV2QnlZZWFyW3ldID0geyBuZXdDdXN0OiBuZXcgU2V0KCksIGV4aXN0Q3VzdDogbmV3IFNldCgpIH07CiAgICBpZiAoY3VzdEZpcnN0WWVhcltpbnYuY29udGFjdF9pZF0gPT09IHkpIGN1c3REZXZCeVllYXJbeV0ubmV3Q3VzdC5hZGQoaW52LmNvbnRhY3RfaWQpOwogICAgZWxzZSBjdXN0RGV2QnlZZWFyW3ldLmV4aXN0Q3VzdC5hZGQoaW52LmNvbnRhY3RfaWQpOwogIH0pOwogIGNvbnN0IGN1c3REZXZBcnIgPSBPYmplY3QuZW50cmllcyhjdXN0RGV2QnlZZWFyKS5tYXAoKFt5LCB2XSkgPT4gKHsKICAgIHllYXI6IHBhcnNlSW50KHkpLCBuZXdDb3VudDogdi5uZXdDdXN0LnNpemUsIGV4aXN0Q291bnQ6IHYuZXhpc3RDdXN0LnNpemUKICB9KSkuc29ydCgoYSwgYikgPT4gYS55ZWFyIC0gYi55ZWFyKTsKCiAgY29uc3QgY3VyQ3VzdERldiA9IGN1c3REZXZBcnIuZmluZChjID0+IGMueWVhciA9PT0gYWN0aXZlWWVhcik7CiAgY29uc3QgbmV3Q3VzdEN1clllYXIgPSBjdXJDdXN0RGV2ID8gY3VyQ3VzdERldi5uZXdDb3VudCA6IDA7CiAgY29uc3QgZXhpc3RDdXN0Q3VyWWVhciA9IGN1ckN1c3REZXYgPyBjdXJDdXN0RGV2LmV4aXN0Q291bnQgOiAwOwoKICAvLyDilIDilIAgTW9udGhseSBjb21wYXJpc29uIOKUgOKUgAogIGZ1bmN0aW9uIG1vbnRobHlGb3JZZWFyKHlyKSB7CiAgICBjb25zdCBtID0gQXJyYXkuZnJvbSh7bGVuZ3RoOiAxMn0sICgpID0+ICh7IHJldmVudWU6IDAsIGNvdW50OiAwIH0pKTsKICAgIGludm9pY2VzLmZvckVhY2goaW52ID0+IHsKICAgICAgaWYgKCFpbnYuaXNfdmFsaWRfZnJvbSB8fCBpbnYuc3RhdHVzID09PSAiY2FuY2VsbGVkIiB8fCBpbnYuc3RhdHVzID09PSAiZHJhZnQiKSByZXR1cm47CiAgICAgIGNvbnN0IGQgPSBuZXcgRGF0ZShpbnYuaXNfdmFsaWRfZnJvbSk7CiAgICAgIGlmIChkLmdldEZ1bGxZZWFyKCkgIT09IHlyKSByZXR1cm47CiAgICAgIG1bZC5nZXRNb250aCgpXS5yZXZlbnVlICs9IHBhcnNlRmxvYXQoaW52LnRvdGFsX25ldCB8fCAwKTsKICAgICAgbVtkLmdldE1vbnRoKCldLmNvdW50Kys7CiAgICB9KTsKICAgIHJldHVybiBtOwogIH0KICBjb25zdCBtb250aGx5Q3VyID0gbW9udGhseUZvclllYXIoYWN0aXZlWWVhcik7CiAgY29uc3QgbW9udGhseVByZXYgPSBtb250aGx5Rm9yWWVhcihhY3RpdmVZZWFyIC0gMSk7CiAgY29uc3QgbW9udGhMYWJlbHMgPSBbIkphbiIsIkZlYiIsIk3DpHIiLCJBcHIiLCJNYWkiLCJKdW4iLCJKdWwiLCJBdWciLCJTZXAiLCJPa3QiLCJOb3YiLCJEZXoiXTsKCiAgcmV0dXJuIHsKICAgIHllYXJseURhdGEsIHllYXJzLCB0b3RhbFJldmVudWUsIGN1clllYXJSZXYsIHlveSwKICAgIG9wZW5Ub3RhbCwgb3BlbkNvdW50OiBvcGVuSW52Lmxlbmd0aCwgb3Blbkxpc3QsCiAgICBhdmdJbnZDdXJZZWFyLCBhdmdJbnZDaGFuZ2UsIGF2Z0ludkJ5WWVhciwgY3VyWWVhckludkNvdW50OiBjdXJZZWFySW52Lmxlbmd0aCwKICAgIHF1b3RlQ29udiwgdG90YWxRdW90ZXMsIGFjY2VwdGVkUXVvdGVzLCBwZW5kaW5nUXVvdGVzLCBkZWNsaW5lZFF1b3RlcywgcXVvdGVzQnlZZWFyLAogICAgdG9wQ3VzdCwgdG9wTWF4LCBjbSwgaW52b2ljZUNvdW50OiByZXZlbnVlSW52Lmxlbmd0aCwKICAgIGF2Z0Rzb0N1clllYXIsIGF2Z0Rzb0xhc3RZZWFyLCBkc29ZZWFybHlBcnIsIGRzb0J1Y2tldHMsCiAgICBuZXdDdXN0Q3VyWWVhciwgZXhpc3RDdXN0Q3VyWWVhciwgY3VzdERldkFyciwKICAgIG1vbnRobHlDdXIsIG1vbnRobHlQcmV2LCBtb250aExhYmVscywKICB9Owp9CgovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKLy8gUkVOREVSSU5HCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAoKZnVuY3Rpb24gcmVuZGVyRGFzaGJvYXJkKGQpIHsKICBjb25zdCBhcHAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYXBwIik7CgogIGNvbnN0IHllYXJCdG5zID0gZC55ZWFycy5tYXAoeSA9PgogICAgYDxidXR0b24gY2xhc3M9InllYXItYnRuIG1vbm8gJHt5ID09PSBhY3RpdmVZZWFyID8gJ2FjdGl2ZScgOiAnJ30iIG9uY2xpY2s9InN3aXRjaFllYXIoJHt5fSkiPiR7eX08L2J1dHRvbj5gCiAgKS5qb2luKCIiKTsKCiAgY29uc3QgY3VzdFJvd3MgPSBkLnRvcEN1c3QubWFwKChjLCBpKSA9PiBgCiAgICA8ZGl2IGNsYXNzPSJjdXN0b21lci1yb3ciPgogICAgICA8ZGl2IGNsYXNzPSJjdXN0b21lci1oZWFkZXIiPgogICAgICAgIDxzcGFuIGNsYXNzPSJjdXN0b21lci1uYW1lIj48c3BhbiBjbGFzcz0iY3VzdG9tZXItcmFuayBtb25vIj4ke1N0cmluZyhpKzEpLnBhZFN0YXJ0KDIsJzAnKX08L3NwYW4+JHsoZC5jbVtjLmlkXSB8fCAnIycrYy5pZCkuc3Vic3RyaW5nKDAsIDMwKX08L3NwYW4+CiAgICAgICAgPHNwYW4gY2xhc3M9ImN1c3RvbWVyLWFtb3VudCBtb25vIj4ke2Zvcm1hdENIRihjLnRvdGFsKX08L3NwYW4+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJtaW5pLWJhciI+PGRpdiBjbGFzcz0ibWluaS1iYXItZmlsbCIgc3R5bGU9IndpZHRoOiAkeyhjLnRvdGFsL2QudG9wTWF4KjEwMCkudG9GaXhlZCgxKX0lIj48L2Rpdj48L2Rpdj4KICAgIDwvZGl2PgogIGApLmpvaW4oIiIpOwoKICBjb25zdCBpbnZSb3dzID0gZC5vcGVuTGlzdC5sZW5ndGggPT09IDAKICAgID8gYDxkaXYgY2xhc3M9ImVtcHR5LXN0YXRlIj48ZGl2IGNsYXNzPSJpY29uIj7inJM8L2Rpdj48ZGl2PktlaW5lIG9mZmVuZW4gUmVjaG51bmdlbjwvZGl2PjwvZGl2PmAKICAgIDogZC5vcGVuTGlzdC5tYXAoaW52ID0+IGAKICAgICAgPGRpdiBjbGFzcz0iaW52LXJvdyI+CiAgICAgICAgPGRpdj4KICAgICAgICAgIDxkaXYgY2xhc3M9Imludi1uYW1lIj4keyhkLmNtW2ludi5jb250YWN0X2lkXSB8fCAnIycraW52LmNvbnRhY3RfaWQpLnN1YnN0cmluZygwLCAyOCl9PC9kaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJpbnYtZGV0YWlsIG1vbm8iPiR7aW52LmRvY3VtZW50X25yIHx8ICfigJMnfSDCtyAke2ludi5pc192YWxpZF9mcm9tID8gbmV3IERhdGUoaW52LmlzX3ZhbGlkX2Zyb20pLnRvTG9jYWxlRGF0ZVN0cmluZygnZGUtQ0gnKSA6ICfigJMnfTwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIDxzcGFuIGNsYXNzPSJpbnYtYW1vdW50IG1vbm8iPiR7Zm9ybWF0Q0hGKGludi50b3RhbF9uZXQpfTwvc3Bhbj4KICAgICAgPC9kaXY+CiAgICBgKS5qb2luKCIiKTsKCiAgLy8gRnVubmVsCiAgY29uc3QgbWF4USA9IE1hdGgubWF4KGQudG90YWxRdW90ZXMsIDEpOwogIGNvbnN0IGZ1bm5lbERhdGEgPSBbCiAgICB7IGxhYmVsOiAiVG90YWwiLCBjb3VudDogZC50b3RhbFF1b3RlcywgcGN0OiAxMDAsIGNvbG9yOiAnIzRhOTBkOScgfSwKICAgIHsgbGFiZWw6ICJBbmdlbm9tbWVuIiwgY291bnQ6IGQuYWNjZXB0ZWRRdW90ZXMsIHBjdDogKGQuYWNjZXB0ZWRRdW90ZXMvbWF4USoxMDApLCBjb2xvcjogJyMyYTZmNGUnIH0sCiAgICB7IGxhYmVsOiAiT2ZmZW4iLCBjb3VudDogZC5wZW5kaW5nUXVvdGVzLCBwY3Q6IChkLnBlbmRpbmdRdW90ZXMvbWF4USoxMDApLCBjb2xvcjogJyNlOGE1NGInIH0sCiAgICB7IGxhYmVsOiAiQWJnZWxlaG50IiwgY291bnQ6IGQuZGVjbGluZWRRdW90ZXMsIHBjdDogKGQuZGVjbGluZWRRdW90ZXMvbWF4USoxMDApLCBjb2xvcjogJyNmZjZiNmInIH0sCiAgXTsKICBjb25zdCBmdW5uZWxSb3dzID0gZnVubmVsRGF0YS5tYXAoZiA9PiBgCiAgICA8ZGl2IGNsYXNzPSJmdW5uZWwtcm93Ij4KICAgICAgPHNwYW4gY2xhc3M9ImZ1bm5lbC1sYWJlbCBtb25vIj4ke2YubGFiZWx9PC9zcGFuPgogICAgICA8ZGl2IGNsYXNzPSJmdW5uZWwtYmFyLXdyYXAiPgogICAgICAgIDxkaXYgY2xhc3M9ImZ1bm5lbC1iYXIiIHN0eWxlPSJ3aWR0aDogJHtNYXRoLm1heChmLnBjdCwgMil9JTsgYmFja2dyb3VuZDogJHtmLmNvbG9yfTsiPiR7Zi5wY3QgPiAxNSA/IGZvcm1hdE51bShmLmNvdW50KSA6ICcnfTwvZGl2PgogICAgICA8L2Rpdj4KICAgICAgPHNwYW4gY2xhc3M9ImZ1bm5lbC1jb3VudCBtb25vIj4ke2Zvcm1hdE51bShmLmNvdW50KX08L3NwYW4+CiAgICA8L2Rpdj4KICBgKS5qb2luKCIiKTsKCiAgY29uc3QgeW95Q2xhc3MgPSBkLnlveSA+IDAgPyAiZ3JlZW4iIDogZC55b3kgPCAwID8gInJlZCIgOiAiIjsKICBjb25zdCB5b3lTaWduID0gZC55b3kgPiAwID8gIisiIDogIiI7CiAgY29uc3QgYXZnQ2hnQ2xhc3MgPSBkLmF2Z0ludkNoYW5nZSA+IDAgPyAiZ3JlZW4iIDogZC5hdmdJbnZDaGFuZ2UgPCAwID8gInJlZCIgOiAiIjsKICBjb25zdCBhdmdDaGdTaWduID0gZC5hdmdJbnZDaGFuZ2UgPiAwID8gIisiIDogIiI7CiAgY29uc3QgZHNvQ2hnID0gZC5hdmdEc29MYXN0WWVhciA+IDAgPyBkLmF2Z0Rzb0N1clllYXIgLSBkLmF2Z0Rzb0xhc3RZZWFyIDogMDsKICBjb25zdCBkc29DbGFzcyA9IGRzb0NoZyA8IDAgPyAiZ3JlZW4iIDogZHNvQ2hnID4gMCA/ICJyZWQiIDogIiI7CiAgY29uc3QgZHNvU2lnbiA9IGRzb0NoZyA+IDAgPyAiKyIgOiAiIjsKCiAgYXBwLmlubmVySFRNTCA9IGAKICAgIDxkaXYgY2xhc3M9ImhlYWRlciI+CiAgICAgIDxkaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iaGVhZGVyLXN1YiBtb25vIj5Ecml4bCBUcmFuc3BvcnRlIEdtYkg8L2Rpdj4KICAgICAgICA8aDE+RmluYW5jZSBEYXNoYm9hcmQ8L2gxPgogICAgICA8L2Rpdj4KICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsgZ2FwOiAxMnB4OyBmbGV4LXdyYXA6IHdyYXA7Ij4KICAgICAgICA8ZGl2IGNsYXNzPSJ5ZWFyLWJ0bnMiPiR7eWVhckJ0bnN9PC9kaXY+CiAgICAgICAgPGEgaHJlZj0iL3ZlcmdsZWljaC5odG1sIiBzdHlsZT0iZm9udC1zaXplOiAxMnB4OyBjb2xvcjogIzRlY2RjNDsgdGV4dC1kZWNvcmF0aW9uOiBub25lOyBib3JkZXI6IDFweCBzb2xpZCAjMWEzYTRhOyBwYWRkaW5nOiA2cHggMTRweDsgYm9yZGVyLXJhZGl1czogNnB4OyBmb250LWZhbWlseTogJ0pldEJyYWlucyBNb25vJywgbW9ub3NwYWNlOyB0cmFuc2l0aW9uOiBhbGwgMC4yczsiIG9ubW91c2VvdmVyPSJ0aGlzLnN0eWxlLmJhY2tncm91bmQ9JyMxYTNhNGEnIiBvbm1vdXNlb3V0PSJ0aGlzLnN0eWxlLmJhY2tncm91bmQ9J3RyYW5zcGFyZW50JyI+8J+TiiBQZXJpb2RlbnZlcmdsZWljaCDihpI8L2E+CiAgICAgICAgPGEgaHJlZj0iL2FwaS9sb2dvdXQiIHN0eWxlPSJmb250LXNpemU6IDExcHg7IGNvbG9yOiAjNWE2YTdhOyB0ZXh0LWRlY29yYXRpb246IG5vbmU7IHBhZGRpbmc6IDZweCAxMHB4OyBib3JkZXItcmFkaXVzOiA2cHg7IGZvbnQtZmFtaWx5OiAnSmV0QnJhaW5zIE1vbm8nLCBtb25vc3BhY2U7IHRyYW5zaXRpb246IGFsbCAwLjJzOyIgb25tb3VzZW92ZXI9InRoaXMuc3R5bGUuY29sb3I9JyNmZjZiNmInIiBvbm1vdXNlb3V0PSJ0aGlzLnN0eWxlLmNvbG9yPScjNWE2YTdhJyI+4o+7IExvZ291dDwvYT4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KCiAgICA8ZGl2IGNsYXNzPSJzZWN0aW9uLXRpdGxlIG1vbm8iPvCfk4ogVW1zYXR6ICYgS2VubnphaGxlbjwvZGl2PgogICAgPGRpdiBjbGFzcz0ia3BpLWdyaWQiPgogICAgICA8ZGl2IGNsYXNzPSJrcGktY2FyZCBhY2NlbnQiPgogICAgICAgIDxkaXYgY2xhc3M9ImtwaS1sYWJlbCBtb25vIj7il4YgVW1zYXR6IEdlc2FtdDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImtwaS12YWx1ZSI+JHtmb3JtYXRDSEYoZC50b3RhbFJldmVudWUpfTwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImtwaS1zdWIgbW9ubyI+JHtmb3JtYXROdW0oZC5pbnZvaWNlQ291bnQpfSBSZWNobnVuZ2VuIChuZXR0byk8L2Rpdj4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9ImtwaS1jYXJkIGFjY2VudCI+CiAgICAgICAgPGRpdiBjbGFzcz0ia3BpLWxhYmVsIG1vbm8iPuKWsiBVbXNhdHogJHthY3RpdmVZZWFyfTwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImtwaS12YWx1ZSI+JHtmb3JtYXRDSEYoZC5jdXJZZWFyUmV2KX08L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJrcGktc3ViIG1vbm8gJHt5b3lDbGFzc30iPiR7ZC55b3kgIT09IDAgPyB5b3lTaWduICsgZC55b3kudG9GaXhlZCgxKSArICclIHZzICcgKyAoYWN0aXZlWWVhci0xKSA6ICfigJMnfTwvZGl2PgogICAgICA8L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0ia3BpLWNhcmQgd2FybiI+CiAgICAgICAgPGRpdiBjbGFzcz0ia3BpLWxhYmVsIG1vbm8iPuKXiyBPZmZlbmUgUmVjaG51bmdlbjwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImtwaS12YWx1ZSI+JHtmb3JtYXRDSEYoZC5vcGVuVG90YWwpfTwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImtwaS1zdWIgbW9ubyI+JHtkLm9wZW5Db3VudH0gb2ZmZW48L2Rpdj4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9ImtwaS1jYXJkIj4KICAgICAgICA8ZGl2IGNsYXNzPSJrcGktbGFiZWwgbW9ubyI+4omhIMOYIFJlY2hudW5nICR7YWN0aXZlWWVhcn08L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJrcGktdmFsdWUiPiR7Zm9ybWF0Q0hGKGQuYXZnSW52Q3VyWWVhcil9PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0ia3BpLXN1YiBtb25vICR7YXZnQ2hnQ2xhc3N9Ij4ke2QuYXZnSW52Q2hhbmdlICE9PSAwID8gYXZnQ2hnU2lnbiArIGQuYXZnSW52Q2hhbmdlLnRvRml4ZWQoMSkgKyAnJSB2cyAnICsgKGFjdGl2ZVllYXItMSkgOiAn4oCTJ30gwrcgJHtkLmN1clllYXJJbnZDb3VudH0gU3RrPC9kaXY+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJrcGktY2FyZCI+CiAgICAgICAgPGRpdiBjbGFzcz0ia3BpLWxhYmVsIG1vbm8iPuKPsSDDmCBaYWhsdW5nc2ZyaXN0PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0ia3BpLXZhbHVlIj4ke2QuYXZnRHNvQ3VyWWVhciA+IDAgPyBkLmF2Z0Rzb0N1clllYXIudG9GaXhlZCgwKSArICcgVGFnZScgOiAn4oCTJ308L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJrcGktc3ViIG1vbm8gJHtkc29DbGFzc30iPiR7ZHNvQ2hnICE9PSAwID8gZHNvU2lnbiArIGRzb0NoZy50b0ZpeGVkKDApICsgJyBUYWdlIHZzICcgKyAoYWN0aXZlWWVhci0xKSA6ICfigJMnfTwvZGl2PgogICAgICA8L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0ia3BpLWNhcmQgaW5mbyI+CiAgICAgICAgPGRpdiBjbGFzcz0ia3BpLWxhYmVsIG1vbm8iPuKXhyBPZmZlcnQtUXVvdGU8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJrcGktdmFsdWUiPiR7ZC5xdW90ZUNvbnYudG9GaXhlZCgwKX0lPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0ia3BpLXN1YiBtb25vIj4ke2Zvcm1hdE51bShkLmFjY2VwdGVkUXVvdGVzKX0gLyAke2Zvcm1hdE51bShkLnRvdGFsUXVvdGVzKX08L2Rpdj4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KCiAgICA8ZGl2IGNsYXNzPSJzZWN0aW9uLXRpdGxlIG1vbm8iPvCfk4ggVW1zYXR6ZW50d2lja2x1bmc8L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImNoYXJ0cy1ncmlkIj4KICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtY2FyZCI+CiAgICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtdGl0bGUgbW9ubyI+SmFocmVzdW1zYXR6IChOZXR0byk8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJjaGFydC13cmFwIj48Y2FudmFzIGlkPSJ5ZWFybHlDaGFydCI+PC9jYW52YXM+PC9kaXY+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJjaGFydC1jYXJkIj4KICAgICAgICA8ZGl2IGNsYXNzPSJjaGFydC10aXRsZSBtb25vIj5Nb25hdHN2ZXJnbGVpY2ggJHthY3RpdmVZZWFyfSB2cyAke2FjdGl2ZVllYXIgLSAxfTwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LXdyYXAiPjxjYW52YXMgaWQ9Im1vbnRoQ29tcGFyZUNoYXJ0Ij48L2NhbnZhcz48L2Rpdj4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KCiAgICA8ZGl2IGNsYXNzPSJzZWN0aW9uLXRpdGxlIG1vbm8iPvCfkrAgUmVjaG51bmdlbiAmIFphaGx1bmdzbW9yYWw8L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImNoYXJ0cy1ncmlkIj4KICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtY2FyZCI+CiAgICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtdGl0bGUgbW9ubyI+w5ggUmVjaG51bmdzYmV0cmFnIHBybyBKYWhyPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtd3JhcCI+PGNhbnZhcyBpZD0iYXZnSW52Q2hhcnQiPjwvY2FudmFzPjwvZGl2PgogICAgICA8L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtY2FyZCI+CiAgICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtdGl0bGUgbW9ubyI+w5ggVGFnZSBiaXMgWmFobHVuZyBwcm8gSmFocjwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LXdyYXAiPjxjYW52YXMgaWQ9ImRzb0NoYXJ0Ij48L2NhbnZhcz48L2Rpdj4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KCiAgICA8ZGl2IGNsYXNzPSJzZWN0aW9uLXRpdGxlIG1vbm8iPvCfk4sgT2ZmZXJ0ZW4gJiBLdW5kZW48L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImNoYXJ0cy1ncmlkIj4KICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtY2FyZCI+CiAgICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtdGl0bGUgbW9ubyI+WmFobHVuZ3NmcmlzdC1WZXJ0ZWlsdW5nPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtd3JhcCI+PGNhbnZhcyBpZD0iZHNvQnVja2V0Q2hhcnQiPjwvY2FudmFzPjwvZGl2PgogICAgICA8L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtY2FyZCI+CiAgICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtdGl0bGUgbW9ubyI+T2ZmZXJ0ZW4tUGlwZWxpbmU8L2Rpdj4KICAgICAgICA8ZGl2IHN0eWxlPSJwYWRkaW5nLXRvcDogOHB4OyI+JHtmdW5uZWxSb3dzfTwvZGl2PgogICAgICAgIDxkaXYgc3R5bGU9Im1hcmdpbi10b3A6IDEycHg7IGZvbnQtc2l6ZTogMTFweDsgY29sb3I6ICMzYTRhNWE7IiBjbGFzcz0ibW9ubyI+Q29udmVyc2lvbjogJHtkLnF1b3RlQ29udi50b0ZpeGVkKDEpfSU8L2Rpdj4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KCiAgICA8ZGl2IGNsYXNzPSJjaGFydHMtZ3JpZCI+CiAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LWNhcmQiPgogICAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LXRpdGxlIG1vbm8iPkt1bmRlbmVudHdpY2tsdW5nIChOZXUgdnMuIEJlc3RhbmQpPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtd3JhcCI+PGNhbnZhcyBpZD0iY3VzdERldkNoYXJ0Ij48L2NhbnZhcz48L2Rpdj4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LWNhcmQiPgogICAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LXRpdGxlIG1vbm8iPk9mZmVydC1RdW90ZSBwcm8gSmFocjwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LXdyYXAiPjxjYW52YXMgaWQ9InF1b3RlWWVhckNoYXJ0Ij48L2NhbnZhcz48L2Rpdj4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KCiAgICA8ZGl2IGNsYXNzPSJzZWN0aW9uLXRpdGxlIG1vbm8iPvCfk5EgRGV0YWlsczwvZGl2PgogICAgPGRpdiBjbGFzcz0iYm90dG9tLWdyaWQiPgogICAgICA8ZGl2IGNsYXNzPSJsaXN0LWNhcmQiPgogICAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LXRpdGxlIG1vbm8iPlRvcCBLdW5kZW4gKFVtc2F0eiBHZXNhbXQpPC9kaXY+CiAgICAgICAgJHtjdXN0Um93c30KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9Imxpc3QtY2FyZCI+CiAgICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtdGl0bGUgbW9ubyI+T2ZmZW5lIFJlY2hudW5nZW48L2Rpdj4KICAgICAgICAke2ludlJvd3N9CiAgICAgIDwvZGl2PgogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0iZm9vdGVyIG1vbm8iPgogICAgICBEYXRlbiB2aWEgYmV4aW8gQVBJIMK3IEFrdHVhbGlzaWVydDogJHtuZXcgRGF0ZSgpLnRvTG9jYWxlRGF0ZVN0cmluZygnZGUtQ0gnKX0gJHtuZXcgRGF0ZSgpLnRvTG9jYWxlVGltZVN0cmluZygnZGUtQ0gnLHtob3VyOicyLWRpZ2l0JyxtaW51dGU6JzItZGlnaXQnfSl9IMK3IFBvd2VyZWQgYnkgU3VwYWJhc2UKICAgIDwvZGl2PgogIGA7CgogIGRyYXdZZWFybHlDaGFydChkLnllYXJseURhdGEpOwogIGRyYXdNb250aENvbXBhcmVDaGFydChkLm1vbnRobHlDdXIsIGQubW9udGhseVByZXYsIGQubW9udGhMYWJlbHMpOwogIGRyYXdBdmdJbnZDaGFydChkLmF2Z0ludkJ5WWVhcik7CiAgZHJhd0Rzb0NoYXJ0KGQuZHNvWWVhcmx5QXJyKTsKICBkcmF3RHNvQnVja2V0Q2hhcnQoZC5kc29CdWNrZXRzKTsKICBkcmF3Q3VzdERldkNoYXJ0KGQuY3VzdERldkFycik7CiAgZHJhd1F1b3RlWWVhckNoYXJ0KGQucXVvdGVzQnlZZWFyLCBkLnllYXJzKTsKfQoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIENIQVJUIEhFTFBFUlMKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCgpjb25zdCBjRGVmID0gewogIHJlc3BvbnNpdmU6IHRydWUsIG1haW50YWluQXNwZWN0UmF0aW86IGZhbHNlLAogIHBsdWdpbnM6IHsgbGVnZW5kOiB7IGRpc3BsYXk6IGZhbHNlIH0sIHRvb2x0aXA6IHsKICAgIGJhY2tncm91bmRDb2xvcjogJyMxYTIzMzInLCBib3JkZXJDb2xvcjogJyMyYTNhNGEnLCBib3JkZXJXaWR0aDogMSwKICAgIHRpdGxlRm9udDogeyBmYW1pbHk6ICInSmV0QnJhaW5zIE1vbm8nIiB9LCBib2R5Rm9udDogeyBmYW1pbHk6ICInSmV0QnJhaW5zIE1vbm8nIiB9LAogIH19LAp9Owpjb25zdCBheCA9IHsKICB4OiB7IGdyaWQ6IHsgZGlzcGxheTogZmFsc2UgfSwgdGlja3M6IHsgY29sb3I6ICcjNGE1YTZhJywgZm9udDogeyBmYW1pbHk6ICInSmV0QnJhaW5zIE1vbm8nIiwgc2l6ZTogMTEgfSB9IH0sCiAgeTogeyBncmlkOiB7IGNvbG9yOiAnIzFhMjMzMicgfSwgdGlja3M6IHsgY29sb3I6ICcjM2E0YTVhJywgZm9udDogeyBmYW1pbHk6ICInSmV0QnJhaW5zIE1vbm8nIiwgc2l6ZTogMTAgfSB9IH0KfTsKZnVuY3Rpb24gZGMobikgeyBpZiAoY2hhcnRzW25dKSB7IGNoYXJ0c1tuXS5kZXN0cm95KCk7IGRlbGV0ZSBjaGFydHNbbl07IH0gfQpmdW5jdGlvbiBsZWcoKSB7IHJldHVybiB7IGRpc3BsYXk6IHRydWUsIHBvc2l0aW9uOiAndG9wJywgbGFiZWxzOiB7IGNvbG9yOiAnIzVhNmE3YScsIGZvbnQ6IHsgZmFtaWx5OiAiJ0pldEJyYWlucyBNb25vJyIsIHNpemU6IDEwIH0sIGJveFdpZHRoOiAxMiwgcGFkZGluZzogMTIgfSB9OyB9CgovLyDilIDilIAgMSkgWWVhcmx5IFJldmVudWUg4pSA4pSACmZ1bmN0aW9uIGRyYXdZZWFybHlDaGFydChkYXRhKSB7CiAgY29uc3QgY3R4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3llYXJseUNoYXJ0Jyk7IGlmICghY3R4KSByZXR1cm47IGRjKCd5ZWFybHknKTsKICBjaGFydHMueWVhcmx5ID0gbmV3IENoYXJ0KGN0eCwgewogICAgdHlwZTogJ2JhcicsCiAgICBkYXRhOiB7IGxhYmVsczogZGF0YS5tYXAoZCA9PiBkLnllYXIpLCBkYXRhc2V0czogW3sgZGF0YTogZGF0YS5tYXAoZCA9PiBkLnJldmVudWUpLAogICAgICBiYWNrZ3JvdW5kQ29sb3I6IGRhdGEubWFwKGQgPT4gZC55ZWFyID09PSBhY3RpdmVZZWFyID8gJyM0ZWNkYzQnIDogJyMyYTZmNGUnKSwgYm9yZGVyUmFkaXVzOiA0LCBib3JkZXJTa2lwcGVkOiBmYWxzZSB9XSB9LAogICAgb3B0aW9uczogeyAuLi5jRGVmLCBzY2FsZXM6IHsgLi4uYXgsIHk6IHsgLi4uYXgueSwgdGlja3M6IHsgLi4uYXgueS50aWNrcywgY2FsbGJhY2s6IHYgPT4gKHYvMTAwMDAwMCkudG9GaXhlZCgxKSsnTScgfSB9IH0sCiAgICAgIHBsdWdpbnM6IHsgLi4uY0RlZi5wbHVnaW5zLCB0b29sdGlwOiB7IC4uLmNEZWYucGx1Z2lucy50b29sdGlwLCBjYWxsYmFja3M6IHsgbGFiZWw6IGMgPT4gZm9ybWF0Q0hGKGMucmF3KSB9IH0gfSB9CiAgfSk7Cn0KCi8vIOKUgOKUgCAyKSBNb250aGx5IENvbXBhcmUg4pSA4pSACmZ1bmN0aW9uIGRyYXdNb250aENvbXBhcmVDaGFydChjdXIsIHByZXYsIGxhYmVscykgewogIGNvbnN0IGN0eCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb250aENvbXBhcmVDaGFydCcpOyBpZiAoIWN0eCkgcmV0dXJuOyBkYygnbW9udGhDb21wYXJlJyk7CiAgY2hhcnRzLm1vbnRoQ29tcGFyZSA9IG5ldyBDaGFydChjdHgsIHsKICAgIHR5cGU6ICdiYXInLAogICAgZGF0YTogeyBsYWJlbHMsIGRhdGFzZXRzOiBbCiAgICAgIHsgbGFiZWw6IGAke2FjdGl2ZVllYXJ9YCwgZGF0YTogY3VyLm1hcChtID0+IG0ucmV2ZW51ZSksIGJhY2tncm91bmRDb2xvcjogJyM0ZWNkYzQnLCBib3JkZXJSYWRpdXM6IDMsIGJvcmRlclNraXBwZWQ6IGZhbHNlIH0sCiAgICAgIHsgbGFiZWw6IGAke2FjdGl2ZVllYXItMX1gLCBkYXRhOiBwcmV2Lm1hcChtID0+IG0ucmV2ZW51ZSksIGJhY2tncm91bmRDb2xvcjogJyMxYTNhNGEnLCBib3JkZXJSYWRpdXM6IDMsIGJvcmRlclNraXBwZWQ6IGZhbHNlIH0sCiAgICBdfSwKICAgIG9wdGlvbnM6IHsgLi4uY0RlZiwgcGx1Z2luczogeyBsZWdlbmQ6IGxlZygpLCB0b29sdGlwOiB7IC4uLmNEZWYucGx1Z2lucy50b29sdGlwLCBjYWxsYmFja3M6IHsgbGFiZWw6IGMgPT4gYCR7Yy5kYXRhc2V0LmxhYmVsfTogJHtmb3JtYXRDSEYoYy5yYXcpfWAgfSB9IH0sCiAgICAgIHNjYWxlczogeyAuLi5heCwgeTogeyAuLi5heC55LCB0aWNrczogeyAuLi5heC55LnRpY2tzLCBjYWxsYmFjazogdiA9PiAodi8xMDAwKS50b0ZpeGVkKDApKydLJyB9IH0gfSB9CiAgfSk7Cn0KCi8vIOKUgOKUgCAzKSBBdmcgSW52b2ljZSDilIDilIAKZnVuY3Rpb24gZHJhd0F2Z0ludkNoYXJ0KGRhdGEpIHsKICBjb25zdCBjdHggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXZnSW52Q2hhcnQnKTsgaWYgKCFjdHgpIHJldHVybjsgZGMoJ2F2Z0ludicpOwogIGNoYXJ0cy5hdmdJbnYgPSBuZXcgQ2hhcnQoY3R4LCB7CiAgICB0eXBlOiAnbGluZScsCiAgICBkYXRhOiB7IGxhYmVsczogZGF0YS5tYXAoZCA9PiBkLnllYXIpLCBkYXRhc2V0czogW3sgZGF0YTogZGF0YS5tYXAoZCA9PiBkLmF2ZyksCiAgICAgIGJvcmRlckNvbG9yOiAnIzZjYjRlZScsIGJhY2tncm91bmRDb2xvcjogJ3JnYmEoMTA4LDE4MCwyMzgsMC4xKScsIGZpbGw6IHRydWUsIHRlbnNpb246IDAuMywKICAgICAgcG9pbnRCYWNrZ3JvdW5kQ29sb3I6ICcjNmNiNGVlJywgcG9pbnRSYWRpdXM6IDQsIHBvaW50SG92ZXJSYWRpdXM6IDcgfV0gfSwKICAgIG9wdGlvbnM6IHsgLi4uY0RlZiwgcGx1Z2luczogeyAuLi5jRGVmLnBsdWdpbnMsIHRvb2x0aXA6IHsgLi4uY0RlZi5wbHVnaW5zLnRvb2x0aXAsCiAgICAgIGNhbGxiYWNrczogeyBsYWJlbDogYyA9PiBgw5ggJHtmb3JtYXRDSEYoYy5yYXcpfSAoJHtkYXRhW2MuZGF0YUluZGV4XS5jb3VudH0gU3RrKWAgfSB9IH0sCiAgICAgIHNjYWxlczogeyAuLi5heCwgeTogeyAuLi5heC55LCB0aWNrczogeyAuLi5heC55LnRpY2tzLCBjYWxsYmFjazogdiA9PiBmb3JtYXRDSEYodikgfSB9IH0gfQogIH0pOwp9CgovLyDilIDilIAgNCkgRFNPIGJ5IFllYXIg4pSA4pSACmZ1bmN0aW9uIGRyYXdEc29DaGFydChkYXRhKSB7CiAgY29uc3QgY3R4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rzb0NoYXJ0Jyk7IGlmICghY3R4KSByZXR1cm47IGRjKCdkc28nKTsKICBjaGFydHMuZHNvID0gbmV3IENoYXJ0KGN0eCwgewogICAgdHlwZTogJ2JhcicsCiAgICBkYXRhOiB7IGxhYmVsczogZGF0YS5tYXAoZCA9PiBkLnllYXIpLCBkYXRhc2V0czogW3sgZGF0YTogZGF0YS5tYXAoZCA9PiBkLmF2ZyksCiAgICAgIGJhY2tncm91bmRDb2xvcjogZGF0YS5tYXAoZCA9PiBkLmF2ZyA8PSAzMCA/ICcjMmE2ZjRlJyA6IGQuYXZnIDw9IDQ1ID8gJyNlOGE1NGInIDogJyNmZjZiNmInKSwgYm9yZGVyUmFkaXVzOiA0LCBib3JkZXJTa2lwcGVkOiBmYWxzZSB9XSB9LAogICAgb3B0aW9uczogeyAuLi5jRGVmLCBwbHVnaW5zOiB7IC4uLmNEZWYucGx1Z2lucywgdG9vbHRpcDogeyAuLi5jRGVmLnBsdWdpbnMudG9vbHRpcCwKICAgICAgY2FsbGJhY2tzOiB7IGxhYmVsOiBjID0+IGDDmCAke2MucmF3LnRvRml4ZWQoMSl9IFRhZ2UgKCR7ZGF0YVtjLmRhdGFJbmRleF0uY291bnR9IFphaGx1bmdlbilgIH0gfSB9LAogICAgICBzY2FsZXM6IHsgLi4uYXgsIHk6IHsgLi4uYXgueSwgdGlja3M6IHsgLi4uYXgueS50aWNrcywgY2FsbGJhY2s6IHYgPT4gdiArICcgVCcgfSB9IH0gfQogIH0pOwp9CgovLyDilIDilIAgNSkgRFNPIERpc3RyaWJ1dGlvbiDilIDilIAKZnVuY3Rpb24gZHJhd0Rzb0J1Y2tldENoYXJ0KGJ1Y2tldHMpIHsKICBjb25zdCBjdHggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHNvQnVja2V0Q2hhcnQnKTsgaWYgKCFjdHgpIHJldHVybjsgZGMoJ2Rzb0J1Y2tldCcpOwogIGNvbnN0IGxhYmVscyA9IE9iamVjdC5rZXlzKGJ1Y2tldHMpOwogIGNvbnN0IHZhbHVlcyA9IE9iamVjdC52YWx1ZXMoYnVja2V0cyk7CiAgY29uc3QgY29sb3JzID0gWycjMmE2ZjRlJywnIzRlY2RjNCcsJyNlOGE1NGInLCcjZmY4YzQyJywnI2ZmNmI2YiddOwogIGNoYXJ0cy5kc29CdWNrZXQgPSBuZXcgQ2hhcnQoY3R4LCB7CiAgICB0eXBlOiAnZG91Z2hudXQnLAogICAgZGF0YTogeyBsYWJlbHMsIGRhdGFzZXRzOiBbeyBkYXRhOiB2YWx1ZXMsIGJhY2tncm91bmRDb2xvcjogY29sb3JzLCBib3JkZXJDb2xvcjogJyMxMTE4MjAnLCBib3JkZXJXaWR0aDogMyB9XSB9LAogICAgb3B0aW9uczogeyByZXNwb25zaXZlOiB0cnVlLCBtYWludGFpbkFzcGVjdFJhdGlvOiBmYWxzZSwgcGx1Z2luczogewogICAgICBsZWdlbmQ6IHsgcG9zaXRpb246ICdyaWdodCcsIGxhYmVsczogeyBjb2xvcjogJyM4YTlhYWEnLCBmb250OiB7IGZhbWlseTogIidKZXRCcmFpbnMgTW9ubyciLCBzaXplOiAxMSB9LCBwYWRkaW5nOiAxMiB9IH0sCiAgICAgIHRvb2x0aXA6IHsgLi4uY0RlZi5wbHVnaW5zLnRvb2x0aXAsIGNhbGxiYWNrczogewogICAgICAgIGxhYmVsOiBjID0+IHsgY29uc3QgdCA9IHZhbHVlcy5yZWR1Y2UoKGEsYikgPT4gYStiLCAwKTsgcmV0dXJuIGAke2MubGFiZWx9IFRhZ2U6ICR7Yy5yYXd9ICgkeyhjLnJhdy90KjEwMCkudG9GaXhlZCgwKX0lKWA7IH0KICAgICAgfX0gfSB9CiAgfSk7Cn0KCi8vIOKUgOKUgCA2KSBDdXN0b21lciBEZXZlbG9wbWVudCDilIDilIAKZnVuY3Rpb24gZHJhd0N1c3REZXZDaGFydChkYXRhKSB7CiAgY29uc3QgY3R4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1c3REZXZDaGFydCcpOyBpZiAoIWN0eCkgcmV0dXJuOyBkYygnY3VzdERldicpOwogIGNoYXJ0cy5jdXN0RGV2ID0gbmV3IENoYXJ0KGN0eCwgewogICAgdHlwZTogJ2JhcicsCiAgICBkYXRhOiB7IGxhYmVsczogZGF0YS5tYXAoZCA9PiBkLnllYXIpLCBkYXRhc2V0czogWwogICAgICB7IGxhYmVsOiAnTmV1a3VuZGVuJywgZGF0YTogZGF0YS5tYXAoZCA9PiBkLm5ld0NvdW50KSwgYmFja2dyb3VuZENvbG9yOiAnIzRlY2RjNCcsIGJvcmRlclJhZGl1czogMywgYm9yZGVyU2tpcHBlZDogZmFsc2UgfSwKICAgICAgeyBsYWJlbDogJ0Jlc3RhbmRza3VuZGVuJywgZGF0YTogZGF0YS5tYXAoZCA9PiBkLmV4aXN0Q291bnQpLCBiYWNrZ3JvdW5kQ29sb3I6ICcjMmE2ZjRlJywgYm9yZGVyUmFkaXVzOiAzLCBib3JkZXJTa2lwcGVkOiBmYWxzZSB9LAogICAgXX0sCiAgICBvcHRpb25zOiB7IC4uLmNEZWYsIHBsdWdpbnM6IHsgbGVnZW5kOiBsZWcoKSwgdG9vbHRpcDogeyAuLi5jRGVmLnBsdWdpbnMudG9vbHRpcCwKICAgICAgY2FsbGJhY2tzOiB7IGxhYmVsOiBjID0+IGAke2MuZGF0YXNldC5sYWJlbH06ICR7Yy5yYXd9YCB9IH0gfSwKICAgICAgc2NhbGVzOiB7IC4uLmF4LCB4OiB7IC4uLmF4LngsIHN0YWNrZWQ6IHRydWUgfSwgeTogeyAuLi5heC55LCBzdGFja2VkOiB0cnVlIH0gfSB9CiAgfSk7Cn0KCi8vIOKUgOKUgCA3KSBRdW90ZSBDb252ZXJzaW9uIGJ5IFllYXIg4pSA4pSACmZ1bmN0aW9uIGRyYXdRdW90ZVllYXJDaGFydChieVllYXIsIHllYXJzKSB7CiAgY29uc3QgY3R4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1b3RlWWVhckNoYXJ0Jyk7IGlmICghY3R4KSByZXR1cm47IGRjKCdxdW90ZVllYXInKTsKICBjb25zdCB5cnMgPSB5ZWFycy5maWx0ZXIoeSA9PiBieVllYXJbeV0pLnNvcnQoKTsKICBjaGFydHMucXVvdGVZZWFyID0gbmV3IENoYXJ0KGN0eCwgewogICAgdHlwZTogJ2JhcicsCiAgICBkYXRhOiB7IGxhYmVsczogeXJzLCBkYXRhc2V0czogWwogICAgICB7IGxhYmVsOiAnQW5nZW5vbW1lbicsIGRhdGE6IHlycy5tYXAoeSA9PiBieVllYXJbeV0/LmFjY2VwdGVkIHx8IDApLCBiYWNrZ3JvdW5kQ29sb3I6ICcjMmE2ZjRlJywgYm9yZGVyUmFkaXVzOiAyLCBib3JkZXJTa2lwcGVkOiBmYWxzZSB9LAogICAgICB7IGxhYmVsOiAnT2ZmZW4nLCBkYXRhOiB5cnMubWFwKHkgPT4gYnlZZWFyW3ldPy5wZW5kaW5nIHx8IDApLCBiYWNrZ3JvdW5kQ29sb3I6ICcjZThhNTRiJywgYm9yZGVyUmFkaXVzOiAyLCBib3JkZXJTa2lwcGVkOiBmYWxzZSB9LAogICAgICB7IGxhYmVsOiAnQWJnZWxlaG50JywgZGF0YTogeXJzLm1hcCh5ID0+IGJ5WWVhclt5XT8uZGVjbGluZWQgfHwgMCksIGJhY2tncm91bmRDb2xvcjogJyNmZjZiNmInLCBib3JkZXJSYWRpdXM6IDIsIGJvcmRlclNraXBwZWQ6IGZhbHNlIH0sCiAgICBdfSwKICAgIG9wdGlvbnM6IHsgLi4uY0RlZiwgcGx1Z2luczogeyBsZWdlbmQ6IGxlZygpIH0sIHNjYWxlczogeyAuLi5heCwgeDogeyAuLi5heC54LCBzdGFja2VkOiB0cnVlIH0sIHk6IHsgLi4uYXgueSwgc3RhY2tlZDogdHJ1ZSB9IH0gfQogIH0pOwp9CgovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKLy8gSU5JVAovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKCmFzeW5jIGZ1bmN0aW9uIGluaXQoKSB7CiAgYXdhaXQgbG9hZEFsbERhdGEoKTsKICByZW5kZXJEYXNoYm9hcmQocHJvY2Vzc0RhdGEoKSk7Cn0KCmZ1bmN0aW9uIHN3aXRjaFllYXIoeSkgewogIGFjdGl2ZVllYXIgPSB5OwogIHJlbmRlckRhc2hib2FyZChwcm9jZXNzRGF0YSgpKTsKfQoKaW5pdCgpLmNhdGNoKGVyciA9PiB7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImFwcCIpLmlubmVySFRNTCA9IGAKICAgIDxkaXYgY2xhc3M9ImxvYWRpbmciIHN0eWxlPSJjb2xvcjogI2ZmNmI2YjsgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsgZ2FwOiAxMnB4OyI+CiAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTogMThweDsiPkZlaGxlciBiZWltIExhZGVuPC9kaXY+CiAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTogMTNweDsgY29sb3I6ICM1YTZhN2E7Ij4ke2Vyci5tZXNzYWdlfTwvZGl2PgogICAgPC9kaXY+YDsKfSk7Cjwvc2NyaXB0Pgo8L2JvZHk+CjwvaHRtbD4K',
  '/vergleich.html': 'PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImRlIj4KPGhlYWQ+CjxtZXRhIGNoYXJzZXQ9IlVURi04Ij4KPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiPgo8dGl0bGU+RHJpeGwgVHJhbnNwb3J0ZSDigJMgUGVyaW9kZW52ZXJnbGVpY2g8L3RpdGxlPgo8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9jaGFydC5qc0A0LjQuMS9kaXN0L2NoYXJ0LnVtZC5taW4uanMiPjwvc2NyaXB0Pgo8bGluayBocmVmPSJodHRwczovL2ZvbnRzLmdvb2dsZWFwaXMuY29tL2NzczI/ZmFtaWx5PURNK1NhbnM6d2dodEA0MDA7NTAwOzYwMDs3MDAmZmFtaWx5PUpldEJyYWlucytNb25vOndnaHRANDAwOzUwMDs2MDAmZGlzcGxheT1zd2FwIiByZWw9InN0eWxlc2hlZXQiPgo8c3R5bGU+CiAgKiB7IG1hcmdpbjogMDsgcGFkZGluZzogMDsgYm94LXNpemluZzogYm9yZGVyLWJveDsgfQogIGJvZHkgeyBiYWNrZ3JvdW5kOiAjMGExMDE4OyBjb2xvcjogI2M4ZDJkYzsgZm9udC1mYW1pbHk6ICdETSBTYW5zJywgc2Fucy1zZXJpZjsgcGFkZGluZzogMjRweCAyMHB4OyBtaW4taGVpZ2h0OiAxMDB2aDsgfQogIC5jb250YWluZXIgeyBtYXgtd2lkdGg6IDEyMDBweDsgbWFyZ2luOiAwIGF1dG87IH0KICAubW9ubyB7IGZvbnQtZmFtaWx5OiAnSmV0QnJhaW5zIE1vbm8nLCBtb25vc3BhY2U7IH0KCiAgLyog4pSA4pSAIEhlYWRlciDilIDilIAgKi8KICAuaGVhZGVyIHsgZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOyBmbGV4LXdyYXA6IHdyYXA7IGdhcDogMTJweDsgbWFyZ2luLWJvdHRvbTogOHB4OyB9CiAgLmhlYWRlci1zdWIgeyBmb250LXNpemU6IDExcHg7IGZvbnQtd2VpZ2h0OiA2MDA7IGxldHRlci1zcGFjaW5nOiAwLjEyZW07IHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7IGNvbG9yOiAjMmE2ZjRlOyBtYXJnaW4tYm90dG9tOiA0cHg7IH0KICAuaGVhZGVyIGgxIHsgZm9udC1zaXplOiAyOHB4OyBmb250LXdlaWdodDogNzAwOyBjb2xvcjogI2U4ZWRmMjsgbGluZS1oZWlnaHQ6IDEuMjsgfQogIC5uYXYtbGluayB7IGZvbnQtc2l6ZTogMTJweDsgY29sb3I6ICM0ZWNkYzQ7IHRleHQtZGVjb3JhdGlvbjogbm9uZTsgYm9yZGVyOiAxcHggc29saWQgIzFhM2E0YTsgcGFkZGluZzogNnB4IDE0cHg7IGJvcmRlci1yYWRpdXM6IDZweDsgdHJhbnNpdGlvbjogYWxsIDAuMnM7IH0KICAubmF2LWxpbms6aG92ZXIgeyBiYWNrZ3JvdW5kOiAjMWEzYTRhOyBjb2xvcjogI2U4ZWRmMjsgfQoKICAvKiDilIDilIAgUGVyaW9kIFNlbGVjdG9yIOKUgOKUgCAqLwogIC5wZXJpb2QtYnVpbGRlciB7IGJhY2tncm91bmQ6ICMxMTE4MjA7IGJvcmRlcjogMXB4IHNvbGlkICMxYTIzMzI7IGJvcmRlci1yYWRpdXM6IDEycHg7IHBhZGRpbmc6IDIwcHggMjRweDsgbWFyZ2luOiAyMHB4IDAgMjhweDsgfQogIC5wYi10aXRsZSB7IGZvbnQtc2l6ZTogMTFweDsgZm9udC13ZWlnaHQ6IDcwMDsgbGV0dGVyLXNwYWNpbmc6IDAuMTJlbTsgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsgY29sb3I6ICMyYTZmNGU7IG1hcmdpbi1ib3R0b206IDE2cHg7IH0KICAucGItcm93IHsgZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGZsZXgtZW5kOyBnYXA6IDEycHg7IGZsZXgtd3JhcDogd3JhcDsgbWFyZ2luLWJvdHRvbTogMTJweDsgfQogIC5wYi1ncm91cCB7IGRpc3BsYXk6IGZsZXg7IGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47IGdhcDogNHB4OyB9CiAgLnBiLWxhYmVsIHsgZm9udC1zaXplOiAxMHB4OyBmb250LXdlaWdodDogNjAwOyBsZXR0ZXItc3BhY2luZzogMC4wOGVtOyB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOyBjb2xvcjogIzVhNmE3YTsgfQogIAogIHNlbGVjdCwgaW5wdXRbdHlwZT0iZGF0ZSJdIHsKICAgIGJhY2tncm91bmQ6ICMwYTEwMTg7IGJvcmRlcjogMXB4IHNvbGlkICMxYTIzMzI7IGNvbG9yOiAjYzhkMmRjOyBmb250LWZhbWlseTogJ0pldEJyYWlucyBNb25vJywgbW9ub3NwYWNlOwogICAgZm9udC1zaXplOiAxM3B4OyBwYWRkaW5nOiA4cHggMTJweDsgYm9yZGVyLXJhZGl1czogNnB4OyBvdXRsaW5lOiBub25lOyB0cmFuc2l0aW9uOiBib3JkZXIgMC4yczsKICB9CiAgc2VsZWN0OmZvY3VzLCBpbnB1dFt0eXBlPSJkYXRlIl06Zm9jdXMgeyBib3JkZXItY29sb3I6ICMyYTZmNGU7IH0KICBzZWxlY3Qgb3B0aW9uIHsgYmFja2dyb3VuZDogIzExMTgyMDsgY29sb3I6ICNjOGQyZGM7IH0KCiAgLnByZXNldC1idG5zIHsgZGlzcGxheTogZmxleDsgZ2FwOiA2cHg7IGZsZXgtd3JhcDogd3JhcDsgbWFyZ2luLWJvdHRvbTogMTRweDsgfQogIC5wcmVzZXQtYnRuIHsgcGFkZGluZzogNXB4IDEycHg7IGJvcmRlci1yYWRpdXM6IDVweDsgYm9yZGVyOiAxcHggc29saWQgIzFhMjMzMjsgY3Vyc29yOiBwb2ludGVyOyBmb250LXNpemU6IDExcHg7IGZvbnQtd2VpZ2h0OiA2MDA7CiAgICBmb250LWZhbWlseTogJ0pldEJyYWlucyBNb25vJywgbW9ub3NwYWNlOyBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsgY29sb3I6ICM1YTZhN2E7IHRyYW5zaXRpb246IGFsbCAwLjJzOyB9CiAgLnByZXNldC1idG46aG92ZXIgeyBib3JkZXItY29sb3I6ICMyYTZmNGU7IGNvbG9yOiAjOGE5YWFhOyB9CiAgLnByZXNldC1idG4uYWN0aXZlIHsgYmFja2dyb3VuZDogIzJhNmY0ZTsgYm9yZGVyLWNvbG9yOiAjMmE2ZjRlOyBjb2xvcjogI2U4ZWRmMjsgfQoKICAvKiBQZXJpb2QgY2hpcHMgKi8KICAucGVyaW9kLWNoaXBzIHsgZGlzcGxheTogZmxleDsgZ2FwOiA4cHg7IGZsZXgtd3JhcDogd3JhcDsgbWFyZ2luLXRvcDogMTJweDsgbWluLWhlaWdodDogMzZweDsgYWxpZ24taXRlbXM6IGNlbnRlcjsgfQogIC5jaGlwIHsgZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsgZ2FwOiA2cHg7IHBhZGRpbmc6IDZweCAxNHB4OyBib3JkZXItcmFkaXVzOiAyMHB4OyBmb250LXNpemU6IDEycHg7IGZvbnQtd2VpZ2h0OiA2MDA7CiAgICBmb250LWZhbWlseTogJ0pldEJyYWlucyBNb25vJywgbW9ub3NwYWNlOyBib3JkZXI6IDFweCBzb2xpZDsgfQogIC5jaGlwIC5yZW1vdmUgeyBjdXJzb3I6IHBvaW50ZXI7IG9wYWNpdHk6IDAuNjsgZm9udC1zaXplOiAxNHB4OyBsaW5lLWhlaWdodDogMTsgfQogIC5jaGlwIC5yZW1vdmU6aG92ZXIgeyBvcGFjaXR5OiAxOyB9CiAgLmNoaXAtZW1wdHkgeyBmb250LXNpemU6IDEycHg7IGNvbG9yOiAjM2E0YTVhOyBwYWRkaW5nOiA4cHggMDsgfQoKICAuYWRkLWJ0biB7IHBhZGRpbmc6IDdweCAxOHB4OyBib3JkZXItcmFkaXVzOiA2cHg7IGJvcmRlcjogbm9uZTsgY3Vyc29yOiBwb2ludGVyOyBmb250LXNpemU6IDEycHg7IGZvbnQtd2VpZ2h0OiA3MDA7CiAgICBmb250LWZhbWlseTogJ0pldEJyYWlucyBNb25vJywgbW9ub3NwYWNlOyBiYWNrZ3JvdW5kOiAjMmE2ZjRlOyBjb2xvcjogI2U4ZWRmMjsgdHJhbnNpdGlvbjogYWxsIDAuMnM7IH0KICAuYWRkLWJ0bjpob3ZlciB7IGJhY2tncm91bmQ6ICMzNTg4NmE7IH0KICAuYWRkLWJ0bjpkaXNhYmxlZCB7IG9wYWNpdHk6IDAuMzsgY3Vyc29yOiBub3QtYWxsb3dlZDsgfQoKICAuY29tcGFyZS1idG4geyBwYWRkaW5nOiAxMHB4IDI4cHg7IGJvcmRlci1yYWRpdXM6IDhweDsgYm9yZGVyOiBub25lOyBjdXJzb3I6IHBvaW50ZXI7IGZvbnQtc2l6ZTogMTNweDsgZm9udC13ZWlnaHQ6IDcwMDsKICAgIGZvbnQtZmFtaWx5OiAnSmV0QnJhaW5zIE1vbm8nLCBtb25vc3BhY2U7IGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsICMyYTZmNGUsICM0ZWNkYzQpOyBjb2xvcjogIzBhMTAxODsgdHJhbnNpdGlvbjogYWxsIDAuMnM7IGxldHRlci1zcGFjaW5nOiAwLjA0ZW07IH0KICAuY29tcGFyZS1idG46aG92ZXIgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTFweCk7IGJveC1zaGFkb3c6IDAgNHB4IDIwcHggcmdiYSg3OCwyMDUsMTk2LDAuMyk7IH0KICAuY29tcGFyZS1idG46ZGlzYWJsZWQgeyBvcGFjaXR5OiAwLjM7IGN1cnNvcjogbm90LWFsbG93ZWQ7IHRyYW5zZm9ybTogbm9uZTsgYm94LXNoYWRvdzogbm9uZTsgfQoKICAvKiDilIDilIAgUmVzdWx0cyDilIDilIAgKi8KICAuc2VjdGlvbi10aXRsZSB7IGZvbnQtc2l6ZTogMTFweDsgZm9udC13ZWlnaHQ6IDcwMDsgbGV0dGVyLXNwYWNpbmc6IDAuMTRlbTsgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsgY29sb3I6ICMyYTZmNGU7IG1hcmdpbjogMjhweCAwIDE0cHg7IH0KCiAgLnJlc3VsdC1ncmlkIHsgZGlzcGxheTogZ3JpZDsgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgMWZyOyBnYXA6IDEycHg7IG1hcmdpbi1ib3R0b206IDI0cHg7IH0KICAucmVzdWx0LWNhcmQgeyBiYWNrZ3JvdW5kOiAjMTExODIwOyBib3JkZXI6IDFweCBzb2xpZCAjMWEyMzMyOyBib3JkZXItcmFkaXVzOiAxMnB4OyBwYWRkaW5nOiAyMHB4OyB9CiAgLnJlc3VsdC1jYXJkLmZ1bGwgeyBncmlkLWNvbHVtbjogMSAvIC0xOyB9CiAgLmNoYXJ0LXRpdGxlIHsgZm9udC1zaXplOiAxM3B4OyBmb250LXdlaWdodDogNjAwOyBjb2xvcjogIzVhNmE3YTsgbGV0dGVyLXNwYWNpbmc6IDAuMDZlbTsgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsgbWFyZ2luLWJvdHRvbTogMTZweDsgfQogIC5jaGFydC13cmFwIHsgcG9zaXRpb246IHJlbGF0aXZlOyBoZWlnaHQ6IDMwMHB4OyB9CgogIC8qIENvbXBhcmUgdGFibGUgKi8KICAuY29tcGFyZS10YWJsZSB7IHdpZHRoOiAxMDAlOyBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlOyB9CiAgLmNvbXBhcmUtdGFibGUgdGggeyBmb250LXNpemU6IDExcHg7IGZvbnQtd2VpZ2h0OiA3MDA7IGxldHRlci1zcGFjaW5nOiAwLjA2ZW07IHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7IGNvbG9yOiAjNWE2YTdhOyAKICAgIHBhZGRpbmc6IDEwcHggMTJweDsgdGV4dC1hbGlnbjogbGVmdDsgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICMxYTIzMzI7IH0KICAuY29tcGFyZS10YWJsZSB0ZCB7IGZvbnQtc2l6ZTogMTNweDsgcGFkZGluZzogMTBweCAxMnB4OyBib3JkZXItYm90dG9tOiAxcHggc29saWQgIzBmMTYyMDsgfQogIC5jb21wYXJlLXRhYmxlIHRyOmhvdmVyIHRkIHsgYmFja2dyb3VuZDogIzBmMTYyMDsgfQogIC5jb21wYXJlLXRhYmxlIC5udW0geyB0ZXh0LWFsaWduOiByaWdodDsgZm9udC13ZWlnaHQ6IDYwMDsgfQogIC5jb21wYXJlLXRhYmxlIC5ncmVlbiB7IGNvbG9yOiAjNGVjZGM0OyB9CiAgLmNvbXBhcmUtdGFibGUgLnJlZCB7IGNvbG9yOiAjZmY2YjZiOyB9CiAgLmNvbXBhcmUtdGFibGUgLmxhYmVsIHsgY29sb3I6ICM4YTlhYWE7IH0KCiAgLmZvb3RlciB7IHRleHQtYWxpZ246IGNlbnRlcjsgcGFkZGluZzogMzJweCAwIDE2cHg7IGNvbG9yOiAjMmEzYTRhOyBmb250LXNpemU6IDExcHg7IH0KCiAgLmxvYWRpbmcgeyBkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsgbWluLWhlaWdodDogNDB2aDsgfQogIC5zcGlubmVyIHsgd2lkdGg6IDIwcHg7IGhlaWdodDogMjBweDsgYm9yZGVyOiAycHggc29saWQgIzRlY2RjNDsgYm9yZGVyLXRvcC1jb2xvcjogdHJhbnNwYXJlbnQ7IGJvcmRlci1yYWRpdXM6IDUwJTsgYW5pbWF0aW9uOiBzcGluIDFzIGxpbmVhciBpbmZpbml0ZTsgbWFyZ2luLXJpZ2h0OiAxMnB4OyB9CgogIC5lbXB0eS1oaW50IHsgdGV4dC1hbGlnbjogY2VudGVyOyBwYWRkaW5nOiA2MHB4IDIwcHg7IGNvbG9yOiAjM2E0YTVhOyB9CiAgLmVtcHR5LWhpbnQgLmljb24geyBmb250LXNpemU6IDQwcHg7IG1hcmdpbi1ib3R0b206IDEycHg7IH0KICAuZW1wdHktaGludCAudGV4dCB7IGZvbnQtc2l6ZTogMTRweDsgbGluZS1oZWlnaHQ6IDEuNjsgfQoKICBAa2V5ZnJhbWVzIHNwaW4geyB0byB7IHRyYW5zZm9ybTogcm90YXRlKDM2MGRlZyk7IH0gfQogIEBrZXlmcmFtZXMgZmFkZUluIHsgZnJvbSB7IG9wYWNpdHk6IDA7IHRyYW5zZm9ybTogdHJhbnNsYXRlWSg4cHgpOyB9IHRvIHsgb3BhY2l0eTogMTsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDApOyB9IH0KICAuZmFkZS1pbiB7IGFuaW1hdGlvbjogZmFkZUluIDAuNXMgZWFzZTsgfQoKICBAbWVkaWEgKG1heC13aWR0aDogNzY4cHgpIHsKICAgIC5yZXN1bHQtZ3JpZCB7IGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyOyB9CiAgICAucGItcm93IHsgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsgYWxpZ24taXRlbXM6IHN0cmV0Y2g7IH0KICAgIC5oZWFkZXIgaDEgeyBmb250LXNpemU6IDIycHg7IH0KICB9Cjwvc3R5bGU+CjwvaGVhZD4KPGJvZHk+CjxkaXYgY2xhc3M9ImNvbnRhaW5lciI+CgogIDxkaXYgY2xhc3M9ImhlYWRlciI+CiAgICA8ZGl2PgogICAgICA8ZGl2IGNsYXNzPSJoZWFkZXItc3ViIG1vbm8iPkRyaXhsIFRyYW5zcG9ydGUgR21iSDwvZGl2PgogICAgICA8aDE+UGVyaW9kZW52ZXJnbGVpY2g8L2gxPgogICAgPC9kaXY+CiAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBnYXA6IDhweDsgYWxpZ24taXRlbXM6IGNlbnRlcjsiPgogICAgICA8YSBocmVmPSIvIiBjbGFzcz0ibmF2LWxpbmsgbW9ubyI+4oaQIERhc2hib2FyZDwvYT4KICAgICAgPGEgaHJlZj0iL2FwaS9sb2dvdXQiIGNsYXNzPSJtb25vIiBzdHlsZT0iZm9udC1zaXplOiAxMXB4OyBjb2xvcjogIzVhNmE3YTsgdGV4dC1kZWNvcmF0aW9uOiBub25lOyBwYWRkaW5nOiA2cHggMTBweDsgYm9yZGVyLXJhZGl1czogNnB4OyB0cmFuc2l0aW9uOiBhbGwgMC4yczsiIG9ubW91c2VvdmVyPSJ0aGlzLnN0eWxlLmNvbG9yPScjZmY2YjZiJyIgb25tb3VzZW91dD0idGhpcy5zdHlsZS5jb2xvcj0nIzVhNmE3YSciPuKPuyBMb2dvdXQ8L2E+CiAgICA8L2Rpdj4KICA8L2Rpdj4KCiAgPCEtLSDilZDilZDilZAgUEVSSU9EIEJVSUxERVIg4pWQ4pWQ4pWQIC0tPgogIDxkaXYgY2xhc3M9InBlcmlvZC1idWlsZGVyIiBpZD0iYnVpbGRlciI+CiAgICA8ZGl2IGNsYXNzPSJwYi10aXRsZSBtb25vIj5QZXJpb2RlbiBhdXN3w6RobGVuPC9kaXY+CgogICAgPCEtLSBQcmVzZXRzIC0tPgogICAgPGRpdiBjbGFzcz0icHJlc2V0LWJ0bnMiIGlkPSJwcmVzZXRCdG5zIj4KICAgICAgPGJ1dHRvbiBjbGFzcz0icHJlc2V0LWJ0biBtb25vIGFjdGl2ZSIgb25jbGljaz0ic2V0TW9kZSgncXVhcnRlcicpIj5RdWFydGFsZTwvYnV0dG9uPgogICAgICA8YnV0dG9uIGNsYXNzPSJwcmVzZXQtYnRuIG1vbm8iIG9uY2xpY2s9InNldE1vZGUoJ21vbnRoJykiPk1vbmF0ZTwvYnV0dG9uPgogICAgICA8YnV0dG9uIGNsYXNzPSJwcmVzZXQtYnRuIG1vbm8iIG9uY2xpY2s9InNldE1vZGUoJ3llYXInKSI+SmFocmU8L2J1dHRvbj4KICAgICAgPGJ1dHRvbiBjbGFzcz0icHJlc2V0LWJ0biBtb25vIiBvbmNsaWNrPSJzZXRNb2RlKCdjdXN0b20nKSI+RWlnZW5lciBaZWl0cmF1bTwvYnV0dG9uPgogICAgPC9kaXY+CgogICAgPCEtLSBRdWFydGVyIHNlbGVjdG9yIC0tPgogICAgPGRpdiBjbGFzcz0icGItcm93IiBpZD0icXVhcnRlclJvdyI+CiAgICAgIDxkaXYgY2xhc3M9InBiLWdyb3VwIj4KICAgICAgICA8c3BhbiBjbGFzcz0icGItbGFiZWwgbW9ubyI+UXVhcnRhbDwvc3Bhbj4KICAgICAgICA8c2VsZWN0IGlkPSJzZWxRdWFydGVyIj4KICAgICAgICAgIDxvcHRpb24gdmFsdWU9IjEiPlExIChKYW4g4oCTIE3DpHIpPC9vcHRpb24+CiAgICAgICAgICA8b3B0aW9uIHZhbHVlPSIyIj5RMiAoQXByIOKAkyBKdW4pPC9vcHRpb24+CiAgICAgICAgICA8b3B0aW9uIHZhbHVlPSIzIj5RMyAoSnVsIOKAkyBTZXApPC9vcHRpb24+CiAgICAgICAgICA8b3B0aW9uIHZhbHVlPSI0Ij5RNCAoT2t0IOKAkyBEZXopPC9vcHRpb24+CiAgICAgICAgPC9zZWxlY3Q+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJwYi1ncm91cCI+CiAgICAgICAgPHNwYW4gY2xhc3M9InBiLWxhYmVsIG1vbm8iPkphaHI8L3NwYW4+CiAgICAgICAgPHNlbGVjdCBpZD0ic2VsUXVhcnRlclllYXIiPjwvc2VsZWN0PgogICAgICA8L2Rpdj4KICAgICAgPGJ1dHRvbiBjbGFzcz0iYWRkLWJ0biBtb25vIiBvbmNsaWNrPSJhZGRQZXJpb2QoKSI+KyBIaW56dWbDvGdlbjwvYnV0dG9uPgogICAgPC9kaXY+CgogICAgPCEtLSBNb250aCBzZWxlY3RvciAtLT4KICAgIDxkaXYgY2xhc3M9InBiLXJvdyIgaWQ9Im1vbnRoUm93IiBzdHlsZT0iZGlzcGxheTpub25lOyI+CiAgICAgIDxkaXYgY2xhc3M9InBiLWdyb3VwIj4KICAgICAgICA8c3BhbiBjbGFzcz0icGItbGFiZWwgbW9ubyI+TW9uYXQ8L3NwYW4+CiAgICAgICAgPHNlbGVjdCBpZD0ic2VsTW9udGgiPgogICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iMSI+SmFudWFyPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iMiI+RmVicnVhcjwvb3B0aW9uPjxvcHRpb24gdmFsdWU9IjMiPk3DpHJ6PC9vcHRpb24+CiAgICAgICAgICA8b3B0aW9uIHZhbHVlPSI0Ij5BcHJpbDwvb3B0aW9uPjxvcHRpb24gdmFsdWU9IjUiPk1haTwvb3B0aW9uPjxvcHRpb24gdmFsdWU9IjYiPkp1bmk8L29wdGlvbj4KICAgICAgICAgIDxvcHRpb24gdmFsdWU9IjciPkp1bGk8L29wdGlvbj48b3B0aW9uIHZhbHVlPSI4Ij5BdWd1c3Q8L29wdGlvbj48b3B0aW9uIHZhbHVlPSI5Ij5TZXB0ZW1iZXI8L29wdGlvbj4KICAgICAgICAgIDxvcHRpb24gdmFsdWU9IjEwIj5Pa3RvYmVyPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iMTEiPk5vdmVtYmVyPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iMTIiPkRlemVtYmVyPC9vcHRpb24+CiAgICAgICAgPC9zZWxlY3Q+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJwYi1ncm91cCI+CiAgICAgICAgPHNwYW4gY2xhc3M9InBiLWxhYmVsIG1vbm8iPkphaHI8L3NwYW4+CiAgICAgICAgPHNlbGVjdCBpZD0ic2VsTW9udGhZZWFyIj48L3NlbGVjdD4KICAgICAgPC9kaXY+CiAgICAgIDxidXR0b24gY2xhc3M9ImFkZC1idG4gbW9ubyIgb25jbGljaz0iYWRkUGVyaW9kKCkiPisgSGluenVmw7xnZW48L2J1dHRvbj4KICAgIDwvZGl2PgoKICAgIDwhLS0gWWVhciBzZWxlY3RvciAtLT4KICAgIDxkaXYgY2xhc3M9InBiLXJvdyIgaWQ9InllYXJSb3ciIHN0eWxlPSJkaXNwbGF5Om5vbmU7Ij4KICAgICAgPGRpdiBjbGFzcz0icGItZ3JvdXAiPgogICAgICAgIDxzcGFuIGNsYXNzPSJwYi1sYWJlbCBtb25vIj5KYWhyPC9zcGFuPgogICAgICAgIDxzZWxlY3QgaWQ9InNlbFllYXIiPjwvc2VsZWN0PgogICAgICA8L2Rpdj4KICAgICAgPGJ1dHRvbiBjbGFzcz0iYWRkLWJ0biBtb25vIiBvbmNsaWNrPSJhZGRQZXJpb2QoKSI+KyBIaW56dWbDvGdlbjwvYnV0dG9uPgogICAgPC9kaXY+CgogICAgPCEtLSBDdXN0b20gc2VsZWN0b3IgLS0+CiAgICA8ZGl2IGNsYXNzPSJwYi1yb3ciIGlkPSJjdXN0b21Sb3ciIHN0eWxlPSJkaXNwbGF5Om5vbmU7Ij4KICAgICAgPGRpdiBjbGFzcz0icGItZ3JvdXAiPgogICAgICAgIDxzcGFuIGNsYXNzPSJwYi1sYWJlbCBtb25vIj5Wb248L3NwYW4+CiAgICAgICAgPGlucHV0IHR5cGU9ImRhdGUiIGlkPSJjdXN0b21Gcm9tIj4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9InBiLWdyb3VwIj4KICAgICAgICA8c3BhbiBjbGFzcz0icGItbGFiZWwgbW9ubyI+QmlzPC9zcGFuPgogICAgICAgIDxpbnB1dCB0eXBlPSJkYXRlIiBpZD0iY3VzdG9tVG8iPgogICAgICA8L2Rpdj4KICAgICAgPGJ1dHRvbiBjbGFzcz0iYWRkLWJ0biBtb25vIiBvbmNsaWNrPSJhZGRQZXJpb2QoKSI+KyBIaW56dWbDvGdlbjwvYnV0dG9uPgogICAgPC9kaXY+CgogICAgPCEtLSBTZWxlY3RlZCBwZXJpb2RzIC0tPgogICAgPGRpdiBjbGFzcz0icGVyaW9kLWNoaXBzIiBpZD0iY2hpcHMiPgogICAgICA8c3BhbiBjbGFzcz0iY2hpcC1lbXB0eSBtb25vIj5Ob2NoIGtlaW5lIFBlcmlvZGVuIGF1c2dld8OkaGx0IOKAkyBmw7xnZSBtaW5kZXN0ZW5zIDIgaGluenU8L3NwYW4+CiAgICA8L2Rpdj4KCiAgICA8ZGl2IHN0eWxlPSJtYXJnaW4tdG9wOiAxNnB4OyBkaXNwbGF5OiBmbGV4OyBnYXA6IDEycHg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7Ij4KICAgICAgPGJ1dHRvbiBjbGFzcz0iY29tcGFyZS1idG4gbW9ubyIgaWQ9ImNvbXBhcmVCdG4iIG9uY2xpY2s9InJ1bkNvbXBhcmlzb24oKSIgZGlzYWJsZWQ+VmVyZ2xlaWNoZW48L2J1dHRvbj4KICAgICAgPHNwYW4gaWQ9ImNvbXBhcmVIaW50IiBjbGFzcz0ibW9ubyIgc3R5bGU9ImZvbnQtc2l6ZTogMTFweDsgY29sb3I6ICMzYTRhNWE7Ij5NaW5kZXN0ZW5zIDIgUGVyaW9kZW4gd8OkaGxlbjwvc3Bhbj4KICAgIDwvZGl2PgogIDwvZGl2PgoKICA8IS0tIOKVkOKVkOKVkCBSRVNVTFRTIOKVkOKVkOKVkCAtLT4KICA8ZGl2IGlkPSJyZXN1bHRzIj4KICAgIDxkaXYgY2xhc3M9ImVtcHR5LWhpbnQiPgogICAgICA8ZGl2IGNsYXNzPSJpY29uIj7wn5OKPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9InRleHQiPlfDpGhsZSBvYmVuIFBlcmlvZGVuIGF1cyB1bmQga2xpY2tlIGF1ZiA8c3Ryb25nPlZlcmdsZWljaGVuPC9zdHJvbmc+LDxicj51bSBlaW5lbiBkZXRhaWxsaWVydGVuIFBlcmlvZGVudmVyZ2xlaWNoIHp1IGVyc3RlbGxlbi48L2Rpdj4KICAgIDwvZGl2PgogIDwvZGl2PgoKICA8ZGl2IGNsYXNzPSJmb290ZXIgbW9ubyI+CiAgICBEYXRlbiB2aWEgYmV4aW8gQVBJIMK3IFBvd2VyZWQgYnkgU3VwYWJhc2UKICA8L2Rpdj4KPC9kaXY+Cgo8c2NyaXB0Pgpjb25zdCBTVVBBQkFTRV9VUkwgPSAiaHR0cHM6Ly9uemZ3ZGVodWFjcndpc3VpeGR4dS5zdXBhYmFzZS5jbyI7CmNvbnN0IFNVUEFCQVNFX0tFWSA9ICJleUpoYkdjaU9pSklVekkxTmlJc0luUjVjQ0k2SWtwWFZDSjkuZXlKcGMzTWlPaUp6ZFhCaFltRnpaU0lzSW5KbFppSTZJbTU2Wm5ka1pXaDFZV055ZDJsemRXbDRaSGgxSWl3aWNtOXNaU0k2SW5ObGNuWnBZMlZmY205c1pTSXNJbWxoZENJNk1UYzNNVEkyT0RVek55d2laWGh3SWpveU1EZzJPRFEwTlRNM2ZRLl9qajVLSFV1bHBnQzFWSW5kMF83bS1Bc01BLU1raGNKc0RrTi0xeDV4WFUiOwoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIFNUQVRFCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAoKbGV0IG1vZGUgPSAicXVhcnRlciI7CmxldCBwZXJpb2RzID0gW107ICAvLyB7IGlkLCBsYWJlbCwgZnJvbSwgdG8sIGNvbG9yIH0KbGV0IGFsbERhdGEgPSBudWxsOwpsZXQgY2hhcnRJbnN0YW5jZXMgPSB7fTsKCmNvbnN0IENPTE9SUyA9IFsnIzRlY2RjNCcsJyNlOGE1NGInLCcjZmY2YjZiJywnIzZjYjRlZScsJyNhNzhiZmEnLCcjZjQ3MmI2JywnIzM0ZDM5OScsJyNmYmJmMjQnXTsKY29uc3QgTU9OVEhfTkFNRVMgPSBbIkphbiIsIkZlYiIsIk3DpHIiLCJBcHIiLCJNYWkiLCJKdW4iLCJKdWwiLCJBdWciLCJTZXAiLCJPa3QiLCJOb3YiLCJEZXoiXTsKCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovLyBEQVRBIExPQURJTkcKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCgphc3luYyBmdW5jdGlvbiBxdWVyeSh0YWJsZSwgcGFyYW1zID0gIiIpIHsKICBjb25zdCBhbGxSb3dzID0gW107CiAgbGV0IG9mZnNldCA9IDA7CiAgd2hpbGUgKHRydWUpIHsKICAgIGNvbnN0IHVybCA9IGAke1NVUEFCQVNFX1VSTH0vcmVzdC92MS8ke3RhYmxlfT8ke3BhcmFtc30mb2Zmc2V0PSR7b2Zmc2V0fSZsaW1pdD0xMDAwYDsKICAgIHRyeSB7CiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKHVybCwgeyBoZWFkZXJzOiB7IGFwaWtleTogU1VQQUJBU0VfS0VZLCBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7U1VQQUJBU0VfS0VZfWAsIFByZWZlcjogImNvdW50PWV4YWN0IiB9IH0pOwogICAgICBpZiAoIXJlcy5vaykgeyBjb25zb2xlLndhcm4oYCR7dGFibGV9QCR7b2Zmc2V0fTogSFRUUCAke3Jlcy5zdGF0dXN9YCk7IGJyZWFrOyB9CiAgICAgIGNvbnN0IGJhdGNoID0gYXdhaXQgcmVzLmpzb24oKTsKICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGJhdGNoKSB8fCBiYXRjaC5sZW5ndGggPT09IDApIGJyZWFrOwogICAgICBhbGxSb3dzLnB1c2goLi4uYmF0Y2gpOwogICAgICBjb25zb2xlLmxvZyhgICAke3RhYmxlfTogJHthbGxSb3dzLmxlbmd0aH0gKGJhdGNoICR7YmF0Y2gubGVuZ3RofSlgKTsKICAgICAgaWYgKGJhdGNoLmxlbmd0aCA8IDEwMDApIGJyZWFrOwogICAgICBvZmZzZXQgKz0gMTAwMDsKICAgIH0gY2F0Y2ggKGUpIHsgY29uc29sZS5lcnJvcihgJHt0YWJsZX1AJHtvZmZzZXR9OiBlcnJvcmAsIGUpOyBicmVhazsgfQogIH0KICBjb25zb2xlLmxvZyhg4pyTICR7dGFibGV9OiAke2FsbFJvd3MubGVuZ3RofSB0b3RhbGApOwogIHJldHVybiBhbGxSb3dzOwp9Cgphc3luYyBmdW5jdGlvbiBsb2FkRGF0YSgpIHsKICBpZiAoYWxsRGF0YSkgcmV0dXJuIGFsbERhdGE7CiAgY29uc29sZS5sb2coIkxvYWRpbmcgaW52b2ljZXMuLi4iKTsKICBjb25zdCBpbnZvaWNlcyA9IGF3YWl0IHF1ZXJ5KCJpbnZvaWNlcyIsICJzZWxlY3Q9aWQsaXNfdmFsaWRfZnJvbSx0b3RhbF9ncm9zcyx0b3RhbF9uZXQsc3RhdHVzLGNvbnRhY3RfaWQsZG9jdW1lbnRfbnIiKTsKICBjb25zb2xlLmxvZygiTG9hZGluZyBxdW90ZXMuLi4iKTsKICBjb25zdCBxdW90ZXMgPSBhd2FpdCBxdWVyeSgicXVvdGVzIiwgInNlbGVjdD1pZCxpc192YWxpZF9mcm9tLHRvdGFsX25ldCxzdGF0dXMsY3JlYXRlZF9hdCIpOwogIGNvbnNvbGUubG9nKCJMb2FkaW5nIGNvbnRhY3RzLi4uIik7CiAgY29uc3QgY29udGFjdHMgPSBhd2FpdCBxdWVyeSgiY29udGFjdHMiLCAic2VsZWN0PWlkLG5hbWVfMSxuYW1lXzIiKTsKICBjb25zb2xlLmxvZygiTG9hZGluZyBwYXltZW50cy4uLiIpOwogIGNvbnN0IHBheW1lbnRzID0gYXdhaXQgcXVlcnkoImluY29taW5nX3BheW1lbnRzIiwgInNlbGVjdD1pZCxpbnZvaWNlX2lkLHBheW1lbnRfZGF0ZSxhbW91bnQiKTsKICBjb25zdCBjbSA9IHt9OwogIGNvbnRhY3RzLmZvckVhY2goYyA9PiBjbVtjLmlkXSA9IFtjLm5hbWVfMSwgYy5uYW1lXzJdLmZpbHRlcihCb29sZWFuKS5qb2luKCIgIikpOwogIGNvbnN0IHBheU1hcCA9IHt9OwogIHBheW1lbnRzLmZvckVhY2gocCA9PiB7IGlmICghcGF5TWFwW3AuaW52b2ljZV9pZF0pIHBheU1hcFtwLmludm9pY2VfaWRdID0gW107IHBheU1hcFtwLmludm9pY2VfaWRdLnB1c2gocCk7IH0pOwogIGFsbERhdGEgPSB7IGludm9pY2VzLCBxdW90ZXMsIGNtLCBwYXlNYXAgfTsKICBjb25zb2xlLmxvZyhgPT09IEFMTCBMT0FERUQgPT09IGludjoke2ludm9pY2VzLmxlbmd0aH0gcXVvdGVzOiR7cXVvdGVzLmxlbmd0aH0gY29udGFjdHM6JHtjb250YWN0cy5sZW5ndGh9IHBheToke3BheW1lbnRzLmxlbmd0aH1gKTsKICByZXR1cm4gYWxsRGF0YTsKfQoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIFBFUklPRCBCVUlMREVSIFVJCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAoKZnVuY3Rpb24gcG9wdWxhdGVZZWFyU2VsZWN0cygpIHsKICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCk7CiAgY29uc3QgeWVhcnMgPSBbXTsKICBmb3IgKGxldCB5ID0gbm93OyB5ID49IDIwMTU7IHktLSkgeWVhcnMucHVzaCh5KTsKICBjb25zdCBodG1sID0geWVhcnMubWFwKHkgPT4gYDxvcHRpb24gdmFsdWU9IiR7eX0iPiR7eX08L29wdGlvbj5gKS5qb2luKCIiKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2VsUXVhcnRlclllYXIiKS5pbm5lckhUTUwgPSBodG1sOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzZWxNb250aFllYXIiKS5pbm5lckhUTUwgPSBodG1sOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzZWxZZWFyIikuaW5uZXJIVE1MID0gaHRtbDsKfQoKZnVuY3Rpb24gc2V0TW9kZShtKSB7CiAgbW9kZSA9IG07CiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLnByZXNldC1idG4iKS5mb3JFYWNoKGIgPT4gYi5jbGFzc0xpc3QucmVtb3ZlKCJhY3RpdmUiKSk7CiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLnByZXNldC1idG5bb25jbGljaz0ic2V0TW9kZSgnJHttfScpIl1gKS5jbGFzc0xpc3QuYWRkKCJhY3RpdmUiKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicXVhcnRlclJvdyIpLnN0eWxlLmRpc3BsYXkgPSBtID09PSAicXVhcnRlciIgPyAiZmxleCIgOiAibm9uZSI7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1vbnRoUm93Iikuc3R5bGUuZGlzcGxheSA9IG0gPT09ICJtb250aCIgPyAiZmxleCIgOiAibm9uZSI7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInllYXJSb3ciKS5zdHlsZS5kaXNwbGF5ID0gbSA9PT0gInllYXIiID8gImZsZXgiIDogIm5vbmUiOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjdXN0b21Sb3ciKS5zdHlsZS5kaXNwbGF5ID0gbSA9PT0gImN1c3RvbSIgPyAiZmxleCIgOiAibm9uZSI7Cn0KCmZ1bmN0aW9uIGFkZFBlcmlvZCgpIHsKICBsZXQgbGFiZWwsIGZyb20sIHRvOwoKICBpZiAobW9kZSA9PT0gInF1YXJ0ZXIiKSB7CiAgICBjb25zdCBxID0gcGFyc2VJbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNlbFF1YXJ0ZXIiKS52YWx1ZSk7CiAgICBjb25zdCB5ID0gcGFyc2VJbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNlbFF1YXJ0ZXJZZWFyIikudmFsdWUpOwogICAgbGFiZWwgPSBgUSR7cX0vJHt5fWA7CiAgICBjb25zdCBzbSA9IChxIC0gMSkgKiAzOwogICAgZnJvbSA9IG5ldyBEYXRlKHksIHNtLCAxKTsKICAgIHRvID0gbmV3IERhdGUoeSwgc20gKyAzLCAwKTsKICB9IGVsc2UgaWYgKG1vZGUgPT09ICJtb250aCIpIHsKICAgIGNvbnN0IG0gPSBwYXJzZUludChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2VsTW9udGgiKS52YWx1ZSk7CiAgICBjb25zdCB5ID0gcGFyc2VJbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNlbE1vbnRoWWVhciIpLnZhbHVlKTsKICAgIGxhYmVsID0gYCR7TU9OVEhfTkFNRVNbbS0xXX0gJHt5fWA7CiAgICBmcm9tID0gbmV3IERhdGUoeSwgbSAtIDEsIDEpOwogICAgdG8gPSBuZXcgRGF0ZSh5LCBtLCAwKTsKICB9IGVsc2UgaWYgKG1vZGUgPT09ICJ5ZWFyIikgewogICAgY29uc3QgeSA9IHBhcnNlSW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzZWxZZWFyIikudmFsdWUpOwogICAgbGFiZWwgPSBgJHt5fWA7CiAgICBmcm9tID0gbmV3IERhdGUoeSwgMCwgMSk7CiAgICB0byA9IG5ldyBEYXRlKHksIDExLCAzMSk7CiAgfSBlbHNlIHsKICAgIGNvbnN0IGZ2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImN1c3RvbUZyb20iKS52YWx1ZTsKICAgIGNvbnN0IHR2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImN1c3RvbVRvIikudmFsdWU7CiAgICBpZiAoIWZ2IHx8ICF0dikgcmV0dXJuOwogICAgZnJvbSA9IG5ldyBEYXRlKGZ2KTsKICAgIHRvID0gbmV3IERhdGUodHYpOwogICAgaWYgKGZyb20gPj0gdG8pIHJldHVybjsKICAgIGxhYmVsID0gYCR7ZnJvbS50b0xvY2FsZURhdGVTdHJpbmcoJ2RlLUNIJyl9IOKAkyAke3RvLnRvTG9jYWxlRGF0ZVN0cmluZygnZGUtQ0gnKX1gOwogIH0KCiAgLy8gQ2hlY2sgZHVwbGljYXRlCiAgaWYgKHBlcmlvZHMuZmluZChwID0+IHAubGFiZWwgPT09IGxhYmVsKSkgcmV0dXJuOwogIGlmIChwZXJpb2RzLmxlbmd0aCA+PSA4KSByZXR1cm47CgogIGNvbnN0IGNvbG9yID0gQ09MT1JTW3BlcmlvZHMubGVuZ3RoICUgQ09MT1JTLmxlbmd0aF07CiAgcGVyaW9kcy5wdXNoKHsgaWQ6IERhdGUubm93KCksIGxhYmVsLCBmcm9tLCB0bywgY29sb3IgfSk7CiAgcmVuZGVyQ2hpcHMoKTsKfQoKZnVuY3Rpb24gcmVtb3ZlUGVyaW9kKGlkKSB7CiAgcGVyaW9kcyA9IHBlcmlvZHMuZmlsdGVyKHAgPT4gcC5pZCAhPT0gaWQpOwogIC8vIFJlYXNzaWduIGNvbG9ycwogIHBlcmlvZHMuZm9yRWFjaCgocCwgaSkgPT4gcC5jb2xvciA9IENPTE9SU1tpICUgQ09MT1JTLmxlbmd0aF0pOwogIHJlbmRlckNoaXBzKCk7Cn0KCmZ1bmN0aW9uIHJlbmRlckNoaXBzKCkgewogIGNvbnN0IGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNoaXBzIik7CiAgaWYgKHBlcmlvZHMubGVuZ3RoID09PSAwKSB7CiAgICBlbC5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9ImNoaXAtZW1wdHkgbW9ubyI+Tm9jaCBrZWluZSBQZXJpb2RlbiBhdXNnZXfDpGhsdCDigJMgZsO8Z2UgbWluZGVzdGVucyAyIGhpbnp1PC9zcGFuPmA7CiAgfSBlbHNlIHsKICAgIGVsLmlubmVySFRNTCA9IHBlcmlvZHMubWFwKHAgPT4gYAogICAgICA8ZGl2IGNsYXNzPSJjaGlwIG1vbm8iIHN0eWxlPSJiYWNrZ3JvdW5kOiAke3AuY29sb3J9MTU7IGJvcmRlci1jb2xvcjogJHtwLmNvbG9yfTQwOyBjb2xvcjogJHtwLmNvbG9yfTsiPgogICAgICAgICR7cC5sYWJlbH0KICAgICAgICA8c3BhbiBjbGFzcz0icmVtb3ZlIiBvbmNsaWNrPSJyZW1vdmVQZXJpb2QoJHtwLmlkfSkiPuKclTwvc3Bhbj4KICAgICAgPC9kaXY+CiAgICBgKS5qb2luKCIiKTsKICB9CiAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvbXBhcmVCdG4iKTsKICBjb25zdCBoaW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvbXBhcmVIaW50Iik7CiAgYnRuLmRpc2FibGVkID0gcGVyaW9kcy5sZW5ndGggPCAyOwogIGhpbnQudGV4dENvbnRlbnQgPSBwZXJpb2RzLmxlbmd0aCA8IDIgPyBgTm9jaCAkezIgLSBwZXJpb2RzLmxlbmd0aH0gUGVyaW9kZShuKSBoaW56dWbDvGdlbmAgOiBgJHtwZXJpb2RzLmxlbmd0aH0gUGVyaW9kZW4gYmVyZWl0YDsKICBoaW50LnN0eWxlLmNvbG9yID0gcGVyaW9kcy5sZW5ndGggPj0gMiA/ICcjNGVjZGM0JyA6ICcjM2E0YTVhJzsKfQoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIENPTVBBUklTT04gTE9HSUMKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCgpmdW5jdGlvbiBmb3JtYXRDSEYodikgewogIGNvbnN0IG4gPSBwYXJzZUZsb2F0KHYpIHx8IDA7CiAgaWYgKE1hdGguYWJzKG4pID49IDEwMDAwMDApIHJldHVybiBgQ0hGICR7KG4vMTAwMDAwMCkudG9GaXhlZCgyKX0gTWlvYDsKICBpZiAoTWF0aC5hYnMobikgPj0gMTAwMDApIHJldHVybiBgQ0hGICR7KG4vMTAwMCkudG9GaXhlZCgwKX1LYDsKICBpZiAoTWF0aC5hYnMobikgPj0gMTAwMCkgcmV0dXJuIGBDSEYgJHsobi8xMDAwKS50b0ZpeGVkKDEpfUtgOwogIHJldHVybiBgQ0hGICR7bi50b0ZpeGVkKDApfWA7Cn0KZnVuY3Rpb24gZm9ybWF0TnVtKHYpIHsgcmV0dXJuIG5ldyBJbnRsLk51bWJlckZvcm1hdCgiZGUtQ0giKS5mb3JtYXQodiB8fCAwKTsgfQoKZnVuY3Rpb24gaW5QZXJpb2QoZGF0ZVN0ciwgZnJvbSwgdG8pIHsKICBpZiAoIWRhdGVTdHIpIHJldHVybiBmYWxzZTsKICBjb25zdCBkID0gbmV3IERhdGUoZGF0ZVN0cik7CiAgcmV0dXJuIGQgPj0gZnJvbSAmJiBkIDw9IHRvOwp9CgpmdW5jdGlvbiBjb21wdXRlUGVyaW9kU3RhdHMoZGF0YSwgcGVyaW9kKSB7CiAgY29uc3QgeyBpbnZvaWNlcywgcXVvdGVzLCBjbSwgcGF5TWFwIH0gPSBkYXRhOwogIGNvbnN0IHsgZnJvbSwgdG8gfSA9IHBlcmlvZDsKCiAgY29uc3QgaW52cyA9IGludm9pY2VzLmZpbHRlcihpID0+IGkuc3RhdHVzICE9PSAiY2FuY2VsbGVkIiAmJiBpLnN0YXR1cyAhPT0gImRyYWZ0IiAmJiBpblBlcmlvZChpLmlzX3ZhbGlkX2Zyb20sIGZyb20sIHRvKSk7CiAgY29uc3QgcmV2ZW51ZSA9IGludnMucmVkdWNlKChzLCBpKSA9PiBzICsgcGFyc2VGbG9hdChpLnRvdGFsX25ldCB8fCAwKSwgMCk7CiAgY29uc3QgY291bnQgPSBpbnZzLmxlbmd0aDsKICBjb25zdCBhdmcgPSBjb3VudCA+IDAgPyByZXZlbnVlIC8gY291bnQgOiAwOwoKICAvLyBVbmlxdWUgY3VzdG9tZXJzCiAgY29uc3QgY3VzdHMgPSBuZXcgU2V0KGludnMubWFwKGkgPT4gaS5jb250YWN0X2lkKS5maWx0ZXIoQm9vbGVhbikpOwoKICAvLyBRdW90ZXMKICBjb25zdCBxcyA9IHF1b3Rlcy5maWx0ZXIocSA9PiBpblBlcmlvZChxLmlzX3ZhbGlkX2Zyb20gfHwgcS5jcmVhdGVkX2F0LCBmcm9tLCB0bykpOwogIGNvbnN0IHFUb3RhbCA9IHFzLmxlbmd0aDsKICBjb25zdCBxQWNjZXB0ZWQgPSBxcy5maWx0ZXIocSA9PiBxLnN0YXR1cyA9PT0gImFjY2VwdGVkIikubGVuZ3RoOwogIGNvbnN0IHFDb252ID0gcVRvdGFsID4gMCA/IChxQWNjZXB0ZWQgLyBxVG90YWwgKiAxMDApIDogMDsKCiAgLy8gRFNPCiAgY29uc3QgcGFpZEludnMgPSBpbnZvaWNlcy5maWx0ZXIoaSA9PiBpLnN0YXR1cyA9PT0gInBhaWQiICYmIGluUGVyaW9kKGkuaXNfdmFsaWRfZnJvbSwgZnJvbSwgdG8pKTsKICBsZXQgZHNvU3VtID0gMCwgZHNvQ291bnQgPSAwOwogIHBhaWRJbnZzLmZvckVhY2goaW52ID0+IHsKICAgIGlmICghcGF5TWFwW2ludi5pZF0pIHJldHVybjsKICAgIGNvbnN0IHBheXMgPSBwYXlNYXBbaW52LmlkXS5maWx0ZXIocCA9PiBwLnBheW1lbnRfZGF0ZSk7CiAgICBpZiAocGF5cy5sZW5ndGggPT09IDApIHJldHVybjsKICAgIGNvbnN0IGxhc3RQYXkgPSBwYXlzLnNvcnQoKGEsIGIpID0+IG5ldyBEYXRlKGIucGF5bWVudF9kYXRlKSAtIG5ldyBEYXRlKGEucGF5bWVudF9kYXRlKSlbMF07CiAgICBjb25zdCBkYXlzID0gTWF0aC5yb3VuZCgobmV3IERhdGUobGFzdFBheS5wYXltZW50X2RhdGUpIC0gbmV3IERhdGUoaW52LmlzX3ZhbGlkX2Zyb20pKSAvIDg2NDAwMDAwKTsKICAgIGlmIChkYXlzID49IDAgJiYgZGF5cyA8IDM2NSkgeyBkc29TdW0gKz0gZGF5czsgZHNvQ291bnQrKzsgfQogIH0pOwogIGNvbnN0IGRzbyA9IGRzb0NvdW50ID4gMCA/IGRzb1N1bSAvIGRzb0NvdW50IDogMDsKCiAgLy8gVG9wIDUgY3VzdG9tZXJzIGluIHRoaXMgcGVyaW9kCiAgY29uc3QgY3VzdFJldiA9IHt9OwogIGludnMuZm9yRWFjaChpbnYgPT4gewogICAgaWYgKCFpbnYuY29udGFjdF9pZCkgcmV0dXJuOwogICAgaWYgKCFjdXN0UmV2W2ludi5jb250YWN0X2lkXSkgY3VzdFJldltpbnYuY29udGFjdF9pZF0gPSB7IGlkOiBpbnYuY29udGFjdF9pZCwgdG90YWw6IDAgfTsKICAgIGN1c3RSZXZbaW52LmNvbnRhY3RfaWRdLnRvdGFsICs9IHBhcnNlRmxvYXQoaW52LnRvdGFsX25ldCB8fCAwKTsKICB9KTsKICBjb25zdCB0b3BDdXN0ID0gT2JqZWN0LnZhbHVlcyhjdXN0UmV2KS5zb3J0KChhLCBiKSA9PiBiLnRvdGFsIC0gYS50b3RhbCkuc2xpY2UoMCwgNSk7CgogIC8vIE1vbnRobHkgYnJlYWtkb3duIHdpdGhpbiBwZXJpb2QKICBjb25zdCBtb250aGx5UmV2ID0ge307CiAgaW52cy5mb3JFYWNoKGludiA9PiB7CiAgICBjb25zdCBkID0gbmV3IERhdGUoaW52LmlzX3ZhbGlkX2Zyb20pOwogICAgY29uc3Qga2V5ID0gYCR7ZC5nZXRGdWxsWWVhcigpfS0ke1N0cmluZyhkLmdldE1vbnRoKCkrMSkucGFkU3RhcnQoMiwnMCcpfWA7CiAgICBtb250aGx5UmV2W2tleV0gPSAobW9udGhseVJldltrZXldIHx8IDApICsgcGFyc2VGbG9hdChpbnYudG90YWxfbmV0IHx8IDApOwogIH0pOwoKICByZXR1cm4geyByZXZlbnVlLCBjb3VudCwgYXZnLCBjdXN0b21lcnM6IGN1c3RzLnNpemUsIHFUb3RhbCwgcUFjY2VwdGVkLCBxQ29udiwgZHNvLCBkc29Db3VudCwgdG9wQ3VzdCwgbW9udGhseVJldiB9Owp9Cgphc3luYyBmdW5jdGlvbiBydW5Db21wYXJpc29uKCkgewogIGlmIChwZXJpb2RzLmxlbmd0aCA8IDIpIHJldHVybjsKCiAgY29uc3QgcmVzdWx0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyZXN1bHRzIik7CiAgcmVzdWx0cy5pbm5lckhUTUwgPSBgPGRpdiBjbGFzcz0ibG9hZGluZyI+PGRpdiBjbGFzcz0ic3Bpbm5lciI+PC9kaXY+PHNwYW4gc3R5bGU9ImNvbG9yOiAjNGVjZGM0OyI+TGFkZSAmIGJlcmVjaG5lLi4uPC9zcGFuPjwvZGl2PmA7CgogIGNvbnN0IGRhdGEgPSBhd2FpdCBsb2FkRGF0YSgpOwogIGNvbnN0IHN0YXRzID0gcGVyaW9kcy5tYXAocCA9PiAoeyAuLi5wLCBzdGF0czogY29tcHV0ZVBlcmlvZFN0YXRzKGRhdGEsIHApIH0pKTsKCiAgLy8gRGVzdHJveSBvbGQgY2hhcnRzCiAgT2JqZWN0LnZhbHVlcyhjaGFydEluc3RhbmNlcykuZm9yRWFjaChjID0+IGMuZGVzdHJveSgpKTsKICBjaGFydEluc3RhbmNlcyA9IHt9OwoKICByZW5kZXJSZXN1bHRzKHN0YXRzLCBkYXRhLmNtKTsKfQoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIFJFU1VMVFMgUkVOREVSSU5HCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAoKZnVuY3Rpb24gcmVuZGVyUmVzdWx0cyhzdGF0cywgY20pIHsKICBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyZXN1bHRzIik7CgogIC8vIEJlc3QgcGVyaW9kIGZvciBlYWNoIG1ldHJpYwogIGNvbnN0IGJlc3RSZXYgPSBNYXRoLm1heCguLi5zdGF0cy5tYXAocyA9PiBzLnN0YXRzLnJldmVudWUpKTsKICBjb25zdCBiZXN0QXZnID0gTWF0aC5tYXgoLi4uc3RhdHMubWFwKHMgPT4gcy5zdGF0cy5hdmcpKTsKICBjb25zdCBiZXN0RHNvID0gTWF0aC5taW4oLi4uc3RhdHMuZmlsdGVyKHMgPT4gcy5zdGF0cy5kc28gPiAwKS5tYXAocyA9PiBzLnN0YXRzLmRzbykpIHx8IDA7CiAgY29uc3QgYmVzdENvbnYgPSBNYXRoLm1heCguLi5zdGF0cy5tYXAocyA9PiBzLnN0YXRzLnFDb252KSk7CgogIC8vIENvbXBhcmlzb24gdGFibGUgcm93cwogIGNvbnN0IG1ldHJpY3MgPSBbCiAgICB7IGxhYmVsOiAiVW1zYXR6IChOZXR0bykiLCBrZXk6ICJyZXZlbnVlIiwgZm10OiBmb3JtYXRDSEYsIGJlc3Q6ICJtYXgiIH0sCiAgICB7IGxhYmVsOiAiQW56YWhsIFJlY2hudW5nZW4iLCBrZXk6ICJjb3VudCIsIGZtdDogZm9ybWF0TnVtLCBiZXN0OiAibWF4IiB9LAogICAgeyBsYWJlbDogIsOYIFJlY2hudW5nc2JldHJhZyIsIGtleTogImF2ZyIsIGZtdDogZm9ybWF0Q0hGLCBiZXN0OiAibWF4IiB9LAogICAgeyBsYWJlbDogIkFrdGl2ZSBLdW5kZW4iLCBrZXk6ICJjdXN0b21lcnMiLCBmbXQ6IGZvcm1hdE51bSwgYmVzdDogIm1heCIgfSwKICAgIHsgbGFiZWw6ICJPZmZlcnRlbiBUb3RhbCIsIGtleTogInFUb3RhbCIsIGZtdDogZm9ybWF0TnVtLCBiZXN0OiAibWF4IiB9LAogICAgeyBsYWJlbDogIk9mZmVydGVuIGFuZ2Vub21tZW4iLCBrZXk6ICJxQWNjZXB0ZWQiLCBmbXQ6IGZvcm1hdE51bSwgYmVzdDogIm1heCIgfSwKICAgIHsgbGFiZWw6ICJPZmZlcnQtUXVvdGUiLCBrZXk6ICJxQ29udiIsIGZtdDogdiA9PiB2LnRvRml4ZWQoMSkgKyAiJSIsIGJlc3Q6ICJtYXgiIH0sCiAgICB7IGxhYmVsOiAiw5ggWmFobHVuZ3NmcmlzdCIsIGtleTogImRzbyIsIGZtdDogdiA9PiB2ID4gMCA/IHYudG9GaXhlZCgwKSArICIgVGFnZSIgOiAi4oCTIiwgYmVzdDogIm1pbiIgfSwKICBdOwoKICBjb25zdCB0YWJsZUhlYWRlciA9IGA8dGggY2xhc3M9Im1vbm8gbGFiZWwiPktlbm56YWhsPC90aD5gICsgc3RhdHMubWFwKHMgPT4KICAgIGA8dGggY2xhc3M9Im1vbm8gbnVtIiBzdHlsZT0iY29sb3I6ICR7cy5jb2xvcn07Ij4ke3MubGFiZWx9PC90aD5gCiAgKS5qb2luKCIiKSArIGA8dGggY2xhc3M9Im1vbm8gbnVtIj7OlDwvdGg+YDsKCiAgY29uc3QgdGFibGVSb3dzID0gbWV0cmljcy5tYXAobSA9PiB7CiAgICBjb25zdCB2YWxzID0gc3RhdHMubWFwKHMgPT4gcy5zdGF0c1ttLmtleV0pOwogICAgY29uc3QgYmVzdCA9IG0uYmVzdCA9PT0gIm1heCIgPyBNYXRoLm1heCguLi52YWxzKSA6IE1hdGgubWluKC4uLnZhbHMuZmlsdGVyKHYgPT4gdiA+IDApKTsKICAgIGNvbnN0IGZpcnN0ID0gdmFsc1swXSwgbGFzdCA9IHZhbHNbdmFscy5sZW5ndGggLSAxXTsKICAgIGxldCBkZWx0YSA9ICIiOwogICAgaWYgKG0ua2V5ID09PSAiZHNvIikgewogICAgICBpZiAoZmlyc3QgPiAwICYmIGxhc3QgPiAwKSB7CiAgICAgICAgY29uc3QgZGlmZiA9IGxhc3QgLSBmaXJzdDsKICAgICAgICBkZWx0YSA9IGA8c3BhbiBjbGFzcz0iJHtkaWZmIDwgMCA/ICdncmVlbicgOiBkaWZmID4gMCA/ICdyZWQnIDogJyd9Ij4ke2RpZmYgPiAwID8gJysnIDogJyd9JHtkaWZmLnRvRml4ZWQoMCl9IFQ8L3NwYW4+YDsKICAgICAgfQogICAgfSBlbHNlIGlmIChtLmtleSA9PT0gInFDb252IikgewogICAgICBjb25zdCBkaWZmID0gbGFzdCAtIGZpcnN0OwogICAgICBkZWx0YSA9IGA8c3BhbiBjbGFzcz0iJHtkaWZmID4gMCA/ICdncmVlbicgOiBkaWZmIDwgMCA/ICdyZWQnIDogJyd9Ij4ke2RpZmYgPiAwID8gJysnIDogJyd9JHtkaWZmLnRvRml4ZWQoMSl9JTwvc3Bhbj5gOwogICAgfSBlbHNlIGlmIChmaXJzdCA+IDApIHsKICAgICAgY29uc3QgcGN0RGlmZiA9ICgobGFzdCAtIGZpcnN0KSAvIGZpcnN0ICogMTAwKTsKICAgICAgZGVsdGEgPSBgPHNwYW4gY2xhc3M9IiR7cGN0RGlmZiA+IDAgPyAnZ3JlZW4nIDogcGN0RGlmZiA8IDAgPyAncmVkJyA6ICcnfSI+JHtwY3REaWZmID4gMCA/ICcrJyA6ICcnfSR7cGN0RGlmZi50b0ZpeGVkKDEpfSU8L3NwYW4+YDsKICAgIH0KCiAgICByZXR1cm4gYDx0cj4KICAgICAgPHRkIGNsYXNzPSJsYWJlbCBtb25vIj4ke20ubGFiZWx9PC90ZD4KICAgICAgJHt2YWxzLm1hcCgodiwgaSkgPT4gewogICAgICAgIGNvbnN0IGlzQmVzdCA9IG0uYmVzdCA9PT0gIm1heCIgPyB2ID09PSBiZXN0ICYmIHYgPiAwIDogdiA9PT0gYmVzdCAmJiB2ID4gMDsKICAgICAgICByZXR1cm4gYDx0ZCBjbGFzcz0ibnVtIG1vbm8iIHN0eWxlPSIke2lzQmVzdCA/ICdjb2xvcjogIzRlY2RjNDsgZm9udC13ZWlnaHQ6IDcwMDsnIDogJyd9Ij4ke20uZm10KHYpfTwvdGQ+YDsKICAgICAgfSkuam9pbigiIil9CiAgICAgIDx0ZCBjbGFzcz0ibnVtIG1vbm8iPiR7ZGVsdGF9PC90ZD4KICAgIDwvdHI+YDsKICB9KS5qb2luKCIiKTsKCiAgZWwuaW5uZXJIVE1MID0gYAogICAgPGRpdiBjbGFzcz0iZmFkZS1pbiI+CiAgICAgIDwhLS0gQ29tcGFyaXNvbiBUYWJsZSAtLT4KICAgICAgPGRpdiBjbGFzcz0ic2VjdGlvbi10aXRsZSBtb25vIj7wn5OKIEtlbm56YWhsZW4tVmVyZ2xlaWNoPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9InJlc3VsdC1jYXJkIiBzdHlsZT0iYmFja2dyb3VuZDogIzExMTgyMDsgYm9yZGVyOiAxcHggc29saWQgIzFhMjMzMjsgYm9yZGVyLXJhZGl1czogMTJweDsgcGFkZGluZzogMjBweDsgbWFyZ2luLWJvdHRvbTogMjRweDsgb3ZlcmZsb3cteDogYXV0bzsiPgogICAgICAgIDx0YWJsZSBjbGFzcz0iY29tcGFyZS10YWJsZSI+CiAgICAgICAgICA8dGhlYWQ+PHRyPiR7dGFibGVIZWFkZXJ9PC90cj48L3RoZWFkPgogICAgICAgICAgPHRib2R5PiR7dGFibGVSb3dzfTwvdGJvZHk+CiAgICAgICAgPC90YWJsZT4KICAgICAgPC9kaXY+CgogICAgICA8IS0tIENoYXJ0cyAtLT4KICAgICAgPGRpdiBjbGFzcz0ic2VjdGlvbi10aXRsZSBtb25vIj7wn5OIIFZpc3VhbGlzaWVydW5nZW48L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0icmVzdWx0LWdyaWQiPgogICAgICAgIDxkaXYgY2xhc3M9InJlc3VsdC1jYXJkIj4KICAgICAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LXRpdGxlIG1vbm8iPlVtc2F0ei1WZXJnbGVpY2g8L2Rpdj4KICAgICAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LXdyYXAiPjxjYW52YXMgaWQ9ImNtcFJldmVudWVDaGFydCI+PC9jYW52YXM+PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0icmVzdWx0LWNhcmQiPgogICAgICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtdGl0bGUgbW9ubyI+w5ggUmVjaG51bmdzYmV0cmFnPC9kaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJjaGFydC13cmFwIj48Y2FudmFzIGlkPSJjbXBBdmdDaGFydCI+PC9jYW52YXM+PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0icmVzdWx0LWNhcmQiPgogICAgICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtdGl0bGUgbW9ubyI+UmVjaG51bmdlbiAmIEt1bmRlbjwvZGl2PgogICAgICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtd3JhcCI+PGNhbnZhcyBpZD0iY21wQ291bnRDaGFydCI+PC9jYW52YXM+PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0icmVzdWx0LWNhcmQiPgogICAgICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtdGl0bGUgbW9ubyI+T2ZmZXJ0ZW4gJiBaYWhsdW5nc21vcmFsPC9kaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJjaGFydC13cmFwIj48Y2FudmFzIGlkPSJjbXBNaXhDaGFydCI+PC9jYW52YXM+PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgoKICAgICAgPCEtLSBUb3AgS3VuZGVuIHBlciBQZXJpb2QgLS0+CiAgICAgIDxkaXYgY2xhc3M9InNlY3Rpb24tdGl0bGUgbW9ubyI+8J+RpSBUb3AgS3VuZGVuIHBybyBQZXJpb2RlPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9InJlc3VsdC1ncmlkIj4KICAgICAgICAke3N0YXRzLm1hcChzID0+IGAKICAgICAgICAgIDxkaXYgY2xhc3M9InJlc3VsdC1jYXJkIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtdGl0bGUgbW9ubyIgc3R5bGU9ImNvbG9yOiAke3MuY29sb3J9OyI+JHtzLmxhYmVsfTwvZGl2PgogICAgICAgICAgICAke3Muc3RhdHMudG9wQ3VzdC5sZW5ndGggPT09IDAgPyAnPGRpdiBzdHlsZT0iY29sb3I6ICMzYTRhNWE7IGZvbnQtc2l6ZTogMTNweDsiPktlaW5lIERhdGVuPC9kaXY+JyA6CiAgICAgICAgICAgICAgcy5zdGF0cy50b3BDdXN0Lm1hcCgoYywgaSkgPT4gYAogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTogZmxleDsganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOyBwYWRkaW5nOiA2cHggMDsgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICMwZjE2MjA7Ij4KICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im1vbm8iIHN0eWxlPSJmb250LXNpemU6IDEycHg7IGNvbG9yOiAjOGE5YWFhOyI+PHNwYW4gc3R5bGU9ImNvbG9yOiAjM2E0YTVhOyBtYXJnaW4tcmlnaHQ6IDZweDsiPiR7aSsxfS48L3NwYW4+JHsoY21bYy5pZF0gfHwgJyMnK2MuaWQpLnN1YnN0cmluZygwLCAyNSl9PC9zcGFuPgogICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ibW9ubyIgc3R5bGU9ImZvbnQtc2l6ZTogMTJweDsgZm9udC13ZWlnaHQ6IDYwMDsgY29sb3I6ICR7cy5jb2xvcn07Ij4ke2Zvcm1hdENIRihjLnRvdGFsKX08L3NwYW4+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICBgKS5qb2luKCIiKQogICAgICAgICAgICB9CiAgICAgICAgICA8L2Rpdj4KICAgICAgICBgKS5qb2luKCIiKX0KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KICBgOwoKICAvLyBEcmF3IGNvbXBhcmlzb24gY2hhcnRzCiAgZHJhd0NtcFJldmVudWVDaGFydChzdGF0cyk7CiAgZHJhd0NtcEF2Z0NoYXJ0KHN0YXRzKTsKICBkcmF3Q21wQ291bnRDaGFydChzdGF0cyk7CiAgZHJhd0NtcE1peENoYXJ0KHN0YXRzKTsKfQoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIENPTVBBUklTT04gQ0hBUlRTCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAoKY29uc3QgY0RlZnMgPSB7CiAgcmVzcG9uc2l2ZTogdHJ1ZSwgbWFpbnRhaW5Bc3BlY3RSYXRpbzogZmFsc2UsCiAgcGx1Z2luczogeyB0b29sdGlwOiB7CiAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjMWEyMzMyJywgYm9yZGVyQ29sb3I6ICcjMmEzYTRhJywgYm9yZGVyV2lkdGg6IDEsCiAgICB0aXRsZUZvbnQ6IHsgZmFtaWx5OiAiJ0pldEJyYWlucyBNb25vJyIgfSwgYm9keUZvbnQ6IHsgZmFtaWx5OiAiJ0pldEJyYWlucyBNb25vJyIgfSwKICB9fSwKfTsKY29uc3QgYXhEZWYgPSB7CiAgeDogeyBncmlkOiB7IGRpc3BsYXk6IGZhbHNlIH0sIHRpY2tzOiB7IGNvbG9yOiAnIzRhNWE2YScsIGZvbnQ6IHsgZmFtaWx5OiAiJ0pldEJyYWlucyBNb25vJyIsIHNpemU6IDExIH0gfSB9LAogIHk6IHsgZ3JpZDogeyBjb2xvcjogJyMxYTIzMzInIH0sIHRpY2tzOiB7IGNvbG9yOiAnIzNhNGE1YScsIGZvbnQ6IHsgZmFtaWx5OiAiJ0pldEJyYWlucyBNb25vJyIsIHNpemU6IDEwIH0gfSB9Cn07CgpmdW5jdGlvbiBkcmF3Q21wUmV2ZW51ZUNoYXJ0KHN0YXRzKSB7CiAgY29uc3QgY3R4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NtcFJldmVudWVDaGFydCcpOyBpZiAoIWN0eCkgcmV0dXJuOwogIGNoYXJ0SW5zdGFuY2VzLnJldiA9IG5ldyBDaGFydChjdHgsIHsKICAgIHR5cGU6ICdiYXInLAogICAgZGF0YTogewogICAgICBsYWJlbHM6IHN0YXRzLm1hcChzID0+IHMubGFiZWwpLAogICAgICBkYXRhc2V0czogW3sgZGF0YTogc3RhdHMubWFwKHMgPT4gcy5zdGF0cy5yZXZlbnVlKSwgYmFja2dyb3VuZENvbG9yOiBzdGF0cy5tYXAocyA9PiBzLmNvbG9yKSwKICAgICAgICBib3JkZXJSYWRpdXM6IDYsIGJvcmRlclNraXBwZWQ6IGZhbHNlLCBtYXhCYXJUaGlja25lc3M6IDgwIH1dCiAgICB9LAogICAgb3B0aW9uczogeyAuLi5jRGVmcywgcGx1Z2luczogeyAuLi5jRGVmcy5wbHVnaW5zLCBsZWdlbmQ6IHsgZGlzcGxheTogZmFsc2UgfSwKICAgICAgdG9vbHRpcDogeyAuLi5jRGVmcy5wbHVnaW5zLnRvb2x0aXAsIGNhbGxiYWNrczogeyBsYWJlbDogYyA9PiBmb3JtYXRDSEYoYy5yYXcpIH0gfSB9LAogICAgICBzY2FsZXM6IHsgLi4uYXhEZWYsIHk6IHsgLi4uYXhEZWYueSwgdGlja3M6IHsgLi4uYXhEZWYueS50aWNrcywgY2FsbGJhY2s6IHYgPT4gZm9ybWF0Q0hGKHYpIH0gfSB9IH0KICB9KTsKfQoKZnVuY3Rpb24gZHJhd0NtcEF2Z0NoYXJ0KHN0YXRzKSB7CiAgY29uc3QgY3R4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NtcEF2Z0NoYXJ0Jyk7IGlmICghY3R4KSByZXR1cm47CiAgY2hhcnRJbnN0YW5jZXMuYXZnID0gbmV3IENoYXJ0KGN0eCwgewogICAgdHlwZTogJ2JhcicsCiAgICBkYXRhOiB7CiAgICAgIGxhYmVsczogc3RhdHMubWFwKHMgPT4gcy5sYWJlbCksCiAgICAgIGRhdGFzZXRzOiBbeyBkYXRhOiBzdGF0cy5tYXAocyA9PiBzLnN0YXRzLmF2ZyksIGJhY2tncm91bmRDb2xvcjogc3RhdHMubWFwKHMgPT4gcy5jb2xvciArICc5MCcpLAogICAgICAgIGJvcmRlckNvbG9yOiBzdGF0cy5tYXAocyA9PiBzLmNvbG9yKSwgYm9yZGVyV2lkdGg6IDIsIGJvcmRlclJhZGl1czogNiwgYm9yZGVyU2tpcHBlZDogZmFsc2UsIG1heEJhclRoaWNrbmVzczogODAgfV0KICAgIH0sCiAgICBvcHRpb25zOiB7IC4uLmNEZWZzLCBwbHVnaW5zOiB7IC4uLmNEZWZzLnBsdWdpbnMsIGxlZ2VuZDogeyBkaXNwbGF5OiBmYWxzZSB9LAogICAgICB0b29sdGlwOiB7IC4uLmNEZWZzLnBsdWdpbnMudG9vbHRpcCwgY2FsbGJhY2tzOiB7IGxhYmVsOiBjID0+IGDDmCAke2Zvcm1hdENIRihjLnJhdyl9YCB9IH0gfSwKICAgICAgc2NhbGVzOiB7IC4uLmF4RGVmLCB5OiB7IC4uLmF4RGVmLnksIHRpY2tzOiB7IC4uLmF4RGVmLnkudGlja3MsIGNhbGxiYWNrOiB2ID0+IGZvcm1hdENIRih2KSB9IH0gfSB9CiAgfSk7Cn0KCmZ1bmN0aW9uIGRyYXdDbXBDb3VudENoYXJ0KHN0YXRzKSB7CiAgY29uc3QgY3R4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NtcENvdW50Q2hhcnQnKTsgaWYgKCFjdHgpIHJldHVybjsKICBjaGFydEluc3RhbmNlcy5jbnQgPSBuZXcgQ2hhcnQoY3R4LCB7CiAgICB0eXBlOiAnYmFyJywKICAgIGRhdGE6IHsKICAgICAgbGFiZWxzOiBzdGF0cy5tYXAocyA9PiBzLmxhYmVsKSwKICAgICAgZGF0YXNldHM6IFsKICAgICAgICB7IGxhYmVsOiAnUmVjaG51bmdlbicsIGRhdGE6IHN0YXRzLm1hcChzID0+IHMuc3RhdHMuY291bnQpLCBiYWNrZ3JvdW5kQ29sb3I6IHN0YXRzLm1hcChzID0+IHMuY29sb3IpLCBib3JkZXJSYWRpdXM6IDQsIGJvcmRlclNraXBwZWQ6IGZhbHNlIH0sCiAgICAgICAgeyBsYWJlbDogJ0t1bmRlbicsIGRhdGE6IHN0YXRzLm1hcChzID0+IHMuc3RhdHMuY3VzdG9tZXJzKSwgYmFja2dyb3VuZENvbG9yOiBzdGF0cy5tYXAocyA9PiBzLmNvbG9yICsgJzUwJyksCiAgICAgICAgICBib3JkZXJDb2xvcjogc3RhdHMubWFwKHMgPT4gcy5jb2xvciksIGJvcmRlcldpZHRoOiAxLCBib3JkZXJSYWRpdXM6IDQsIGJvcmRlclNraXBwZWQ6IGZhbHNlIH0sCiAgICAgIF0KICAgIH0sCiAgICBvcHRpb25zOiB7IC4uLmNEZWZzLCBwbHVnaW5zOiB7CiAgICAgIGxlZ2VuZDogeyBkaXNwbGF5OiB0cnVlLCBwb3NpdGlvbjogJ3RvcCcsIGxhYmVsczogeyBjb2xvcjogJyM1YTZhN2EnLCBmb250OiB7IGZhbWlseTogIidKZXRCcmFpbnMgTW9ubyciLCBzaXplOiAxMCB9LCBib3hXaWR0aDogMTIsIHBhZGRpbmc6IDEyIH0gfSwKICAgICAgdG9vbHRpcDogeyAuLi5jRGVmcy5wbHVnaW5zLnRvb2x0aXAgfSB9LAogICAgICBzY2FsZXM6IGF4RGVmIH0KICB9KTsKfQoKZnVuY3Rpb24gZHJhd0NtcE1peENoYXJ0KHN0YXRzKSB7CiAgY29uc3QgY3R4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NtcE1peENoYXJ0Jyk7IGlmICghY3R4KSByZXR1cm47CiAgY2hhcnRJbnN0YW5jZXMubWl4ID0gbmV3IENoYXJ0KGN0eCwgewogICAgdHlwZTogJ2JhcicsCiAgICBkYXRhOiB7CiAgICAgIGxhYmVsczogc3RhdHMubWFwKHMgPT4gcy5sYWJlbCksCiAgICAgIGRhdGFzZXRzOiBbCiAgICAgICAgeyBsYWJlbDogJ09mZmVydC1RdW90ZSAlJywgZGF0YTogc3RhdHMubWFwKHMgPT4gcy5zdGF0cy5xQ29udiksIGJhY2tncm91bmRDb2xvcjogJyM0YTkwZDknLCBib3JkZXJSYWRpdXM6IDQsIGJvcmRlclNraXBwZWQ6IGZhbHNlLCB5QXhpc0lEOiAneScgfSwKICAgICAgICB7IGxhYmVsOiAnw5ggWmFobHVuZ3NmcmlzdCAoVGFnZSknLCBkYXRhOiBzdGF0cy5tYXAocyA9PiBzLnN0YXRzLmRzbyksIGJhY2tncm91bmRDb2xvcjogJyNlOGE1NGInLCBib3JkZXJSYWRpdXM6IDQsIGJvcmRlclNraXBwZWQ6IGZhbHNlLCB5QXhpc0lEOiAneTEnIH0sCiAgICAgIF0KICAgIH0sCiAgICBvcHRpb25zOiB7IC4uLmNEZWZzLCBwbHVnaW5zOiB7CiAgICAgIGxlZ2VuZDogeyBkaXNwbGF5OiB0cnVlLCBwb3NpdGlvbjogJ3RvcCcsIGxhYmVsczogeyBjb2xvcjogJyM1YTZhN2EnLCBmb250OiB7IGZhbWlseTogIidKZXRCcmFpbnMgTW9ubyciLCBzaXplOiAxMCB9LCBib3hXaWR0aDogMTIsIHBhZGRpbmc6IDEyIH0gfSwKICAgICAgdG9vbHRpcDogeyAuLi5jRGVmcy5wbHVnaW5zLnRvb2x0aXAgfSB9LAogICAgICBzY2FsZXM6IHsKICAgICAgICAuLi5heERlZiwKICAgICAgICB5OiB7IC4uLmF4RGVmLnksIHBvc2l0aW9uOiAnbGVmdCcsIHRpdGxlOiB7IGRpc3BsYXk6IHRydWUsIHRleHQ6ICdRdW90ZSAlJywgY29sb3I6ICcjNGE5MGQ5JywgZm9udDogeyBmYW1pbHk6ICInSmV0QnJhaW5zIE1vbm8nIiwgc2l6ZTogMTAgfSB9IH0sCiAgICAgICAgeTE6IHsgLi4uYXhEZWYueSwgcG9zaXRpb246ICdyaWdodCcsIGdyaWQ6IHsgZGlzcGxheTogZmFsc2UgfSwgdGl0bGU6IHsgZGlzcGxheTogdHJ1ZSwgdGV4dDogJ1RhZ2UnLCBjb2xvcjogJyNlOGE1NGInLCBmb250OiB7IGZhbWlseTogIidKZXRCcmFpbnMgTW9ubyciLCBzaXplOiAxMCB9IH0gfSwKICAgICAgfSB9CiAgfSk7Cn0KCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovLyBJTklUCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAoKcG9wdWxhdGVZZWFyU2VsZWN0cygpOwoKLy8gQXV0by1hZGQgYSB1c2VmdWwgZGVmYXVsdDogbGFzdCAzIFExcwpjb25zdCBjdXJZZWFyID0gbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpOwpjb25zdCBjdXJRID0gTWF0aC5mbG9vcihuZXcgRGF0ZSgpLmdldE1vbnRoKCkgLyAzKSArIDE7Cjwvc2NyaXB0Pgo8L2JvZHk+CjwvaHRtbD4K'
};
PAGES_B64['/index.html'] = PAGES_B64['/'];

function decodePage(key) {
  const b64 = PAGES_B64[key];
  if (!b64) return null;
  return Buffer.from(b64, 'base64').toString('utf8');
}

module.exports = async (req, res) => {
  const cookies = cookie.parse(req.headers.cookie || '');
  const token = cookies[COOKIE_NAME];
  const isAuth = verifyToken(token);

  let reqPath = req.url.split('?')[0];
  if (reqPath === '' || reqPath === '/') reqPath = '/';

  if (!isAuth) {
    res.setHeader('Content-Type', 'text/html; charset=utf-8');
    return res.status(200).send(getLoginPage());
  }

  const page = decodePage(reqPath) || decodePage('/');
  if (page) {
    res.setHeader('Content-Type', 'text/html; charset=utf-8');
    return res.status(200).send(page);
  }

  return res.status(404).send('Not found');
};
